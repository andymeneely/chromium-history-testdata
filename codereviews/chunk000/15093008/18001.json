{"files":{"tools/telemetry/telemetry/core/platform/profiler/profiler_finder.py":{"status":"M","num_chunks":1,"no_base_file":false,"property_changes":"","num_added":7,"num_removed":4,"messages":[],"id":19002,"is_binary":false},"tools/perf/perf_tools/memory_measurement.py":{"status":"M","num_chunks":3,"no_base_file":false,"property_changes":"","num_added":12,"num_removed":0,"messages":[{"author":"tonyg","author_email":"tonyg@chromium.org","text":"I don't like this code in the MemoryMeasurement because it means tcmalloc-heap doesn't work with other measurements. Is there a way we can push this into the Profiler?","draft":false,"lineno":60,"date":"2013-05-14 16:52:44.842510","left":false},{"author":"Dai Mikurube","author_email":"dmikurube@chromium.org","text":"Ah, I thought that this condition can coexist with chrome && ... && chrome.memoryBenchmarking.isHeapProfilerRunning().","draft":false,"lineno":52,"date":"2013-05-14 17:02:10.705140","left":false},{"author":"bulach","author_email":"bulach@chromium.org","text":"On 2013/05/14 16:52:44, tonyg wrote:\n> I don't like this code in the MemoryMeasurement because it means tcmalloc-heap\n> doesn't work with other measurements. Is there a way we can push this into the\n> Profiler?\n\n\"it's complicated\" :)\n- Profiler knows nothing about tab, or browser, and that's probably for good.\n\n- tcmalloc will dump the heap at regular intervals, for any measurement, by using --profiler=tcmalloc-heap.. this is just a \"minor\" optimization to ensure that the _last_ dump is actually made, which seems to make sense in \"memory_measurment.py\", no?\n\n- at most, other measurements would loose up to the last \"interval\" dump.. \n\nso whilst I agree it'd be nice to push this to profiler, would you be ok doing as a separate patch?\n\n\n","draft":false,"lineno":60,"date":"2013-05-14 17:54:47.486980","left":false},{"author":"tonyg","author_email":"tonyg@chromium.org","text":"Please use json instead of eval","draft":false,"lineno":53,"date":"2013-05-14 18:54:13.620510","left":false},{"author":"tonyg","author_email":"tonyg@chromium.org","text":"On 2013/05/14 17:54:47, bulach wrote:\n> On 2013/05/14 16:52:44, tonyg wrote:\n> > I don't like this code in the MemoryMeasurement because it means tcmalloc-heap\n> > doesn't work with other measurements. Is there a way we can push this into the\n> > Profiler?\n> \n> \"it's complicated\" :)\n> - Profiler knows nothing about tab, or browser, and that's probably for good.\n> \n> - tcmalloc will dump the heap at regular intervals, for any measurement, by\n> using --profiler=tcmalloc-heap.. this is just a \"minor\" optimization to ensure\n> that the _last_ dump is actually made, which seems to make sense in\n> \"memory_measurment.py\", no?\n> \n> - at most, other measurements would loose up to the last \"interval\" dump.. \n> \n> so whilst I agree it'd be nice to push this to profiler, would you be ok doing\n> as a separate patch?\n> \n> \n\nHow long is the interval? If it is sufficiently short, should we just remove this code from memory_measurement? In any case, it seems like we don't need the print line because the profiler is guaranteed to print that out in collect profiler. Also, if you decide to keep this, please add a comment explaining that this is a minor optimization to ensure the last dump is made.","draft":false,"lineno":60,"date":"2013-05-14 18:54:13.620790","left":false},{"author":"bulach","author_email":"bulach@chromium.org","text":"On 2013/05/14 18:54:13, tonyg wrote:\n> Please use json instead of eval\n\nDone.","draft":false,"lineno":53,"date":"2013-05-15 10:22:56.109150","left":false},{"author":"bulach","author_email":"bulach@chromium.org","text":"On 2013/05/14 18:54:13, tonyg wrote:\n> On 2013/05/14 17:54:47, bulach wrote:\n> > On 2013/05/14 16:52:44, tonyg wrote:\n> > > I don't like this code in the MemoryMeasurement because it means\n> tcmalloc-heap\n> > > doesn't work with other measurements. Is there a way we can push this into\n> the\n> > > Profiler?\n> > \n> > \"it's complicated\" :)\n> > - Profiler knows nothing about tab, or browser, and that's probably for good.\n> > \n> > - tcmalloc will dump the heap at regular intervals, for any measurement, by\n> > using --profiler=tcmalloc-heap.. this is just a \"minor\" optimization to ensure\n> > that the _last_ dump is actually made, which seems to make sense in\n> > \"memory_measurment.py\", no?\n> > \n> > - at most, other measurements would loose up to the last \"interval\" dump.. \n> > \n> > so whilst I agree it'd be nice to push this to profiler, would you be ok doing\n> > as a separate patch?\n> > \n> > \n> \n> How long is the interval? If it is sufficiently short, should we just remove\n> this code from memory_measurement? In any case, it seems like we don't need the\n> print line because the profiler is guaranteed to print that out in collect\n> profiler. Also, if you decide to keep this, please add a comment explaining that\n> this is a minor optimization to ensure the last dump is made.\n\nthe interval is relatively large right now. it takes a couple of secs to dump the files, so in reality it has to be >=5secs..\nI added a comment explaining this.\nalso, the file names seem indeed irrelevant, so I removed the print, eval, etc..\n\nsee more discussion on the underlying layer here:\nhttps://codereview.chromium.org/15082004/","draft":false,"lineno":60,"date":"2013-05-15 10:22:56.109580","left":false}],"id":19001,"is_binary":false},"tools/telemetry/telemetry/core/platform/profiler/tcmalloc_heap_profiler.py":{"status":"A","num_chunks":1,"no_base_file":false,"property_changes":"","num_added":125,"num_removed":0,"messages":[{"author":"tonyg","author_email":"tonyg@chromium.org","text":"Can these just implement object instead of Profiler and drop the is_supported and name methods? It seems like TCMallocHeapProfiler has the Profiler interface covered.","draft":false,"lineno":18,"date":"2013-05-14 16:52:44.842800","left":false},{"author":"tonyg","author_email":"tonyg@chromium.org","text":"I didn't double check, but can't we get an existing adb_commands object from the platform_backend or something?","draft":false,"lineno":35,"date":"2013-05-14 16:52:44.843090","left":false},{"author":"tonyg","author_email":"tonyg@chromium.org","text":"logging.info?","draft":false,"lineno":41,"date":"2013-05-14 16:52:44.843370","left":false},{"author":"tonyg","author_email":"tonyg@chromium.org","text":"Why do we have to run again? Can we do Browser.close() or something instead?","draft":false,"lineno":45,"date":"2013-05-14 16:52:44.843670","left":false},{"author":"tonyg","author_email":"tonyg@chromium.org","text":"Is this print necessary since it will be pulled to the host?","draft":false,"lineno":59,"date":"2013-05-14 16:52:44.843900","left":false},{"author":"tonyg","author_email":"tonyg@chromium.org","text":"Again, let's try to reuse adb_commands if possible.","draft":false,"lineno":60,"date":"2013-05-14 16:52:44.844080","left":false},{"author":"tonyg","author_email":"tonyg@chromium.org","text":"What does the dict() wrapper do? Isn't it already a dict?","draft":false,"lineno":74,"date":"2013-05-14 16:52:44.844230","left":false},{"author":"tonyg","author_email":"tonyg@chromium.org","text":"Should we check isdir() as well?","draft":false,"lineno":85,"date":"2013-05-14 16:52:44.844410","left":false},{"author":"tonyg","author_email":"tonyg@chromium.org","text":"drop the parens. Also, I think we normally do startswith('linux') instead of == 'linux2'.","draft":false,"lineno":118,"date":"2013-05-14 16:52:44.844570","left":false},{"author":"tonyg","author_email":"tonyg@chromium.org","text":"Do we need to throw in an:\n\nif options.browser_type.startswith('cros'):\n  return False","draft":false,"lineno":120,"date":"2013-05-14 16:52:44.844760","left":false},{"author":"tonyg","author_email":"tonyg@chromium.org","text":"These is_supported calls are no-ops. I'd just return True.","draft":false,"lineno":122,"date":"2013-05-14 16:52:44.845070","left":false},{"author":"bulach","author_email":"bulach@chromium.org","text":"On 2013/05/14 16:52:44, tonyg wrote:\n> Can these just implement object instead of Profiler and drop the is_supported\n> and name methods? It seems like TCMallocHeapProfiler has the Profiler interface\n> covered.\n\noh, much nicer! done.","draft":false,"lineno":18,"date":"2013-05-14 17:54:47.487360","left":false},{"author":"bulach","author_email":"bulach@chromium.org","text":"On 2013/05/14 16:52:44, tonyg wrote:\n> I didn't double check, but can't we get an existing adb_commands object from the\n> platform_backend or something?\n\nDone.","draft":false,"lineno":35,"date":"2013-05-14 17:54:47.487670","left":false},{"author":"bulach","author_email":"bulach@chromium.org","text":"On 2013/05/14 16:52:44, tonyg wrote:\n> logging.info?\n\nDone.","draft":false,"lineno":41,"date":"2013-05-14 17:54:47.487970","left":false},{"author":"bulach","author_email":"bulach@chromium.org","text":"On 2013/05/14 16:52:44, tonyg wrote:\n> Why do we have to run again? Can we do Browser.close() or something instead?\n\nI think at this stage where the profiler has been created is already too late to mess up with the browser...","draft":false,"lineno":45,"date":"2013-05-14 17:54:47.488290","left":false},{"author":"bulach","author_email":"bulach@chromium.org","text":"On 2013/05/14 16:52:44, tonyg wrote:\n> Is this print necessary since it will be pulled to the host?\n\nDone.","draft":false,"lineno":59,"date":"2013-05-14 17:54:47.488600","left":false},{"author":"bulach","author_email":"bulach@chromium.org","text":"On 2013/05/14 16:52:44, tonyg wrote:\n> Again, let's try to reuse adb_commands if possible.\n\nDone.","draft":false,"lineno":60,"date":"2013-05-14 17:54:47.488890","left":false},{"author":"bulach","author_email":"bulach@chromium.org","text":"On 2013/05/14 16:52:44, tonyg wrote:\n> What does the dict() wrapper do? Isn't it already a dict?\n\nat some point I did that in the classmethod and didn't want to mess up with the \"singleton\", so dict() makes a copy of it..\nno longer necessary, removed here and above.","draft":false,"lineno":74,"date":"2013-05-14 17:54:47.489210","left":false},{"author":"bulach","author_email":"bulach@chromium.org","text":"On 2013/05/14 16:52:44, tonyg wrote:\n> Should we check isdir() as well?\n\nadding an assertion below.","draft":false,"lineno":85,"date":"2013-05-14 17:54:47.489510","left":false},{"author":"bulach","author_email":"bulach@chromium.org","text":"On 2013/05/14 16:52:44, tonyg wrote:\n> drop the parens. Also, I think we normally do startswith('linux') instead of ==\n> 'linux2'.\n\nDone.","draft":false,"lineno":118,"date":"2013-05-14 17:54:47.489760","left":false},{"author":"bulach","author_email":"bulach@chromium.org","text":"On 2013/05/14 16:52:44, tonyg wrote:\n> drop the parens. Also, I think we normally do startswith('linux') instead of ==\n> 'linux2'.\n\nDone.","draft":false,"lineno":118,"date":"2013-05-14 17:54:47.490040","left":false},{"author":"bulach","author_email":"bulach@chromium.org","text":"On 2013/05/14 16:52:44, tonyg wrote:\n> Do we need to throw in an:\n> \n> if options.browser_type.startswith('cros'):\n>   return False\n\nDone.","draft":false,"lineno":120,"date":"2013-05-14 17:54:47.490360","left":false},{"author":"bulach","author_email":"bulach@chromium.org","text":"On 2013/05/14 16:52:44, tonyg wrote:\n> These is_supported calls are no-ops. I'd just return True.\n\nDone.","draft":false,"lineno":122,"date":"2013-05-14 17:54:47.490650","left":false},{"author":"tonyg","author_email":"tonyg@chromium.org","text":"On 2013/05/14 17:54:47, bulach wrote:\n> On 2013/05/14 16:52:44, tonyg wrote:\n> > Why do we have to run again? Can we do Browser.close() or something instead?\n> \n> I think at this stage where the profiler has been created is already too late to\n> mess up with the browser...\n\nYou are right, too bad.","draft":false,"lineno":45,"date":"2013-05-14 18:54:13.621080","left":false}],"id":19003,"is_binary":false}},"owner_email":"bulach@chromium.org","owner":"bulach","message":"TCMallocHeapProfiler","try_job_results":[],"created":"2013-05-14 15:32:58.061560","url":null,"num_comments":31,"modified":"2013-05-15 10:22:56.166900","patchset":18001,"issue":15093008}