{"description":"Added the ability launch multiple instances of the Chrome browser with flags.\nThe main purpose is to perform integration testing with sync where profiles are synced correctly across browsers.\nAdded one basic bookmark sync test: testAddBookmarkAndVerifySync\n\nTEST=none\nBUG=none\nCommitted: http://src.chromium.org/viewvc/chrome?view=rev&revision=108545","cc":["chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"reviewers":["dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org"],"messages":[{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","nirnimesh@chromium.org","jrg@chromium.org","anantha@chromium.org","dyu@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"I took the approach to add the test server, flags, syncing the account, and launching the new browser to pyauto.py so that anyone who wants to use the test server can create a test and use these functions. This is the ground work for writing integration tests with sync feature in pyAuto. This simplifies the process of having to setup and tear down in each test class.\n\nThe downside is the need to pass the '--http-xmpp-server' flag in __main__. The test server will be launched regardless which tests are run. Once the test completes than the server will be terminated. Those that need it will use it and others will not.\n\nIf this is a problem then I can move the launching and terminating of the server in the pyauto.PyUITest. Then whoever writes the tests will have to override setUp() and tearDown() in the test class in order to launch and terminate the server. \n\nI'm not sure if there may be tests that cannot tolerate while the server if running during execution that may give false results.","disapproval":false,"date":"2011-10-11 02:25:41.384603","approval":false},{"sender":"nirnimesh@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","nirnimesh@chromium.org","jrg@chromium.org","anantha@chromium.org","dyu@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"I haven't looked at the xmpp server code yet, but the code to launch additional browser can be simplified by using the remote feature dtu added recently. Adding him for comments.","disapproval":false,"date":"2011-10-11 18:31:46.241790","approval":false},{"sender":"dtu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","nirnimesh@chromium.org","jrg@chromium.org","anantha@chromium.org","dyu@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"You can launch an additional PyAuto/Browser instance by passing the --remote-host parameter:\n  python bookmarks.py --remote-host=localhost\nIt will automatically create an object to represent the remote instance and call setUp() and tearDown(). Instead of new_browser.CheckSyncAccount(), it would be self.remote.CheckSyncAccount().\n\nThe existing remote-host feature seems like it should work for this scenario, but there could be some limitations I've overlooked.","disapproval":false,"date":"2011-10-11 19:19:53.681281","approval":false},{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","nirnimesh@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"Can I pass any set of flags? It's not just connecting to a localhost but also I need to connect to the test sync server, which is done with the flag '--sync-allow-insecure-xmpp-connection' and '--sync-url=http://127.0.0.1:60625/chromiumsync'","disapproval":false,"date":"2011-10-11 19:34:09.647996","approval":false},{"sender":"rsimha@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","nirnimesh@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"First off, thanks a lot for doing this work :)\n\nI have some preliminary comments below.\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/functional/bookmarks.py\nFile chrome/test/functional/bookmarks.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/functional/bookmarks.py#newcode508\nchrome/test/functional/bookmarks.py:508: # Refresh the booksmarks in the first browser.\ns/booksmarks/bookmarks/\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/functional/bookmarks.py#newcode526\nchrome/test/functional/bookmarks.py:526: # |http://www.com|.\nThe bookmarks ought to be an exact match after they are synced. Are you observing a difference? (It could be a bug if you are.)\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py#newcode95\nchrome/test/pyautolib/pyauto.py:95: _HTTP_XMPP_SERVER = None\nCall this _SYNC_SERVER.\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py#newcode96\nchrome/test/pyautolib/pyauto.py:96: _HTTP_XMPP_SERVER_PORTS = {}\n_SYNC_SERVER_PORTS.\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py#newcode213\nchrome/test/pyautolib/pyauto.py:213: \nnit: Need only one blank line here.\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py#newcode214\nchrome/test/pyautolib/pyauto.py:214: def CheckSyncAccount(self, account_key):\nThe name CheckSyncAccount is a little ambiguous. How about calling this function SignInToSyncAndVerifyState?\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py#newcode224\nchrome/test/pyautolib/pyauto.py:224: self.NavigateToURL('about:sync')\nGetSyncInfo() grabs sync state directly from the ProfileSyncService. Navigating to about:sync here isn't a prerequisite. Any reason you think it's necessary?\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py#newcode229\nchrome/test/pyautolib/pyauto.py:229: self.assertTrue(self.GetSyncInfo()['last synced'] == 'Just now')\nThis seems to be copied from sync.py. It might make sense to replace the corresponding blocks in that file with a call to this function.\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py#newcode4366\nchrome/test/pyautolib/pyauto.py:4366: def _LaunchHTTPXMPPServer(self):\nCalling this method _LaunchPythonSyncServer() is probably more descriptive of what it does.  What do you think?\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py#newcode4367\nchrome/test/pyautolib/pyauto.py:4367: \"\"\"Launch the local HTTP-XMPP test server.\nSame comment as above. It's more descriptive to say that you're starting a python sync server.\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py#newcode4371\nchrome/test/pyautolib/pyauto.py:4371: propograted.\ns/propograted/propagated/","disapproval":false,"date":"2011-10-11 21:14:04.315276","approval":false},{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","nirnimesh@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"http://codereview.chromium.org/8224025/diff/1/chrome/test/functional/bookmarks.py\nFile chrome/test/functional/bookmarks.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/functional/bookmarks.py#newcode508\nchrome/test/functional/bookmarks.py:508: # Refresh the booksmarks in the first browser.\nOn 2011/10/11 21:14:04, rsimha wrote:\n> s/booksmarks/bookmarks/\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/functional/bookmarks.py#newcode526\nchrome/test/functional/bookmarks.py:526: # |http://www.com|.\nI removed this as the synced URL is the same. \n\nOn 2011/10/11 21:14:04, rsimha wrote:\n> The bookmarks ought to be an exact match after they are synced. Are you\n> observing a difference? (It could be a bug if you are.)\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py#newcode95\nchrome/test/pyautolib/pyauto.py:95: _HTTP_XMPP_SERVER = None\nOn 2011/10/11 21:14:04, rsimha wrote:\n> Call this _SYNC_SERVER.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py#newcode96\nchrome/test/pyautolib/pyauto.py:96: _HTTP_XMPP_SERVER_PORTS = {}\nOn 2011/10/11 21:14:04, rsimha wrote:\n> _SYNC_SERVER_PORTS.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py#newcode213\nchrome/test/pyautolib/pyauto.py:213: \nOn 2011/10/11 21:14:04, rsimha wrote:\n> nit: Need only one blank line here.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py#newcode214\nchrome/test/pyautolib/pyauto.py:214: def CheckSyncAccount(self, account_key):\nOn 2011/10/11 21:14:04, rsimha wrote:\n> The name CheckSyncAccount is a little ambiguous. How about calling this function\n> SignInToSyncAndVerifyState?\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py#newcode224\nchrome/test/pyautolib/pyauto.py:224: self.NavigateToURL('about:sync')\nI added this here more as a debugging step for authentication issues. I can remove this.\n\nOn 2011/10/11 21:14:04, rsimha wrote:\n> GetSyncInfo() grabs sync state directly from the ProfileSyncService. Navigating\n> to about:sync here isn't a prerequisite. Any reason you think it's necessary?\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py#newcode229\nchrome/test/pyautolib/pyauto.py:229: self.assertTrue(self.GetSyncInfo()['last synced'] == 'Just now')\nOn 2011/10/11 21:14:04, rsimha wrote:\n> This seems to be copied from sync.py. It might make sense to replace the\n> corresponding blocks in that file with a call to this function.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py#newcode4366\nchrome/test/pyautolib/pyauto.py:4366: def _LaunchHTTPXMPPServer(self):\nOn 2011/10/11 21:14:04, rsimha wrote:\n> Calling this method _LaunchPythonSyncServer() is probably more descriptive of\n> what it does.  What do you think?\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py#newcode4367\nchrome/test/pyautolib/pyauto.py:4367: \"\"\"Launch the local HTTP-XMPP test server.\nOn 2011/10/11 21:14:04, rsimha wrote:\n> Same comment as above. It's more descriptive to say that you're starting a\n> python sync server.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/1/chrome/test/pyautolib/pyauto.py#newcode4371\nchrome/test/pyautolib/pyauto.py:4371: propograted.\nOn 2011/10/11 21:14:04, rsimha wrote:\n> s/propograted/propagated/\n\nDone.","disapproval":false,"date":"2011-10-11 22:59:23.846540","approval":false},{"sender":"nirnimesh@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","nirnimesh@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"I've taken a cursory look only at this point. I'll do a full review, but I wanted to send out initial comments.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/functional/bookmarks.py\nFile chrome/test/functional/bookmarks.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/functional/bookmarks.py#newcode480\nchrome/test/functional/bookmarks.py:480: def ExtraChromeFlags(self):\nThis should not apply to the rest of the tests in this test case.\n\nMove your test to another test case, in the same file, and define ExtraChromeFlags only there\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/functional/bookmarks.py#newcode486\nchrome/test/functional/bookmarks.py:486: return self.ChromeFlagsForSyncTestServer(tempfile.mkdtemp(),\nappend to pyauto.PyUITest.ExtraChromeFlags(self). Don't override it\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/functional/bookmarks.py#newcode529\nchrome/test/functional/bookmarks.py:529: import sys\nthis will not work when running the full suite.\nThis will not even be called.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py#newcode168\nchrome/test/pyautolib/pyauto.py:168: needed.\nThe idea of a 2nd browser doesn't gel well with chromeos.\n\nAdd: does not apply to chromeos\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py#newcode172\nchrome/test/pyautolib/pyauto.py:172: \"\"\"\nassert not chromeos\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py#newcode213\nchrome/test/pyautolib/pyauto.py:213: def SignInToSyncAndVerifyState(self, account_key):\nthis is a test function. should go in test_utils.py","disapproval":false,"date":"2011-10-11 23:08:53.969382","approval":false},{"sender":"rsimha@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","nirnimesh@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"http://codereview.chromium.org/8224025/diff/7001/chrome/test/functional/sync.py\nFile chrome/test/functional/sync.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/functional/sync.py#newcode26\nchrome/test/functional/sync.py:26: self.assertTrue(self.GetSyncInfo()['last synced'] == 'Just now')\nReplace this block too.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/functional/sync.py#newcode55\nchrome/test/functional/sync.py:55: self.assertTrue(self.GetSyncInfo()['last synced'] == 'Just now')\nAnd this one.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/functional/sync.py#newcode85\nchrome/test/functional/sync.py:85: self.assertTrue(self.SignInToSync(username, password))\nThis too.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py#newcode159\nchrome/test/pyautolib/pyauto.py:159: def http_xmpp_server_ports(self):\ns/http_xmpp_server_ports/sync_server_ports/\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py#newcode214\nchrome/test/pyautolib/pyauto.py:214: \"\"\"Sign into sync, sync the browser and verifies the browser is synced.\nHow about \"Sign into sync and verify that it was successful.\"?\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py#newcode223\nchrome/test/pyautolib/pyauto.py:223: new_timeout = self.ActionTimeoutChanger(self, 60 * 1000)  # 1 min.\nThis should be done by tests based on how long they need to run. Remove from here and make sure that every test that enables sync has a larger timeout. If it's a single sync cycle, 1 minute should be sufficient. If a test involves several sync cycles, 2 minutes might be needed.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py#newcode4325\nchrome/test/pyautolib/pyauto.py:4325: if _OPTIONS and _OPTIONS.http_xmpp_server:\ns/http_xmpp_server/sync_server/\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py#newcode4570\nchrome/test/pyautolib/pyauto.py:4570: '', '--http-xmpp-server', action='store_true', default=False,\ns/http-xmpp-server/sync-server/\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py#newcode4571\nchrome/test/pyautolib/pyauto.py:4571: help='Start the HTTP-XMPP server.')\nStart a python sync server.","disapproval":false,"date":"2011-10-11 23:25:04.197132","approval":false},{"sender":"dtu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","nirnimesh@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"On 2011/10/11 19:34:09, dyu1 wrote:\n> Can I pass any set of flags? It's not just connecting to a localhost but also I\n> need to connect to the test sync server, which is done with the flag\n> '--sync-allow-insecure-xmpp-connection' and\n> '--sync-url=http://127.0.0.1:60625/chromiumsync'\n\nHrm, you're right; it currently does not take additional PyAuto arguments.","disapproval":false,"date":"2011-10-12 00:24:32.918562","approval":false},{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","nirnimesh@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"@nir\n\nWhat are my options for the following...\n\nchrome/test/functional/bookmarks.py:529: import sys\nthis will not work when running the full suite.\nThis will not even be called.\n\nShould I move the launching and terminating of the sync server out of pyauto.PyUITest? This would somewhat complicate the set up and tear down process. Are there any other solutions where is can be avoided?","disapproval":false,"date":"2011-10-12 00:40:09.595326","approval":false},{"sender":"nirnimesh@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"On 2011/10/12 00:40:09, dyu1 wrote:\n> @nir\n> \n> What are my options for the following...\n> \n> chrome/test/functional/bookmarks.py:529: import sys\n> this will not work when running the full suite.\n> This will not even be called.\n> \n> Should I move the launching and terminating of the sync server out of\n> pyauto.PyUITest? This would somewhat complicate the set up and tear down\n> process. Are there any other solutions where is can be avoided?\n\nHow about do that in the setup/tearDown in the test?","disapproval":false,"date":"2011-10-12 00:47:44.063940","approval":false},{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"Made the following changes:\n\n1. Moved CheckSyncAccount(), ChromeFlagsForSyncTestServer(), LaunchNewBrowser() to test_utils.py file so that pyauto.py will have less changes. \n\n2. Discarded '--sync-server' flag from __main__. The functions for launching and terminating the sync server is moved from PyUITestSuite to PyUITest.Now the server will be launched and killed in the setUp() and tearDown() functions corresponding to the tests within the new test class for integration testing between bookmarks and sync.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/functional/bookmarks.py\nFile chrome/test/functional/bookmarks.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/functional/bookmarks.py#newcode480\nchrome/test/functional/bookmarks.py:480: def ExtraChromeFlags(self):\nOn 2011/10/11 23:08:54, Nirnimesh wrote:\n> This should not apply to the rest of the tests in this test case.\n> \n> Move your test to another test case, in the same file, and define\n> ExtraChromeFlags only there\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/functional/bookmarks.py#newcode486\nchrome/test/functional/bookmarks.py:486: return self.ChromeFlagsForSyncTestServer(tempfile.mkdtemp(),\nAppended in 2 places. In the test and in the LaunchNewBrowser in test_utils.py\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/functional/bookmarks.py#newcode529\nchrome/test/functional/bookmarks.py:529: import sys\nShould I move the launching and terminating of the sync server out of pyauto.PyUITest? Is there another solution to handle the full suite?\n\n\nOn 2011/10/11 23:08:54, Nirnimesh wrote:\n> this will not work when running the full suite.\n> This will not even be called.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/functional/sync.py\nFile chrome/test/functional/sync.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/functional/sync.py#newcode26\nchrome/test/functional/sync.py:26: self.assertTrue(self.GetSyncInfo()['last synced'] == 'Just now')\nOn 2011/10/11 23:25:04, rsimha wrote:\n> Replace this block too.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/functional/sync.py#newcode55\nchrome/test/functional/sync.py:55: self.assertTrue(self.GetSyncInfo()['last synced'] == 'Just now')\nOn 2011/10/11 23:25:04, rsimha wrote:\n> And this one.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/functional/sync.py#newcode85\nchrome/test/functional/sync.py:85: self.assertTrue(self.SignInToSync(username, password))\nReplacing it here causes the test to throw an error.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py#newcode159\nchrome/test/pyautolib/pyauto.py:159: def http_xmpp_server_ports(self):\nOn 2011/10/11 23:25:04, rsimha wrote:\n> s/http_xmpp_server_ports/sync_server_ports/\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py#newcode168\nchrome/test/pyautolib/pyauto.py:168: needed.\nOn 2011/10/11 23:08:54, Nirnimesh wrote:\n> The idea of a 2nd browser doesn't gel well with chromeos.\n> \n> Add: does not apply to chromeos\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py#newcode172\nchrome/test/pyautolib/pyauto.py:172: \"\"\"\nOn 2011/10/11 23:08:54, Nirnimesh wrote:\n> assert not chromeos\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py#newcode213\nchrome/test/pyautolib/pyauto.py:213: def SignInToSyncAndVerifyState(self, account_key):\nOn 2011/10/11 23:08:54, Nirnimesh wrote:\n> this is a test function. should go in test_utils.py\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py#newcode214\nchrome/test/pyautolib/pyauto.py:214: \"\"\"Sign into sync, sync the browser and verifies the browser is synced.\nOn 2011/10/11 23:25:04, rsimha wrote:\n> How about \"Sign into sync and verify that it was successful.\"?\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py#newcode223\nchrome/test/pyautolib/pyauto.py:223: new_timeout = self.ActionTimeoutChanger(self, 60 * 1000)  # 1 min.\nOn 2011/10/11 23:25:04, rsimha wrote:\n> This should be done by tests based on how long they need to run. Remove from\n> here and make sure that every test that enables sync has a larger timeout. If\n> it's a single sync cycle, 1 minute should be sufficient. If a test involves\n> several sync cycles, 2 minutes might be needed.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py#newcode4325\nchrome/test/pyautolib/pyauto.py:4325: if _OPTIONS and _OPTIONS.http_xmpp_server:\nOn 2011/10/11 23:25:04, rsimha wrote:\n> s/http_xmpp_server/sync_server/\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py#newcode4570\nchrome/test/pyautolib/pyauto.py:4570: '', '--http-xmpp-server', action='store_true', default=False,\nOn 2011/10/11 23:25:04, rsimha wrote:\n> s/http-xmpp-server/sync-server/\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/7001/chrome/test/pyautolib/pyauto.py#newcode4571\nchrome/test/pyautolib/pyauto.py:4571: help='Start the HTTP-XMPP server.')\nOn 2011/10/11 23:25:04, rsimha wrote:\n> Start a python sync server.\n\nDone.","disapproval":false,"date":"2011-10-12 21:32:12.029978","approval":false},{"sender":"dennisjeffrey@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"The others seem to be doing a thorough review of functionality.  Just throwing in a handful of minor comments.\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/functional/bookmarks.py\nFile chrome/test/functional/bookmarks.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/functional/bookmarks.py#newcode488\nchrome/test/functional/bookmarks.py:488: |ChromeFlagsForTestServer()| is invoked to create the flags list and a temp\n'ChromeFlagsForTestServer' -->\n'ChromeFlagsForSyncTestServer'\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/functional/bookmarks.py#newcode533\nchrome/test/functional/bookmarks.py:533: # Launch a new instance of the browser with a clean profile (Browser 2)\nnit: add period at end of sentence.\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/functional/bookmarks.py#newcode543\nchrome/test/functional/bookmarks.py:543: self.assertEqual(new_browser_bookmarks.NodeCount(), bookmarks.NodeCount())\n(optional) Add an informative message in case the assertion fails, describing the different node counts from both browsers.\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/functional/test_utils.py\nFile chrome/test/functional/test_utils.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/functional/test_utils.py#newcode321\nchrome/test/functional/test_utils.py:321: def SignInToSyncAndVerifyState(self, account_key):\nnit: instead of the variable name 'self', I prefer 'test' like what some of the other helper functions in this file use.  Seeing 'self' there makes it look like the function is contained in a class, which is not true for this function.\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/functional/test_utils.py#newcode342\nchrome/test/functional/test_utils.py:342: user_data_dir: The directory path where user data files is saved by the\nnit: 'files is' --> 'files are'\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/functional/test_utils.py#newcode362\nchrome/test/functional/test_utils.py:362: Able to launch new instances of browsers with whatever extra flags is\nnit: 'flags is' --> 'flags are'\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/functional/test_utils.py#newcode377\nchrome/test/functional/test_utils.py:377: chrome_flags: browser flags.\n'a list of browser flags'\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/pyautolib/pyauto.py#newcode169\nchrome/test/pyautolib/pyauto.py:169: Prior to launching the new sync test server process, any occuring\n'occuring' -->\n'occurring'\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/pyautolib/pyauto.py#newcode177\nchrome/test/pyautolib/pyauto.py:177: AssertionError if the test server ports passed with json format is\n'format is' -->\n'format are'\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/pyautolib/pyauto.py#newcode198\nchrome/test/pyautolib/pyauto.py:198: _SYNC_SERVER = subprocess.Popen(args,\nnit: move this argument to the next line","disapproval":false,"date":"2011-10-12 21:52:10.248262","approval":false},{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"http://codereview.chromium.org/8224025/diff/11001/chrome/test/functional/bookmarks.py\nFile chrome/test/functional/bookmarks.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/functional/bookmarks.py#newcode488\nchrome/test/functional/bookmarks.py:488: |ChromeFlagsForTestServer()| is invoked to create the flags list and a temp\nOn 2011/10/12 21:52:10, dennis_jeffrey wrote:\n> 'ChromeFlagsForTestServer' -->\n> 'ChromeFlagsForSyncTestServer'\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/functional/bookmarks.py#newcode533\nchrome/test/functional/bookmarks.py:533: # Launch a new instance of the browser with a clean profile (Browser 2)\nOn 2011/10/12 21:52:10, dennis_jeffrey wrote:\n> nit: add period at end of sentence.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/functional/bookmarks.py#newcode543\nchrome/test/functional/bookmarks.py:543: self.assertEqual(new_browser_bookmarks.NodeCount(), bookmarks.NodeCount())\nOn 2011/10/12 21:52:10, dennis_jeffrey wrote:\n> (optional) Add an informative message in case the assertion fails, describing\n> the different node counts from both browsers.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/functional/test_utils.py\nFile chrome/test/functional/test_utils.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/functional/test_utils.py#newcode321\nchrome/test/functional/test_utils.py:321: def SignInToSyncAndVerifyState(self, account_key):\nOn 2011/10/12 21:52:10, dennis_jeffrey wrote:\n> nit: instead of the variable name 'self', I prefer 'test' like what some of the\n> other helper functions in this file use.  Seeing 'self' there makes it look like\n> the function is contained in a class, which is not true for this function.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/functional/test_utils.py#newcode342\nchrome/test/functional/test_utils.py:342: user_data_dir: The directory path where user data files is saved by the\nOn 2011/10/12 21:52:10, dennis_jeffrey wrote:\n> nit: 'files is' --> 'files are'\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/functional/test_utils.py#newcode362\nchrome/test/functional/test_utils.py:362: Able to launch new instances of browsers with whatever extra flags is\nOn 2011/10/12 21:52:10, dennis_jeffrey wrote:\n> nit: 'flags is' --> 'flags are'\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/functional/test_utils.py#newcode377\nchrome/test/functional/test_utils.py:377: chrome_flags: browser flags.\nOn 2011/10/12 21:52:10, dennis_jeffrey wrote:\n> 'a list of browser flags'\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/pyautolib/pyauto.py#newcode169\nchrome/test/pyautolib/pyauto.py:169: Prior to launching the new sync test server process, any occuring\nOn 2011/10/12 21:52:10, dennis_jeffrey wrote:\n> 'occuring' -->\n> 'occurring'\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/pyautolib/pyauto.py#newcode177\nchrome/test/pyautolib/pyauto.py:177: AssertionError if the test server ports passed with json format is\n'format are' or did you mean 'formats are'?\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/pyautolib/pyauto.py#newcode198\nchrome/test/pyautolib/pyauto.py:198: _SYNC_SERVER = subprocess.Popen(args,\nOn 2011/10/12 21:52:10, dennis_jeffrey wrote:\n> nit: move this argument to the next line\n\nDone.","disapproval":false,"date":"2011-10-12 22:30:27.503609","approval":false},{"sender":"dennisjeffrey@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"Code I commented on LGTM.  Please wait for the others to approve before you submit.\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/11001/chrome/test/pyautolib/pyauto.py#newcode177\nchrome/test/pyautolib/pyauto.py:177: AssertionError if the test server ports passed with json format is\nOn 2011/10/12 22:30:27, dyu1 wrote:\n> 'format are' or did you mean 'formats are'?\n\nThe way you changed it is fine - and it was only a minor nit anyway ;-)\n\nBut FYI, I think even \"format are\" would have been grammatically correct here too, because the subject that the sentence is talking about is really the \"server ports\", and those are plural.  So it's the server ports that \"are incorrect\", not the \"json format\".\n\nhttp://codereview.chromium.org/8224025/diff/17001/chrome/test/functional/bookmarks.py\nFile chrome/test/functional/bookmarks.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/17001/chrome/test/functional/bookmarks.py#newcode545\nchrome/test/functional/bookmarks.py:545: 'The total count of bookmark nodes, including folders, do not match.')\nName the message argument:\n\nmsg='...'","disapproval":false,"date":"2011-10-12 23:02:45.549614","approval":true},{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"http://codereview.chromium.org/8224025/diff/17001/chrome/test/functional/bookmarks.py\nFile chrome/test/functional/bookmarks.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/17001/chrome/test/functional/bookmarks.py#newcode545\nchrome/test/functional/bookmarks.py:545: 'The total count of bookmark nodes, including folders, do not match.')\nOn 2011/10/12 23:02:45, dennis_jeffrey wrote:\n> Name the message argument:\n> \n> msg='...'\n\nDone.","disapproval":false,"date":"2011-10-12 23:11:52.222426","approval":false},{"sender":"nirnimesh@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"http://codereview.chromium.org/8224025/diff/11004/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/11004/chrome/test/pyautolib/pyauto.py#newcode39\nchrome/test/pyautolib/pyauto.py:39: import simplejson\nThis cannot be done here. Do it after the _LocateBinDirs(), or move _LocateBinDirs() up.\n\nI'm getting the following error on my machine:\n\n[nirnimesh@circus src]$ python chrome/test/functional/pyauto_functional.py bookmarks\nRunning: arch -i386 python2.6 chrome/test/functional/pyauto_functional.py bookmarks\nCannot import pyauto from ['/Volumes/1/chrome/cr-git/src/chrome/test/functional', '/Volumes/1/chrome/cr-git/src/out/16.0.907.0', '/usr/local/lib/wxPython-ansi-2.8.11.0/lib/python2.6/site-packages', '/usr/local/lib/wxPython-ansi-2.8.11.0/lib/python2.6/site-packages/wx-2.8-mac-ansi', '/System/Library/Frameworks/Python.framework/Versions/2.6/lib/python26.zip', '/System/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6', '/System/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/plat-darwin', '/System/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/plat-mac', '/System/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/plat-mac/lib-scriptpackages', '/System/Library/Frameworks/Python.framework/Versions/2.6/Extras/lib/python', '/System/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/lib-tk', '/System/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/lib-old', '/System/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/lib-dynload', '/Library/Python/2.6/site-packages', '/usr/local/lib/wxPython-ansi-2.8.11.0/lib/python2.6', '/System/Library/Frameworks/Python.framework/Versions/2.6/Extras/lib/python/PyObjC', '/System/Library/Frameworks/Python.framework/Versions/2.6/Extras/lib/python/wx-2.8-mac-unicode', 'chrome/test/functional/../pyautolib']\nTraceback (most recent call last):\n  File \"chrome/test/functional/pyauto_functional.py\", line 85, in <module>\n    import pyauto\n  File \"/Volumes/1/chrome/cr-git/src/chrome/test/functional/../pyautolib/pyauto.py\", line 39, in <module>\n    import simplejson\nImportError: No module named simplejson","disapproval":false,"date":"2011-10-13 23:33:54.166600","approval":false},{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"http://codereview.chromium.org/8224025/diff/11004/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/11004/chrome/test/pyautolib/pyauto.py#newcode39\nchrome/test/pyautolib/pyauto.py:39: import simplejson\nDone","disapproval":false,"date":"2011-10-14 00:25:51.959504","approval":false},{"sender":"nirnimesh@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"Still getting errors.\n\n[nirnimesh@circus src]$ python chrome/test/functional/pyauto_functional.py bookmarks.BookmarksAndSyncTest.testAddBookmarkAndVerifySync\nRunning: arch -i386 python2.6 chrome/test/functional/pyauto_functional.py bookmarks.BookmarksAndSyncTest.testAddBookmarkAndVerifySync\nHTTP server started on port 60916...\nsending server_data: {\"port\": 60916} (15 bytes)\n[ RUN        ] bookmarks.BookmarksAndSyncTest.testAddBookmarkAndVerifySync: \"Verify a bookmark syncs between two browsers.\"\nTraceback (most recent call last):\n  File \"/Volumes/1/chrome/cr-git/src/chrome/test/pyautolib/../../../net/tools/testserver/testserver.py\", line 26, in <module>\n    import simplejson\nImportError: No module named simplejson\n[      ERROR ] bookmarks.BookmarksAndSyncTest.testAddBookmarkAndVerifySync\n\n======================================================================\nERROR: bookmarks.BookmarksAndSyncTest.testAddBookmarkAndVerifySync: \"Verify a bookmark syncs between two browsers.\"\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/Volumes/1/chrome/cr-git/src/chrome/test/functional/bookmarks.py\", line 497, in setUp\n    self.LaunchPythonSyncServer()\n  File \"chrome/test/functional/../pyautolib/pyauto.py\", line 210, in LaunchPythonSyncServer\n    self._KillPythonSyncServer()\n  File \"/Volumes/1/chrome/cr-git/src/out/16.0.907.0/pyautolib.py\", line 1193, in <lambda>\n    __getattr__ = lambda self, name: _swig_getattr(self, PyUITestBase, name)\n  File \"/Volumes/1/chrome/cr-git/src/out/16.0.907.0/pyautolib.py\", line 58, in _swig_getattr\n    raise AttributeError(name)\nAttributeError: _KillPythonSyncServer","disapproval":false,"date":"2011-10-14 01:13:56.607032","approval":false},{"sender":"nirnimesh@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"http://codereview.chromium.org/8224025/diff/21001/chrome/test/functional/bookmarks.py\nFile chrome/test/functional/bookmarks.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/21001/chrome/test/functional/bookmarks.py#newcode492\nchrome/test/functional/bookmarks.py:492: test_utils.ChromeFlagsForSyncTestServer(tempfile.mkdtemp(),\nChromeFlagsForSyncTestServer should be in pyauto.py -- it seems general enough.\n\nhttp://codereview.chromium.org/8224025/diff/21001/chrome/test/functional/bookmarks.py#newcode497\nchrome/test/functional/bookmarks.py:497: self.LaunchPythonSyncServer()\nMove it after pyauto.PyUITest.setUp(), so that you won't need to try/except block\n\nhttp://codereview.chromium.org/8224025/diff/21001/chrome/test/functional/bookmarks.py#newcode506\nchrome/test/functional/bookmarks.py:506: try:\nremove try/except. Move self.KillPythonSyncServer() before pyauto.PyUITest.tearDown(self)\n\nhttp://codereview.chromium.org/8224025/diff/21001/chrome/test/functional/test_utils.py\nFile chrome/test/functional/test_utils.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/21001/chrome/test/functional/test_utils.py#newcode359\nchrome/test/functional/test_utils.py:359: def LaunchNewBrowser(chrome_flags=[]):\nNo, all this was fine in pyauto.py\n\nI meant that you should create the new browser and test server in setUp/tearDown in the tests that need it.","disapproval":false,"date":"2011-10-14 01:18:59.944474","approval":false},{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"Looking at the error you get it seems like you are not able to import simplejson. This is strange since I removed the import statement from the very top and used the existing 'import simplejson from json' I think this issue will be resolved if you're able to import simplejson in a pythion command prompt.\n\nAlso I had moved both _KillPythonSyncServer() and _LaunchPythonSyncServer into pyauto.PyUITest. They are no longer private so the function names are not prefixed with '_'. Your errors still show that they are private. Can you download the new changes and try running it again?","disapproval":false,"date":"2011-10-14 21:15:30.951240","approval":false},{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"Several comments and questions inline.\n\nOn 2011/10/14 01:18:59, Nirnimesh wrote:\n> http://codereview.chromium.org/8224025/diff/21001/chrome/test/functional/bookmarks.py\n> File chrome/test/functional/bookmarks.py (right):\n> \n> http://codereview.chromium.org/8224025/diff/21001/chrome/test/functional/bookmarks.py#newcode492\n> chrome/test/functional/bookmarks.py:492:\n> test_utils.ChromeFlagsForSyncTestServer(tempfile.mkdtemp(),\n> ChromeFlagsForSyncTestServer should be in pyauto.py -- it seems general enough.\n\n\nOK, doable.\n\n> \n> http://codereview.chromium.org/8224025/diff/21001/chrome/test/functional/bookmarks.py#newcode497\n> chrome/test/functional/bookmarks.py:497: self.LaunchPythonSyncServer()\n> Move it after pyauto.PyUITest.setUp(), so that you won't need to try/except\n> block\n\nThis cannot be done. The reason being that the server's ports are needed before the call to ExtraChromeFlags(). We never explicitly call ExtraChromeFlags() but rather it is called implicitly by pyauto.PyUITest.setUp(self). \n\nFirst the sync server needs to launch, which will provide the ports and then call pyauto.PyUITest.setUp(self) which in turn will call ExtraChromeFlags() with the prot numbers passed to flags. \n\nThe only thing I'm able to change at this point is to get rid of the try:except: block. Of course this makes the assumption that pyauto.PyUITest.setUp(self) wont raise any exceptions. Do you think this is the right assumption to make?\n\n> \n> http://codereview.chromium.org/8224025/diff/21001/chrome/test/functional/bookmarks.py#newcode506\n> chrome/test/functional/bookmarks.py:506: try:\n> remove try/except. Move self.KillPythonSyncServer() before\n> pyauto.PyUITest.tearDown(self)\n\nDONE\n\n> \n> http://codereview.chromium.org/8224025/diff/21001/chrome/test/functional/test_utils.py\n> File chrome/test/functional/test_utils.py (right):\n> \n> http://codereview.chromium.org/8224025/diff/21001/chrome/test/functional/test_utils.py#newcode359\n> chrome/test/functional/test_utils.py:359: def LaunchNewBrowser(chrome_flags=[]):\n> No, all this was fine in pyauto.py\n> \n> I meant that you should create the new browser and test server in setUp/tearDown\n> in the tests that need it.\n\nI moved it back to pyauto.py but your comment about having setup and tear down in the tests themselves is still unclear. In bookmarks.py I currently have two test classes. One is strictly bookmarks tests and one I created to integrate sync testing with bookmarks. The second test class has the setup and tear down so it does not affect the first test class. The discriminating between the two test classes is done, so I'm confused what still needs to be done?\n\nAbout the new browser, do you want it to be launched in setUp? If this is the case then there is no control over the point of creation during the test. Currently you can terminate it before the test finishes at any point by calling new_browser.tearDown().","disapproval":false,"date":"2011-10-14 21:25:07.246309","approval":false},{"sender":"rsimha@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"Thanks for patiently iterating through this CL. It's going to prove very useful to be able to run pyauto tests against a local sync server.\n\nChanges that I commented on LGTM. I'll let Nirnimesh take care of final approval.","disapproval":false,"date":"2011-10-14 23:41:50.559692","approval":true},{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","dtu@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"On 2011/10/14 21:15:30, dyu1 wrote:\n> Looking at the error you get it seems like you are not able to import\n> simplejson. This is strange since I removed the import statement from the very\n> top and used the existing 'import simplejson from json' I think this issue will\n> be resolved if you're able to import simplejson in a pythion command prompt.\n> \n> Also I had moved both _KillPythonSyncServer() and _LaunchPythonSyncServer into\n> pyauto.PyUITest. They are no longer private so the function names are not\n> prefixed with '_'. Your errors still show that they are private. Can you\n> download the new changes and try running it again?\n\nNir: Can you run the following manually from the command line? 'src/net/tools/testserver/testserver.py --sync --log-to-console'\n\nlet me know if you get an error.","disapproval":false,"date":"2011-10-15 22:02:49.659790","approval":false},{"sender":"nirnimesh@chromium.org","recipients":["reply@chromiumcodereview.appspotmail.com"],"text":"Of course. testserver.py is not meant to be used without setting the right\npython path. That's what the C++ testserver code does -- sets the right path\nand then launches off testserver.py\n\n\nOn Sat, Oct 15, 2011 at 3:02 PM, <dyu@chromium.org> wrote:\n\n> On 2011/10/14 21:15:30, dyu1 wrote:\n>\n>> Looking at the error you get it seems like you are not able to import\n>> simplejson. This is strange since I removed the import statement from the\n>> very\n>> top and used the existing 'import simplejson from json' I think this issue\n>>\n> will\n>\n>> be resolved if you're able to import simplejson in a pythion command\n>> prompt.\n>>\n>\n>  Also I had moved both _KillPythonSyncServer() and _LaunchPythonSyncServer\n>> into\n>> pyauto.PyUITest. They are no longer private so the function names are not\n>> prefixed with '_'. Your errors still show that they are private. Can you\n>> download the new changes and try running it again?\n>>\n>\n> Nir: Can you run the following manually from the command line?\n> 'src/net/tools/testserver/**testserver.py --sync --log-to-console'\n>\n> let me know if you get an error.\n>\n> http://codereview.chromium.**org/8224025/<http://codereview.chromium.org/8224025/>\n>\n\n\n\n-- \n../NiR\n","disapproval":false,"date":"2011-10-16 03:58:35.300168","approval":false},{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"Fixed the issue that was could have been causing the errors on the mac.\n\nhttp://codereview.chromium.org/8224025/diff/21001/chrome/test/functional/bookmarks.py\nFile chrome/test/functional/bookmarks.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/21001/chrome/test/functional/bookmarks.py#newcode492\nchrome/test/functional/bookmarks.py:492: test_utils.ChromeFlagsForSyncTestServer(tempfile.mkdtemp(),\nOn 2011/10/14 01:19:00, Nirnimesh wrote:\n> ChromeFlagsForSyncTestServer should be in pyauto.py -- it seems general enough.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/21001/chrome/test/functional/bookmarks.py#newcode497\nchrome/test/functional/bookmarks.py:497: self.LaunchPythonSyncServer()\nThis cannot be done. The reason being that the server's ports are needed before\nthe call to ExtraChromeFlags(). We never explicitly call ExtraChromeFlags() but\nrather it is called implicitly by pyauto.PyUITest.setUp(self). \n\nFirst the sync server needs to launch, which will provide the ports and then\ncall pyauto.PyUITest.setUp(self) which in turn will call ExtraChromeFlags() with\nthe prot numbers passed to flags. \n\nThe only thing I'm able to change at this point is to get rid of the try:except:\nblock. Of course this makes the assumption that pyauto.PyUITest.setUp(self) wont\nraise any exceptions. Do you think this is the right assumption to make?\n\nhttp://codereview.chromium.org/8224025/diff/21001/chrome/test/functional/bookmarks.py#newcode506\nchrome/test/functional/bookmarks.py:506: try:\nOn 2011/10/14 01:19:00, Nirnimesh wrote:\n> remove try/except. Move self.KillPythonSyncServer() before\n> pyauto.PyUITest.tearDown(self)\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/21001/chrome/test/functional/test_utils.py\nFile chrome/test/functional/test_utils.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/21001/chrome/test/functional/test_utils.py#newcode359\nchrome/test/functional/test_utils.py:359: def LaunchNewBrowser(chrome_flags=[]):\nI moved it back to pyauto.py but your comment about having setup and tear down\nin the tests themselves is still unclear. In bookmarks.py I currently have two\ntest classes. One is strictly bookmarks tests and one I created to integrate\nsync testing with bookmarks. The second test class has the setup and tear down\nso it does not affect the first test class. The discriminating between the two\ntest classes is done, so I'm confused what still needs to be done?\n\nAbout the new browser, do you want it to be launched in setUp? If this is the\ncase then there is no control over the point of creation during the test.\nCurrently you can terminate it before the test finishes at any point by calling\nnew_browser.tearDown().","disapproval":false,"date":"2011-10-16 22:33:12.744477","approval":false},{"sender":"nirnimesh@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"I'm happy to see this support so thanks for doing this.\n\nThe implementation should be made clearer. It seems to be going in circles. I've made specific notes in comments. In general, your test class should be like:\n\nclass MyTest(pyauto.PyUITest):\n\ndef ExtraChromeFlags(self):\n  return pyauto.PyUITest.ExtraChromeFlags(self) + [extra flags for connecting to local sync server]\n\ndef setUp(self):\n  self.LaunchSyncServer()\n  pyauto.PyUITest.setUp(self)\n  \n\ndef tearDown(self):\n  pyauto.PyUITest.tearDown(self)\n  self.DestroySyncServer()\n\n\ndef testMyFunc(self):\n  new_browser = self.GetNewBrowserInstance()\n  do something on self\n  do something on new_browser\n\n\nie. all helper methods/classes go in pyauto.py, but no globals.\nAll control happens from the TestCase that uses it.\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode156\nchrome/test/pyautolib/pyauto.py:156: \nAll this new code is too close to the top. Move it further down, after all the setUp/tearDown and other @staticmethod's in this class\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode160\nchrome/test/pyautolib/pyauto.py:160: \"\"\"Launches a new browser and sets some extra flags.\n\"and sets\" -> with\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode162\nchrome/test/pyautolib/pyauto.py:162: Able to launch new instances of browsers with whatever extra flags is\nThis is a repeat of what you said in the previous line. Remove this line.\n\nAdd: The new browser is launched with its own fresh profile.\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode166\nchrome/test/pyautolib/pyauto.py:166: chrome_flags: list of flags when launching a new browser.\nflags -> extra\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode173\nchrome/test/pyautolib/pyauto.py:173: def setUp(self, chrome_flags):\nWhen is new browser's tearDown called?\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode193\nchrome/test/pyautolib/pyauto.py:193: global _SYNC_SERVER_PORTS\nI don't think it's necessary to have this global anymore. Find a way to make it not so. Use member vars if needed. Make the testserver launching be similar to StartFTPServer()\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode215\nchrome/test/pyautolib/pyauto.py:215: TEST_SERVER_PATH = os.path.join(pyauto_paths.GetSourceDir(),\nWhy all caps?\n\nInclude testserver.py in this var.\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode231\nchrome/test/pyautolib/pyauto.py:231: _SYNC_SERVER = subprocess.Popen(\nInstead of launching the testserver yourself, why not use the swigged TestServer class with TYPE_SYNC? Make it like StartFTPServer()\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode257\nchrome/test/pyautolib/pyauto.py:257: def ChromeFlagsForSyncTestServer(user_data_dir, port, xmpp_port):\nWhy not move this inside LaunchNewBrowser()?\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode261\nchrome/test/pyautolib/pyauto.py:261: user_data_dir: The directory path where user data files is saved by the\nwhy? It would create a fresh clean profile of its own anyway\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode4409\nchrome/test/pyautolib/pyauto.py:4409: if _OPTIONS and _OPTIONS.sync_server:\nthis should not be necessary. A test should be able to launch and destroy all that's needed, like StartFTPServer usage.","disapproval":false,"date":"2011-10-19 06:35:47.981340","approval":false},{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"http://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode156\nchrome/test/pyautolib/pyauto.py:156: \nOn 2011/10/19 06:35:48, Nirnimesh wrote:\n> All this new code is too close to the top. Move it further down, after all the\n> setUp/tearDown and other @staticmethod's in this class\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode160\nchrome/test/pyautolib/pyauto.py:160: \"\"\"Launches a new browser and sets some extra flags.\nOn 2011/10/19 06:35:48, Nirnimesh wrote:\n> \"and sets\" -> with\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode162\nchrome/test/pyautolib/pyauto.py:162: Able to launch new instances of browsers with whatever extra flags is\nOn 2011/10/19 06:35:48, Nirnimesh wrote:\n> This is a repeat of what you said in the previous line. Remove this line.\n> \n> Add: The new browser is launched with its own fresh profile.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode166\nchrome/test/pyautolib/pyauto.py:166: chrome_flags: list of flags when launching a new browser.\nOn 2011/10/19 06:35:48, Nirnimesh wrote:\n> flags -> extra\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode173\nchrome/test/pyautolib/pyauto.py:173: def setUp(self, chrome_flags):\nThe browser tear down was called in the last line in testAddBookmarkAndVerifySync() function within bookmarks.py.\nThe line was new_browser's super class tearDown(). The NewBrowser didn't need to implement tearDown().\n\nI changed this a little by adding a destructor __del__() in ExtraBrowser() which just calls the pyUITest.tearDown() and then the superclasses's destructor. This way when the new_browser var is out of scope, tearDown is called before it is destroyed. This is done by explicitly calling the destructor 'del new_browser'\n\nOn 2011/10/19 06:35:48, Nirnimesh wrote:\n> When is new browser's tearDown called?\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode193\nchrome/test/pyautolib/pyauto.py:193: global _SYNC_SERVER_PORTS\nOn 2011/10/19 06:35:48, Nirnimesh wrote:\n> I don't think it's necessary to have this global anymore. Find a way to make it\n> not so. Use member vars if needed. Make the testserver launching be similar to\n> StartFTPServer()\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode215\nchrome/test/pyautolib/pyauto.py:215: TEST_SERVER_PATH = os.path.join(pyauto_paths.GetSourceDir(),\nOn 2011/10/19 06:35:48, Nirnimesh wrote:\n> Why all caps?\n> \n> Include testserver.py in this var.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode231\nchrome/test/pyautolib/pyauto.py:231: _SYNC_SERVER = subprocess.Popen(\nI tried to make it like StartFTPServer by using 'sync_server = pyautolib.TestServer(pyautolib.TestServer.TYPE_SYNC, pyautolib.FilePath(\"))' While it did create a new process running testserver.py with the same params as in subprocess.fopen I couldn't find a way to get the ports (http and xmpp).\n\nThe way dtu implemented this it takes in one flag so it launches the server using pipe --start-pipe=x. Is there a way to use this and get the two ports needed to start the sync server?\n\n\nOn 2011/10/19 06:35:48, Nirnimesh wrote:\n> Instead of launching the testserver yourself, why not use the swigged TestServer\n> class with TYPE_SYNC? Make it like StartFTPServer()\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode257\nchrome/test/pyautolib/pyauto.py:257: def ChromeFlagsForSyncTestServer(user_data_dir, port, xmpp_port):\nThis can't be done because if ChromeFlagsForSyncTestServer() is inside LaunchNewBrowser() then we wont be able to call this function in the main test browser (browser 1). This function is also used in ExtraChfromeFlags() and not only in the new_browser.\n\n\nOn 2011/10/19 06:35:48, Nirnimesh wrote:\n> Why not move this inside LaunchNewBrowser()?\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode261\nchrome/test/pyautolib/pyauto.py:261: user_data_dir: The directory path where user data files is saved by the\nI created this argument based on Ragu's manual steps to start the multiple browsers in the sync server. \n\nOn 2011/10/19 06:35:48, Nirnimesh wrote:\n> why? It would create a fresh clean profile of its own anyway\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode4409\nchrome/test/pyautolib/pyauto.py:4409: if _OPTIONS and _OPTIONS.sync_server:\nOn 2011/10/19 06:35:48, Nirnimesh wrote:\n> this should not be necessary. A test should be able to launch and destroy all\n> that's needed, like StartFTPServer usage.\n\nDone.","disapproval":false,"date":"2011-10-20 20:19:48.861697","approval":false},{"sender":"nirnimesh@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"http://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode231\nchrome/test/pyautolib/pyauto.py:231: _SYNC_SERVER = subprocess.Popen(\nHow does Raghu use them for sync tests? (sync uses the same TestServer code)","disapproval":false,"date":"2011-10-21 01:44:29.540053","approval":false},{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"Based on Raghu's response it seem that the methods in net::TestServer is not yet hooked up via testing_automation_provider. \n\n\"The test server is started off as a child process of the chrome test process on posix and windows. The python flags are appended to the command line and started off by a method called LaunchPython (here and here). The actual command line is constructed in a method called AddCommandLineArguments.\n\nThe sync integration tests use this infrastructure via a method called SetUpLocalPythonTestServer.\n\nIf you want to use the existing methods in test_server.cc (which might be a good idea), it should be possible to hook up to the methods in net::TestServer via testing_automation_provider. Of course, you may not be able to use what is in sync_test.cc because it's part of the chrome_test target and not the chrome target, but there should be a way to work around this.\"\n\nOn 2011/10/21 01:44:29, Nirnimesh wrote:\n> http://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py\n> File chrome/test/pyautolib/pyauto.py (right):\n> \n> http://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode231\n> chrome/test/pyautolib/pyauto.py:231: _SYNC_SERVER = subprocess.Popen(\n> How does Raghu use them for sync tests? (sync uses the same TestServer code)","disapproval":false,"date":"2011-10-24 18:57:14.512802","approval":false},{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"http://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode173\nchrome/test/pyautolib/pyauto.py:173: def setUp(self, chrome_flags):\nChanged the use of the destructor from 'del new_browser' to 'new_browser.tearDown().\n\nhttp://codereview.chromium.org/8224025/diff/34001/chrome/test/pyautolib/pyauto.py#newcode261\nchrome/test/pyautolib/pyauto.py:261: user_data_dir: The directory path where user data files is saved by the\nremoved the user_data_dir flag.","disapproval":false,"date":"2011-10-24 19:34:08.301248","approval":false},{"sender":"nirnimesh@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"On 2011/10/24 18:57:14, dyu1 wrote:\n> Based on Raghu's response it seem that the methods in net::TestServer is not yet\n> hooked up via testing_automation_provider. \n> \n> \"The test server is started off as a child process of the chrome test process on\n> posix and windows. The python flags are appended to the command line and started\n> off by a method called LaunchPython (here and here). The actual command line is\n> constructed in a method called AddCommandLineArguments.\n> \n> The sync integration tests use this infrastructure via a method called\n> SetUpLocalPythonTestServer.\n> \n> If you want to use the existing methods in test_server.cc (which might be a good\n> idea), it should be possible to hook up to the methods in net::TestServer via\n> testing_automation_provider. Of course, you may not be able to use what is in\n> sync_test.cc because it's part of the chrome_test target and not the chrome\n> target, but there should be a way to work around this.\"\n\nWe already expose TestServer to pyauto (see pyautolib.i). Why not use/extend that?\nIt doesn't need to be hooked via testing_automation_provider.","disapproval":false,"date":"2011-10-27 00:24:46.104037","approval":false},{"sender":"nirnimesh@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"I'm unable to run it either. Please make sure you're able to get a successful try run (use -t pyauto_functional_tests), since I'd like to be able to run it.\n\n\n[nirnimesh@circus src]$ python chrome/test/functional/pyauto_functional.py bookmarks.BookmarksAndSyncTest.testAddBookmarkAndVerifySync\nRunning: arch -i386 python2.6 chrome/test/functional/pyauto_functional.py bookmarks.BookmarksAndSyncTest.testAddBookmarkAndVerifySync\n[5374:2571:1026/173413:1989065640073279:ERROR:file_util.cc(345)] Couldn't open /Volumes/1/chrome/cr-git/src/out/17.0.919.0/resources.pak\n[5374:2571:1026/173413:1989065640149520:ERROR:resource_bundle.cc(404)] Failed to load /Volumes/1/chrome/cr-git/src/out/17.0.919.0/resources.pak\nSome features may not be available.\n[5374:2571:1026/173413:1989065641329198:WARNING:python_utils.cc(85)] Can't find pyproto next to /Volumes/1/chrome/cr-git/src/out/17.0.919.0\n[5374:2571:1026/173413:1989065641400787:WARNING:python_utils.cc(94)] Can't find pyproto next to /Volumes/1/chrome/cr-git/src/out/Release\n[5374:2571:1026/173413:1989065641428294:WARNING:test_server.cc(309)] Cannot find pyproto dir for generated code. Testserver features that rely on it will not work\nHTTP server started on port 63749...\nsending server_data: {\"port\": 63749} (15 bytes)\n[ RUN        ] bookmarks.BookmarksAndSyncTest.testAddBookmarkAndVerifySync: \"Verify a bookmark syncs between two browsers.\"\nTraceback (most recent call last):\n  File \"/Volumes/1/chrome/cr-git/src/chrome/test/pyautolib/../../../net/tools/testserver/testserver.py\", line 1924, in <module>\n    sys.exit(main(options, args))\n  File \"/Volumes/1/chrome/cr-git/src/chrome/test/pyautolib/../../../net/tools/testserver/testserver.py\", line 1783, in main\n    server = SyncHTTPServer(('127.0.0.1', port), SyncPageHandler)\n  File \"/Volumes/1/chrome/cr-git/src/chrome/test/pyautolib/../../../net/tools/testserver/testserver.py\", line 131, in __init__\n    import chromiumsync\n  File \"/Volumes/1/chrome/cr-git/src/net/tools/testserver/chromiumsync.py\", line 21, in <module>\n    import app_specifics_pb2\nImportError: No module named app_specifics_pb2\n[      ERROR ] bookmarks.BookmarksAndSyncTest.testAddBookmarkAndVerifySync\n\n======================================================================\nERROR: bookmarks.BookmarksAndSyncTest.testAddBookmarkAndVerifySync: \"Verify a bookmark syncs between two browsers.\"\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/Volumes/1/chrome/cr-git/src/chrome/test/functional/bookmarks.py\", line 496, in setUp\n    self.sync_server = self.LaunchPythonSyncServer()\n  File \"/Volumes/1/chrome/cr-git/src/chrome/test/functional/../pyautolib/pyauto.py\", line 648, in LaunchPythonSyncServer\n    test_server_data_len = struct.unpack('=L', data[:4])[0]\nerror: unpack requires a string argument of length 4","disapproval":false,"date":"2011-10-27 00:37:05.802562","approval":false},{"sender":"nirnimesh@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"I've reviewed the entire code now. The only major remaining bit is to investigate use of swigged TestServer (pyautolib.i) to work in sync server mode. If it turns out too complex or infeasible I'm fine with the current implementation, but I'd like the investigation to be done first.\n\nThanks for working on this.\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/functional/bookmarks.py\nFile chrome/test/functional/bookmarks.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/functional/bookmarks.py#newcode481\nchrome/test/functional/bookmarks.py:481: class BookmarksAndSyncTest(pyauto.PyUITest):\nI think this should reside in sync.py\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/functional/bookmarks.py#newcode495\nchrome/test/functional/bookmarks.py:495: \nnit: remove blank line\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/functional/bookmarks.py#newcode496\nchrome/test/functional/bookmarks.py:496: self.sync_server = self.LaunchPythonSyncServer()\nself._sync_server\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/functional/bookmarks.py#newcode512\nchrome/test/functional/bookmarks.py:512: new_browser = self.LaunchNewBrowser(\nyou're referring this as browser 2 everywhere. Rename var to browser2 for clarity\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (left):\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#oldcode154\nchrome/test/pyautolib/pyauto.py:154: def _SetExtraChromeFlags(self):\nwhy are you moving this?\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#oldcode2589\nchrome/test/pyautolib/pyauto.py:2589: def GetDOMValue(self, expr, tab_index=0, windex=0, frame_xpath=''):\nWhy? Are these leftover from another CL?\nSync to tot please\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#oldcode3795\nchrome/test/pyautolib/pyauto.py:3795: def ConnectToCellularNetwork(self):\nwhy?\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode606\nchrome/test/pyautolib/pyauto.py:606: PyUITest.tearDown(self)\nSince tearDown is being called in __del__, call setUp in __init__()\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode610\nchrome/test/pyautolib/pyauto.py:610: new_browser.setUp(chrome_flags)\nsee previous comment.\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode625\nchrome/test/pyautolib/pyauto.py:625: 'net/tools/testserver/testserver.py')\n/ will not work on win. Use join\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode626\nchrome/test/pyautolib/pyauto.py:626: EXTRA_PYTHON_PATH = [\nwhy caps?\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode627\nchrome/test/pyautolib/pyauto.py:627: os.path.join(pyauto_paths.GetThirdPartyDir(), 'pyftpdlib/src'),\ndo not use /\nUse join\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode637\nchrome/test/pyautolib/pyauto.py:637: args = command_line.split()\nwhy not directly construct a list.\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode648\nchrome/test/pyautolib/pyauto.py:648: test_server_data_len = struct.unpack('=L', data[:4])[0]\nwhat is this for?\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode652\nchrome/test/pyautolib/pyauto.py:652: logging.debug('Started sync server.')\nInclude the port info as well\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode662\nchrome/test/pyautolib/pyauto.py:662: logging.debug('Stopped sync server.')\ninclude port info as well\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode4746\nchrome/test/pyautolib/pyauto.py:4746: os.putenv('CHROME_HEADLESS', '1')\nwhy?","disapproval":false,"date":"2011-10-27 05:37:55.164685","approval":false},{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"http://codereview.chromium.org/8224025/diff/43001/chrome/test/functional/bookmarks.py\nFile chrome/test/functional/bookmarks.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/functional/bookmarks.py#newcode481\nchrome/test/functional/bookmarks.py:481: class BookmarksAndSyncTest(pyauto.PyUITest):\nOn 2011/10/27 05:37:55, Nirnimesh wrote:\n> I think this should reside in sync.py\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/functional/bookmarks.py#newcode495\nchrome/test/functional/bookmarks.py:495: \nOn 2011/10/27 05:37:55, Nirnimesh wrote:\n> nit: remove blank line\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/functional/bookmarks.py#newcode512\nchrome/test/functional/bookmarks.py:512: new_browser = self.LaunchNewBrowser(\nOn 2011/10/27 05:37:55, Nirnimesh wrote:\n> you're referring this as browser 2 everywhere. Rename var to browser2 for\n> clarity\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (left):\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#oldcode154\nchrome/test/pyautolib/pyauto.py:154: def _SetExtraChromeFlags(self):\nOn 2011/10/27 05:37:55, Nirnimesh wrote:\n> why are you moving this?\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#oldcode3795\nchrome/test/pyautolib/pyauto.py:3795: def ConnectToCellularNetwork(self):\nOn 2011/10/27 05:37:55, Nirnimesh wrote:\n> why?\n\nI don't know why this was removed. I synced it to TOT before uploading the changes.\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode606\nchrome/test/pyautolib/pyauto.py:606: PyUITest.tearDown(self)\nOn 2011/10/27 05:37:55, Nirnimesh wrote:\n> Since tearDown is being called in __del__, call setUp in __init__()\n\nAdded __init__() where I call setUp()\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode610\nchrome/test/pyautolib/pyauto.py:610: new_browser.setUp(chrome_flags)\nOn 2011/10/27 05:37:55, Nirnimesh wrote:\n> see previous comment.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode625\nchrome/test/pyautolib/pyauto.py:625: 'net/tools/testserver/testserver.py')\nOn 2011/10/27 05:37:55, Nirnimesh wrote:\n> / will not work on win. Use join\n\nThis function no longer exists.\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode626\nchrome/test/pyautolib/pyauto.py:626: EXTRA_PYTHON_PATH = [\nOn 2011/10/27 05:37:55, Nirnimesh wrote:\n> why caps?\n\nThis function no longer exists.\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode627\nchrome/test/pyautolib/pyauto.py:627: os.path.join(pyauto_paths.GetThirdPartyDir(), 'pyftpdlib/src'),\nOn 2011/10/27 05:37:55, Nirnimesh wrote:\n> do not use /\n> Use join\n\nThis function no longer exists.\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode637\nchrome/test/pyautolib/pyauto.py:637: args = command_line.split()\nOn 2011/10/27 05:37:55, Nirnimesh wrote:\n> why not directly construct a list.\n\nThis function no longer exists.\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode648\nchrome/test/pyautolib/pyauto.py:648: test_server_data_len = struct.unpack('=L', data[:4])[0]\nOn 2011/10/27 05:37:55, Nirnimesh wrote:\n> what is this for?\n\nThis function no longer exists.\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode652\nchrome/test/pyautolib/pyauto.py:652: logging.debug('Started sync server.')\nOn 2011/10/27 05:37:55, Nirnimesh wrote:\n> Include the port info as well\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode662\nchrome/test/pyautolib/pyauto.py:662: logging.debug('Stopped sync server.')\nOn 2011/10/27 05:37:55, Nirnimesh wrote:\n> include port info as well\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/43001/chrome/test/pyautolib/pyauto.py#newcode4746\nchrome/test/pyautolib/pyauto.py:4746: os.putenv('CHROME_HEADLESS', '1')\nOn 2011/10/27 05:37:55, Nirnimesh wrote:\n> why?\n\nI didn't add this. This has always been here.","disapproval":false,"date":"2011-10-31 19:40:58.600836","approval":false},{"sender":"nirnimesh@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"Looks very good now. Just some minor issues remaining.\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/functional/bookmarks.py\nFile chrome/test/functional/bookmarks.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/functional/bookmarks.py#newcode15\nchrome/test/functional/bookmarks.py:15: import test_utils\nunused?\n\nLooks like you do not have to edit this file afterall.\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/functional/bookmarks.py#newcode482\nchrome/test/functional/bookmarks.py:482: pyauto_functional.main()\nwhy? This won't work.\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/functional/sync.py\nFile chrome/test/functional/sync.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/functional/sync.py#newcode98\nchrome/test/functional/sync.py:98: class SyncIntegrationTest(pyauto.PyUITest):\nI think 'sync' tests are disabled at the moment. Enable 'sync.SyncIntegrationTest' specifically in the win section of the CONTINUOUS suite.\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/functional/sync.py#newcode112\nchrome/test/functional/sync.py:112: self.sync_server = self.StartSyncServer()\nsync_server can be private.\n\nsync_server -> _sync_server\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (left):\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py#oldcode154\nchrome/test/pyautolib/pyauto.py:154: def _SetExtraChromeFlags(self):\nWhy are you moving this?\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py#newcode42\nchrome/test/pyautolib/pyauto.py:42: import struct\nunused?\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py#newcode577\nchrome/test/pyautolib/pyauto.py:577: def LaunchNewBrowser(chrome_flags=[]):\nAll that this function does is create an instance of ExtraBrowser().\nI wouldn't mind ExtraBrowser being out of this function, inside PyUITest class, and then you could get rid of LaunchNewBrowser completely.\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py#newcode592\nchrome/test/pyautolib/pyauto.py:592: \"\"\"Accepts Chrome flags to set up launching a new browser.\n\"Accepts Chrome flags to set up launching a new browser\" -> \"Accepts extra chrome flags for launching a new browser instance\"\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py#newcode595\nchrome/test/pyautolib/pyauto.py:595: chrome_flags: browser flags.\nextra chrome flags\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py#newcode598\nchrome/test/pyautolib/pyauto.py:598: self.chrome_flags = chrome_flags\nchrome_flags should be private.\nself._chrome_flags\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py#newcode630\nchrome/test/pyautolib/pyauto.py:630: def _SetExtraChromeFlags(self):\ndo not move this.","disapproval":false,"date":"2011-11-01 08:31:33.334853","approval":false},{"sender":"nirnimesh@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"Please commit the test_sync_account data file (separate CL).\nPlease use the trybots with -b win -t pyauto_functional_tests\n\nI get this:\n\n======================================================================\nERROR: sync.SyncIntegrationTest.testAddBookmarkAndVerifySync: \"Verify a bookmark syncs between two browsers.\"\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/disk2/code/cr-git/src/chrome/test/functional/sync.py\", line 132, in testAddBookmarkAndVerifySync\n    test_utils.SignInToSyncAndVerifyState(self, account_key)\n  File \"/disk2/code/cr-git/src/chrome/test/functional/test_utils.py\", line 326, in SignInToSyncAndVerifyState\n    creds = test.GetPrivateInfo()[account_key]\nKeyError: 'test_sync_account'","disapproval":false,"date":"2011-11-01 17:35:32.987314","approval":false},{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"Requesting response from Nir for two questions before uploading the changes.\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/functional/bookmarks.py\nFile chrome/test/functional/bookmarks.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/functional/bookmarks.py#newcode15\nchrome/test/functional/bookmarks.py:15: import test_utils\nOn 2011/11/01 08:31:33, Nirnimesh wrote:\n> unused?\n> \n> Looks like you do not have to edit this file afterall.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/functional/bookmarks.py#newcode482\nchrome/test/functional/bookmarks.py:482: pyauto_functional.main()\nOn 2011/11/01 08:31:33, Nirnimesh wrote:\n> why? This won't work.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/functional/sync.py\nFile chrome/test/functional/sync.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/functional/sync.py#newcode98\nchrome/test/functional/sync.py:98: class SyncIntegrationTest(pyauto.PyUITest):\nOn 2011/11/01 08:31:33, Nirnimesh wrote:\n> I think 'sync' tests are disabled at the moment. Enable\n> 'sync.SyncIntegrationTest' specifically in the win section of the CONTINUOUS\n> suite.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/functional/sync.py#newcode112\nchrome/test/functional/sync.py:112: self.sync_server = self.StartSyncServer()\nOn 2011/11/01 08:31:33, Nirnimesh wrote:\n> sync_server can be private.\n> \n> sync_server -> _sync_server\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py#newcode42\nchrome/test/pyautolib/pyauto.py:42: import struct\nOn 2011/11/01 08:31:33, Nirnimesh wrote:\n> unused?\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py#newcode577\nchrome/test/pyautolib/pyauto.py:577: def LaunchNewBrowser(chrome_flags=[]):\nOn 2011/11/01 08:31:33, Nirnimesh wrote:\n> All that this function does is create an instance of ExtraBrowser().\n> I wouldn't mind ExtraBrowser being out of this function, inside PyUITest class,\n> and then you could get rid of LaunchNewBrowser completely.\n\nThis class ExtraBrowser cannot be put inside PyUITest because it inherits from PyUITest and when the interpreter reads this class it tries to find PyUITest but it hasn't yet finished with PyUITest, so it gives \"NameError: name 'PyUITest' is not defined\".\n\nWhen the same class is nested in a function the interpreter won't bother with this class and it will try to define this class only when the function is invoked but by then 'PyUITest' it is already defined.\ne.g. This gives error NameError: name 'A' is not defined:\nclass A(object):\n  class B(A):\n    pass\n\nbut this is ok:\nclass A(object):\n  def f(self):\n    class B(A):\n      pass\n    return B()\n\nWhat I can do is put the class ExtraBrowser outside pyUITest so to create a new browser you just call pyauto.ExtraBrowser(optional flags). Is this what you want done?\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py#newcode592\nchrome/test/pyautolib/pyauto.py:592: \"\"\"Accepts Chrome flags to set up launching a new browser.\nOn 2011/11/01 08:31:33, Nirnimesh wrote:\n> \"Accepts Chrome flags to set up launching a new browser\" -> \"Accepts extra\n> chrome flags for launching a new browser instance\"\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py#newcode595\nchrome/test/pyautolib/pyauto.py:595: chrome_flags: browser flags.\nOn 2011/11/01 08:31:33, Nirnimesh wrote:\n> extra chrome flags\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py#newcode598\nchrome/test/pyautolib/pyauto.py:598: self.chrome_flags = chrome_flags\nOn 2011/11/01 08:31:33, Nirnimesh wrote:\n> chrome_flags should be private.\n> self._chrome_flags\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py#newcode630\nchrome/test/pyautolib/pyauto.py:630: def _SetExtraChromeFlags(self):\nOn 2011/11/01 08:31:33, Nirnimesh wrote:\n> do not move this.\n\nWhere should I move this back to? Above 'def setUp(self):'?","disapproval":false,"date":"2011-11-02 19:39:32.080220","approval":false},{"sender":"nirnimesh@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"http://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py#newcode577\nchrome/test/pyautolib/pyauto.py:577: def LaunchNewBrowser(chrome_flags=[]):\n\n> What I can do is put the class ExtraBrowser outside pyUITest so to create a new\n> browser you just call pyauto.ExtraBrowser(optional flags). Is this what you want\n> done?\n\nThis sounds good to me.\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py#newcode630\nchrome/test/pyautolib/pyauto.py:630: def _SetExtraChromeFlags(self):\nYes, please move it to where it originally was.","disapproval":false,"date":"2011-11-02 19:47:58.552747","approval":false},{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"http://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py#newcode577\nchrome/test/pyautolib/pyauto.py:577: def LaunchNewBrowser(chrome_flags=[]):\nOn 2011/11/02 19:47:58, Nirnimesh wrote:\n> \n> > What I can do is put the class ExtraBrowser outside pyUITest so to create a\n> new\n> > browser you just call pyauto.ExtraBrowser(optional flags). Is this what you\n> want\n> > done?\n> \n> This sounds good to me.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/48001/chrome/test/pyautolib/pyauto.py#newcode630\nchrome/test/pyautolib/pyauto.py:630: def _SetExtraChromeFlags(self):\nOn 2011/11/02 19:47:58, Nirnimesh wrote:\n> Yes, please move it to where it originally was.\n\nDone.","disapproval":false,"date":"2011-11-02 22:30:03.074315","approval":false},{"sender":"nirnimesh@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"A few more things need to happen before this can go in:\n\n1. DEPS that pulls in pyauto_private needs to be uprev'd. I sent you CL for that.\n2. You're assuming that the sync protobufs are present on the device where it runs. This is not true on any machine that does not build from source, including the Chrome QA machines. You'd need to:\n  a. begin archiving the protobufs\n  b. update the scripts (buildbot + fetch_prebuilt_pyauto) to fetch protobufs.\n\nTraceback (most recent call last):\n  File \"/Volumes/1/chrome/cr-git/src/net/tools/testserver/testserver.py\", line 1934, in <module>\n    sys.exit(main(options, args))\n  File \"/Volumes/1/chrome/cr-git/src/net/tools/testserver/testserver.py\", line 1793, in main\n    server = SyncHTTPServer(('127.0.0.1', port), SyncPageHandler)\n  File \"/Volumes/1/chrome/cr-git/src/net/tools/testserver/testserver.py\", line 131, in __init__\n    import chromiumsync\n  File \"/Volumes/1/chrome/cr-git/src/net/tools/testserver/chromiumsync.py\", line 21, in <module>\n    import app_notification_specifics_pb2\nImportError: No module named app_notification_specifics_pb2\n[42776:2571:1102/173109:2593649178665150:ERROR:test_server_posix.cc(145)] Could not read server_data_len\n[      ERROR ] sync.SyncIntegrationTest.testAddBookmarkAndVerifySync\n\n======================================================================\nERROR: sync.SyncIntegrationTest.testAddBookmarkAndVerifySync: \"Verify a bookmark syncs between two browsers.\"\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/Volumes/1/chrome/cr-git/src/chrome/test/functional/sync.py\", line 112, in setUp\n    self._sync_server = self.StartSyncServer()\n  File \"chrome/test/functional/../pyautolib/pyauto.py\", line 684, in StartSyncServer\n    assert sync_server.Start(), 'Could not start sync server'\nAssertionError: Could not start sync server","disapproval":false,"date":"2011-11-03 00:36:35.930995","approval":false},{"sender":"nirnimesh@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"Since the process of archiving is a long drawn one (it'll take time for buildbot scripts to be updated), I'm fine with running this on the chromium win bots only for now. ie enable in the CONTINUOUS win section only.\n\nhttp://codereview.chromium.org/8224025/diff/53002/chrome/test/functional/PYAUTO_TESTS\nFile chrome/test/functional/PYAUTO_TESTS (right):\n\nhttp://codereview.chromium.org/8224025/diff/53002/chrome/test/functional/PYAUTO_TESTS#newcode472\nchrome/test/functional/PYAUTO_TESTS:472: 'sync.SyncIntegrationTest',\nFULL already includes CONTINUOUS. You don't need to put it here again","disapproval":false,"date":"2011-11-03 00:40:03.258387","approval":false},{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"http://codereview.chromium.org/8224025/diff/53002/chrome/test/functional/PYAUTO_TESTS\nFile chrome/test/functional/PYAUTO_TESTS (right):\n\nhttp://codereview.chromium.org/8224025/diff/53002/chrome/test/functional/PYAUTO_TESTS#newcode472\nchrome/test/functional/PYAUTO_TESTS:472: 'sync.SyncIntegrationTest',\nOn 2011/11/03 00:40:03, Nirnimesh wrote:\n> FULL already includes CONTINUOUS. You don't need to put it here again\n\nDone.","disapproval":false,"date":"2011-11-03 01:42:24.191603","approval":false},{"sender":"nirnimesh@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"LGTM after you re-sync your client and resolve.\n\nThis is looking very good now. I can see this being very useful for functional verification of a lot of sync properties -- you've added a test for bookmarks but it can (and should) definitely be expanded to cover functional testing for other things like syncing of extensions, apps, prefs, etc.\n\nhttp://codereview.chromium.org/8224025/diff/59001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/59001/chrome/test/pyautolib/pyauto.py#newcode595\nchrome/test/pyautolib/pyauto.py:595: \nAdd: Use the 'ExtraBrowser' class to launch a new browser with these flags.\n\nhttp://codereview.chromium.org/8224025/diff/59001/chrome/test/pyautolib/pyauto.py#newcode1082\nchrome/test/pyautolib/pyauto.py:1082: self._SendJSONRequest(0,\nPlease re-sync your client. This change should not be in your CL.\n\nhttp://codereview.chromium.org/8224025/diff/59001/chrome/test/pyautolib/pyauto.py#newcode1113\nchrome/test/pyautolib/pyauto.py:1113: self._GetResultFromJSONRequest(cmd_dict)\nThis one too should not be there.","disapproval":false,"date":"2011-11-03 04:48:44.344804","approval":true},{"sender":"dyu@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"http://codereview.chromium.org/8224025/diff/59001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/59001/chrome/test/pyautolib/pyauto.py#newcode595\nchrome/test/pyautolib/pyauto.py:595: \nOn 2011/11/03 04:48:44, Nirnimesh wrote:\n> Add: Use the 'ExtraBrowser' class to launch a new browser with these flags.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/59001/chrome/test/pyautolib/pyauto.py#newcode1082\nchrome/test/pyautolib/pyauto.py:1082: self._SendJSONRequest(0,\nOn 2011/11/03 04:48:44, Nirnimesh wrote:\n> Please re-sync your client. This change should not be in your CL.\n\nDone.\n\nhttp://codereview.chromium.org/8224025/diff/59001/chrome/test/pyautolib/pyauto.py#newcode1113\nchrome/test/pyautolib/pyauto.py:1113: self._GetResultFromJSONRequest(cmd_dict)\nOn 2011/11/03 04:48:44, Nirnimesh wrote:\n> This one too should not be there.\n\nDone.","disapproval":false,"date":"2011-11-03 21:29:46.704335","approval":false},{"sender":"nirnimesh@chromium.org","recipients":["dyu@chromium.org","dennisjeffrey@chromium.org","nirnimesh@chromium.org","rsimha@chromium.org","chromium-reviews@chromium.org","jrg@chromium.org","anantha@chromium.org","phajdan.jr@chromium.org","dennisjeffrey@chromium.org"],"text":"http://codereview.chromium.org/8224025/diff/60001/chrome/test/pyautolib/pyauto.py\nFile chrome/test/pyautolib/pyauto.py (right):\n\nhttp://codereview.chromium.org/8224025/diff/60001/chrome/test/pyautolib/pyauto.py#newcode1084\nchrome/test/pyautolib/pyauto.py:1084: self._SendJSONRequest(0,\nThis is still there.\n\nhttp://codereview.chromium.org/8224025/diff/60001/chrome/test/pyautolib/pyauto.py#newcode1115\nchrome/test/pyautolib/pyauto.py:1115: self._GetResultFromJSONRequest(cmd_dict)\nand this.","disapproval":false,"date":"2011-11-03 23:21:39.024301","approval":false}],"owner_email":"dyu@chromium.org","private":false,"base_url":"svn://chrome-svn/chrome/trunk/src/","owner":"dyu1","subject":"Added the ability launch multiple instances of the Chrome browser with flags.","created":"2011-10-11 02:09:42.755396","patchsets":[1,7001,11001,17001,11004,21001,31001,34001,37001,43001,48001,53002,59001,60001],"modified":"2011-11-03 23:21:39.501122","closed":true,"commit":false,"issue":8224025}