{"files":{"cc/trees/proxy.h":{"status":"M","num_chunks":1,"no_base_file":false,"property_changes":"","num_added":3,"num_removed":12,"messages":[],"id":65023,"is_binary":false},"cc/trees/thread_proxy.cc":{"status":"M","num_chunks":11,"no_base_file":false,"property_changes":"","num_added":171,"num_removed":132,"messages":[{"author":"danakj","author_email":"danakj@chromium.org","text":"accessing an impl variable on the main thread without a lock = no.\n\nbut you just passed this value in with the bind, so you shouldn't need it right? in fact, this condition would never be true since was_first_create = !has_renderer_caps_on_impl_thread","draft":false,"lineno":994,"date":"2013-04-12 00:38:35.174680","left":false},{"author":"danakj","author_email":"danakj@chromium.org","text":"why would this function even be called then in this scenario? should this be a dcheck/notreached?","draft":false,"lineno":995,"date":"2013-04-12 00:38:35.175030","left":false},{"author":"danakj","author_email":"danakj@chromium.org","text":"I'm not clear why this is a PostTask to the main thread when we're already on the main thread. James, what's the logic here in the old code?","draft":false,"lineno":1000,"date":"2013-04-12 00:38:35.175370","left":false},{"author":"danakj","author_email":"danakj@chromium.org","text":"I think an enum here instead of a bool woudl help readability a bunch","draft":false,"lineno":1004,"date":"2013-04-12 00:38:35.175690","left":false},{"author":"danakj","author_email":"danakj@chromium.org","text":"Heh, please do this without gotos. :)","draft":false,"lineno":1015,"date":"2013-04-12 00:38:35.176010","left":false},{"author":"danakj","author_email":"danakj@chromium.org","text":"this should be ::RecreateOutputSurface... I guess","draft":false,"lineno":1094,"date":"2013-04-12 00:38:35.176330","left":false},{"author":"danakj","author_email":"danakj@chromium.org","text":"Should this tell the caller that it didn't do anything? This is going to return success = true, implicitly, but it's not obvious IMO. This could be more clear.","draft":false,"lineno":1108,"date":"2013-04-12 00:38:35.176660","left":false},{"author":"danakj","author_email":"danakj@chromium.org","text":"seems like this should be an early out\n\nif !success\n  bind/verify contexts\n  signal\n  return\n\nthen youll have much less if (success) checks here.","draft":false,"lineno":1122,"date":"2013-04-12 00:38:35.176990","left":false},{"author":"danakj","author_email":"danakj@chromium.org","text":"rahter than \"ignoring_vsync\" in here, what about something like \"initialize_renderer_immediately\"? or \"synchronously\".. or something.","draft":false,"lineno":1127,"date":"2013-04-12 00:38:35.177300","left":false},{"author":"danakj","author_email":"danakj@chromium.org","text":"How does the offscreen context provider get to the init renderer function in this case?","draft":false,"lineno":1128,"date":"2013-04-12 00:38:35.177610","left":false},{"author":"danakj","author_email":"danakj@chromium.org","text":"are the caps NULL sometimes? I dont see that.","draft":false,"lineno":1129,"date":"2013-04-12 00:38:35.177880","left":false},{"author":"danakj","author_email":"danakj@chromium.org","text":"same comment about an early-out condition. you could do this right after trying to initialize and return there.","draft":false,"lineno":1167,"date":"2013-04-12 00:38:35.178150","left":false},{"author":"boliu","author_email":"boliu@chromium.org","text":"On 2013/04/12 00:38:35, danakj wrote:\n> accessing an impl variable on the main thread without a lock = no.\n> \n> but you just passed this value in with the bind, so you shouldn't need it right?\n> in fact, this condition would never be true since was_first_create =\n> !has_renderer_caps_on_impl_thread\n\nchanged to main thread copy","draft":false,"lineno":994,"date":"2013-04-12 02:10:21.071110","left":false},{"author":"boliu","author_email":"boliu@chromium.org","text":"On 2013/04/12 00:38:35, danakj wrote:\n> why would this function even be called then in this scenario? should this be a\n> dcheck/notreached?\n\nThis is the two paths, synchronous RecreateOutputSurfaceAndInitializeRenderer and the async one here, interacting in bad ways.\n\nSo the async path is kicked off when first initialized, then if RecreateOutputSurfaceAndInitializeRenderer is called immediately after and wins the race, can actually fall into this case.\n\nLayerTreeHostTestDeviceScaleFactorScalesViewportAndLayers.RunMultiThread is the first test that does this, and without this early return, it just hangs.\n\nI would like to understand why the test hangs without this, but I presume it's probably a test problem.\n\nI would also like add more tests specifically testing how these two recreate paths interact","draft":false,"lineno":995,"date":"2013-04-12 02:10:21.071400","left":false},{"author":"boliu","author_email":"boliu@chromium.org","text":"On 2013/04/12 00:38:35, danakj wrote:\n> I'm not clear why this is a PostTask to the main thread when we're already on\n> the main thread. James, what's the logic here in the old code?\n\nThis is for the *retrying* recreate if it fails. output_surface_recreation_callback_ is posted again if LTH::OnCreateAttemped returns retry, and cancelled if succeeds.","draft":false,"lineno":1000,"date":"2013-04-12 02:10:21.071580","left":false},{"author":"boliu","author_email":"boliu@chromium.org","text":"On 2013/04/12 00:38:35, danakj wrote:\n> this should be ::RecreateOutputSurface... I guess\n\nused for both initial create and recreate, so hard to come up with sensible names...","draft":false,"lineno":1094,"date":"2013-04-12 02:10:21.071770","left":false},{"author":"boliu","author_email":"boliu@chromium.org","text":"On 2013/04/12 00:38:35, danakj wrote:\n> Should this tell the caller that it didn't do anything? This is going to return\n> success = true, implicitly, but it's not obvious IMO. This could be more clear.\n\nGoing to make default to false at callsite and explicitly set to true here.","draft":false,"lineno":1108,"date":"2013-04-12 02:10:21.072000","left":false},{"author":"boliu","author_email":"boliu@chromium.org","text":"On 2013/04/12 00:38:35, danakj wrote:\n> seems like this should be an early out\n> \n> if !success\n>   bind/verify contexts\n>   signal\n>   return\n> \n> then youll have much less if (success) checks here.\n\nDone.","draft":false,"lineno":1122,"date":"2013-04-12 02:10:21.072200","left":false},{"author":"boliu","author_email":"boliu@chromium.org","text":"On 2013/04/12 00:38:35, danakj wrote:\n> How does the offscreen context provider get to the init renderer function in\n> this case?\n\nBug! Make setting offscreen_context_provider_passed_ unconditioned","draft":false,"lineno":1128,"date":"2013-04-12 02:10:21.072370","left":false},{"author":"boliu","author_email":"boliu@chromium.org","text":"On 2013/04/12 00:38:35, danakj wrote:\n> are the caps NULL sometimes? I dont see that.\n\nin older version..\n\nRemoved this check and add DCHECK at beginning of function for success and capabilities","draft":false,"lineno":1129,"date":"2013-04-12 02:10:21.072540","left":false},{"author":"boliu","author_email":"boliu@chromium.org","text":"On 2013/04/12 00:38:35, danakj wrote:\n> same comment about an early-out condition. you could do this right after trying\n> to initialize and return there.\n\nRemoved the !has_renderer_capabilities_on_impl_thread_ above as James was saying we should be updating these capabilities on every recreate.\n\nThen merge the into a single if/else if","draft":false,"lineno":1167,"date":"2013-04-12 02:10:21.072700","left":false}],"id":65026,"is_binary":false},"cc/test/layer_tree_test.cc":{"status":"M","num_chunks":3,"no_base_file":false,"property_changes":"","num_added":30,"num_removed":3,"messages":[],"id":65014,"is_binary":false},"cc/scheduler/scheduler_state_machine_unittest.cc":{"status":"M","num_chunks":45,"no_base_file":false,"property_changes":"","num_added":68,"num_removed":22,"messages":[],"id":65010,"is_binary":false},"cc/trees/layer_tree_host_unittest.cc":{"status":"M","num_chunks":7,"no_base_file":false,"property_changes":"","num_added":38,"num_removed":49,"messages":[],"id":65021,"is_binary":false},"cc/trees/thread_proxy.h":{"status":"M","num_chunks":7,"no_base_file":false,"property_changes":"","num_added":32,"num_removed":20,"messages":[],"id":65027,"is_binary":false},"cc/test/fake_proxy.cc":{"status":"M","num_chunks":2,"no_base_file":false,"property_changes":"","num_added":10,"num_removed":5,"messages":[],"id":65012,"is_binary":false},"cc/scheduler/scheduler_state_machine.h":{"status":"M","num_chunks":4,"no_base_file":false,"property_changes":"","num_added":6,"num_removed":3,"messages":[],"id":65009,"is_binary":false},"cc/trees/layer_tree_host.cc":{"status":"M","num_chunks":6,"no_base_file":false,"property_changes":"","num_added":82,"num_removed":73,"messages":[],"id":65016,"is_binary":false},"cc/trees/layer_tree_host.h":{"status":"M","num_chunks":3,"no_base_file":false,"property_changes":"","num_added":5,"num_removed":3,"messages":[],"id":65017,"is_binary":false},"cc/trees/layer_tree_host_impl.cc":{"status":"M","num_chunks":2,"no_base_file":false,"property_changes":"","num_added":27,"num_removed":13,"messages":[],"id":65018,"is_binary":false},"cc/trees/layer_tree_host_impl.h":{"status":"M","num_chunks":1,"no_base_file":false,"property_changes":"","num_added":4,"num_removed":1,"messages":[],"id":65019,"is_binary":false},"cc/layers/delegated_renderer_layer_impl_unittest.cc":{"status":"M","num_chunks":1,"no_base_file":false,"property_changes":"","num_added":1,"num_removed":1,"messages":[],"id":65001,"is_binary":false},"cc/trees/layer_tree_host_unittest_context.cc":{"status":"M","num_chunks":10,"no_base_file":false,"property_changes":"","num_added":29,"num_removed":15,"messages":[],"id":65022,"is_binary":false},"cc/trees/single_thread_proxy.h":{"status":"M","num_chunks":2,"no_base_file":false,"property_changes":"","num_added":2,"num_removed":8,"messages":[],"id":65025,"is_binary":false},"cc/test/fake_proxy.h":{"status":"M","num_chunks":2,"no_base_file":false,"property_changes":"","num_added":6,"num_removed":4,"messages":[],"id":65013,"is_binary":false},"cc/scheduler/scheduler.cc":{"status":"M","num_chunks":2,"no_base_file":false,"property_changes":"","num_added":17,"num_removed":7,"messages":[],"id":65006,"is_binary":false},"cc/trees/layer_tree_host_impl_unittest.cc":{"status":"M","num_chunks":17,"no_base_file":false,"property_changes":"","num_added":17,"num_removed":17,"messages":[],"id":65020,"is_binary":false},"cc/layers/layer_impl_unittest.cc":{"status":"M","num_chunks":2,"no_base_file":false,"property_changes":"","num_added":2,"num_removed":2,"messages":[],"id":65002,"is_binary":false},"cc/scheduler/scheduler_state_machine.cc":{"status":"M","num_chunks":7,"no_base_file":false,"property_changes":"","num_added":36,"num_removed":8,"messages":[],"id":65008,"is_binary":false},"cc/layers/picture_layer_impl_unittest.cc":{"status":"M","num_chunks":1,"no_base_file":false,"property_changes":"","num_added":1,"num_removed":1,"messages":[],"id":65004,"is_binary":false},"cc/scheduler/scheduler.h":{"status":"M","num_chunks":3,"no_base_file":false,"property_changes":"","num_added":6,"num_removed":1,"messages":[],"id":65007,"is_binary":false},"cc/test/layer_tree_test.h":{"status":"M","num_chunks":4,"no_base_file":false,"property_changes":"","num_added":6,"num_removed":0,"messages":[],"id":65015,"is_binary":false},"cc/scheduler/scheduler_unittest.cc":{"status":"M","num_chunks":13,"no_base_file":false,"property_changes":"","num_added":62,"num_removed":1,"messages":[],"id":65011,"is_binary":false},"cc/layers/texture_layer_unittest.cc":{"status":"M","num_chunks":1,"no_base_file":false,"property_changes":"","num_added":2,"num_removed":1,"messages":[],"id":65005,"is_binary":false},"cc/layers/picture_image_layer_impl_unittest.cc":{"status":"M","num_chunks":1,"no_base_file":false,"property_changes":"","num_added":1,"num_removed":1,"messages":[],"id":65003,"is_binary":false},"cc/trees/single_thread_proxy.cc":{"status":"M","num_chunks":4,"no_base_file":false,"property_changes":"","num_added":41,"num_removed":51,"messages":[],"id":65024,"is_binary":false}},"owner_email":"boliu@chromium.org","owner":"boliu","message":"Cleaned up thread_proxy; have not renamed anything yet. Somewhat sane to look at now.","try_job_results":[{"parent_name":null,"tests":["defaulttests"],"slave":"vm373-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/win_rel/builds/134050","timestamp":"2013-04-12 00:04:40.784068","builder":"win_rel","clobber":false,"project":"Chromium Try Server","reason":"glrenderer_init","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYoND9BQwLEghQYXRjaFNldBiB9AMMCxIMVHJ5Sm9iUmVzdWx0GI30Aww","requester":"boliu@chromium.org","buildnumber":"134050","revision":"193624"},{"parent_name":null,"tests":["defaulttests"],"slave":"slave362-c4","url":"http://build.chromium.org/p/tryserver.chromium/builders/linux_chromeos/builds/102439","timestamp":"2013-04-11 20:55:25.140339","builder":"linux_chromeos","clobber":false,"project":"Chromium Try Server","reason":"glrenderer_init","result":"2","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYoND9BQwLEghQYXRjaFNldBiB9AMMCxIMVHJ5Sm9iUmVzdWx0GIP0Aww","requester":"boliu@chromium.org","buildnumber":"102439","revision":"193624"},{"parent_name":"android_dbg","tests":["defaulttests"],"slave":"chromeperf53","url":"http://build.chromium.org/p/tryserver.chromium/builders/android_dbg_triggered_tests/builds/44844","timestamp":"2013-04-11 20:38:59.164278","builder":"android_dbg_triggered_tests","clobber":false,"project":"Chromium Try Server","reason":"Triggerable(android_dbg)","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYoND9BQwLEghQYXRjaFNldBiB9AMMCxIMVHJ5Sm9iUmVzdWx0GKGTBAw","requester":null,"buildnumber":"44844","revision":"193624"},{"parent_name":null,"tests":["defaulttests"],"slave":"vm186-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/win7_aura/builds/28332","timestamp":"2013-04-11 20:38:35.178806","builder":"win7_aura","clobber":false,"project":"Chromium Try Server","reason":"glrenderer_init","result":"2","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYoND9BQwLEghQYXRjaFNldBiB9AMMCxIMVHJ5Sm9iUmVzdWx0GIT0Aww","requester":"boliu@chromium.org","buildnumber":"28332","revision":"193624"},{"parent_name":null,"tests":["defaulttests"],"slave":"slave303-c4","url":"http://build.chromium.org/p/tryserver.chromium/builders/linux_rel/builds/116387","timestamp":"2013-04-11 20:29:28.377144","builder":"linux_rel","clobber":false,"project":"Chromium Try Server","reason":"glrenderer_init","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYoND9BQwLEghQYXRjaFNldBiB9AMMCxIMVHJ5Sm9iUmVzdWx0GJH0Aww","requester":"boliu@chromium.org","buildnumber":"116387","revision":"193624"},{"parent_name":null,"tests":["defaulttests"],"slave":"slave335-c4","url":"http://build.chromium.org/p/tryserver.chromium/builders/linux_layout_rel/builds/3458","timestamp":"2013-04-11 20:27:11.957681","builder":"linux_layout_rel","clobber":false,"project":"Chromium Try Server","reason":"glrenderer_init","result":"2","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYoND9BQwLEghQYXRjaFNldBiB9AMMCxIMVHJ5Sm9iUmVzdWx0GI_0Aww","requester":"boliu@chromium.org","buildnumber":"3458","revision":"193624"},{"parent_name":null,"tests":["defaulttests"],"slave":"vm653-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/mac_asan/builds/26947","timestamp":"2013-04-11 20:23:01.655746","builder":"mac_asan","clobber":false,"project":"Chromium Try Server","reason":"glrenderer_init","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYoND9BQwLEghQYXRjaFNldBiB9AMMCxIMVHJ5Sm9iUmVzdWx0GI70Aww","requester":"boliu@chromium.org","buildnumber":"26947","revision":"193624"},{"parent_name":null,"tests":["defaulttests"],"slave":"vm699-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/mac_rel/builds/117400","timestamp":"2013-04-11 20:20:18.141820","builder":"mac_rel","clobber":false,"project":"Chromium Try Server","reason":"glrenderer_init","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYoND9BQwLEghQYXRjaFNldBiB9AMMCxIMVHJ5Sm9iUmVzdWx0GJD0Aww","requester":"boliu@chromium.org","buildnumber":"117400","revision":"193624"},{"parent_name":null,"tests":["defaulttests"],"slave":"slave342-c4","url":"http://build.chromium.org/p/tryserver.chromium/builders/linux_aura/builds/31477","timestamp":"2013-04-11 20:17:34.159302","builder":"linux_aura","clobber":false,"project":"Chromium Try Server","reason":"glrenderer_init","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYoND9BQwLEghQYXRjaFNldBiB9AMMCxIMVHJ5Sm9iUmVzdWx0GIL0Aww","requester":"boliu@chromium.org","buildnumber":"31477","revision":"193624"},{"parent_name":null,"tests":["compile"],"slave":"vm718-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/mac/builds/42646","timestamp":"2013-04-11 20:01:23.304248","builder":"mac","clobber":false,"project":"Chromium Try Server","reason":"glrenderer_init","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYoND9BQwLEghQYXRjaFNldBiB9AMMCxIMVHJ5Sm9iUmVzdWx0GIr0Aww","requester":"boliu@chromium.org","buildnumber":"42646","revision":"193624"},{"parent_name":null,"tests":["compile"],"slave":"vm133-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/win/builds/63859","timestamp":"2013-04-11 19:57:27.630465","builder":"win","clobber":false,"project":"Chromium Try Server","reason":"glrenderer_init","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYoND9BQwLEghQYXRjaFNldBiB9AMMCxIMVHJ5Sm9iUmVzdWx0GIf0Aww","requester":"boliu@chromium.org","buildnumber":"63859","revision":"193624"},{"parent_name":null,"tests":["defaulttests"],"slave":"vm448-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/android_dbg/builds/52484","timestamp":"2013-04-11 19:57:03.822179","builder":"android_dbg","clobber":false,"project":"Chromium Try Server","reason":"glrenderer_init","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYoND9BQwLEghQYXRjaFNldBiB9AMMCxIMVHJ5Sm9iUmVzdWx0GIv0Aww","requester":"boliu@chromium.org","buildnumber":"52484","revision":"193624"},{"parent_name":null,"tests":["defaulttests"],"slave":"slave397-c4","url":"http://build.chromium.org/p/tryserver.chromium/builders/linux_asan/builds/26081","timestamp":"2013-04-11 19:50:15.825245","builder":"linux_asan","clobber":false,"project":"Chromium Try Server","reason":"glrenderer_init","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYoND9BQwLEghQYXRjaFNldBiB9AMMCxIMVHJ5Sm9iUmVzdWx0GIb0Aww","requester":"boliu@chromium.org","buildnumber":"26081","revision":"193624"},{"parent_name":null,"tests":["compile"],"slave":"slave336-c4","url":"http://build.chromium.org/p/tryserver.chromium/builders/linux_clang/builds/98137","timestamp":"2013-04-11 19:42:46.490707","builder":"linux_clang","clobber":false,"project":"Chromium Try Server","reason":"glrenderer_init","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYoND9BQwLEghQYXRjaFNldBiB9AMMCxIMVHJ5Sm9iUmVzdWx0GIz0Aww","requester":"boliu@chromium.org","buildnumber":"98137","revision":"193624"},{"parent_name":null,"tests":["defaulttests"],"slave":"slave103-c4","url":"http://build.chromium.org/p/tryserver.chromium/builders/android_clang_dbg/builds/34218","timestamp":"2013-04-11 19:41:27.529447","builder":"android_clang_dbg","clobber":false,"project":"Chromium Try Server","reason":"glrenderer_init","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYoND9BQwLEghQYXRjaFNldBiB9AMMCxIMVHJ5Sm9iUmVzdWx0GIX0Aww","requester":"boliu@chromium.org","buildnumber":"34218","revision":"193624"},{"parent_name":null,"tests":["defaulttests"],"slave":"mini25-l1","url":"http://build.chromium.org/p/tryserver.chromium/builders/ios_dbg_simulator/builds/42062","timestamp":"2013-04-11 19:38:04.543874","builder":"ios_dbg_simulator","clobber":false,"project":"Chromium Try Server","reason":"glrenderer_init","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYoND9BQwLEghQYXRjaFNldBiB9AMMCxIMVHJ5Sm9iUmVzdWx0GIj0Aww","requester":"boliu@chromium.org","buildnumber":"42062","revision":"193624"},{"parent_name":null,"tests":["defaulttests"],"slave":"mini29-l1","url":"http://build.chromium.org/p/tryserver.chromium/builders/ios_rel_device/builds/40335","timestamp":"2013-04-11 19:35:03.076074","builder":"ios_rel_device","clobber":false,"project":"Chromium Try Server","reason":"glrenderer_init","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYoND9BQwLEghQYXRjaFNldBiB9AMMCxIMVHJ5Sm9iUmVzdWx0GIn0Aww","requester":"boliu@chromium.org","buildnumber":"40335","revision":"193624"}],"created":"2013-04-11 19:27:08.590410","url":null,"num_comments":21,"modified":"2013-04-12 02:10:21.384410","patchset":64001,"issue":12544032}