{"description":"Revert \"Clean-up of the asynchronous behaviour of the experimental extension popup API. \"\n\nThis reverts http://codereview.chromium.org/1512007\n\nTBR=twiz\n\nCommitted: http://src.chromium.org/viewvc/chrome?view=rev&revision=46184","cc":["chromium-reviews@chromium.org"],"reviewers":["twiz@chromium.org"],"messages":[{"sender":"phajdan.jr@chromium.org","recipients":["phajdan.jr@chromium.org","twiz@chromium.org","chromium-reviews@chromium.org"],"text":"The patch apparently broke browser_test on Release Windows. Sorry for the revert. Please make sure to watch the tree after commit, and to use the release trybots when relanding.\n\nHere are the failure logs:\n\nhttp://build.chromium.org/buildbot/waterfall/builders/Chromium%20XP/builds/11721/steps/browser_tests/logs/stdio\n\n\nNote: Google Test filter = ExtensionApiTest.Popup\n[==========] Running 1 test from 1 test case.\n[----------] Global test environment set-up.\n[----------] 1 test from ExtensionApiTest\n[ RUN      ] ExtensionApiTest.Popup\nGot EXTENSION_LOADED notification.\n( RUN      ) showNoFocusShift\nGot EXTENSION_HOST_DID_STOP_LOADING notification.\nGot EXTENSION_HOST_DID_STOP_LOADING notification.\n(  SUCCESS )\n( RUN      ) noPopup\n(  SUCCESS )\n( RUN      ) noParentWindow\n(  SUCCESS )\n( RUN      ) show\n(  SUCCESS )\n( RUN      ) accessPopup\n(  SUCCESS )\n( RUN      ) accessHost\n(  SUCCESS )\n( RUN      ) closePopup\n(  SUCCESS )\n( RUN      ) popupBlackBorder\n(  SUCCESS )\n( RUN      ) disallowMultiplePopups\nBacktrace:\n\tExtensionPopupHost::NativeFocusWillChange [0x005BB600+32] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_popup_api.cc:145)\nBacktrace:\n\tExtensionPopupHost::NativeFocusWillChange [0x005BB600+32] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_popup_api.cc:145)\n\tviews::FocusManager::WidgetFocusManager::OnWidgetFocusEvent [0x012B6790+80] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\views\\focus\\focus_manager.cc:61)\n\tviews::WidgetWin::OnSetFocus [0x012CC65F+47] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\views\\widget\\widget_win.cc:878)\n\tBubbleWidget::OnSetFocus [0x0065641D+13] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\views\\browser_bubble_win.cc:85)\n\tviews::WidgetWin::_ProcessWindowMessage [0x005B9A4B+2971] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\views\\widget\\widget_win.h:170)\n\tviews::WidgetWin::ProcessWindowMessage [0x005B9CAC+44] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\views\\widget\\widget_win.h:94)\n\tviews::WidgetWin::OnWndProc [0x012CC72D+77] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\views\\widget\\widget_win.cc:1200)\n\tapp::WindowImpl::WndProc [0x008F3E48+200] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\app\\win\\window_impl.cc:185)\n\tWindowFromDC [0x7D9472D8+59]\n\tWindowFromDC [0x7D947568+715]\n\tGetWindowLongW [0x7D947D93+177]\n\tGetWindowLongW [0x7D947E46+356]\n\tKiUserCallbackDispatcher [0x7D61EA2E+46]\n\tRtlRaiseStatus [0x7D61EC1B+177]\n\tMulDiv [0x7D4D8AF9+653]\n\tMulDiv [0x7D4D8A55+489]\n\tRtlRaiseStatus [0x7D61EC4A+224]\n\tRtlRaiseStatus [0x7D61EC1B+177]\n\tKiUserExceptionDispatcher [0x7D61EA56+14]\nBacktrace:\n\tkMaxUpdateFrequencySeconds [0x0140B208+3940]\n\tExtensionHost::Observe [0x00509180+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:236)\n\tExtensionHost::GetBrowser [0x00507EE0+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.h:214)\n\tExtensionHost::GetNativeViewOfHost [0x00507F00+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.h:217)\n\tv8::internal::RegExpTree::AsQuantifier [0x00CE2560+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\v8\\src\\ast.h:2052)\n\tExtensionHost::associated_tab_contents [0x00507E80+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.h:86)\n\t[thunk]:ExtensionHost::`vector deleting destructor' [0x00507EB0+0]\n\tExtensionHost::CreateNewWindow [0x00507250+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:551)\n\tExtensionHost::CreateNewWidget [0x00507050+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:559)\n\tExtensionHost::ShowCreatedWindow [0x005072D0+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:572)\n\tExtensionHost::ShowCreatedWidget [0x00507060+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:589)\n\tv8::internal::AssignedVariablesAnalyzer::VisitThisFunction [0x00CF2200+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\v8\\src\\data-flow.cc:66)\n\tExtensionHost::StartDragging [0x00507090+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:614)\n\tv8::internal::AssignedVariablesAnalyzer::VisitThisFunction [0x00CF2200+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\v8\\src\\data-flow.cc:66)\n\tExtensionHost::GotFocus [0x00507330+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:626)\n\tv8::internal::AssignedVariablesAnalyzer::VisitThisFunction [0x00CF2200+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\v8\\src\\data-flow.cc:66)\n\tExtensionHost::PreHandleKeyboardEvent [0x00508BC0+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:641)\n\tExtensionHost::HandleKeyboardEvent [0x00507340+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:651)\n\tExtensionHost::HandleMouseEvent [0x005073A0+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:665)\n\tExtensionHost::HandleMouseLeave [0x005073B0+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:672)\n\tExtensionHost::UpdatePreferredSize [0x00507130+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:269)\n\tExtensionHost::GetViewDelegate [0x00507040+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:545)\n\tv8::internal::RegExpTree::AsQuantifier [0x00CE2560+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\v8\\src\\ast.h:2052)\n\tv8::internal::RegExpTree::AsQuantifier [0x00CE2560+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\v8\\src\\ast.h:2052)\n\tv8::internal::RegExpTree::AsQuantifier [0x00CE2560+0] (c:\\b\\slave\\chromium-rel-xp\\build\\src\\v8\\src\\ast.h:2052)","disapproval":false,"date":"2010-05-01 08:59:09.128767","approval":false},{"sender":"twiz@google.com","recipients":["reply@chromiumcodereview.appspotmail.com"],"text":"On Sat, May 1, 2010 at 4:59 AM, <phajdan.jr@chromium.org> wrote:\n\n> Reviewers: Jeff Timanus,\n>\n> Message:\n> The patch apparently broke browser_test on Release Windows. Sorry for the\n> revert. Please make sure to watch the tree after commit, and to use the\n> release\n> trybots when relanding.\n>\n\nThanks for addressing this, Phajdan.  I'll make sure to keep a special eye\non testing the follow-up with the release try-bots.\n\n\nJeff\n\n>\n> Here are the failure logs:\n>\n>\n> http://build.chromium.org/buildbot/waterfall/builders/Chromium%20XP/builds/11721/steps/browser_tests/logs/stdio\n>\n>\n> Note: Google Test filter = ExtensionApiTest.Popup\n> [==========] Running 1 test from 1 test case.\n> [----------] Global test environment set-up.\n> [----------] 1 test from ExtensionApiTest\n> [ RUN      ] ExtensionApiTest.Popup\n> Got EXTENSION_LOADED notification.\n> ( RUN      ) showNoFocusShift\n> Got EXTENSION_HOST_DID_STOP_LOADING notification.\n> Got EXTENSION_HOST_DID_STOP_LOADING notification.\n> (  SUCCESS )\n> ( RUN      ) noPopup\n> (  SUCCESS )\n> ( RUN      ) noParentWindow\n> (  SUCCESS )\n> ( RUN      ) show\n> (  SUCCESS )\n> ( RUN      ) accessPopup\n> (  SUCCESS )\n> ( RUN      ) accessHost\n> (  SUCCESS )\n> ( RUN      ) closePopup\n> (  SUCCESS )\n> ( RUN      ) popupBlackBorder\n> (  SUCCESS )\n> ( RUN      ) disallowMultiplePopups\n> Backtrace:\n>        ExtensionPopupHost::NativeFocusWillChange [0x005BB600+32]\n>\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_popup_api.cc:145)\n> Backtrace:\n>        ExtensionPopupHost::NativeFocusWillChange [0x005BB600+32]\n>\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_popup_api.cc:145)\n>        views::FocusManager::WidgetFocusManager::OnWidgetFocusEvent\n> [0x012B6790+80]\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\views\\focus\\focus_manager.cc:61)\n>        views::WidgetWin::OnSetFocus [0x012CC65F+47]\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\views\\widget\\widget_win.cc:878)\n>        BubbleWidget::OnSetFocus [0x0065641D+13]\n>\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\views\\browser_bubble_win.cc:85)\n>        views::WidgetWin::_ProcessWindowMessage [0x005B9A4B+2971]\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\views\\widget\\widget_win.h:170)\n>        views::WidgetWin::ProcessWindowMessage [0x005B9CAC+44]\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\views\\widget\\widget_win.h:94)\n>        views::WidgetWin::OnWndProc [0x012CC72D+77]\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\views\\widget\\widget_win.cc:1200)\n>        app::WindowImpl::WndProc [0x008F3E48+200]\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\app\\win\\window_impl.cc:185)\n>        WindowFromDC [0x7D9472D8+59]\n>        WindowFromDC [0x7D947568+715]\n>        GetWindowLongW [0x7D947D93+177]\n>        GetWindowLongW [0x7D947E46+356]\n>        KiUserCallbackDispatcher [0x7D61EA2E+46]\n>        RtlRaiseStatus [0x7D61EC1B+177]\n>        MulDiv [0x7D4D8AF9+653]\n>        MulDiv [0x7D4D8A55+489]\n>        RtlRaiseStatus [0x7D61EC4A+224]\n>        RtlRaiseStatus [0x7D61EC1B+177]\n>        KiUserExceptionDispatcher [0x7D61EA56+14]\n> Backtrace:\n>        kMaxUpdateFrequencySeconds [0x0140B208+3940]\n>        ExtensionHost::Observe [0x00509180+0]\n>\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:236)\n>        ExtensionHost::GetBrowser [0x00507EE0+0]\n>\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.h:214)\n>        ExtensionHost::GetNativeViewOfHost [0x00507F00+0]\n>\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.h:217)\n>        v8::internal::RegExpTree::AsQuantifier [0x00CE2560+0]\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\v8\\src\\ast.h:2052)\n>        ExtensionHost::associated_tab_contents [0x00507E80+0]\n>\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.h:86)\n>        [thunk]:ExtensionHost::`vector deleting destructor' [0x00507EB0+0]\n>        ExtensionHost::CreateNewWindow [0x00507250+0]\n>\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:551)\n>        ExtensionHost::CreateNewWidget [0x00507050+0]\n>\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:559)\n>        ExtensionHost::ShowCreatedWindow [0x005072D0+0]\n>\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:572)\n>        ExtensionHost::ShowCreatedWidget [0x00507060+0]\n>\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:589)\n>        v8::internal::AssignedVariablesAnalyzer::VisitThisFunction\n> [0x00CF2200+0]\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\v8\\src\\data-flow.cc:66)\n>        ExtensionHost::StartDragging [0x00507090+0]\n>\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:614)\n>        v8::internal::AssignedVariablesAnalyzer::VisitThisFunction\n> [0x00CF2200+0]\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\v8\\src\\data-flow.cc:66)\n>        ExtensionHost::GotFocus [0x00507330+0]\n>\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:626)\n>        v8::internal::AssignedVariablesAnalyzer::VisitThisFunction\n> [0x00CF2200+0]\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\v8\\src\\data-flow.cc:66)\n>        ExtensionHost::PreHandleKeyboardEvent [0x00508BC0+0]\n>\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:641)\n>        ExtensionHost::HandleKeyboardEvent [0x00507340+0]\n>\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:651)\n>        ExtensionHost::HandleMouseEvent [0x005073A0+0]\n>\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:665)\n>        ExtensionHost::HandleMouseLeave [0x005073B0+0]\n>\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:672)\n>        ExtensionHost::UpdatePreferredSize [0x00507130+0]\n>\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:269)\n>        ExtensionHost::GetViewDelegate [0x00507040+0]\n>\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\chrome\\browser\\extensions\\extension_host.cc:545)\n>        v8::internal::RegExpTree::AsQuantifier [0x00CE2560+0]\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\v8\\src\\ast.h:2052)\n>        v8::internal::RegExpTree::AsQuantifier [0x00CE2560+0]\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\v8\\src\\ast.h:2052)\n>        v8::internal::RegExpTree::AsQuantifier [0x00CE2560+0]\n> (c:\\b\\slave\\chromium-rel-xp\\build\\src\\v8\\src\\ast.h:2052)\n>\n> Description:\n> Revert \"Clean-up of the asynchronous behaviour of the experimental\n> extension\n> popup API. \"\n>\n> This reverts http://codereview.chromium.org/1512007\n>\n> TBR=twiz\n>\n> Committed: http://src.chromium.org/viewvc/chrome?view=rev&revision=46184\n>\n> Please review this at http://codereview.chromium.org/1735026/show\n>\n> Affected files:\n>  M chrome/browser/extensions/extension_host.h\n>  M chrome/browser/extensions/extension_host.cc\n>  M chrome/browser/extensions/extension_popup_api.cc\n>  M chrome/browser/renderer_host/render_view_host.h\n>  M chrome/browser/renderer_host/render_view_host.cc\n>  M chrome/browser/renderer_host/render_view_host_delegate.h\n>  chrome/common/extensions/api/extension_api.json\n>  M chrome/common/extensions/docs/extension.html\n>  M chrome/common/extensions/docs/history.html\n>  M chrome/common/notification_type.h\n>  M chrome/common/render_messages_internal.h\n>  M chrome/renderer/extensions/extension_process_bindings.cc\n>  M chrome/renderer/render_view.cc\n>  M chrome/test/data/extensions/api_test/popup/toolband.html\n>  D chrome/test/data/extensions/api_test/popup/toolband_popup_a.html\n>  D chrome/test/data/extensions/api_test/popup/toolband_popup_b.html\n>\n>\n>\n\n\n-- \nSoftware Developer\nGoogle Canada\n(514) 670-8756\n","disapproval":false,"date":"2010-05-01 17:09:37.534988","approval":false}],"owner_email":"phajdan.jr@chromium.org","private":false,"base_url":"","owner":"Paweł Hajdan Jr.","subject":"Revert \"Clean-up of the asynchronous behaviour of the experimental extension popup API. \"","created":"2010-05-01 08:02:16.801063","patchsets":[1],"modified":"2011-05-24 13:12:50.705203","closed":true,"commit":false,"issue":1735026}