{"description":"Implement Bookmark All Tabs... Added an abstraction of BookmarkEditorController called BookmarkEditorBaseController, from which BookmarkEditorController and the new BookmarkAllTabsController derive.  The bookmark/folder name, URL and OK button now use bindings/KVO.  Added BookmarkAllTabs.xib which is nearly identical to BookmarkEditor.xib.  Changed unit test since an empty bookmark name is now acceptable.  Added unit test for the Bookmark All Tabs...\r\n\r\nBookmarkEditor.xib changes: Removed the bookmark name and url as outlets and instead bound their values to controller's displayName and displayURL respectively.  Bound the OK button enabling to the controller's okEnabled.\r\n\r\nBUG=25099\r\nTEST=Open two or more tabs.  Bring up a contextual menu by control-clicking on one of the tabs.  Choose the Bookmark All Tabs... menu item.  A dialog will be presented in which you can type a folder name and select the parent folder in which the new folder will be placed.  By default, the most recently touched folder will be selected as the parent.  Click OK.  Now check to parent folder to see that the newly created folder has been added and then check within that folder to see that the open tabs have been added.\r\n\r\nPerform the above operation again only this time choose the Bookmark All Tabs... menu item found in the Bookmarks menu.\r\n\n\nCommitted: http://src.chromium.org/viewvc/chrome?view=rev&revision=31200","cc":["chromium-reviews@googlegroups.com","jrg@chromium.org","phajdan.jr@chromium.org","pam+watch@chromium.org","ben+cc@chromium.org"],"reviewers":["jrg@chromium.org","pinkerton@chromium.org"],"messages":[{"sender":"mrossetti@chromium.org","recipients":["mrossetti@chromium.org","jrg@chromium.org","chromium-reviews@googlegroups.com","jrg@chromium.org","phajdan.jr@chromium.org","pam+watch@chromium.org","ben+cc@chromium.org"],"text":"","disapproval":false,"date":"2009-11-04 04:17:51.574911","approval":false},{"sender":"pinkerton@chromium.org","recipients":["mrossetti@chromium.org","jrg@chromium.org","pinkerton@chromium.org","chromium-reviews@googlegroups.com","jrg@chromium.org","phajdan.jr@chromium.org","pam+watch@chromium.org","ben+cc@chromium.org"],"text":"Was there a reason why you needed to create nearly identical nibs? Was there nothing you could do in awakeFromNib to re-use them? Maybe add a comment in the code as to why, and include how they differ?\n\nhttp://codereview.chromium.org/357005/diff/2001/3005\nFile chrome/browser/cocoa/bookmark_editor_controller.mm (right):\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode114\nLine 114: NSSet* keys = [NSSet setWithObjects:@\"displayName\", @\"displayURL\", nil];\nwhy not just return these in a single line rather than breaking it up into decl + return? It's not like you're really going to need to debug this method, it's pretty simple.\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode126\nLine 126: (bookmarkAllTabs) ? @\"BookmarkAllTabs\" : @\"BookmarkEditor\";\nno need for parens\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode160\nLine 160: l10n_util::GetString(IDS_BOOMARK_EDITOR_NEW_FOLDER_NAME);\ncontinuation lines indent an additional 4 spaces.\n\nhowever, you should probably use GetNSStringWithFixup() as it does what you need.\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode340\nLine 340: // non-blank title.\nyou probalby mean \"non-empty\", since blank titles are technically allowed.\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode344\nLine 344: okEnabled = ([[[self displayName] stringByTrimmingCharactersInSet:\ndoesn't this get us back to the case where you can't have a whitespace-only name for a title? Didn't we already decide this was ok? Or am I confused?\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode376\nLine 376: Browser* browser = BrowserList::GetLastActive();\nthis dialog is window-modal, so what happens if while the user is filling it out, the user makes a different window frontmost? Won't it grab the Browser for the wrong window?\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode377\nLine 377: TabStripModel* tabstrip_model = browser->tabstrip_model();\nIt makes me sad that the bookmark code has to know about the tab model. Is there no way to abstract this?","disapproval":false,"date":"2009-11-04 14:24:16.848496","approval":false},{"sender":"pinkerton@chromium.org","recipients":["mrossetti@chromium.org","jrg@chromium.org","pinkerton@chromium.org","chromium-reviews@googlegroups.com","jrg@chromium.org","phajdan.jr@chromium.org","pam+watch@chromium.org","ben+cc@chromium.org"],"text":"Sigh, it submitted before I was ready.\n\nhttp://codereview.chromium.org/357005/diff/2001/3005\nFile chrome/browser/cocoa/bookmark_editor_controller.mm (right):\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode376\nLine 376: Browser* browser = BrowserList::GetLastActive();\nOn 2009/11/04 14:24:16, pink wrote:\n> this dialog is window-modal, so what happens if while the user is filling it\n> out, the user makes a different window frontmost? Won't it grab the Browser for\n> the wrong window?\n\nNever mind, clearly this is wrong (since the window has to be frontmost to OK the dialog), but I can't remove this comment.","disapproval":false,"date":"2009-11-04 14:26:39.902821","approval":false},{"sender":"jrg@chromium.org","recipients":["mrossetti@chromium.org","jrg@chromium.org","pinkerton@chromium.org","chromium-reviews@googlegroups.com","jrg@chromium.org","phajdan.jr@chromium.org","pam+watch@chromium.org","ben+cc@chromium.org"],"text":"http://codereview.chromium.org/357005/diff/2001/3006\nFile chrome/browser/cocoa/bookmark_editor_controller.h (right):\n\nhttp://codereview.chromium.org/357005/diff/2001/3006#newcode43\nLine 43: IBOutlet NSButton* okButton_;\nplace with other IBOutlets\n\nhttp://codereview.chromium.org/357005/diff/2001/3005\nFile chrome/browser/cocoa/bookmark_editor_controller.mm (right):\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode118\nLine 118: - (id)initWithParentWindow:(NSWindow*)parentWindow\nOverall comment for entire file: you've got a number of\nif (bookmarkAlLTabs) {  }\nconditionals in a number of functions.  It's not messy per se but is headed in that direction.  Wouldn't subclassing make this simpler?\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode131\nLine 131: [self setBookmarkAllTabs:bookmarkAllTabs];\nSure, it's the same as bookmarkAllTabs_ = bookmarkAllTabs, but it doesn't match other calls right here so seems like there is more hidden.\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode160\nLine 160: l10n_util::GetString(IDS_BOOMARK_EDITOR_NEW_FOLDER_NAME);\nOn 2009/11/04 14:24:16, pink wrote:\n> continuation lines indent an additional 4 spaces.\n> \n> however, you should probably use GetNSStringWithFixup() as it does what you\n> need.\n\nditto pink's comment\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode381\nLine 381: const std::wstring tabTitle = UTF16ToWideHack(tc->GetTitle());\nAbstract this loop into a method called TabContentThingies: which returns a std::vector of std::pair<Title,URL>.  See next file for more info on why.\n\nhttp://codereview.chromium.org/357005/diff/2001/3004\nFile chrome/browser/cocoa/bookmark_editor_controller_unittest.mm (right):\n\nhttp://codereview.chromium.org/357005/diff/2001/3004#newcode365\nLine 365: #if 0\nA \"TODO\" is not OK here.\nEither fix 10899 or abstract out calls to TabContents (see TabContentThingies: comment in other file) so that you can override it in your unit test and make everything else work fine.","disapproval":false,"date":"2009-11-04 18:22:10.132363","approval":false},{"sender":"mrossetti@chromium.org","recipients":["mrossetti@chromium.org","jrg@chromium.org","pinkerton@chromium.org","chromium-reviews@googlegroups.com","jrg@chromium.org","phajdan.jr@chromium.org","pam+watch@chromium.org","ben+cc@chromium.org"],"text":"All issues addressed.  Added an abstraction of the BookmarkEditorController and a new controller based on that abstraction for doing the BookmarkAllTabs work.\n\nThanks for the suggestions!\n\nhttp://codereview.chromium.org/357005/diff/2001/3006\nFile chrome/browser/cocoa/bookmark_editor_controller.h (right):\n\nhttp://codereview.chromium.org/357005/diff/2001/3006#newcode43\nLine 43: IBOutlet NSButton* okButton_;\nOn 2009/11/04 18:22:10, John Grabowski wrote:\n> place with other IBOutlets\n\nDone.\n\nhttp://codereview.chromium.org/357005/diff/2001/3005\nFile chrome/browser/cocoa/bookmark_editor_controller.mm (right):\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode114\nLine 114: NSSet* keys = [NSSet setWithObjects:@\"displayName\", @\"displayURL\", nil];\nOn 2009/11/04 14:24:16, pink wrote:\n> why not just return these in a single line rather than breaking it up into decl\n> + return? It's not like you're really going to need to debug this method, it's\n> pretty simple.\n\nDone.\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode118\nLine 118: - (id)initWithParentWindow:(NSWindow*)parentWindow\nOn 2009/11/04 18:22:10, John Grabowski wrote:\n> Overall comment for entire file: you've got a number of\n> if (bookmarkAlLTabs) {  }\n> conditionals in a number of functions.  It's not messy per se but is headed in\n> that direction.  Wouldn't subclassing make this simpler? \n\nDone.\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode126\nLine 126: (bookmarkAllTabs) ? @\"BookmarkAllTabs\" : @\"BookmarkEditor\";\nOn 2009/11/04 14:24:16, pink wrote:\n> no need for parens\n\nThis code has been eliminated.\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode131\nLine 131: [self setBookmarkAllTabs:bookmarkAllTabs];\nOn 2009/11/04 18:22:10, John Grabowski wrote:\n> Sure, it's the same as bookmarkAllTabs_ = bookmarkAllTabs, but it doesn't match\n> other calls right here so seems like there is more hidden.\n\nThis code is now gone.\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode160\nLine 160: l10n_util::GetString(IDS_BOOMARK_EDITOR_NEW_FOLDER_NAME);\nOn 2009/11/04 14:24:16, pink wrote:\n> continuation lines indent an additional 4 spaces.\n> \n> however, you should probably use GetNSStringWithFixup() as it does what you\n> need.\n\nDone.\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode160\nLine 160: l10n_util::GetString(IDS_BOOMARK_EDITOR_NEW_FOLDER_NAME);\nOn 2009/11/04 14:24:16, pink wrote:\n> continuation lines indent an additional 4 spaces.\n> \n> however, you should probably use GetNSStringWithFixup() as it does what you\n> need.\n\nDone.\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode340\nLine 340: // non-blank title.\nOn 2009/11/04 14:24:16, pink wrote:\n> you probalby mean \"non-empty\", since blank titles are technically allowed.\n\nDone.\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode344\nLine 344: okEnabled = ([[[self displayName] stringByTrimmingCharactersInSet:\nOn 2009/11/04 14:24:16, pink wrote:\n> doesn't this get us back to the case where you can't have a whitespace-only name\n> for a title? Didn't we already decide this was ok? Or am I confused?\n\nCan folders have blank/empty names?  I'll have to check.\n\nhttp://codereview.chromium.org/357005/diff/2001/3005#newcode381\nLine 381: const std::wstring tabTitle = UTF16ToWideHack(tc->GetTitle());\nOn 2009/11/04 18:22:10, John Grabowski wrote:\n> Abstract this loop into a method called TabContentThingies: which returns a\n> std::vector of std::pair<Title,URL>.  See next file for more info on why.\n\nDone.\n\nhttp://codereview.chromium.org/357005/diff/2001/3004\nFile chrome/browser/cocoa/bookmark_editor_controller_unittest.mm (right):\n\nhttp://codereview.chromium.org/357005/diff/2001/3004#newcode365\nLine 365: #if 0\nOn 2009/11/04 18:22:10, John Grabowski wrote:\n> A \"TODO\" is not OK here.\n> Either fix 10899 or abstract out calls to TabContents (see TabContentThingies:\n> comment in other file) so that you can override it in your unit test and make\n> everything else work fine.\n\nDone.","disapproval":false,"date":"2009-11-05 18:14:55.507930","approval":false},{"sender":"mrossetti@chromium.org","recipients":["mrossetti@chromium.org","jrg@chromium.org","pinkerton@chromium.org","chromium-reviews@googlegroups.com","jrg@chromium.org","phajdan.jr@chromium.org","pam+watch@chromium.org","ben+cc@chromium.org"],"text":"Uploaded missing files.","disapproval":false,"date":"2009-11-05 20:04:22.660702","approval":false},{"sender":"jrg@chromium.org","recipients":["mrossetti@chromium.org","jrg@chromium.org","pinkerton@chromium.org","chromium-reviews@googlegroups.com","jrg@chromium.org","phajdan.jr@chromium.org","pam+watch@chromium.org","ben+cc@chromium.org"],"text":"Almost there.\nPlease add some more simple unit tests, merge in dmac's CL, and I'll be happy.\n\nhttp://codereview.chromium.org/357005/diff/4008/8009\nFile chrome/browser/cocoa/bookmark_all_tabs_controller.h (right):\n\nhttp://codereview.chromium.org/357005/diff/4008/8009#newcode13\nLine 13: typedef std::vector<ActiveTabNameURLPair> ActiveTabsNameURLPairList;\ntype is vector but name is BlahBlahList?\nHow about BlahBlahArray?\n\nhttp://codereview.chromium.org/357005/diff/4008/8007\nFile chrome/browser/cocoa/bookmark_all_tabs_controller.mm (right):\n\nhttp://codereview.chromium.org/357005/diff/4008/8007#newcode36\nLine 36: [super awakeFromNib];\nPerhaps [super awakeFromNib] first?  Especially before calling the base class's setInitialName:.\n\nhttp://codereview.chromium.org/357005/diff/4008/8007#newcode59\nLine 59: NSString* name = [[self displayName] stringByTrimmingCharactersInSet:\nWhat if I want to name the folder \"       \"?\n\nhttp://codereview.chromium.org/357005/diff/4008/8008\nFile chrome/browser/cocoa/bookmark_editor_base_controller.h (right):\n\nhttp://codereview.chromium.org/357005/diff/4008/8008#newcode21\nLine 21: // NOTE: Derived classes must be dispatched via the |BookmarkEditor::Show|\nNot sure about \"must be\".\nAlso, use pipes for args, not functions, in comments.\n\nhttp://codereview.chromium.org/357005/diff/4008/8008#newcode63\nLine 63: // The OK action will record the edited bookmark.  The default dismisses\nspace above this line\n\nhttp://codereview.chromium.org/357005/diff/4008/8010\nFile chrome/browser/cocoa/bookmark_editor_base_controller.mm (right):\n\nhttp://codereview.chromium.org/357005/diff/4008/8010#newcode73\nLine 73: const BookmarkNode* GetFolderChildForParent(const BookmarkNode* parent_node,\nunit test this dude\n\nhttp://codereview.chromium.org/357005/diff/4008/8010#newcode89\nLine 89: int IndexOfFolderChild(const BookmarkNode* child_node) {\nunit test this dude\n\nhttp://codereview.chromium.org/357005/diff/4008/8010#newcode181\nLine 181: - (void)selectNodeInBrowser:(const BookmarkNode*)node {\nunit test which calls selectNodeInBrowser: then confirms value with selectedNode below.\n\nhttp://codereview.chromium.org/357005/diff/4008/8010#newcode300\nLine 300: - (BOOL)okEnabled {\nNo longer needed?\n\nhttp://codereview.chromium.org/357005/diff/4008/8010#newcode326\nLine 326: [self autorelease];\nBe sure to merge in dmac's CL at http://codereview.chromium.org/361011 which impacts this function specifically.  Recommend you do that before trying to land given file reorg.\n\nhttp://codereview.chromium.org/357005/diff/4008/8010#newcode339\nLine 339: - (BOOL)okButtonEnabled {\nObsolete?\n\nhttp://codereview.chromium.org/357005/diff/4008/8005\nFile chrome/browser/cocoa/bookmark_editor_controller.mm (right):\n\nhttp://codereview.chromium.org/357005/diff/4008/8005#newcode60\nLine 60: [super awakeFromNib];\nPossibly call [super awakeFromNib] first?\n\nhttp://codereview.chromium.org/357005/diff/4008/8004\nFile chrome/browser/cocoa/bookmark_editor_controller_unittest.mm (right):\n\nhttp://codereview.chromium.org/357005/diff/4008/8004#newcode134\nLine 134: EXPECT_TRUE([default_controller_ okButtonEnabled]);\nOK buttons always enabled so no more need for unit test.","disapproval":false,"date":"2009-11-05 21:11:03.874628","approval":false},{"sender":"mrossetti@chromium.org","recipients":["mrossetti@chromium.org","jrg@chromium.org","pinkerton@chromium.org","chromium-reviews@googlegroups.com","jrg@chromium.org","phajdan.jr@chromium.org","pam+watch@chromium.org","ben+cc@chromium.org"],"text":"Merged with latest from dmaclach.\n\nhttp://codereview.chromium.org/357005/diff/4008/8009\nFile chrome/browser/cocoa/bookmark_all_tabs_controller.h (right):\n\nhttp://codereview.chromium.org/357005/diff/4008/8009#newcode13\nLine 13: typedef std::vector<ActiveTabNameURLPair> ActiveTabsNameURLPairList;\nOn 2009/11/05 21:11:03, John Grabowski wrote:\n> type is vector but name is BlahBlahList?\n> How about BlahBlahArray?\n\nDone.\n\nhttp://codereview.chromium.org/357005/diff/4008/8007\nFile chrome/browser/cocoa/bookmark_all_tabs_controller.mm (right):\n\nhttp://codereview.chromium.org/357005/diff/4008/8007#newcode36\nLine 36: [super awakeFromNib];\nOn 2009/11/05 21:11:03, John Grabowski wrote:\n> Perhaps [super awakeFromNib] first?  Especially before calling the base class's\n> setInitialName:.\n> \n\nIt's gotta be last since the super's uses the initialName.\n\nhttp://codereview.chromium.org/357005/diff/4008/8007#newcode59\nLine 59: NSString* name = [[self displayName] stringByTrimmingCharactersInSet:\nOn 2009/11/05 21:11:03, John Grabowski wrote:\n> What if I want to name the folder \"       \"?\n> \n\nYeah, I should only be stripping out newlines.\n\nhttp://codereview.chromium.org/357005/diff/4008/8008\nFile chrome/browser/cocoa/bookmark_editor_base_controller.h (right):\n\nhttp://codereview.chromium.org/357005/diff/4008/8008#newcode21\nLine 21: // NOTE: Derived classes must be dispatched via the |BookmarkEditor::Show|\nOn 2009/11/05 21:11:03, John Grabowski wrote:\n> Not sure about \"must be\".\n> Also, use pipes for args, not functions, in comments.\n> \n\nDone.\n\nhttp://codereview.chromium.org/357005/diff/4008/8008#newcode63\nLine 63: // The OK action will record the edited bookmark.  The default dismisses\nOn 2009/11/05 21:11:03, John Grabowski wrote:\n> space above this line\n> \n\nDone.\n\nhttp://codereview.chromium.org/357005/diff/4008/8010\nFile chrome/browser/cocoa/bookmark_editor_base_controller.mm (right):\n\nhttp://codereview.chromium.org/357005/diff/4008/8010#newcode73\nLine 73: const BookmarkNode* GetFolderChildForParent(const BookmarkNode* parent_node,\nOn 2009/11/05 21:11:03, John Grabowski wrote:\n> unit test this dude\n\nDone.\n\nhttp://codereview.chromium.org/357005/diff/4008/8010#newcode89\nLine 89: int IndexOfFolderChild(const BookmarkNode* child_node) {\nOn 2009/11/05 21:11:03, John Grabowski wrote:\n> unit test this dude\n\nDone.\n\nhttp://codereview.chromium.org/357005/diff/4008/8010#newcode181\nLine 181: - (void)selectNodeInBrowser:(const BookmarkNode*)node {\nOn 2009/11/05 21:11:03, John Grabowski wrote:\n> unit test which calls selectNodeInBrowser: then confirms value with selectedNode\n> below.\n\nDone.\n\nhttp://codereview.chromium.org/357005/diff/4008/8010#newcode300\nLine 300: - (BOOL)okEnabled {\nOn 2009/11/05 21:11:03, John Grabowski wrote:\n> No longer needed?\n\nIt's needed.  The BookmarkAllTabsController doesn't provide an -[okEnabled] since it's always enabled.  I _could_ default to NO here and override in BookmarkAllTabsController, but didn't see a need for that.\n\nhttp://codereview.chromium.org/357005/diff/4008/8010#newcode326\nLine 326: [self autorelease];\nOn 2009/11/05 21:11:03, John Grabowski wrote:\n> Be sure to merge in dmac's CL at http://codereview.chromium.org/361011 which\n> impacts this function specifically.  Recommend you do that before trying to land\n> given file reorg.\n\nDone.\n\nhttp://codereview.chromium.org/357005/diff/4008/8010#newcode339\nLine 339: - (BOOL)okButtonEnabled {\nOn 2009/11/05 21:11:03, John Grabowski wrote:\n> Obsolete?\n\nNo, I'm adding a unit test to BookmarkAllTabs to insure that the OK button is always enabled.\n\nhttp://codereview.chromium.org/357005/diff/4008/8005\nFile chrome/browser/cocoa/bookmark_editor_controller.mm (right):\n\nhttp://codereview.chromium.org/357005/diff/4008/8005#newcode60\nLine 60: [super awakeFromNib];\nOn 2009/11/05 21:11:03, John Grabowski wrote:\n> Possibly call [super awakeFromNib] first?\n\nI'd like to keep it consistent with the same call made from BookmarkAllTabsController.  In this case it doesn't matter, but in BATC it makes a difference.\n\nhttp://codereview.chromium.org/357005/diff/4008/8004\nFile chrome/browser/cocoa/bookmark_editor_controller_unittest.mm (right):\n\nhttp://codereview.chromium.org/357005/diff/4008/8004#newcode134\nLine 134: EXPECT_TRUE([default_controller_ okButtonEnabled]);\nOn 2009/11/05 21:11:03, John Grabowski wrote:\n> OK buttons always enabled so no more need for unit test.\n\nThe OK button is only enabled when there is a valid URL.  So we still need this test.","disapproval":false,"date":"2009-11-06 01:58:57.765195","approval":false},{"sender":"jrg@chromium.org","recipients":["mrossetti@chromium.org","jrg@chromium.org","pinkerton@chromium.org","chromium-reviews@googlegroups.com","jrg@chromium.org","phajdan.jr@chromium.org","pam+watch@chromium.org","ben+cc@chromium.org"],"text":"LGTM","disapproval":false,"date":"2009-11-06 02:06:19.636469","approval":true}],"owner_email":"mrossetti@chromium.org","private":false,"base_url":"svn://svn.chromium.org/chrome/trunk/src/","owner":"mrossetti","subject":"Implement Bookmark All Tabs... using the BookmarkEditorController and determi...","created":"2009-11-04 04:08:39.405590","patchsets":[1,2001,8001,10001,4008,13001],"modified":"2011-05-20 02:33:04.140614","closed":true,"commit":false,"issue":357005}