{"description":"We should switch the keyboard layout to the layout the user set according to which user POD is selected.\n\nBUG=152843\n\nCommitted: https://src.chromium.org/viewvc/chrome?view=rev&revision=213144","cc":["chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"reviewers":["nkostylev@chromium.org","mnissler@chromium.org","nona@chromium.org"],"messages":[{"sender":"alemate@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"","disapproval":false,"date":"2013-07-09 13:06:23.398860","approval":false},{"sender":"nkostylev@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"You'll need someone from\nhttps://code.google.com/p/chromium/codesearch#chromium/src/chrome/browser/chromeos/input_method/OWNERS&sq=package:chromium&type=cs\nhttps://code.google.com/p/chromium/codesearch#chromium/src/chromeos/ime/OWNERS&sq=package:chromium&type=cs\n\nhttps://code.google.com/p/chromium/codesearch#chromium/src/chrome/browser/prefs/OWNERS&sq=package:chromium&type=cs","disapproval":false,"date":"2013-07-09 13:21:57.844290","approval":false},{"sender":"nkostylev@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"Where latin-based keyboard layout's are filtered?\nCL summary should mention that.","disapproval":false,"date":"2013-07-09 13:24:31.652040","approval":false},{"sender":"alemate@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","mnissler@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"Added check for \"Full Latin Keyboard language\".\n\nI created table of such languages manually googling, reading Wikipedia, and testing a few layouts by hand.\n\nAmong current languages in chromeos/ime/input_methods.txt there seems quite a few not having this feature:\n\n\"be\",     // Belarusian\n\"bg\",     // Bulgarian\n\"el\",     // Greek\n\"he\",     // Hebrew\n\"hy\",     // Armenian\n\"ja\",     // Japanese\n\"ka\",     // Georgian\n\"mn\",     // Mongolian\n\"ru\",     // Russian\n\"sr\",     // Serbian\n\"uk\"      // Ukrainian\n\nAll the others seem to have all 26 Latin letters on keyboard, despite not having some of them in alphabet.\n\nThe list of \"Full latin Keyboard Languages\" is in kFullLatinKeyboardLanguageList[] in chrome/browser/chromeos/input_method/input_method_manager_impl.cc . \n\nI think it should be somehow verified.\n\nA special note to nona:\nAlso for the check to be fast, I use sorted vector of two-letter language codes (as vector<uint_16>) and a special type InputMethodManagerImpl::TwoLetterLanguageCode (so that actually vector<TwoLetterLanguageCode> is stored). Do you think it's ok to modify input_method_manager_impl.{cc,h} this way, or should I put this code to some other file?","disapproval":false,"date":"2013-07-10 16:21:58.906640","approval":false},{"sender":"nkostylev@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","mnissler@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"Please fix unit_test:\n[ RUN      ] InputMethodPersistenceTest.TestPrefPersistenceByState\n[29587:29587:0711/013832:2507777282366:FATAL:input_method_persistence.cc(44)] Check failed: manager. \n[29587:29587:0711/013832:2507777282366:FATAL:input_method_persistence.cc(44)] Check failed: manager. \nReceived signal 6\n [0x7f9d9ac3d58e] base::debug::StackTrace::StackTrace()\n [0x7f9d9ac3dab8] base::debug::(anonymous namespace)::StackDumpSignalHandler()\n [0x7f9d947d6cb0] <unknown>\n [0x7f9d93519425] gsignal\n [0x7f9d9351cb8b] abort\n [0x7f9d9ac3c4c9] base::debug::BreakDebugger()\n [0x7f9d9ac64c64] logging::LogMessage::~LogMessage()\n [0x000003547e84] _ZN8chromeos12input_method12_GLOBAL__N_1L21SetUserLRUInputMethodERKSs.constprop.25\n [0x0000035486b3] chromeos::input_method::InputMethodPersistence::InputMethodChanged()\n [0x0000009c8a93] chromeos::input_method::InputMethodPersistenceTest_TestPrefPersistenceByState_Test::TestBody()\n [0x00000373a99a] testing::Test::Run()\n [0x00000373aa5a] testing::TestInfo::Run()\n [0x00000373ab9f] testing::TestCase::Run()\n [0x00000373ae2f] testing::internal::UnitTestImpl::RunAllTests()\n [0x000003735823] testing::UnitTest::Run()\n [0x000003f135de] base::TestSuite::Run()\n [0x000003d4c33a] main\n [0x7f9d9350476d] __libc_start_main\n [0x00000050c499] <unknown>","disapproval":false,"date":"2013-07-11 08:54:55.394010","approval":false},{"sender":"nkostylev@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","mnissler@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"Please review:\n\nnona@ for\nchrome/browser/chromeos/input_method/*\nchromeos/ime/*\n\nmnissler@ for chrome/browser/prefs.*\n\nI'll review chrome/browser/ui/webui/chromeos/login/*","disapproval":false,"date":"2013-07-11 08:59:56.244130","approval":false},{"sender":"nkostylev@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","mnissler@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"https://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc\nFile chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc (right):\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode985\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:985: #if defined(OS_CHROMEOS)\nNo need for OS_CHROMEOS here as this class is already located in chromeos specific folder.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode994\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:994: #if defined(OS_CHROMEOS)\nnit: same here.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode996\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:996: if (g_browser_process == NULL)\nnit: drop this check.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode999\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:999: if (!base::chromeos::IsRunningOnChromeOS())\nWhat about relying on stubs instead when not running on a real Chrome OS VM image/device?\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1003\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1003: DCHECK(local_state);\nnit: Drop this DCHECK.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1005\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1005: if (local_state == NULL)\nnit: Drop this.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1010\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1010: DCHECK(manager);\nnit: Drop this DCHECK.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1013\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1013: do {\nYou should delete this loop it is not really needed.\nMy proposal:\n\nHave a utility method that tries to switch to user specific input method and returns bool. Code that calls it will switch to default if needed.\n\nIntroducing this method will also help split this method into smaller parts.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1018\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1018: DLOG(WARNING) << \"SetUserInputMethod('\" << username\nnit: I guess it is perfectly normal situation till at least one user signs in that has latin-based input_methods.\n\nNo need for DLOG(WARNING) here.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1027\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1027: DLOG(WARNING) << \"SetUserInputMethod('\" << username\nnit: Same here. This looks like a perfectly normal (rare but normal) situation so no need for DLOG(WARNING).\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1032\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1032: if (manager == NULL)\nYou don't have to check for manager not being NULL. It is assumed it is always not NULL when we are accessing it. You could check its lifetime if you want.\n\nIf this assumption is not true this code better crash and generate crash report instead of doing nothing.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1037\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1037: DCHECK(ime_util);\nnit: Drop DCHECK\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1039\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1039: if (ime_util == NULL)\nSame here.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1047\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1047: LOG(WARNING) << \"SetUserInputMethod('\" << username\nnit: I propose dropping log message as well and just doing pref cleanup instead.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1056\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1056: ->GetActiveInputMethodIds(),\nnit: -> should be on the previous line\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1058\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1058: if (!chromeos::input_method::InputMethodManager::Get()->EnableInputMethod(\nnit:\n\nif (!chromeos::input_method::InputMethodManager::Get()->\n        EnableInputMethod(input_method)) {\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1065\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1065: chromeos::input_method::InputMethodManager::Get()->ChangeInputMethod(\nnit: this looks more readable:\n\nchromeos::input_method::InputMethodManager::Get()->\n    ChangeInputMethod(input_method);\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1075\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1075: DLOG(WARNING)\nnit: No need for DLOG(WARNING), perfectly normal situation.","disapproval":false,"date":"2013-07-11 09:13:53.563770","approval":false},{"sender":"nona@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","mnissler@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"https://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.cc\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.cc (right):\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.cc#newcode125\nchrome/browser/chromeos/input_method/input_method_manager_impl.cc:125: const char* kFullLatinKeyboardLanguageList[] = {\nPlease notice that there is \"xkb:jp::jpn\" keyboard which is for Latin character input in jp109 keyboard. (http://en.wikipedia.org/wiki/Keyboard_layout#Japanese)\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.h\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.h (right):\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.h#newcode102\nchrome/browser/chromeos/input_method/input_method_manager_impl.h:102: virtual bool IsLanguageFullLatinKeyboard(const std::string& lang) const\nAs I mentioned in crbug.com/152843, please consider to use IsKeyboardLayout function instead.\n\nIf you feel bad for non-Latin keyboard on login screen like Russian keyboard, please do as separate work. (I recommend getting advise from UX or i18n team's).\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.h#newcode191\nchrome/browser/chromeos/input_method/input_method_manager_impl.h:191: // Start or stop the system input method framework as needed.\nnit: Starts or stops\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc\nFile chrome/browser/chromeos/input_method/input_method_persistence.cc (right):\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode32\nchrome/browser/chromeos/input_method/input_method_persistence.cc:32: #if defined(OS_CHROMEOS)\nnit: no need to add OS_CHROMEOS. This class is only used in chromeos environment.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode37\nchrome/browser/chromeos/input_method/input_method_persistence.cc:37: if (local_state != NULL) {\nIf you put DCHECK, please remove this condition, if local_state can be NULL, please remove DCHECK.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode46\nchrome/browser/chromeos/input_method/input_method_persistence.cc:46: if (manager == NULL)\nno need to check manager, you already put DCHECK above.\nI think this shouldn't be NULL, so just DCHECK is fine :)\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode53\nchrome/browser/chromeos/input_method/input_method_persistence.cc:53: if (ime_util == NULL)\nditto.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode57\nchrome/browser/chromeos/input_method/input_method_persistence.cc:57: ime_util->GetLanguageCodeFromInputMethodId(input_method)))\nPlease note that third party input can set any language, so we should check IsKeyboardLayout.","disapproval":false,"date":"2013-07-11 09:43:55.905280","approval":false},{"sender":"mnissler@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","mnissler@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"LGTM once you get coding style sorted (other reviewers cover that) and fix pref name declaration.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.cc\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.cc (right):\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.cc#newcode335\nchrome/browser/chromeos/input_method/input_method_manager_impl.cc:335: // starts or stops the system input method framework as needed.\nnit: Starts\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.cc#newcode340\nchrome/browser/chromeos/input_method/input_method_manager_impl.cc:340: if (ContainOnlyKeyboardLayout(active_input_method_ids_)) {\nnit: ContainOnlyKeyboardLayout should be ContainsOnlyKeyboardLayout (imperative \"contain\" certainly doesn't make sense here).\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.cc#newcode342\nchrome/browser/chromeos/input_method/input_method_manager_impl.cc:342: // at crosbug.com/27051.\nnit: new code should refer to crbug.com IMHO\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc\nFile chrome/browser/chromeos/input_method/input_method_persistence.cc (right):\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode35\nchrome/browser/chromeos/input_method/input_method_persistence.cc:35: DCHECK(local_state);\nNot needed, local_state != NULL should be guaranteed by initialization order. If it's not, you have bigger problems :)\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode44\nchrome/browser/chromeos/input_method/input_method_persistence.cc:44: DCHECK(manager);\nDoes this singleton getter actually return NULL in any circumstance? Being overly defensive makes code unreadable.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode65\nchrome/browser/chromeos/input_method/input_method_persistence.cc:65: // updater may have side-effects, therefore we do not replace\n*Updater\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc\nFile chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc (right):\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1108\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1108: // Set Least Recently used input method for the user\nnit: missing period.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/common/pref_names.cc\nFile chrome/common/pref_names.cc (right):\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/common/pref_names.cc#newcode2508\nchrome/common/pref_names.cc:2508: // (used at login screen)\nnit: Missing period, not using the full line width on line 2507 for the comment.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/common/pref_names.cc#newcode2509\nchrome/common/pref_names.cc:2509: extern const char kUsersLRUInputMethod[] = \"UsersLRUInputMethod\";\nThis should be earlier in this file (the file as three sections \"PROFILE PREFS\", \"LOCAL STATE\", \"SERVICE PREFS\") in the \"LOCAL STATE\" section, note that there's a whole section of Chrome OS section there where you can add your pref. I know I'm fighting a lost battle here, but still :)\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/common/pref_names.h\nFile chrome/common/pref_names.h (right):\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/common/pref_names.h#newcode940\nchrome/common/pref_names.h:940: extern const char kUsersLRUInputMethod[];\nWhen you change definition order in pref_names.cc, please adjust this file to be consistent.","disapproval":false,"date":"2013-07-11 10:05:48.784600","approval":true},{"sender":"alemate@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","mnissler@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"- Added checking against IsKeyboardLayout().\n- Added support for languages with some Full Latin Keyboard layouts (like \"xkb:jp::jpn\").\n- Moved checker code to separate files.\n- (probably) fixed all style inconsistencies.\n\nPlease review.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.cc\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.cc (right):\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.cc#newcode125\nchrome/browser/chromeos/input_method/input_method_manager_impl.cc:125: const char* kFullLatinKeyboardLanguageList[] = {\nOn 2013/07/11 09:43:56, Seigo Nonaka wrote:\n> Please notice that there is \"xkb:jp::jpn\" keyboard which is for Latin character\n> input in jp109 keyboard. (http://en.wikipedia.org/wiki/Keyboard_layout#Japanese)\n> \n\nThat's a good point. I've been waiting for something like that. ;-)\n\nI think I should extend this structure to keep a list of \"explicitly allowed keyboards for this language\".\nNULL would mean \"any\". So that I can have only one list for \"jp\" with a single entry \"xkb:jp::jpn\" for now.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.cc#newcode335\nchrome/browser/chromeos/input_method/input_method_manager_impl.cc:335: // starts or stops the system input method framework as needed.\nOn 2013/07/11 10:05:49, Mattias Nissler wrote:\n> nit: Starts\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.cc#newcode340\nchrome/browser/chromeos/input_method/input_method_manager_impl.cc:340: if (ContainOnlyKeyboardLayout(active_input_method_ids_)) {\nOn 2013/07/11 10:05:49, Mattias Nissler wrote:\n> nit: ContainOnlyKeyboardLayout should be ContainsOnlyKeyboardLayout (imperative\n> \"contain\" certainly doesn't make sense here).\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.cc#newcode342\nchrome/browser/chromeos/input_method/input_method_manager_impl.cc:342: // at crosbug.com/27051.\nOn 2013/07/11 10:05:49, Mattias Nissler wrote:\n> nit: new code should refer to http://crbug.com IMHO\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.h\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.h (right):\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.h#newcode102\nchrome/browser/chromeos/input_method/input_method_manager_impl.h:102: virtual bool IsLanguageFullLatinKeyboard(const std::string& lang) const\nOn 2013/07/11 09:43:56, Seigo Nonaka wrote:\n> As I mentioned in crbug.com/152843, please consider to use IsKeyboardLayout\n> function instead.\n> \n> If you feel bad for non-Latin keyboard on login screen like Russian keyboard,\n> please do as separate work. (I recommend getting advise from UX or i18n team's).\n> \n\nIt has already been discussed a bit in https://code.google.com/p/chromium/issues/detail?id=152843 . I think I'll add people from UX & i18n there.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.h#newcode191\nchrome/browser/chromeos/input_method/input_method_manager_impl.h:191: // Start or stop the system input method framework as needed.\nOn 2013/07/11 09:43:56, Seigo Nonaka wrote:\n> nit: Starts or stops\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc\nFile chrome/browser/chromeos/input_method/input_method_persistence.cc (right):\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode32\nchrome/browser/chromeos/input_method/input_method_persistence.cc:32: #if defined(OS_CHROMEOS)\nOn 2013/07/11 09:43:56, Seigo Nonaka wrote:\n> nit: no need to add OS_CHROMEOS. This class is only used in chromeos\n> environment.\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode35\nchrome/browser/chromeos/input_method/input_method_persistence.cc:35: DCHECK(local_state);\nOn 2013/07/11 10:05:49, Mattias Nissler wrote:\n> Not needed, local_state != NULL should be guaranteed by initialization order. If\n> it's not, you have bigger problems :)\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode37\nchrome/browser/chromeos/input_method/input_method_persistence.cc:37: if (local_state != NULL) {\nOn 2013/07/11 09:43:56, Seigo Nonaka wrote:\n> If you put DCHECK, please remove this condition, if local_state can be NULL,\n> please remove DCHECK.\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode44\nchrome/browser/chromeos/input_method/input_method_persistence.cc:44: DCHECK(manager);\nOn 2013/07/11 10:05:49, Mattias Nissler wrote:\n> Does this singleton getter actually return NULL in any circumstance? Being\n> overly defensive makes code unreadable.\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode46\nchrome/browser/chromeos/input_method/input_method_persistence.cc:46: if (manager == NULL)\nOn 2013/07/11 09:43:56, Seigo Nonaka wrote:\n> no need to check manager, you already put DCHECK above.\n> I think this shouldn't be NULL, so just DCHECK is fine :)\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode53\nchrome/browser/chromeos/input_method/input_method_persistence.cc:53: if (ime_util == NULL)\nOn 2013/07/11 09:43:56, Seigo Nonaka wrote:\n> ditto.\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode57\nchrome/browser/chromeos/input_method/input_method_persistence.cc:57: ime_util->GetLanguageCodeFromInputMethodId(input_method)))\nOn 2013/07/11 09:43:56, Seigo Nonaka wrote:\n> Please note that third party input can set any language, so we should check\n> IsKeyboardLayout. \n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode65\nchrome/browser/chromeos/input_method/input_method_persistence.cc:65: // updater may have side-effects, therefore we do not replace\nOn 2013/07/11 10:05:49, Mattias Nissler wrote:\n> *Updater\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc\nFile chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc (right):\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode985\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:985: #if defined(OS_CHROMEOS)\nOn 2013/07/11 09:13:54, Nikita Kostylev wrote:\n> No need for OS_CHROMEOS here as this class is already located in chromeos\n> specific folder.\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode994\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:994: #if defined(OS_CHROMEOS)\nOn 2013/07/11 09:13:54, Nikita Kostylev wrote:\n> nit: same here.\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode996\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:996: if (g_browser_process == NULL)\nOn 2013/07/11 09:13:54, Nikita Kostylev wrote:\n> nit: drop this check.\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode999\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:999: if (!base::chromeos::IsRunningOnChromeOS())\nOn 2013/07/11 09:13:54, Nikita Kostylev wrote:\n> What about relying on stubs instead when not running on a real Chrome OS VM\n> image/device?\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1003\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1003: DCHECK(local_state);\nOn 2013/07/11 09:13:54, Nikita Kostylev wrote:\n> nit: Drop this DCHECK.\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1005\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1005: if (local_state == NULL)\nOn 2013/07/11 09:13:54, Nikita Kostylev wrote:\n> nit: Drop this.\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1010\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1010: DCHECK(manager);\nOn 2013/07/11 09:13:54, Nikita Kostylev wrote:\n> nit: Drop this DCHECK.\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1013\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1013: do {\nOn 2013/07/11 09:13:54, Nikita Kostylev wrote:\n> You should delete this loop it is not really needed.\n> My proposal:\n> \n> Have a utility method that tries to switch to user specific input method and\n> returns bool. Code that calls it will switch to default if needed.\n> \n> Introducing this method will also help split this method into smaller parts.\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1018\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1018: DLOG(WARNING) << \"SetUserInputMethod('\" << username\nOn 2013/07/11 09:13:54, Nikita Kostylev wrote:\n> nit: I guess it is perfectly normal situation till at least one user signs in\n> that has latin-based input_methods.\n> \n> No need for DLOG(WARNING) here.\n\nDo all our users always have some latin input method enabled ?\nProbably HW-default is always enabled, I think.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1027\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1027: DLOG(WARNING) << \"SetUserInputMethod('\" << username\nOn 2013/07/11 09:13:54, Nikita Kostylev wrote:\n> nit: Same here. This looks like a perfectly normal (rare but normal) situation\n> so no need for DLOG(WARNING).\n\nBut it's debug log, isn't it? I think I'd better have a trace of rare events at least in debug log.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1032\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1032: if (manager == NULL)\nOn 2013/07/11 09:13:54, Nikita Kostylev wrote:\n> You don't have to check for manager not being NULL. It is assumed it is always\n> not NULL when we are accessing it. You could check its lifetime if you want.\n> \n> If this assumption is not true this code better crash and generate crash report\n> instead of doing nothing.\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1037\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1037: DCHECK(ime_util);\nOn 2013/07/11 09:13:54, Nikita Kostylev wrote:\n> nit: Drop DCHECK\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1039\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1039: if (ime_util == NULL)\nOn 2013/07/11 09:13:54, Nikita Kostylev wrote:\n> Same here.\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1047\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1047: LOG(WARNING) << \"SetUserInputMethod('\" << username\nOn 2013/07/11 09:13:54, Nikita Kostylev wrote:\n> nit: I propose dropping log message as well and just doing pref cleanup instead.\n\nIt is probably dangerous to silently drop user preferences. I've added pref cleanup, but left log message. Do you think it is OK now?\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1056\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1056: ->GetActiveInputMethodIds(),\nOn 2013/07/11 09:13:54, Nikita Kostylev wrote:\n> nit: -> should be on the previous line\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1058\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1058: if (!chromeos::input_method::InputMethodManager::Get()->EnableInputMethod(\nOn 2013/07/11 09:13:54, Nikita Kostylev wrote:\n> nit:\n> \n> if (!chromeos::input_method::InputMethodManager::Get()->\n>         EnableInputMethod(input_method)) {\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1065\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1065: chromeos::input_method::InputMethodManager::Get()->ChangeInputMethod(\nOn 2013/07/11 09:13:54, Nikita Kostylev wrote:\n> nit: this looks more readable:\n> \n> chromeos::input_method::InputMethodManager::Get()->\n>     ChangeInputMethod(input_method);\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1075\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1075: DLOG(WARNING)\nOn 2013/07/11 09:13:54, Nikita Kostylev wrote:\n> nit: No need for DLOG(WARNING), perfectly normal situation.\n\nBut it's debug log. Let's leave traces of rare events at least in debug log.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode1108\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:1108: // Set Least Recently used input method for the user\nOn 2013/07/11 10:05:49, Mattias Nissler wrote:\n> nit: missing period.\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/common/pref_names.cc\nFile chrome/common/pref_names.cc (right):\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/common/pref_names.cc#newcode2508\nchrome/common/pref_names.cc:2508: // (used at login screen)\nOn 2013/07/11 10:05:49, Mattias Nissler wrote:\n> nit: Missing period, not using the full line width on line 2507 for the comment.\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/common/pref_names.cc#newcode2509\nchrome/common/pref_names.cc:2509: extern const char kUsersLRUInputMethod[] = \"UsersLRUInputMethod\";\nOn 2013/07/11 10:05:49, Mattias Nissler wrote:\n> This should be earlier in this file (the file as three sections \"PROFILE PREFS\",\n> \"LOCAL STATE\", \"SERVICE PREFS\") in the \"LOCAL STATE\" section, note that there's\n> a whole section of Chrome OS section there where you can add your pref. I know\n> I'm fighting a lost battle here, but still :)\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/common/pref_names.h\nFile chrome/common/pref_names.h (right):\n\nhttps://codereview.chromium.org/18856014/diff/29001/chrome/common/pref_names.h#newcode940\nchrome/common/pref_names.h:940: extern const char kUsersLRUInputMethod[];\nOn 2013/07/11 10:05:49, Mattias Nissler wrote:\n> When you change definition order in pref_names.cc, please adjust this file to be\n> consistent.\n\nDone.","disapproval":false,"date":"2013-07-12 20:10:48.839400","approval":false},{"sender":"nkostylev@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","mnissler@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"https://codereview.chromium.org/18856014/diff/67001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc\nFile chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc (right):\n\nhttps://codereview.chromium.org/18856014/diff/67001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode110\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:110: static bool Contains(const std::vector<std::string>& container,\nnit: no need to mark function static. Usually such utility functions are just declared in unnamed namespace\n\nhttps://codereview.chromium.org/18856014/diff/67001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode992\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:992: static bool SetUserInputMethodImpl(\nPlease move this helper method to unnamed namespace in this file and drop static.\nhttp://google-styleguide.googlecode.com/svn/trunk/cppguide.xml#Nonmember,_Static_Member,_and_Global_Functions\n\nhttps://codereview.chromium.org/18856014/diff/67001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.h\nFile chrome/browser/ui/webui/chromeos/login/signin_screen_handler.h (right):\n\nhttps://codereview.chromium.org/18856014/diff/67001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.h#newcode196\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.h:196: // Required Local State preferences\nnit: dot is missing.\n\nhttps://codereview.chromium.org/18856014/diff/67001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.h#newcode385\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.h:385: // Update current input method (namely keyboard layout) to LRU by this user\nnit: dot is missing.\n\nhttps://codereview.chromium.org/18856014/diff/67001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.h#newcode388\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.h:388: // Update current input method to HW default\nnit: dot is missing.","disapproval":false,"date":"2013-07-15 12:56:37.803650","approval":false},{"sender":"alemate@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","mnissler@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"Mattias Nissler, Seigo Nonaka\n\nI've updated code. Please review again. Thank you.\n\n\n\n\nOn 2013/07/11 09:43:55, Seigo Nonaka wrote:\n> https://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.cc\n> File chrome/browser/chromeos/input_method/input_method_manager_impl.cc (right):\n> \n> https://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.cc#newcode125\n> chrome/browser/chromeos/input_method/input_method_manager_impl.cc:125: const\n> char* kFullLatinKeyboardLanguageList[] = {\n> Please notice that there is \"xkb:jp::jpn\" keyboard which is for Latin character\n> input in jp109 keyboard. (http://en.wikipedia.org/wiki/Keyboard_layout#Japanese)\n> \n> https://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.h\n> File chrome/browser/chromeos/input_method/input_method_manager_impl.h (right):\n> \n> https://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.h#newcode102\n> chrome/browser/chromeos/input_method/input_method_manager_impl.h:102: virtual\n> bool IsLanguageFullLatinKeyboard(const std::string& lang) const\n> As I mentioned in crbug.com/152843, please consider to use IsKeyboardLayout\n> function instead.\n> \n> If you feel bad for non-Latin keyboard on login screen like Russian keyboard,\n> please do as separate work. (I recommend getting advise from UX or i18n team's).\n> \n> https://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_manager_impl.h#newcode191\n> chrome/browser/chromeos/input_method/input_method_manager_impl.h:191: // Start\n> or stop the system input method framework as needed.\n> nit: Starts or stops\n> \n> https://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc\n> File chrome/browser/chromeos/input_method/input_method_persistence.cc (right):\n> \n> https://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode32\n> chrome/browser/chromeos/input_method/input_method_persistence.cc:32: #if\n> defined(OS_CHROMEOS)\n> nit: no need to add OS_CHROMEOS. This class is only used in chromeos\n> environment.\n> \n> https://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode37\n> chrome/browser/chromeos/input_method/input_method_persistence.cc:37: if\n> (local_state != NULL) {\n> If you put DCHECK, please remove this condition, if local_state can be NULL,\n> please remove DCHECK.\n> \n> https://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode46\n> chrome/browser/chromeos/input_method/input_method_persistence.cc:46: if (manager\n> == NULL)\n> no need to check manager, you already put DCHECK above.\n> I think this shouldn't be NULL, so just DCHECK is fine :)\n> \n> https://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode53\n> chrome/browser/chromeos/input_method/input_method_persistence.cc:53: if\n> (ime_util == NULL)\n> ditto.\n> \n> https://codereview.chromium.org/18856014/diff/29001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode57\n> chrome/browser/chromeos/input_method/input_method_persistence.cc:57:\n> ime_util->GetLanguageCodeFromInputMethodId(input_method)))\n> Please note that third party input can set any language, so we should check\n> IsKeyboardLayout.","disapproval":false,"date":"2013-07-17 16:11:51.358800","approval":false},{"sender":"nona@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","mnissler@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"lgtm but please wait Nikita's review :)\n\nhttps://codereview.chromium.org/18856014/diff/67001/chrome/browser/chromeos/input_method/input_method_persistence.cc\nFile chrome/browser/chromeos/input_method/input_method_persistence.cc (right):\n\nhttps://codereview.chromium.org/18856014/diff/67001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode79\nchrome/browser/chromeos/input_method/input_method_persistence.cc:79: << prefs::kUsersLRUInputMethod << \"' for '\" << username\nnit: indent?\n\nhttps://codereview.chromium.org/18856014/diff/67001/chromeos/ime/input_methods.txt\nFile chromeos/ime/input_methods.txt (right):\n\nhttps://codereview.chromium.org/18856014/diff/67001/chromeos/ime/input_methods.txt#newcode64\nchromeos/ime/input_methods.txt:64: #   chrome/browser/chromeos/input_method/input_method_manager_impl_ll.cc\nNo need to do now, but how about introducing new low into following entries to be able to know the target keyboard layout is fully alphabetic keyboard or not?","disapproval":false,"date":"2013-07-22 13:17:34.137110","approval":true},{"sender":"nona@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","mnissler@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"https://codereview.chromium.org/18856014/diff/67001/chromeos/ime/input_methods.txt\nFile chromeos/ime/input_methods.txt (right):\n\nhttps://codereview.chromium.org/18856014/diff/67001/chromeos/ime/input_methods.txt#newcode64\nchromeos/ime/input_methods.txt:64: #   chrome/browser/chromeos/input_method/input_method_manager_impl_ll.cc\nOn 2013/07/22 13:17:34, Seigo Nonaka wrote:\n> No need to do now, but how about introducing new low into following entries to\n> be able to know the target keyboard layout is fully alphabetic keyboard or not?\n\nUgh, /low/column/s please...","disapproval":false,"date":"2013-07-22 14:14:40.438400","approval":false},{"sender":"alemate@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","mnissler@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"I cleaned code, probably style is correct now.\n\nPlease review.\n\nhttps://codereview.chromium.org/18856014/diff/67001/chrome/browser/chromeos/input_method/input_method_persistence.cc\nFile chrome/browser/chromeos/input_method/input_method_persistence.cc (right):\n\nhttps://codereview.chromium.org/18856014/diff/67001/chrome/browser/chromeos/input_method/input_method_persistence.cc#newcode79\nchrome/browser/chromeos/input_method/input_method_persistence.cc:79: << prefs::kUsersLRUInputMethod << \"' for '\" << username\nOn 2013/07/22 13:17:34, Seigo Nonaka wrote:\n> nit: indent?\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/67001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc\nFile chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc (right):\n\nhttps://codereview.chromium.org/18856014/diff/67001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode110\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:110: static bool Contains(const std::vector<std::string>& container,\nOn 2013/07/15 12:56:38, Nikita Kostylev wrote:\n> nit: no need to mark function static. Usually such utility functions are just\n> declared in unnamed namespace\n\nBoth gcc/clang do not warn on unused non-static functions in unnamed namespaces. Don't know why. So let's use static inside unnamed namespaces.\n\nhttps://codereview.chromium.org/18856014/diff/67001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc#newcode992\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.cc:992: static bool SetUserInputMethodImpl(\nOn 2013/07/15 12:56:38, Nikita Kostylev wrote:\n> Please move this helper method to unnamed namespace in this file and drop\n> static.\n> http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml#Nonmember%2C_Static_Member%2C_and_Global_Functions\n\nMoved to unnamed namespace and left it static, because compilers do not warn on unused non-static functions in unnamed namespaces.\n\nhttps://codereview.chromium.org/18856014/diff/67001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.h\nFile chrome/browser/ui/webui/chromeos/login/signin_screen_handler.h (right):\n\nhttps://codereview.chromium.org/18856014/diff/67001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.h#newcode196\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.h:196: // Required Local State preferences\nOn 2013/07/15 12:56:38, Nikita Kostylev wrote:\n> nit: dot is missing.\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/67001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.h#newcode385\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.h:385: // Update current input method (namely keyboard layout) to LRU by this user\nOn 2013/07/15 12:56:38, Nikita Kostylev wrote:\n> nit: dot is missing.\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/67001/chrome/browser/ui/webui/chromeos/login/signin_screen_handler.h#newcode388\nchrome/browser/ui/webui/chromeos/login/signin_screen_handler.h:388: // Update current input method to HW default\nOn 2013/07/15 12:56:38, Nikita Kostylev wrote:\n> nit: dot is missing.\n\nDone.\n\nhttps://codereview.chromium.org/18856014/diff/67001/chromeos/ime/input_methods.txt\nFile chromeos/ime/input_methods.txt (right):\n\nhttps://codereview.chromium.org/18856014/diff/67001/chromeos/ime/input_methods.txt#newcode64\nchromeos/ime/input_methods.txt:64: #   chrome/browser/chromeos/input_method/input_method_manager_impl_ll.cc\nOn 2013/07/22 13:17:34, Seigo Nonaka wrote:\n> No need to do now, but how about introducing new low into following entries to\n> be able to know the target keyboard layout is fully alphabetic keyboard or not?\n\nProbably, but do we have any plugin-based layouts not mentioned here? Also the first comment in this file suggests not to add unnecessary layouts here. \n\nI was thinking of API to directly check a letter through already loaded keyboard layout. But it looks like a lot of new code all over the system... So I hope someone would once get a strong reason to create it ;-)","disapproval":false,"date":"2013-07-22 14:24:20.767790","approval":false},{"sender":"nkostylev@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","mnissler@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"lgtm\n\nI've executed few trybots.\nOnce they are green please check commit queue checkbox.\n\nContext: just checking CQ checkbox may not be sufficient as some trybots are not included (like cros_*) and other trybots do run limited number of tests.","disapproval":false,"date":"2013-07-22 18:50:31.081410","approval":true},{"sender":"commit-bot@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","mnissler@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/alemate@chromium.org/18856014/98001","disapproval":false,"date":"2013-07-23 12:46:08.113160","approval":false},{"sender":"commit-bot@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","mnissler@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"Retried try job too often on mac_rel for step(s) sync_integration_tests\nhttp://build.chromium.org/p/tryserver.chromium/buildstatus?builder=mac_rel&number=151867","disapproval":false,"date":"2013-07-23 14:12:14.890290","approval":false},{"sender":"commit-bot@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","mnissler@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/alemate@chromium.org/18856014/98001","disapproval":false,"date":"2013-07-23 14:42:46.380200","approval":false},{"sender":"commit-bot@chromium.org","recipients":["alemate@chromium.org","nkostylev@chromium.org","mnissler@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","nona+watch@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org"],"text":"Change committed as 213144","disapproval":false,"date":"2013-07-23 17:11:28.923220","approval":false}],"owner_email":"alemate@chromium.org","private":false,"base_url":"https://chromium.googlesource.com/chromium/src.git@master","owner":"alemate","subject":"We should switch the keyboard layout to the layout the user set according to","created":"2013-07-09 12:49:17.769670","patchsets":[1,15002,17001,29001,45001,47001,58001,67001,87001,98001],"modified":"2013-07-23 17:11:29.417350","closed":true,"commit":false,"issue":18856014}