{"description":"OpenFileSystem should accept not mount_type but lower filesystem type\n\nFileSystemContext::ResolveURL which will be enabled by the Blink side change[1]\npasses not a mount_type (ex. kFileSystemTypeExternal) but a lower filesystem\ntype (ex. kFileSystemTypeNativeLocal) into FileSystemBackend::OpenFileSystem.\n\n[1] https://codereview.chromium.org/24376002/\n\n\nBUG=177137,297412\nTEST=browser_tests --gtest_filter=FileDisplay/FileManagerBrowserTest.* (with Blink patch)\nTEST=unit_tests --gtest_filter=ChromeOSFileSystemBackendTest.*\nNOTRY=true\n\nCommitted: https://src.chromium.org/viewvc/chrome?view=rev&revision=224991","cc":["chromium-reviews@chromium.org","nkostylev+watch@chromium.org","tzik+watch@chromium.org","oshima+watch@chromium.org","kinuko+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","kinuko@chromium.org"],"reviewers":["satorux@chromium.org"],"messages":[{"sender":"nhiroki@chromium.org","recipients":["nhiroki@chromium.org","satorux@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","tzik+watch@chromium.org","oshima+watch@chromium.org","kinuko+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","kinuko@chromium.org"],"text":"Hi satoru-san, can you review this? Thanks.","disapproval":false,"date":"2013-09-23 17:49:46.673390","approval":false},{"sender":"kinuko@chromium.org","recipients":["nhiroki@chromium.org","satorux@chromium.org","kinuko@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","tzik+watch@chromium.org","oshima+watch@chromium.org","kinuko+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","kinuko@chromium.org"],"text":"https://codereview.chromium.org/24373002/diff/3001/chrome/browser/chromeos/fileapi/file_system_backend.cc\nFile chrome/browser/chromeos/fileapi/file_system_backend.cc (right):\n\nhttps://codereview.chromium.org/24373002/diff/3001/chrome/browser/chromeos/fileapi/file_system_backend.cc#newcode116\nchrome/browser/chromeos/fileapi/file_system_backend.cc:116: GetFileSystemName(origin_url, mount_type),\nHmm... this looks to be a very unfortunate change, I think at least we need a TODO comment here.\n\nHere's why: if cros backend's going to migrate to multiple filesystems this should return a root URL that includes mount-name path for the given fs type (like we do for syncfs).  It doesn't look correct to always assume kExternal type for all filesystem types either.\n\nSome more thoughts:\n- OpenFileSystem for non-sandboxed filesystems should be probably just deprecated as it has no points.  Existing callsites (there're three, [1]) should be revised either to use ResolveURL or to directly use GetFileSystemRootURI / GetExternalFileSystemRootURIString\n- When crbug.com/284963 is done ResolveURI should start to return the correct root URI which includes the mount name for isolated/external types (and the part must be able to be generalized so that we don't need to call per-backend OpenFileSystem for non-sandboxed filesystems just to get the rootURI & name)\n\n[1] https://code.google.com/p/chromium/codesearch#search/&q=%5C-%3EOpenFileSystem%20file:src/chrome/browser/chromeos/*&sq=package:chromium&type=cs","disapproval":false,"date":"2013-09-23 23:57:34.700080","approval":false},{"sender":"satorux@chromium.org","recipients":["nhiroki@chromium.org","satorux@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","tzik+watch@chromium.org","oshima+watch@chromium.org","kinuko+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","kinuko@chromium.org"],"text":"https://codereview.chromium.org/24373002/diff/3001/chrome/browser/chromeos/fileapi/file_system_backend.cc\nFile chrome/browser/chromeos/fileapi/file_system_backend.cc (right):\n\nhttps://codereview.chromium.org/24373002/diff/3001/chrome/browser/chromeos/fileapi/file_system_backend.cc#newcode116\nchrome/browser/chromeos/fileapi/file_system_backend.cc:116: GetFileSystemName(origin_url, mount_type),\nOn 2013/09/23 23:57:34, kinuko wrote:\n> Hmm... this looks to be a very unfortunate change, I think at least we need a\n> TODO comment here.\n> \n> Here's why: if cros backend's going to migrate to multiple filesystems this\n> should return a root URL that includes mount-name path for the given fs type\n> (like we do for syncfs).  It doesn't look correct to always assume kExternal\n> type for all filesystem types either.\n> \n> Some more thoughts:\n> - OpenFileSystem for non-sandboxed filesystems should be probably just\n> deprecated as it has no points.  Existing callsites (there're three, [1]) should\n> be revised either to use ResolveURL or to directly use GetFileSystemRootURI /\n> GetExternalFileSystemRootURIString\n> - When crbug.com/284963 is done ResolveURI should start to return the correct\n> root URI which includes the mount name for isolated/external types (and the part\n> must be able to be generalized so that we don't need to call per-backend\n> OpenFileSystem for non-sandboxed filesystems just to get the rootURI & name)\n> \n> [1]\n> https://code.google.com/p/chromium/codesearch#search/&q=%255C-%253EOpenFileSystem%2520file:src/chrome/browser/chromeos/*&sq=package:chromium&type=cs\n\nAgreed. TODO comment is a crbug.com URL would be nice here.","disapproval":false,"date":"2013-09-24 04:12:50.879010","approval":false},{"sender":"nhiroki@chromium.org","recipients":["nhiroki@chromium.org","satorux@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","tzik+watch@chromium.org","oshima+watch@chromium.org","kinuko+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","kinuko@chromium.org"],"text":"Updated. Can you take another look? Thanks!\n\nhttps://codereview.chromium.org/24373002/diff/3001/chrome/browser/chromeos/fileapi/file_system_backend.cc\nFile chrome/browser/chromeos/fileapi/file_system_backend.cc (right):\n\nhttps://codereview.chromium.org/24373002/diff/3001/chrome/browser/chromeos/fileapi/file_system_backend.cc#newcode116\nchrome/browser/chromeos/fileapi/file_system_backend.cc:116: GetFileSystemName(origin_url, mount_type),\nOn 2013/09/24 04:12:51, satorux1 wrote:\n> On 2013/09/23 23:57:34, kinuko wrote:\n> > Hmm... this looks to be a very unfortunate change, I think at least we need a\n> > TODO comment here.\n> > \n> > Here's why: if cros backend's going to migrate to multiple filesystems this\n> > should return a root URL that includes mount-name path for the given fs type\n> > (like we do for syncfs).  It doesn't look correct to always assume kExternal\n> > type for all filesystem types either.\n> > \n> > Some more thoughts:\n> > - OpenFileSystem for non-sandboxed filesystems should be probably just\n> > deprecated as it has no points.  Existing callsites (there're three, [1])\n> should\n> > be revised either to use ResolveURL or to directly use GetFileSystemRootURI /\n> > GetExternalFileSystemRootURIString\n> > - When crbug.com/284963 is done ResolveURI should start to return the correct\n> > root URI which includes the mount name for isolated/external types (and the\n> part\n> > must be able to be generalized so that we don't need to call per-backend\n> > OpenFileSystem for non-sandboxed filesystems just to get the rootURI & name)\n> > \n> > [1]\n> >\n> https://code.google.com/p/chromium/codesearch#search/&q=%25255C-%25253EOpenFileSystem%252520file:src/chrome/browser/chromeos/*&sq=package:chromium&type=cs\n> \n> Agreed. TODO comment is a http://crbug.com URL would be nice here.\n\nFiled (http://crbug.com/297412) and added a comment.","disapproval":false,"date":"2013-09-24 06:14:28.364010","approval":false},{"sender":"satorux@chromium.org","recipients":["nhiroki@chromium.org","satorux@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","tzik+watch@chromium.org","oshima+watch@chromium.org","kinuko+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","kinuko@chromium.org"],"text":"lgtm","disapproval":false,"date":"2013-09-24 06:19:20.166990","approval":true},{"sender":"commit-bot@chromium.org","recipients":["nhiroki@chromium.org","satorux@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","tzik+watch@chromium.org","oshima+watch@chromium.org","kinuko+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","kinuko@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/nhiroki@chromium.org/24373002/14001","disapproval":false,"date":"2013-09-24 06:21:29.696760","approval":false},{"sender":"commit-bot@chromium.org","recipients":["nhiroki@chromium.org","satorux@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","tzik+watch@chromium.org","oshima+watch@chromium.org","kinuko+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","kinuko@chromium.org"],"text":"Retried try job too often on linux_aura for step(s) browser_tests\nhttp://build.chromium.org/p/tryserver.chromium/buildstatus?builder=linux_aura&number=79935","disapproval":false,"date":"2013-09-24 12:00:57.751440","approval":false},{"sender":"commit-bot@chromium.org","recipients":["nhiroki@chromium.org","satorux@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","tzik+watch@chromium.org","oshima+watch@chromium.org","kinuko+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","kinuko@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/nhiroki@chromium.org/24373002/14001","disapproval":false,"date":"2013-09-24 13:24:35.971710","approval":false},{"sender":"commit-bot@chromium.org","recipients":["nhiroki@chromium.org","satorux@chromium.org","chromium-reviews@chromium.org","nkostylev+watch@chromium.org","tzik+watch@chromium.org","oshima+watch@chromium.org","kinuko+watch@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","kinuko@chromium.org"],"text":"Change committed as 224991","disapproval":false,"date":"2013-09-24 13:25:19.352720","approval":false}],"owner_email":"nhiroki@chromium.org","private":false,"base_url":"svn://svn.chromium.org/chrome/trunk/src","owner":"nhiroki","subject":"OpenFileSystem should accept not mount_type but lower filesystem type","created":"2013-09-23 16:52:27.067390","patchsets":[3001,14001],"modified":"2013-09-24 13:25:19.575050","closed":true,"commit":false,"issue":24373002}