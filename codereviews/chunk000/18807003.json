{"description":"Ignore reordered notifications in the NTP for installing apps.\n\nChanges to the app sort order via ExtensionSorting does not rely on the\nextension corresponding to the reordered ID to be installed. This\nchanges a DCHECK to instead ignore such changes for the NTP webui.\n\nBUG=257960\nTEST=Enable App Launcher, install a big app, and move it in the app\nlauncher while it is downloading. Chrome should not crash.\n\nCommitted: https://src.chromium.org/viewvc/chrome?view=rev&revision=211928\n\nCommitted: https://src.chromium.org/viewvc/chrome?view=rev&revision=212031","cc":["chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"reviewers":["benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org"],"messages":[{"sender":"tapted@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org"],"text":"Ben could you take a look? This is primarily to get something to merge to m29 to avoid the crasher. By the time m30 is released this should be obsoleted by http://crrev.com/17038002\n\nhttps://codereview.chromium.org/18807003/diff/1/chrome/browser/extensions/extension_install_ui_browsertest.cc\nFile chrome/browser/extensions/extension_install_ui_browsertest.cc (right):\n\nhttps://codereview.chromium.org/18807003/diff/1/chrome/browser/extensions/extension_install_ui_browsertest.cc#newcode225\nchrome/browser/extensions/extension_install_ui_browsertest.cc:225: }\nI think this is the limit of what we can check without a big overhaul, or making the test quite fragile. That is, the test has the problem that it doesn't (or can't) inspect what's going on in AppLauncherHandler or in the NTP DOMWindow. I verified that this test is getting coverage of the changed code, but it would be nice to check, e.g., that the NTP is actually showing two apps in the correct order. I confirmed that that is the case by putting content::RunMessageLoop() at the end of the test, but maybe that's not good enough.\n\nI thought of something like the following, but it's a mess:\n\n  std::string result;\n  EXPECT_TRUE(content::ExecuteScriptAndExtractString(\n        browser()->tab_strip_model()->GetActiveWebContents(),\n        \"document.querySelectorAll('.app-img-container')[0].title\",\n        &result));","disapproval":false,"date":"2013-07-10 05:11:58.012150","approval":false},{"sender":"tapted@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"bah +chrome-apps-syd-reviews","disapproval":false,"date":"2013-07-10 05:12:33.705100","approval":false},{"sender":"benwells@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"On 2013/07/10 05:12:33, tapted wrote:\n> bah +chrome-apps-syd-reviews\n\ncalamity: please have a look, you're the expert in app ordering.","disapproval":false,"date":"2013-07-10 05:28:47.613590","approval":false},{"sender":"calamity@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"lgtm, I fixed a crash there for disabled apps but forgot about  installing ones.","disapproval":false,"date":"2013-07-10 07:07:33.367960","approval":true},{"sender":"tapted@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"Dan, could you please take a look for the webui change?","disapproval":false,"date":"2013-07-10 08:13:43.961040","approval":false},{"sender":"dbeam@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"https://chromiumcodereview.appspot.com/18807003/diff/1/chrome/browser/ui/webui/ntp/app_launcher_handler.cc\nFile chrome/browser/ui/webui/ntp/app_launcher_handler.cc (right):\n\nhttps://chromiumcodereview.appspot.com/18807003/diff/1/chrome/browser/ui/webui/ntp/app_launcher_handler.cc#newcode292\nchrome/browser/ui/webui/ntp/app_launcher_handler.cc:292: if (!extension)\nhow is this possible? nothing would be showing to be reordered until it's actually installed (which is after downloading)\n\nhttps://chromiumcodereview.appspot.com/18807003/diff/1/chrome/browser/ui/webui/ntp/app_launcher_handler.cc#newcode293\nchrome/browser/ui/webui/ntp/app_launcher_handler.cc:293: return;  // Extension could still be downloading or installing.\nnit:\n\n  if (!extension) {\n    // Extension could still be downloading or installing.\n    return;\n  }","disapproval":false,"date":"2013-07-10 18:22:18.030120","approval":false},{"sender":"dbeam@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"https://chromiumcodereview.appspot.com/18807003/diff/1/chrome/browser/ui/webui/ntp/app_launcher_handler.cc\nFile chrome/browser/ui/webui/ntp/app_launcher_handler.cc (right):\n\nhttps://chromiumcodereview.appspot.com/18807003/diff/1/chrome/browser/ui/webui/ntp/app_launcher_handler.cc#newcode292\nchrome/browser/ui/webui/ntp/app_launcher_handler.cc:292: if (!extension)\nOn 2013/07/10 18:22:18, Dan Beam wrote:\n> how is this possible? nothing would be showing to be reordered until it's\n> actually installed (which is after downloading)\n\nis it possible that this is while an app is *uninstalling*?","disapproval":false,"date":"2013-07-10 18:22:51.497450","approval":false},{"sender":"tapted@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"https://chromiumcodereview.appspot.com/18807003/diff/1/chrome/browser/ui/webui/ntp/app_launcher_handler.cc\nFile chrome/browser/ui/webui/ntp/app_launcher_handler.cc (right):\n\nhttps://chromiumcodereview.appspot.com/18807003/diff/1/chrome/browser/ui/webui/ntp/app_launcher_handler.cc#newcode292\nchrome/browser/ui/webui/ntp/app_launcher_handler.cc:292: if (!extension)\nOn 2013/07/10 18:22:18, Dan Beam wrote:\n> how is this possible? nothing would be showing to be reordered until it's\n> actually installed (which is after downloading)\n\nThe CrOS-style app launcher that's, uh, launching in Windows grabs a temporary icon from the webstore and loads it without the full Extension* to show a download progress bar. While the progress bar is showing, the app can be moved around (and I think it's a pretty likely use-case, e.g., for someone to move the app to a preferred page at this point).\n\nTo get the full gist, I put an animated gif of the Mac version at http://crbug.com/257960#c3 . Looks like crbug won't animate it inline, but downloading the attachment works.\n\nThe sequence of operations is the same as the logic in the added test, in extension_install_ui_browsertest.cc .\n\nhttps://chromiumcodereview.appspot.com/18807003/diff/1/chrome/browser/ui/webui/ntp/app_launcher_handler.cc#newcode293\nchrome/browser/ui/webui/ntp/app_launcher_handler.cc:293: return;  // Extension could still be downloading or installing.\nOn 2013/07/10 18:22:18, Dan Beam wrote:\n> nit:\n> \n>   if (!extension) {\n>     // Extension could still be downloading or installing.\n>     return;\n>   }\n\nDone.","disapproval":false,"date":"2013-07-11 00:09:15.543560","approval":false},{"sender":"benwells@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"lgtm","disapproval":false,"date":"2013-07-12 01:51:54.516250","approval":true},{"sender":"tapted@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"dbeam: ping?","disapproval":false,"date":"2013-07-13 02:02:34.515830","approval":false},{"sender":"dbeam@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"Still don't really like this. You should make not-fully-installed extensions undraggable in the UI IMO otherwise this'll be annoying for users.","disapproval":false,"date":"2013-07-13 02:28:47.389540","approval":false},{"sender":"tapted@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"On 2013/07/13 02:28:47, Dan Beam wrote:\n> Still don't really like this. You should make not-fully-installed extensions\n> undraggable in the UI IMO otherwise this'll be annoying for users.\n\nI've verified that the changed order is preserved when the item is fully installed and appears on the NTP. That is, the NTP UI will insert it at the appropriate place once installed. Is that the part you were worried would be annoying?\n\nLong term, we are separating the two sorting schemes -- this is in progress in http://crrev.com/17038002, but not something I would suggest merging back to m29 to fix the crash.","disapproval":false,"date":"2013-07-13 03:37:41.117170","approval":false},{"sender":"dbeam@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"On 2013/07/13 03:37:41, tapted wrote:\n> On 2013/07/13 02:28:47, Dan Beam wrote:\n> > Still don't really like this. You should make not-fully-installed extensions\n> > undraggable in the UI IMO otherwise this'll be annoying for users.\n> \n> I've verified that the changed order is preserved when the item is fully\n> installed and appears on the NTP. That is, the NTP UI will insert it at the\n> appropriate place once installed. Is that the part you were worried would be\n> annoying?\n\nso you're saying that partially installed extensions show up only in the app launcher but not in the NTP?  if that's the case, lgtm.  i still think you should prohibit partially installed apps from being dragged at all in the _app launcher_ so this code never gets hit (i.e. show a list of *installing* apps at the end of the apps launcher's list and don't let the user drag until they're actually installed [unless this works in the app launcher]).\n\n> \n> Long term, we are separating the two sorting schemes -- this is in progress in\n> http://crrev.com/17038002, but not something I would suggest merging back to m29\n> to fix the crash.","disapproval":false,"date":"2013-07-15 21:57:08.361950","approval":true},{"sender":"tapted@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"Thanks Dan!\n\nOn 2013/07/15 21:57:08, Dan Beam wrote:\n> On 2013/07/13 03:37:41, tapted wrote:\n> > On 2013/07/13 02:28:47, Dan Beam wrote:\n> > > Still don't really like this. You should make not-fully-installed extensions\n> > > undraggable in the UI IMO otherwise this'll be annoying for users.\n> > \n> > I've verified that the changed order is preserved when the item is fully\n> > installed and appears on the NTP. That is, the NTP UI will insert it at the\n> > appropriate place once installed. Is that the part you were worried would be\n> > annoying?\n> \n> so you're saying that partially installed extensions show up only in the app\n> launcher but not in the NTP?\n\nyes - that's correct.\n\n>  if that's the case, lgtm.  i still think you\n> should prohibit partially installed apps from being dragged at all in the _app\n> launcher_ so this code never gets hit (i.e. show a list of *installing* apps at\n> the end of the apps launcher's list and don't let the user drag until they're\n> actually installed [unless this works in the app launcher]).\n\ncalamity is working on segregating the sort order in the app launcher in http://crrev.com/17038002, which I think will address your concens long term. If the NTP isn't opened in a browser, dragging installing apps (progress bar and all) is currently functional in the app launcher and works as expected. This crash with the NTP opened probably just slipped through because CrOS doesn't use the 'Apps' page of the NTP. However, windows and mac use both.","disapproval":false,"date":"2013-07-15 23:32:06.711480","approval":false},{"sender":"commit-bot@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/tapted@chromium.org/18807003/16001","disapproval":false,"date":"2013-07-15 23:33:44.566520","approval":false},{"sender":"commit-bot@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"Sorry for I got bad news for ya.\nCompile failed with a clobber build on linux_aura.\nhttp://build.chromium.org/p/tryserver.chromium/buildstatus?builder=linux_aura&number=59736\nYour code is likely broken or HEAD is junk. Please ensure your\ncode is not broken then alert the build sheriffs.\nLook at the try server FAQ for more details.","disapproval":false,"date":"2013-07-16 03:59:15.565040","approval":false},{"sender":"commit-bot@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/tapted@chromium.org/18807003/44001","disapproval":false,"date":"2013-07-16 23:11:45.685290","approval":false},{"sender":"commit-bot@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"Change committed as 211928","disapproval":false,"date":"2013-07-17 04:19:43.511870","approval":false},{"sender":"tapted@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"The rebase in patch set 3 (needed for http://crrev.com/211297 ) pulled in some components I was using for testing. I should have caught that screwup earlier - sorry. Trying the CQ gauntlet again..","disapproval":false,"date":"2013-07-17 05:22:42.743290","approval":false},{"sender":"commit-bot@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/tapted@chromium.org/18807003/67001","disapproval":false,"date":"2013-07-17 05:25:58.026360","approval":false},{"sender":"commit-bot@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"Step \"update\" is always a major failure.\nLook at the try server FAQ for more details.\nhttp://build.chromium.org/p/tryserver.chromium/buildstatus?builder=linux_clang&number=124700","disapproval":false,"date":"2013-07-17 05:40:16.264910","approval":false},{"sender":"commit-bot@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/tapted@chromium.org/18807003/67001","disapproval":false,"date":"2013-07-17 06:49:49.183820","approval":false},{"sender":"commit-bot@chromium.org","recipients":["tapted@chromium.org","benwells@chromium.org","calamity@chromium.org","dbeam@chromium.org","chromium-reviews@chromium.org","dbeam+watch-ntp@chromium.org","chromium-apps-reviews@chromium.org","pedrosimonetti+watch@chromium.org","estade+watch@chromium.org","extensions-reviews@chromium.org","chrome-apps-syd-reviews@chromium.org"],"text":"Change committed as 212031","disapproval":false,"date":"2013-07-17 14:04:45.644800","approval":false}],"owner_email":"tapted@chromium.org","private":false,"base_url":"svn://svn.chromium.org/chrome/trunk/src","owner":"tapted","subject":"Ignore reordered notifications in the NTP for installing apps.","created":"2013-07-10 03:51:38.799620","patchsets":[1,16001,44001,67001],"modified":"2013-07-17 14:04:46.335810","closed":true,"commit":false,"issue":18807003}