{"description":"chrome/browser/chromeos/input_method/ refactoring [part 6 of 6]. \r\n\r\n* Overview of the change\r\n\r\nThe main purpose of this CL is to make InputMethodManager fully unit-testable. To accomplish that, InputMethodManager is modified as follows:\r\n\r\n- Add setters to set mock versions of IBusController, CandidateWindowController, and XKeyboard.\r\n- Move ibus-daemon startup and shutdown code from the manager to IBusControllerImpl. They lived in the manager only for historical reasons.\r\n- Remove code for monitoring the status of the connection between Chrome and ibus-daemon (InputMethodManager::OnConnectionChange(bool)). This kind of thing should also be done in IBusControllerImpl.\r\n\r\n\r\n* Details\r\n\r\nash/shell.cc:\r\nash/system/ime/tray_ime.cc:\r\nash/system/tray/system_tray*.*:\r\nchrome/browser/chromeos/system/ash_system_tray_delegate.cc:\r\n\r\nRemove unused parameter |is_selection| from the SystemTrayDelegate interface following sadrul's suggestion in http://codereview.chromium.org/10008043/.\r\n\r\n\r\nchrome/browser/chromeos/chrome_browser_main_chromeos.cc:\r\n\r\nInitialize() and Shutdown() InputMethodManager.\r\n\r\n\r\nchrome/browser/chromeos/extensions/input_method_event_router.h:\r\nchrome/browser/chromeos/extensions/input_method_event_router.cc:\r\n\r\nFollow the interface change of InputMethodManager::Observer. Implementation is not changed at all.\r\n\r\n\r\nchrome/browser/chromeos/input_method/browser_state_monitor.h:\r\nchrome/browser/chromeos/input_method/browser_state_monitor.cc:\r\n\r\nFollow the interface change of InputMethodManager::Observer.\r\nMake the class testable by adding some setters and getters.\r\nRemove STATE_LOGGING_IN. Since preferences.cc is fixed in #5 of the series of patches, the intermediate state is no longer needed.\r\n\r\n\r\nchrome/browser/chromeos/input_method/browser_state_monitor_unittest.cc:\r\n\r\nVerify if the implementation updates the correct pref file (i.e. Local\\ State or Preferences depending on the browser state).\r\n\r\n\r\nchrome/browser/chromeos/input_method/ibus_controller.h:\r\n\r\nSimplify the IBusController::Observer interface.\r\nAdd Start() which is called when a non-XKB input method is enabled.\r\nRename SetImePropertyActivated() to ActivateInputMethodProperty() and remove the second parameter |is_selection| which is no longer needed.\r\nRemove CreateInputMethodDescriptor() as we can simply use a constructor in InputMethodDescriptor.\r\n\r\n\r\nchrome/browser/chromeos/input_method/ibus_controller.cc:\r\n\r\nMove HAVE_IBUS part to chrome/browser/chromeos/input_method/ibus_controller_impl.cc.\r\nMove !HAVE_IBUS part to chrome/browser/chromeos/input_method/mock_ibus_controller.cc.\r\nMove some functions which do not depend on libibus to chrome/browser/chromeos/input_method/ibus_controller_base.cc.\r\n\r\n\r\nchrome/browser/chromeos/input_method/ibus_controller_base.h:\r\nchrome/browser/chromeos/input_method/ibus_controller_base.cc:\r\nchrome/browser/chromeos/input_method/ibus_controller_base_unittest.cc:\r\n\r\nImplement some part of the IBusController interface. Since the files do not depend on libibus, they are unit-testable.\r\n\r\n\r\nchrome/browser/chromeos/input_method/ibus_controller_impl.h:\r\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:\r\n\r\nImplement libibus dependent part of the IBusController interface.\r\nMoved ibus-daemon startup and shutdown code from input_method_manager.cc. Most of other part are unchanged.\r\n\r\n\r\nchrome/browser/chromeos/input_method/ibus_controller_impl_unittest.cc:\r\n\r\nTests FindAndUpdateProperty() function in ibus_controller_impl.cc since the function does not use libibus structues/functions. Other functions in ibus_controller_impl.cc will become unit testable soon once crosbug.com/26334 is fixed (by nona@c).\r\n\r\n\r\nchrome/browser/chromeos/input_method/input_method_engine.cc:\r\n\r\nFollow InputMethodManager interface changes.\r\n\r\n\r\nchrome/browser/chromeos/input_method/input_method_manager.h:\r\n\r\nSimplify InputMethodManager::Observer interface.\r\nAdd EnableInputMethods(). We used to set an ibus-daemon config called \"preload_engines\" to enable input methods, but it is difficult to understand. In addition to the readability problem, the \"preload_engines\" config has been removed from ibus-1.5. On the daemon side, what we have to do to switch the current input method is just to call ibus_bus_set_global_engine(\"engine-name\") without calling ibus_config_set_value(\"preload_engiens\", ...). So enabling engines by calling SetInputMethodConfig() does not make sense at all now.\r\nRename AddActiveIme() to AddInputMethodExtension(). Do the same for RemoveActiveIme().\r\nMove StartInputMethodDaemon() and StopInputMethodDaemon() to IBusControllerImpl. This should be done automatically in the libibus layer.\r\nAdd Initialize() and Shutdown() to stop initializing the instance as a singleton.\r\n\r\n\r\nchrome/browser/chromeos/input_method/input_method_manager.cc:\r\n\r\nMove to input_method_manager_impl.cc.\r\n\r\n\r\nchrome/browser/chromeos/input_method/input_method_manager_impl.h:\r\nchrome/browser/chromeos/input_method/input_method_manager_impl.cc:\r\n\r\nThe manager implementation. Fully tested.\r\n\r\n\r\nchrome/browser/chromeos/input_method/input_method_manager_browsertest.cc:\r\nchrome/browser/chromeos/input_method/input_method_manager_impl_unittest.cc:\r\n\r\nRename input_method_manager_browsertest.cc to input_method_manager_impl_unittest.cc.\r\nAdded bunch of unit tests that tests all methods in the manager implementation.\r\n\r\n\r\nchrome/browser/chromeos/login/login_utils_browsertest.cc:\r\nchrome/browser/ui/webui/options2/language_options_handler2_unittest.cc:\r\n\r\nInitialize() and Shutdown() the input method manager instance.\r\n\r\n\r\nchrome/browser/chromeos/login/screen_locker.cc:\r\n\r\nMove code for changing the set of enabled input methods on lock/unlock to input_method_manager_impl.cc.\r\n\r\n\r\nchrome/browser/chromeos/preferences_unittest.cc:\r\n\r\nAdd a unit test which checks if the correct input method is set as a default one on signing in.\r\n\r\n\r\nNote that the CL compiles and works correctly only with app-i18n/ibus >= 1.4.99.\r\n\r\nBUG=chromium-os:19655\r\nTEST=try\n\nCommitted: https://src.chromium.org/viewvc/chrome?view=rev&revision=132751","cc":["chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"reviewers":["kinaba@chromium.org","nona@chromium.org","zork@chromium.org","mukai@chromium.org","csilv@chromium.org","nkostylev@chromium.org","sky@chromium.org"],"messages":[{"sender":"yusukes@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"kinaba, nona, sorry for sending such a huge change... but please help me review it.\n\nI think you can review input_method_manager_impl.cc as a new file (although it's git-mv'ed from input_method_manager.cc) since almost everything is rewritten. OTOH, ibus_controller_impl.cc, which is git-mv'ed from ibus_controller.cc, is almost unchanged (except new functions). I'll let you know which functions in ibus_controller_impl.cc are new and which are not.","disapproval":false,"date":"2012-04-12 07:47:32.596132","approval":false},{"sender":"yusukes@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"http://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc\nFile chrome/browser/chromeos/input_method/ibus_controller_impl.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode59\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:59: const char* Or(const char* str1, const char* str2) {\nunchaged\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode64\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:64: bool PropertyKeyIsBlacklisted(const char* key) {\nunchanged\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode77\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:77: IBusInputContext* GetInputContext(const std::string& input_context_path,\nunchanged\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode93\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:93: bool PropertyHasChildren(IBusProperty* prop) {\nremoved const_cast<> which is unnecessary for ibus-1.5. other than that, unchanged.\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode102\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:102: bool ConvertProperty(IBusProperty* ibus_prop,\nunchanged\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode182\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:182: bool FlattenProperty(IBusProperty* ibus_prop,\nunchanged (other than const_cast<> removal)\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode247\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:247: bool FlattenPropertyList(IBusPropList* ibus_prop_list,\nunchanged\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode272\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:272: const char* PropTypeToString(int prop_type) {\nunchanged\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode289\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:289: const char* PropStateToString(int prop_state) {\nunchanged\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode302\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:302: std::string Spacer(int n) {\nunchanged\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode307\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:307: std::string PrintProp(IBusProperty *prop, int tree_level) {\nunchanged (other than const_cast<> removal)\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode346\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:346: std::string PrintPropList(IBusPropList *prop_list, int tree_level) {\nunchanged\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode362\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:362: IBusControllerImpl::IBusControllerImpl()\nchanged. added member variable initialization.\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode369\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:369: IBusControllerImpl::~IBusControllerImpl() {\nunchanged\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode406\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:406: bool IBusControllerImpl::Start(const std::vector<std::string>& ids) {\nnew function\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode412\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:412: bool IBusControllerImpl::Stop() {\nrenamed but unchanged.\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode440\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:440: bool IBusControllerImpl::ChangeInputMethod(const std::string& id) {\nrewritten. the key point here is to copy |id| to |current_input_method_id_| and switch to the remembered ID when a connection to ibus-daemon is established.\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode471\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:471: bool IBusControllerImpl::ActivateInputMethodProperty(const std::string& key) {\nrenamed. the second parameter is removed. line 481-494 are new.\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode550\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:550: bool IBusControllerImpl::IBusConnectionsAreAlive() {\nrewritten. check process_handle_ as well.\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode555\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:555: void IBusControllerImpl::MaybeRestoreConnections() {\nrewritten\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode568\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:568: void IBusControllerImpl::MaybeInitializeIBusBus() {\nrenamed but unchanged.\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode590\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:590: void IBusControllerImpl::MaybeRestoreIBusConfig() {\nunchanged\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode636\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:636: void IBusControllerImpl::MaybeDestroyIBusConfig() {\nunchanged\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode647\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:647: void IBusControllerImpl::SendChangeInputMethodRequest(const std::string& id) {\nnew function\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode657\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:657: void IBusControllerImpl::SendAllInputMethodConfigs() {\nnew function\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode667\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:667: bool IBusControllerImpl::SetInputMethodConfigInternal(\nrenamed and slightly modified/simplified\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode721\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:721: void IBusControllerImpl::ConnectBusSignals() {\nunchanged\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode745\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:745: void IBusControllerImpl::ConnectPanelServiceSignals() {\nunchanged\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode772\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:772: void IBusControllerImpl::BusConnected(IBusBus* bus) {\nunchanged\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode777\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:777: void IBusControllerImpl::BusDisconnected(IBusBus* bus) {\nremoved FOR_EACH_OBSERVER\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode785\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:785: void IBusControllerImpl::BusNameOwnerChanged(IBusBus* bus,\nunchanged\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode818\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:818: void IBusControllerImpl::FocusIn(IBusPanelService* panel,\nunchanged\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode828\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:828: void IBusControllerImpl::RegisterProperties(IBusPanelService* panel,\nrewritten\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode846\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:846: void IBusControllerImpl::UpdateProperty(IBusPanelService* panel,\nrewritten\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode871\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:871: bool IBusControllerImpl::MaybeLaunchIBusDaemon() {\nmoved from the manager\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode894\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:894: bool IBusControllerImpl::LaunchProcess(const std::string& command_line,\nmoved from the manager\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode919\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:919: void IBusControllerImpl::SetInputMethodConfigCallback(GObject* source_object,\nunchanged\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode943\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:943: void IBusControllerImpl::OnIBusDaemonExit(GPid pid,\nmoved from the manager, slightly modified.\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode956\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:956: bool IBusControllerImpl::FindAndUpdatePropertyForTesting(\nnew function for testing.","disapproval":false,"date":"2012-04-12 08:56:50.246217","approval":false},{"sender":"yusukes@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"kinaba, nona, to be exact, please review only the following files:\n\nchrome/browser/chromeos/*\nchrome/browser/chromeos/input_method/*\nchrome/browser/chromeos/login/screen_locker.cc\n\nOther files will be reviewed by OWNERs of the directories.","disapproval":false,"date":"2012-04-12 09:01:16.556224","approval":false},{"sender":"nona@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"http://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/input_method_manager.h\nFile chrome/browser/chromeos/input_method/input_method_manager.h (right):\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/input_method_manager.h#newcode79\nchrome/browser/chromeos/input_method/input_method_manager.h:79: virtual InputMethodDescriptors* GetSupportedInputMethods() = 0;\nI think this function can be const.\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/input_method_manager.h#newcode83\nchrome/browser/chromeos/input_method/input_method_manager.h:83: virtual InputMethodDescriptors* GetActiveInputMethods() = 0;\nI think this function can be const.\n\nhttp://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/input_method/input_method_manager_impl.cc\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/input_method/input_method_manager_impl.cc#newcode196\nchrome/browser/chromeos/input_method/input_method_manager_impl.cc:196: // keep reletive order of the extension input method IDs.\ntypo? relative","disapproval":false,"date":"2012-04-13 04:03:14.469032","approval":false},{"sender":"yusukes@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"http://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/input_method_manager.h\nFile chrome/browser/chromeos/input_method/input_method_manager.h (right):\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/input_method_manager.h#newcode79\nchrome/browser/chromeos/input_method/input_method_manager.h:79: virtual InputMethodDescriptors* GetSupportedInputMethods() = 0;\nOn 2012/04/13 04:03:14, nona1 wrote:\n> I think this function can be const.\n\nDone.\n\nhttp://codereview.chromium.org/9999018/diff/10009/chrome/browser/chromeos/input_method/input_method_manager.h#newcode83\nchrome/browser/chromeos/input_method/input_method_manager.h:83: virtual InputMethodDescriptors* GetActiveInputMethods() = 0;\nOn 2012/04/13 04:03:14, nona1 wrote:\n> I think this function can be const.\n\nDone.\n\nhttp://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/input_method/input_method_manager_impl.cc\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/input_method/input_method_manager_impl.cc#newcode196\nchrome/browser/chromeos/input_method/input_method_manager_impl.cc:196: // keep reletive order of the extension input method IDs.\nOn 2012/04/13 04:03:14, nona1 wrote:\n> typo? relative\n\nDone.","disapproval":false,"date":"2012-04-13 08:00:45.395512","approval":false},{"sender":"kinaba@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"Reviewed the codes _except_ unittest parts (review for the tests will come later). Only a few nits of comments.\n\nhttp://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/input_method/ibus_controller_impl.h\nFile chrome/browser/chromeos/input_method/ibus_controller_impl.h (right):\n\nhttp://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/input_method/ibus_controller_impl.h#newcode156\nchrome/browser/chromeos/input_method/ibus_controller_impl.h:156: // An object which knows all valid input method and layout IDs.\nnit: s/method/methods/\n\nhttp://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/input_method/input_method_manager_impl.h\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.h (right):\n\nhttp://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/input_method/input_method_manager_impl.h#newcode156\nchrome/browser/chromeos/input_method/input_method_manager_impl.h:156: // allow allow callbacks when the input method status changes.\nnit: allow allow -> allow\n\nhttp://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/input_method/input_method_manager_unittest.cc\nFile chrome/browser/chromeos/input_method/input_method_manager_unittest.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/input_method/input_method_manager_unittest.cc#newcode6\nchrome/browser/chromeos/input_method/input_method_manager_unittest.cc:6: #include \"base/memory/scoped_ptr.h\"\nlogging and scoped_ptr don't look to be used.\n\nhttp://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/preferences.cc\nFile chrome/browser/chromeos/preferences.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/preferences.cc#newcode703\nchrome/browser/chromeos/preferences.cc:703: void Preferences::UpdateVirturalKeyboardPreference(PrefService* prefs) {\nNot directly related to this CL, but could you add\n\"// static\" before this method definition as done for\nPreferences::RegisterUserPrefs? (regarding my overlook of staticness in http://codereview.chromium.org/10027008/ :)).","disapproval":false,"date":"2012-04-13 08:08:52.949149","approval":false},{"sender":"yusukes@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"http://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/input_method/ibus_controller_impl.h\nFile chrome/browser/chromeos/input_method/ibus_controller_impl.h (right):\n\nhttp://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/input_method/ibus_controller_impl.h#newcode156\nchrome/browser/chromeos/input_method/ibus_controller_impl.h:156: // An object which knows all valid input method and layout IDs.\nOn 2012/04/13 08:08:53, kinaba wrote:\n> nit: s/method/methods/\n\nDone.\n\nhttp://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/input_method/input_method_manager_impl.h\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.h (right):\n\nhttp://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/input_method/input_method_manager_impl.h#newcode156\nchrome/browser/chromeos/input_method/input_method_manager_impl.h:156: // allow allow callbacks when the input method status changes.\nOn 2012/04/13 08:08:53, kinaba wrote:\n> nit: allow allow -> allow\n\nDone.\n\nhttp://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/input_method/input_method_manager_unittest.cc\nFile chrome/browser/chromeos/input_method/input_method_manager_unittest.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/input_method/input_method_manager_unittest.cc#newcode6\nchrome/browser/chromeos/input_method/input_method_manager_unittest.cc:6: #include \"base/memory/scoped_ptr.h\"\nOn 2012/04/13 08:08:53, kinaba wrote:\n> logging and scoped_ptr don't look to be used.\n\nDone.\n\nhttp://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/preferences.cc\nFile chrome/browser/chromeos/preferences.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/13002/chrome/browser/chromeos/preferences.cc#newcode703\nchrome/browser/chromeos/preferences.cc:703: void Preferences::UpdateVirturalKeyboardPreference(PrefService* prefs) {\nOn 2012/04/13 08:08:53, kinaba wrote:\n> Not directly related to this CL, but could you add\n> \"// static\" before this method definition as done for\n> Preferences::RegisterUserPrefs? (regarding my overlook of staticness in\n> http://codereview.chromium.org/10027008/ :)).\n\nDone.","disapproval":false,"date":"2012-04-13 08:59:28.034618","approval":false},{"sender":"nona@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"Sorry for hashed reply.\nI reviewed input_method_manager_impl.*\nI will review the rest files as soon as possible.\n\nhttp://codereview.chromium.org/9999018/diff/8092/chrome/browser/chromeos/input_method/input_method_manager_impl.cc\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/8092/chrome/browser/chromeos/input_method/input_method_manager_impl.cc#newcode257\nchrome/browser/chromeos/input_method/input_method_manager_impl.cc:257: } else {\nI'm not sure about should_hide_properties_ variable, but is it okay to keep old value in the case of non-Keyboard layout engine.\n\nhttp://codereview.chromium.org/9999018/diff/8092/chrome/browser/chromeos/input_method/input_method_manager_impl_unittest.cc\nFile chrome/browser/chromeos/input_method/input_method_manager_impl_unittest.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/8092/chrome/browser/chromeos/input_method/input_method_manager_impl_unittest.cc#newcode11\nchrome/browser/chromeos/input_method/input_method_manager_impl_unittest.cc:11: #include \"chrome/browser/chromeos/language_preferences.h\"\nnit: alphabetic order if possible.","disapproval":false,"date":"2012-04-13 09:44:22.126592","approval":false},{"sender":"yusukes@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"http://codereview.chromium.org/9999018/diff/8092/chrome/browser/chromeos/input_method/input_method_manager_impl.cc\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/8092/chrome/browser/chromeos/input_method/input_method_manager_impl.cc#newcode257\nchrome/browser/chromeos/input_method/input_method_manager_impl.cc:257: } else {\nOn 2012/04/13 09:44:22, nona1 wrote:\n> I'm not sure about should_hide_properties_ variable, but is it okay to keep old\n> value in the case of non-Keyboard layout engine.\n\nprobably it's possible to remove should_hide_properties_ from the new InputMethodManager implementation. checking..","disapproval":false,"date":"2012-04-16 02:11:25.764784","approval":false},{"sender":"yusukes@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"Please take another look.\n\nIn addition to addressing nona's comments, I've removed the parameter of IBusController::Start() since it's not used at all.\n\nhttp://codereview.chromium.org/9999018/diff/8092/chrome/browser/chromeos/input_method/input_method_manager_impl.cc\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/8092/chrome/browser/chromeos/input_method/input_method_manager_impl.cc#newcode257\nchrome/browser/chromeos/input_method/input_method_manager_impl.cc:257: } else {\nOn 2012/04/13 09:44:22, nona1 wrote:\n> I'm not sure about should_hide_properties_ variable, but is it okay to keep old\n> value in the case of non-Keyboard layout engine.\n\nRemoved the variable. Slightly modified IBusControllerImpl::ChangeInputMethod() instead.\n\nhttp://codereview.chromium.org/9999018/diff/8092/chrome/browser/chromeos/input_method/input_method_manager_impl_unittest.cc\nFile chrome/browser/chromeos/input_method/input_method_manager_impl_unittest.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/8092/chrome/browser/chromeos/input_method/input_method_manager_impl_unittest.cc#newcode11\nchrome/browser/chromeos/input_method/input_method_manager_impl_unittest.cc:11: #include \"chrome/browser/chromeos/language_preferences.h\"\nOn 2012/04/13 09:44:22, nona1 wrote:\n> nit: alphabetic order if possible.\n\nDone.","disapproval":false,"date":"2012-04-16 05:54:30.906370","approval":false},{"sender":"yusukes@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","zork@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"+zork\n\nZach, please review the following files (and overall structure of the change, of course):\n\nchrome/browser/chromeos/*\nchrome/browser/chromeos/input_method/*\nchrome/browser/chromeos/login/screen_locker.cc","disapproval":false,"date":"2012-04-16 05:55:40.547910","approval":false},{"sender":"kinaba@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","zork@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"LGTM with very few nits (but I'd like to wait for Zach's comment, too :)).\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/ibus_controller_base.cc\nFile chrome/browser/chromeos/input_method/ibus_controller_base.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/ibus_controller_base.cc#newcode33\nchrome/browser/chromeos/input_method/ibus_controller_base.cc:33: return SetInputMethodConfigInternal(key, value);\nIt seems more natural to me that current_config_values_ is updated only when SetInputMethodConfigInternal returned true.\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/ibus_controller_base.cc#newcode46\nchrome/browser/chromeos/input_method/ibus_controller_base.cc:46: const ConfigKeyType key = std::make_pair(section, config_name);\nnit: key(section, config_name)\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager_impl.cc\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager_impl.cc#newcode374\nchrome/browser/chromeos/input_method/input_method_manager_impl.cc:374: iter = active_input_method_ids_.begin();\nShall we factor out the pattern of above 6 lines? It is also used in lines 461-466.\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager_impl.h\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.h (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager_impl.h#newcode13\nchrome/browser/chromeos/input_method/input_method_manager_impl.h:13: #include \"base/observer_list.h\"\nAlso #include \"base/memory/scoped_ptr.h\"\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/mock_ibus_controller.h\nFile chrome/browser/chromeos/input_method/mock_ibus_controller.h (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/mock_ibus_controller.h#newcode16\nchrome/browser/chromeos/input_method/mock_ibus_controller.h:16: typedef std::vector<InputMethodProperty> InputMethodPropertyList;\nInputMethodPropertyList is not used.","disapproval":false,"date":"2012-04-16 10:22:53.679306","approval":true},{"sender":"yusukes@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","zork@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"http://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/ibus_controller_base.cc\nFile chrome/browser/chromeos/input_method/ibus_controller_base.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/ibus_controller_base.cc#newcode33\nchrome/browser/chromeos/input_method/ibus_controller_base.cc:33: return SetInputMethodConfigInternal(key, value);\nOn 2012/04/16 10:22:53, kinaba wrote:\n> It seems more natural to me that current_config_values_ is updated only when\n> SetInputMethodConfigInternal returned true.\n\nGood point. Fixed.\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/ibus_controller_base.cc#newcode46\nchrome/browser/chromeos/input_method/ibus_controller_base.cc:46: const ConfigKeyType key = std::make_pair(section, config_name);\nOn 2012/04/16 10:22:53, kinaba wrote:\n> nit: key(section, config_name)\n\nDone.\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager_impl.cc\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager_impl.cc#newcode374\nchrome/browser/chromeos/input_method/input_method_manager_impl.cc:374: iter = active_input_method_ids_.begin();\nOn 2012/04/16 10:22:53, kinaba wrote:\n> Shall we factor out the pattern of above 6 lines? It is also used in lines\n> 461-466.\n\nDone.\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager_impl.h\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.h (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager_impl.h#newcode13\nchrome/browser/chromeos/input_method/input_method_manager_impl.h:13: #include \"base/observer_list.h\"\nOn 2012/04/16 10:22:53, kinaba wrote:\n> Also #include \"base/memory/scoped_ptr.h\"\n\nDone.\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/mock_ibus_controller.h\nFile chrome/browser/chromeos/input_method/mock_ibus_controller.h (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/mock_ibus_controller.h#newcode16\nchrome/browser/chromeos/input_method/mock_ibus_controller.h:16: typedef std::vector<InputMethodProperty> InputMethodPropertyList;\nOn 2012/04/16 10:22:53, kinaba wrote:\n> InputMethodPropertyList is not used.\n\nDone.","disapproval":false,"date":"2012-04-16 11:25:43.817794","approval":false},{"sender":"nona@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","zork@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"lgtm\n\nlgtm\n\nhttp://codereview.chromium.org/9999018/diff/16008/chrome/browser/chromeos/input_method/ibus_controller_base.h\nFile chrome/browser/chromeos/input_method/ibus_controller_base.h (right):\n\nhttp://codereview.chromium.org/9999018/diff/16008/chrome/browser/chromeos/input_method/ibus_controller_base.h#newcode15\nchrome/browser/chromeos/input_method/ibus_controller_base.h:15: #include \"chrome/browser/chromeos/input_method/ibus_controller.h\"\nnit: alphabetic order if possible.","disapproval":false,"date":"2012-04-16 16:17:16.033340","approval":true},{"sender":"zork@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","zork@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"http://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/ibus_controller_base.cc\nFile chrome/browser/chromeos/input_method/ibus_controller_base.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/ibus_controller_base.cc#newcode48\nchrome/browser/chromeos/input_method/ibus_controller_base.cc:48: = current_config_values_.find(key);\nNit: I think the = should be on the previous line.\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/ibus_controller_impl.cc\nFile chrome/browser/chromeos/input_method/ibus_controller_impl.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode118\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:118: LOG(ERROR) << \"The property has sub properties, \"\nShouldn't all the LOG(ERROR) be VLOG(1)?\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager.cc\nFile chrome/browser/chromeos/input_method/input_method_manager.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager.cc#newcode35\nchrome/browser/chromeos/input_method/input_method_manager.cc:35: // TODO(yusukes): The NULL check is needed for some unit_tests such as\nIt's supposed to be safe to call delete on a null pointer, so this hack shouldn't be needed.\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager_impl.cc\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager_impl.cc#newcode27\nchrome/browser/chromeos/input_method/input_method_manager_impl.cc:27: typename T::iterator Find(T& container, const typename T::value_type& value) {\nWhy define these wrappers?  It doesn't seem to add much clarity.\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager_impl.h\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.h (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager_impl.h#newcode66\nchrome/browser/chromeos/input_method/input_method_manager_impl.h:66: GetCurrentInputMethodProperties() const OVERRIDE;\nnit: Indent 4 spaces.\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/mock_input_method_manager.h\nFile chrome/browser/chromeos/input_method/mock_input_method_manager.h (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/mock_input_method_manager.h#newcode57\nchrome/browser/chromeos/input_method/mock_input_method_manager.h:57: GetCurrentInputMethodProperties() const OVERRIDE;\nNit: indent.","disapproval":false,"date":"2012-04-17 01:26:35.880730","approval":false},{"sender":"yusukes@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","zork@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"http://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/ibus_controller_base.cc\nFile chrome/browser/chromeos/input_method/ibus_controller_base.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/ibus_controller_base.cc#newcode48\nchrome/browser/chromeos/input_method/ibus_controller_base.cc:48: = current_config_values_.find(key);\nOn 2012/04/17 01:26:36, Zachary Kuznia wrote:\n> Nit: I think the = should be on the previous line.\n\nDone.\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/ibus_controller_impl.cc\nFile chrome/browser/chromeos/input_method/ibus_controller_impl.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode118\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:118: LOG(ERROR) << \"The property has sub properties, \"\nOn 2012/04/17 01:26:36, Zachary Kuznia wrote:\n> Shouldn't all the LOG(ERROR) be VLOG(1)?\n\nAgreed, but since there're more than 80 LOG(ERROR)s in chrome/browser/chromeos/input_method/, I'll replace them with VLOGs in a separate CL.\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager.cc\nFile chrome/browser/chromeos/input_method/input_method_manager.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager.cc#newcode35\nchrome/browser/chromeos/input_method/input_method_manager.cc:35: // TODO(yusukes): The NULL check is needed for some unit_tests such as\nOn 2012/04/17 01:26:36, Zachary Kuznia wrote:\n> It's supposed to be safe to call delete on a null pointer, so this hack\n> shouldn't be needed.\n\nDone.\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager_impl.cc\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager_impl.cc#newcode27\nchrome/browser/chromeos/input_method/input_method_manager_impl.cc:27: typename T::iterator Find(T& container, const typename T::value_type& value) {\nOn 2012/04/17 01:26:36, Zachary Kuznia wrote:\n> Why define these wrappers?  It doesn't seem to add much clarity.\n\nI defined them just because I didn't want to type begin(), end(), ... many times. But using template<> was overkill. Removed Find() and changed Contain() to a normal, non-template function.\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager_impl.h\nFile chrome/browser/chromeos/input_method/input_method_manager_impl.h (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/input_method_manager_impl.h#newcode66\nchrome/browser/chromeos/input_method/input_method_manager_impl.h:66: GetCurrentInputMethodProperties() const OVERRIDE;\nOn 2012/04/17 01:26:36, Zachary Kuznia wrote:\n> nit: Indent 4 spaces.\n\nDone.\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/mock_input_method_manager.h\nFile chrome/browser/chromeos/input_method/mock_input_method_manager.h (right):\n\nhttp://codereview.chromium.org/9999018/diff/15002/chrome/browser/chromeos/input_method/mock_input_method_manager.h#newcode57\nchrome/browser/chromeos/input_method/mock_input_method_manager.h:57: GetCurrentInputMethodProperties() const OVERRIDE;\nOn 2012/04/17 01:26:36, Zachary Kuznia wrote:\n> Nit: indent.\n\nDone.\n\nhttp://codereview.chromium.org/9999018/diff/16008/chrome/browser/chromeos/input_method/ibus_controller_base.h\nFile chrome/browser/chromeos/input_method/ibus_controller_base.h (right):\n\nhttp://codereview.chromium.org/9999018/diff/16008/chrome/browser/chromeos/input_method/ibus_controller_base.h#newcode15\nchrome/browser/chromeos/input_method/ibus_controller_base.h:15: #include \"chrome/browser/chromeos/input_method/ibus_controller.h\"\nOn 2012/04/16 16:17:16, nona1 wrote:\n> nit: alphabetic order if possible.\n\nDone.","disapproval":false,"date":"2012-04-17 02:23:32.106053","approval":false},{"sender":"zork@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","zork@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"lgtm","disapproval":false,"date":"2012-04-17 02:26:49.067456","approval":true},{"sender":"yusukes@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","zork@chromium.org","mukai@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"mukai,\nCould you briefly check ash/ and chrome/browser/chromeos/system/ash_system_tray_delegate.cc changes? I've slightly modified your IME property code.","disapproval":false,"date":"2012-04-17 03:42:28.550396","approval":false},{"sender":"mukai@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","zork@chromium.org","mukai@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"lgtm\n\nIt looks good.  Put a few nitpicks.\nYou may want to take a look at crrev.com/131583 and revert all changes in it, because it's no longer necessary.  You can do this in another CL though.\n\nhttp://codereview.chromium.org/9999018/diff/25001/ash/system/ime/tray_ime.cc\nFile ash/system/ime/tray_ime.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/25001/ash/system/ime/tray_ime.cc#newcode7\nash/system/ime/tray_ime.cc:7: #include <utility>\noh, I introduced this by mistake but nobody seems using.  Please remove it too.\n\nhttp://codereview.chromium.org/9999018/diff/25001/ash/system/ime/tray_ime.cc#newcode171\nash/system/ime/tray_ime.cc:171: std::map<views::View*, IMEPropertyInfo> property_map_;\nThen you can switch here back to std::string (just store key itself only).\nPlease revert crrev.com/131583 itself.\n\nhttp://codereview.chromium.org/9999018/diff/25001/ash/system/tray/system_tray_delegate.h\nFile ash/system/tray/system_tray_delegate.h (right):\n\nhttp://codereview.chromium.org/9999018/diff/25001/ash/system/tray/system_tray_delegate.h#newcode51\nash/system/tray/system_tray_delegate.h:51: bool is_selection;\nso this field is not necessary anymore\n\nhttp://codereview.chromium.org/9999018/diff/25001/chrome/browser/chromeos/input_method/ibus_controller_impl.cc\nFile chrome/browser/chromeos/input_method/ibus_controller_impl.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/25001/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode499\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:499: if (current_property_list_[i].key == key) {\nshouldn't return earlier if the corresponding property is not in the list?","disapproval":false,"date":"2012-04-17 03:55:05.014669","approval":true},{"sender":"yusukes@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","zork@chromium.org","mukai@chromium.org","csilv@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"+csilv\nChris, could you do owners review for chrome/browser/ui/webui/options2/language_options_handler2_unittest.cc?\n\nThe change is simple: Since InputMethodManager is no longer a singleton, the options2 test which depends on the manager has to initialize and shutdown the manager explicitly.","disapproval":false,"date":"2012-04-17 03:56:46.384842","approval":false},{"sender":"yusukes@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","zork@chromium.org","mukai@chromium.org","csilv@chromium.org","nkostylev@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"+nkostylev\nNikita, could you do owners review for chrome/browser/chromeos/login/?\n\nIME setup code in login/screen_locker.cc is moved to input_method/input_method_manager_impl.cc and now it's fully unit-tested.","disapproval":false,"date":"2012-04-17 04:01:12.253347","approval":false},{"sender":"yusukes@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","zork@chromium.org","mukai@chromium.org","csilv@chromium.org","nkostylev@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"http://codereview.chromium.org/9999018/diff/25001/ash/system/ime/tray_ime.cc\nFile ash/system/ime/tray_ime.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/25001/ash/system/ime/tray_ime.cc#newcode7\nash/system/ime/tray_ime.cc:7: #include <utility>\nOn 2012/04/17 03:55:05, Jun Mukai wrote:\n> oh, I introduced this by mistake but nobody seems using.  Please remove it too.\n\nDone.\n\nhttp://codereview.chromium.org/9999018/diff/25001/ash/system/ime/tray_ime.cc#newcode171\nash/system/ime/tray_ime.cc:171: std::map<views::View*, IMEPropertyInfo> property_map_;\nOn 2012/04/17 03:55:05, Jun Mukai wrote:\n> Then you can switch here back to std::string (just store key itself only).\n> Please revert crrev.com/131583 itself.\n\nDone.\n\nhttp://codereview.chromium.org/9999018/diff/25001/ash/system/tray/system_tray_delegate.h\nFile ash/system/tray/system_tray_delegate.h (right):\n\nhttp://codereview.chromium.org/9999018/diff/25001/ash/system/tray/system_tray_delegate.h#newcode51\nash/system/tray/system_tray_delegate.h:51: bool is_selection;\nOn 2012/04/17 03:55:05, Jun Mukai wrote:\n> so this field is not necessary anymore\n\nDone.\n\nhttp://codereview.chromium.org/9999018/diff/25001/chrome/browser/chromeos/input_method/ibus_controller_impl.cc\nFile chrome/browser/chromeos/input_method/ibus_controller_impl.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/25001/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode499\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:499: if (current_property_list_[i].key == key) {\nOn 2012/04/17 03:55:05, Jun Mukai wrote:\n> shouldn't return earlier if the corresponding property is not in the list?\n\nI think line 504-507 does this.","disapproval":false,"date":"2012-04-17 04:33:32.493985","approval":false},{"sender":"mukai@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","zork@chromium.org","mukai@chromium.org","csilv@chromium.org","nkostylev@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"lgtm\n\nhttp://codereview.chromium.org/9999018/diff/25001/chrome/browser/chromeos/input_method/ibus_controller_impl.cc\nFile chrome/browser/chromeos/input_method/ibus_controller_impl.cc (right):\n\nhttp://codereview.chromium.org/9999018/diff/25001/chrome/browser/chromeos/input_method/ibus_controller_impl.cc#newcode499\nchrome/browser/chromeos/input_method/ibus_controller_impl.cc:499: if (current_property_list_[i].key == key) {\nOn 2012/04/17 04:33:32, Yusuke Sato wrote:\n> On 2012/04/17 03:55:05, Jun Mukai wrote:\n> > shouldn't return earlier if the corresponding property is not in the list?\n> \n> I think line 504-507 does this.\n> \n\nah, got it. thanks.","disapproval":false,"date":"2012-04-17 04:42:52.721703","approval":true},{"sender":"yusukes@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","zork@chromium.org","mukai@chromium.org","csilv@chromium.org","nkostylev@chromium.org","sky@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"+sky,\nScott, could you review ash/?\n\nThis CL reverts mukai's r131583 to follow an interface change in chrome/browser/chromeos/input_method/.","disapproval":false,"date":"2012-04-17 04:52:15.016715","approval":false},{"sender":"nkostylev@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","zork@chromium.org","mukai@chromium.org","csilv@chromium.org","nkostylev@chromium.org","sky@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"On 2012/04/17 04:01:12, Yusuke Sato wrote:\n> +nkostylev\n> Nikita, could you do owners review for chrome/browser/chromeos/login/?\n> \n> IME setup code in login/screen_locker.cc is moved to\n> input_method/input_method_manager_impl.cc and now it's fully unit-tested.\n\nchromeos/login lgtm","disapproval":false,"date":"2012-04-17 11:49:30.831571","approval":true},{"sender":"sky@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","zork@chromium.org","mukai@chromium.org","csilv@chromium.org","nkostylev@chromium.org","sky@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"LGTM","disapproval":false,"date":"2012-04-17 16:12:45.462144","approval":true},{"sender":"csilv@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","zork@chromium.org","mukai@chromium.org","csilv@chromium.org","nkostylev@chromium.org","sky@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"language_options_handler2_unittest.cc owner lgtm","disapproval":false,"date":"2012-04-17 17:32:26.456826","approval":true},{"sender":"commit-bot@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","zork@chromium.org","mukai@chromium.org","csilv@chromium.org","nkostylev@chromium.org","sky@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/yusukes@chromium.org/9999018/32001","disapproval":false,"date":"2012-04-18 05:47:12.232291","approval":false},{"sender":"commit-bot@chromium.org","recipients":["yusukes@chromium.org","kinaba@chromium.org","nona@chromium.org","zork@chromium.org","mukai@chromium.org","csilv@chromium.org","nkostylev@chromium.org","sky@chromium.org","chromium-reviews@chromium.org","sadrul@chromium.org","nkostylev+watch@chromium.org","derat+watch@chromium.org","mihaip+watch@chromium.org","aa@chromium.org","stevenjb+watch@chromium.org","davemoore+watch@chromium.org","yusukes+watch@chromium.org","zork@chromium.org"],"text":"Can't process patch for file chrome/browser/chromeos/preferences.cc.\nFile's status is None, patchset upload is incomplete.","disapproval":false,"date":"2012-04-18 05:47:17.922851","approval":false}],"owner_email":"yusukes@chromium.org","private":false,"base_url":"svn://svn.chromium.org/chrome/trunk/src","owner":"Yusuke Sato","subject":"chrome/browser/chromeos/input_method/ refactoring [part 6 of 6]","created":"2012-04-10 05:35:59.290670","patchsets":[52,3001,5002,10009,13002,11044,8092,15002,16008,25001,24044,32001],"modified":"2012-04-18 05:55:42.782212","closed":true,"commit":false,"issue":9999018}