{"description":"Remove confidence from AutocompleteMatch and use History DB instead.\n\nAdds a class responsible for providing recommended actions given an AutocompleteMatch which uses the History Database to determine that action.\n\nBUG=92896,94423\nTEST=NetworkActionPredictorTest*\n\n\nCommitted: http://src.chromium.org/viewvc/chrome?view=rev&revision=99140","cc":["chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"reviewers":["pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","commit-bot@chromium.org"],"messages":[{"sender":"dominich@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"The per-provider confidence calculations showed some promise, but using the ShortcutsBackend is closer in spirit to the original version that tracked probability based on user behaviour and gives much more reasonable confidence distributions.\n\nAccuracy of prediction will be determined by a field trial once this has been in canary for a while.","disapproval":false,"date":"2011-08-23 22:56:28.329584","approval":false},{"sender":"pkasting@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"I'm WebKit sheriff this week, so I may not get to this before Friday.","disapproval":false,"date":"2011-08-24 00:49:27.003896","approval":false},{"sender":"dominich@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"sky: Added as this fixes bug 94423 that you entered.\ngeorgey: Added to review changes to Shortcut things.\npkasting: Please review everything.","disapproval":false,"date":"2011-08-29 18:17:19.068928","approval":false},{"sender":"sky@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"http://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/autocomplete_edit.cc\nFile chrome/browser/autocomplete/autocomplete_edit.cc (right):\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/autocomplete_edit.cc#newcode216\nchrome/browser/autocomplete/autocomplete_edit.cc:216: action = network_action_predictor_->RecommendAction(user_text_,\nDoes it really make sense to have both instant and prerendering enabled at the same time? If you have instant enabled shouldn't we always use instant?","disapproval":false,"date":"2011-08-29 22:01:08.770487","approval":false},{"sender":"dominich@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"http://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/autocomplete_edit.cc\nFile chrome/browser/autocomplete/autocomplete_edit.cc (right):\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/autocomplete_edit.cc#newcode216\nchrome/browser/autocomplete/autocomplete_edit.cc:216: action = network_action_predictor_->RecommendAction(user_text_,\nOn 2011/08/29 22:01:08, sky wrote:\n> Does it really make sense to have both instant and prerendering enabled at the\n> same time? If you have instant enabled shouldn't we always use instant?\n\nObviously I don't think so. :)\n\nJust as we only Prerender when we're confident that the user is going to navigate to a given page, we should only use Instant when we're extremely confident that the user wants to see a particular page.\n\nThis change allows us to still use Instant when that confidence is high, but to gracefully degrade to Prerendering (and DNS preconnect) when the confidence is lower.\n\nIt is true that Instant and Prerender use the same resources as far as the client and server are concerned, but Instant actually shows the page so should require a higher confidence level.\n\nIn the current system, Instant and Prerender are in competition. This allows both systems to play a part in a better user experience.","disapproval":false,"date":"2011-08-29 22:07:14.782192","approval":false},{"sender":"sky@chromium.org","recipients":["reply@chromiumcodereview.appspotmail.com"],"text":"On Mon, Aug 29, 2011 at 3:07 PM,  <dominich@chromium.org> wrote:\n>\n> http://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/autocomplete_edit.cc\n> File chrome/browser/autocomplete/autocomplete_edit.cc (right):\n>\n> http://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/autocomplete_edit.cc#newcode216\n> chrome/browser/autocomplete/autocomplete_edit.cc:216: action =\n> network_action_predictor_->RecommendAction(user_text_,\n> On 2011/08/29 22:01:08, sky wrote:\n>>\n>> Does it really make sense to have both instant and prerendering\n>\n> enabled at the\n>>\n>> same time? If you have instant enabled shouldn't we always use\n>\n> instant?\n>\n> Obviously I don't think so. :)\n>\n> Just as we only Prerender when we're confident that the user is going to\n> navigate to a given page, we should only use Instant when we're\n> extremely confident that the user wants to see a particular page.\n>\n> This change allows us to still use Instant when that confidence is high,\n> but to gracefully degrade to Prerendering (and DNS preconnect) when the\n> confidence is lower.\n>\n> It is true that Instant and Prerender use the same resources as far as\n> the client and server are concerned, but Instant actually shows the page\n> so should require a higher confidence level.\n>\n> In the current system, Instant and Prerender are in competition. This\n> allows both systems to play a part in a better user experience.\n\nI think this leads to a worse experience where visibility it will seem\nas though instant isn't working for some urls.\n\n  -Scott\n","disapproval":false,"date":"2011-08-29 22:11:57.999212","approval":false},{"sender":"pkasting@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"I have the opposite concern: I don't think we should ever show the page (instant) for navigations based on a heuristic.  Prerendering is as high as I think we should go.\n\nThere are many reasons why we've moved away from doing instant for navigations, and all of them apply to the cases here.","disapproval":false,"date":"2011-08-29 22:15:33.980624","approval":false},{"sender":"dominich@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"My understanding, which may be wrong, is that we're moving towards restricting Instant to search only. In that case, there will not be any confusion - Searches will show up instantly and other pages will be prerendered.","disapproval":false,"date":"2011-08-29 22:16:35.233053","approval":false},{"sender":"sky@chromium.org","recipients":["reply@chromiumcodereview.appspotmail.com"],"text":"On Mon, Aug 29, 2011 at 3:16 PM,  <dominich@chromium.org> wrote:\n> My understanding, which may be wrong, is that we're moving towards\n> restricting\n> Instant to search only. In that case, there will not be any confusion -\n> Searches\n> will show up instantly and other pages will be prerendered.\n\nI'm not aware of us doing that. You should talk with Glen for his perspective.\n\n  -Scott\n","disapproval":false,"date":"2011-08-29 22:22:22.957930","approval":false},{"sender":"dominich@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"Here's a proposal:\n\nIf Instant is enabled, just do Instant as we do now.\n\nIf Instant fails (can it?) or is restricted to search or is disabled, then use the system in this CL to decide between Prerender and DNS Preconnect.\n\nThis gives us the best of both worlds.","disapproval":false,"date":"2011-08-29 22:37:17.777243","approval":false},{"sender":"sky@chromium.org","recipients":["reply@chromiumcodereview.appspotmail.com"],"text":"On Mon, Aug 29, 2011 at 3:37 PM,  <dominich@chromium.org> wrote:\n> Here's a proposal:\n>\n> If Instant is enabled, just do Instant as we do now.\n>\n> If Instant fails (can it?) or is restricted to search or is disabled, then\n> use\n> the system in this CL to decide between Prerender and DNS Preconnect.\n>\n> This gives us the best of both worlds.\n\nSGTM. I think this will come down to whether search only instant is\nenabled as I believe the cases where instant won't load are also cases\nwe wouldn't want to prerender either.\n\n  -Scott\n","disapproval":false,"date":"2011-08-29 23:05:22.949094","approval":false},{"sender":"glen@chromium.org","recipients":["reply@chromiumcodereview.appspotmail.com"],"text":"On Mon, Aug 29, 2011 at 3:22 PM, Scott Violet <sky@chromium.org> wrote:\n> On Mon, Aug 29, 2011 at 3:16 PM, Â <dominich@chromium.org> wrote:\n>> My understanding, which may be wrong, is that we're moving\n>> towards restricting Instant to search only. In that case, there will\n>> not be any confusion - Searches will show up instantly and other\n>> pages will be prerendered.\n>\n> I'm not aware of us doing that. You should talk with Glen for his\n> perspective.\n\nWe don't plan to separate instant for search and navigation, though\nthere are experiments looking into this that may change our minds.\n","disapproval":false,"date":"2011-08-29 23:21:18.746775","approval":false},{"sender":"pkasting@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","glen@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"LGTM\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/autocomplete_edit.cc\nFile chrome/browser/autocomplete/autocomplete_edit.cc (right):\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/autocomplete_edit.cc#newcode246\nchrome/browser/autocomplete/autocomplete_edit.cc:246: InstantController* instant = controller_->GetInstant();\nSince I don't know anything about instant sky will need to object if this isn't right.\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/autocomplete_edit.cc#newcode1050\nchrome/browser/autocomplete/autocomplete_edit.cc:1050: match.destination_url, NetworkActionPredictor::IsPreconnectable(match));\nNit: I would put this first arg on the previous line (but still indent this line 4)\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/autocomplete_edit.h\nFile chrome/browser/autocomplete/autocomplete_edit.h (right):\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/autocomplete_edit.h#newcode568\nchrome/browser/autocomplete/autocomplete_edit.h:568: scoped_ptr<NetworkActionPredictor> network_action_predictor_;\nNit: Why use a scoped_ptr here instead of a plain member?  The lifetime of this object is the same as the lifetime of the class.\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/history_contents_provider.cc\nFile chrome/browser/autocomplete/history_contents_provider.cc (right):\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/history_contents_provider.cc#newcode207\nchrome/browser/autocomplete/history_contents_provider.cc:207: MatchInTitle(result) ? AutocompleteMatch::HISTORY_TITLE :\nNit: I'd still prefer to wrap after ? instead of :\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/history_quick_provider.cc\nFile chrome/browser/autocomplete/history_quick_provider.cc (right):\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/history_quick_provider.cc#newcode139\nchrome/browser/autocomplete/history_quick_provider.cc:139: AutocompleteMatch match(this, score, !!info.visit_count(),\nNit: While you're here, can you indent this as\n\n  AutocompleteMatch match(this, score, !!info.visit_count(),\n      history_match.url_matches_empty() ?\n          AutocompleteMatch::HISTORY_URL : AutocompleteMatch::HISTORY_TITLE);\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/network_action_predictor.cc\nFile chrome/browser/autocomplete/network_action_predictor.cc (right):\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/network_action_predictor.cc#newcode41\nchrome/browser/autocomplete/network_action_predictor.cc:41: NetworkActionPredictor::RecommendAction(const string16& user_text,\nNit: I would indent this 4\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/network_action_predictor.cc#newcode48\nchrome/browser/autocomplete/network_action_predictor.cc:48: ShortcutMap::const_iterator matching_it = shortcut_map_.end();\nNit: Another way of doing all this that might be more readable is to define a predicate functor and then use std::find_if().\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/network_action_predictor.cc#newcode49\nchrome/browser/autocomplete/network_action_predictor.cc:49: \nNit: I suggest removing this blank line and the one below the loop.\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/network_action_predictor.cc#newcode50\nchrome/browser/autocomplete/network_action_predictor.cc:50: ShortcutMap::const_iterator lower_it = shortcut_map_.lower_bound(lower_text);\nNit: Roll this into the loop initialization below\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/network_action_predictor_unittest.cc\nFile chrome/browser/autocomplete/network_action_predictor_unittest.cc (right):\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/network_action_predictor_unittest.cc#newcode129\nchrome/browser/autocomplete/network_action_predictor_unittest.cc:129: TEST_F(NetworkActionPredictorTest, IsPreconnectable) {\nNit: TBH I'm not sure this test is useful.  It's basically an exact copy of the switch statement from the function.  It seems like the only time it will ever fail is if we change that switch in which case we'll just be annoyed and have to make the change in two places.\n\nUnless IsPreconnectable() becomes more complex, it feels like we should just eliminate this test.","disapproval":false,"date":"2011-08-30 20:33:40.999421","approval":true},{"sender":"dominich@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","glen@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"There are two fairly significant changes in this patch:\n\n1) Instant is not handled by the NetworkActionPredictor. We will try to do Instant and if we fail, then we will see what we can do.\n\n2) brettw expressed concern with using the ShortcutsBackend for this and asked that I use the in-memory history database instead. As I no longer have access to what the user typed to get to a URL, I have tweaked the recommendation heuristic accordingly. I think this will serve for getting a useful range of confidence scores and when the ShortcutsProvider is on by default, perhaps I will switch to that.\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/autocomplete_edit.cc\nFile chrome/browser/autocomplete/autocomplete_edit.cc (right):\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/autocomplete_edit.cc#newcode1050\nchrome/browser/autocomplete/autocomplete_edit.cc:1050: match.destination_url, NetworkActionPredictor::IsPreconnectable(match));\nOn 2011/08/30 20:33:41, Peter Kasting wrote:\n> Nit: I would put this first arg on the previous line (but still indent this line\n> 4)\n\nDone.\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/autocomplete_edit.h\nFile chrome/browser/autocomplete/autocomplete_edit.h (right):\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/autocomplete_edit.h#newcode568\nchrome/browser/autocomplete/autocomplete_edit.h:568: scoped_ptr<NetworkActionPredictor> network_action_predictor_;\nOn 2011/08/30 20:33:41, Peter Kasting wrote:\n> Nit: Why use a scoped_ptr here instead of a plain member?  The lifetime of this\n> object is the same as the lifetime of the class.\n\nDone.\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/history_contents_provider.cc\nFile chrome/browser/autocomplete/history_contents_provider.cc (right):\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/history_contents_provider.cc#newcode207\nchrome/browser/autocomplete/history_contents_provider.cc:207: MatchInTitle(result) ? AutocompleteMatch::HISTORY_TITLE :\nOn 2011/08/30 20:33:41, Peter Kasting wrote:\n> Nit: I'd still prefer to wrap after ? instead of :\n\nDone.\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/history_quick_provider.cc\nFile chrome/browser/autocomplete/history_quick_provider.cc (right):\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/history_quick_provider.cc#newcode139\nchrome/browser/autocomplete/history_quick_provider.cc:139: AutocompleteMatch match(this, score, !!info.visit_count(),\nOn 2011/08/30 20:33:41, Peter Kasting wrote:\n> Nit: While you're here, can you indent this as\n> \n>   AutocompleteMatch match(this, score, !!info.visit_count(),\n>       history_match.url_matches_empty() ?\n>           AutocompleteMatch::HISTORY_URL : AutocompleteMatch::HISTORY_TITLE);\n\nDone.\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/network_action_predictor.cc\nFile chrome/browser/autocomplete/network_action_predictor.cc (right):\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/network_action_predictor.cc#newcode41\nchrome/browser/autocomplete/network_action_predictor.cc:41: NetworkActionPredictor::RecommendAction(const string16& user_text,\nOn 2011/08/30 20:33:41, Peter Kasting wrote:\n> Nit: I would indent this 4\n\nDone.\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/network_action_predictor_unittest.cc\nFile chrome/browser/autocomplete/network_action_predictor_unittest.cc (right):\n\nhttp://codereview.chromium.org/7686012/diff/18001/chrome/browser/autocomplete/network_action_predictor_unittest.cc#newcode129\nchrome/browser/autocomplete/network_action_predictor_unittest.cc:129: TEST_F(NetworkActionPredictorTest, IsPreconnectable) {\nOn 2011/08/30 20:33:41, Peter Kasting wrote:\n> Nit: TBH I'm not sure this test is useful.  It's basically an exact copy of the\n> switch statement from the function.  It seems like the only time it will ever\n> fail is if we change that switch in which case we'll just be annoyed and have to\n> make the change in two places.\n> \n> Unless IsPreconnectable() becomes more complex, it feels like we should just\n> eliminate this test.\n\nDone.","disapproval":false,"date":"2011-08-30 21:06:58.711118","approval":false},{"sender":"pkasting@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","glen@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"What's the problem with using the Shortcuts Provider backend?  I'm kind of frustrated that I sort of hear secondhand about people not wanting to use that data.  The shortcuts provider is not on probation or \"possibly not going to ship\" or something like that.  It's going in, and if there's something you'd use it for when it's on by default, you should go ahead and use it immediately.\n\nhttp://codereview.chromium.org/7686012/diff/30001/chrome/browser/autocomplete/autocomplete_edit.cc\nFile chrome/browser/autocomplete/autocomplete_edit.cc (right):\n\nhttp://codereview.chromium.org/7686012/diff/30001/chrome/browser/autocomplete/autocomplete_edit.cc#newcode212\nchrome/browser/autocomplete/autocomplete_edit.cc:212: bool might_support_instant = false;\nNit: Simpler:\n\n  if (in_revert_ || !controller_->GetTabContentsWrapper() ||\n      !DoInstant(current_match, &suggested_text)) {\n    // Confer with the NetworkActionPredictor ...\n\nhttp://codereview.chromium.org/7686012/diff/30001/chrome/browser/autocomplete/autocomplete_edit.h\nFile chrome/browser/autocomplete/autocomplete_edit.h (right):\n\nhttp://codereview.chromium.org/7686012/diff/30001/chrome/browser/autocomplete/autocomplete_edit.h#newcode433\nchrome/browser/autocomplete/autocomplete_edit.h:433: // Tries to start an instant preview for |match|.Returns true if instant is\nNit: Space after period\n\nhttp://codereview.chromium.org/7686012/diff/30001/chrome/browser/autocomplete/network_action_predictor.cc\nFile chrome/browser/autocomplete/network_action_predictor.cc (right):\n\nhttp://codereview.chromium.org/7686012/diff/30001/chrome/browser/autocomplete/network_action_predictor.cc#newcode55\nchrome/browser/autocomplete/network_action_predictor.cc:55: //  const string16 lower_text(base::i18n::ToLower(user_text));\nAre you wanting to check in with this commented out?","disapproval":false,"date":"2011-08-30 21:45:17.586696","approval":false},{"sender":"dominich@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","glen@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"There's a reluctance to hang anything on code that is behind a flag - as the provider is behind a flag, the backend is implicitly behind one too. It surprised me too, but I will experiment with switching back to it when it is on by default.\n\nhttp://codereview.chromium.org/7686012/diff/30001/chrome/browser/autocomplete/autocomplete_edit.cc\nFile chrome/browser/autocomplete/autocomplete_edit.cc (right):\n\nhttp://codereview.chromium.org/7686012/diff/30001/chrome/browser/autocomplete/autocomplete_edit.cc#newcode212\nchrome/browser/autocomplete/autocomplete_edit.cc:212: bool might_support_instant = false;\nOn 2011/08/30 21:45:17, Peter Kasting wrote:\n> Nit: Simpler:\n> \n>   if (in_revert_ || !controller_->GetTabContentsWrapper() ||\n>       !DoInstant(current_match, &suggested_text)) {\n>     // Confer with the NetworkActionPredictor ...\n\nDone.\n\nhttp://codereview.chromium.org/7686012/diff/30001/chrome/browser/autocomplete/autocomplete_edit.h\nFile chrome/browser/autocomplete/autocomplete_edit.h (right):\n\nhttp://codereview.chromium.org/7686012/diff/30001/chrome/browser/autocomplete/autocomplete_edit.h#newcode433\nchrome/browser/autocomplete/autocomplete_edit.h:433: // Tries to start an instant preview for |match|.Returns true if instant is\nOn 2011/08/30 21:45:17, Peter Kasting wrote:\n> Nit: Space after period\n\nDone.\n\nhttp://codereview.chromium.org/7686012/diff/30001/chrome/browser/autocomplete/network_action_predictor.cc\nFile chrome/browser/autocomplete/network_action_predictor.cc (right):\n\nhttp://codereview.chromium.org/7686012/diff/30001/chrome/browser/autocomplete/network_action_predictor.cc#newcode55\nchrome/browser/autocomplete/network_action_predictor.cc:55: //  const string16 lower_text(base::i18n::ToLower(user_text));\nOn 2011/08/30 21:45:17, Peter Kasting wrote:\n> Are you wanting to check in with this commented out?\n\nI was going to, but now you've asked I'll remove it. It's here for posterity anyway.","disapproval":false,"date":"2011-08-30 21:57:05.899830","approval":false},{"sender":"pkasting@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","glen@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"On 2011/08/30 21:57:05, dominich wrote:\n> There's a reluctance to hang anything on code that is behind a flag - as the\n> provider is behind a flag, the backend is implicitly behind one too.\n\nWe should consider the backend to be not behind a flag (and if that's not true in the code, make it true), and then make your change depend on the backend.  Frankly, IMO we should make the entire shortcut provider not be behind a flag.  I don't see any reason for the flag at this point.\n\nAccordingly, we should not land this change without the Shortcut Provider integration and then tie that in later.","disapproval":false,"date":"2011-08-30 22:03:42.319425","approval":false},{"sender":"sky@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","glen@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"http://codereview.chromium.org/7686012/diff/34001/chrome/browser/autocomplete/autocomplete_edit.cc\nFile chrome/browser/autocomplete/autocomplete_edit.cc (right):\n\nhttp://codereview.chromium.org/7686012/diff/34001/chrome/browser/autocomplete/autocomplete_edit.cc#newcode212\nchrome/browser/autocomplete/autocomplete_edit.cc:212: if (in_revert_ || controller_->GetTabContentsWrapper() ||\nWhy the GetTabContentsWrapper check here? Did you mean !GetTabContentsWrapper? Even so, why is it needed?\n\nhttp://codereview.chromium.org/7686012/diff/34001/chrome/browser/autocomplete/autocomplete_edit.cc#newcode213\nchrome/browser/autocomplete/autocomplete_edit.cc:213: !DoInstant(current_match, &suggested_text)) {\nnit: spacing is off here.","disapproval":false,"date":"2011-08-30 22:11:06.183398","approval":false},{"sender":"dominich@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","glen@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"http://codereview.chromium.org/7686012/diff/34001/chrome/browser/autocomplete/autocomplete_edit.cc\nFile chrome/browser/autocomplete/autocomplete_edit.cc (right):\n\nhttp://codereview.chromium.org/7686012/diff/34001/chrome/browser/autocomplete/autocomplete_edit.cc#newcode212\nchrome/browser/autocomplete/autocomplete_edit.cc:212: if (in_revert_ || controller_->GetTabContentsWrapper() ||\nOn 2011/08/30 22:11:06, sky wrote:\n> Why the GetTabContentsWrapper check here? Did you mean !GetTabContentsWrapper?\n> Even so, why is it needed?\n\nIt's not. A refactoring error.\n\nhttp://codereview.chromium.org/7686012/diff/34001/chrome/browser/autocomplete/autocomplete_edit.cc#newcode213\nchrome/browser/autocomplete/autocomplete_edit.cc:213: !DoInstant(current_match, &suggested_text)) {\nOn 2011/08/30 22:11:06, sky wrote:\n> nit: spacing is off here.\n\nDone.","disapproval":false,"date":"2011-08-31 02:27:02.194110","approval":false},{"sender":"sky@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","glen@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"I only looked at autocomplete_edit. LGTM","disapproval":false,"date":"2011-08-31 14:13:38.263191","approval":true},{"sender":"dominich@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","glen@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"On 2011/08/30 22:03:42, Peter Kasting wrote:\n> On 2011/08/30 21:57:05, dominich wrote:\n> > There's a reluctance to hang anything on code that is behind a flag - as the\n> > provider is behind a flag, the backend is implicitly behind one too.\n> \n> We should consider the backend to be not behind a flag (and if that's not true\n> in the code, make it true), and then make your change depend on the backend. \n> Frankly, IMO we should make the entire shortcut provider not be behind a flag. \n> I don't see any reason for the flag at this point.\n> \n> Accordingly, we should not land this change without the Shortcut Provider\n> integration and then tie that in later.\n\nI would like to start collecting data around this approach to prerendering sooner rather than later. This will allow me to see if I can get good results from the history alone or if I need the ShortcutBackend. If the latter, that's a good argument for releasing the ShortcutProvider from behind a flag, but I need data from users to get to that point.","disapproval":false,"date":"2011-08-31 17:19:13.725381","approval":false},{"sender":"pkasting@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","glen@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"LGTM","disapproval":false,"date":"2011-09-01 00:23:40.021945","approval":true},{"sender":"georgey@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","glen@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"LGTM\n\nhttp://codereview.chromium.org/7686012/diff/26005/chrome/browser/autocomplete/shortcuts_provider.h\nFile chrome/browser/autocomplete/shortcuts_provider.h (right):\n\nhttp://codereview.chromium.org/7686012/diff/26005/chrome/browser/autocomplete/shortcuts_provider.h#newcode57\nchrome/browser/autocomplete/shortcuts_provider.h:57: const std::vector<std::string>& shortcut_ids) OVERRIDE;\nI see we're doing the same thing here. The last one merges the changes :)\nI also added additional notification - for purge of history.","disapproval":false,"date":"2011-09-01 00:33:59.396541","approval":true},{"sender":"commit-bot@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","commit-bot@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"Can't process patch for file chrome/chrome_browser.gypi.\nFile's status is None, patchset upload is incomplete.","disapproval":false,"date":"2011-09-01 01:04:41.307482","approval":false},{"sender":"commit-bot@chromium.org","recipients":["dominich@chromium.org","pkasting@chromium.org","georgey@chromium.org","sky@chromium.org","commit-bot@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","erikkay@chromium.org","mihaip+watch@chromium.org"],"text":"Change committed as 99140","disapproval":false,"date":"2011-09-01 06:17:02.230931","approval":false}],"owner_email":"dominich@chromium.org","private":false,"base_url":"svn://svn.chromium.org/chrome/trunk/src","owner":"dominich","subject":"Remove confidence from AutocompleteMatch and use History DB instead.","created":"2011-08-19 20:51:42.349975","patchsets":[1,2001,4001,6001,8001,9001,11001,10025,15001,18001,30001,34001,26005,44001],"modified":"2011-09-01 06:17:02.440082","closed":true,"commit":false,"issue":7686012}