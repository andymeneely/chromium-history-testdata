{"description":"Fix virtual keyboard issue with login screen.\n\nhttp://codereview.chromium.org/7170018/ causes this problem.\nIn CL 7170018, it will not create the input method until it\nis requested by a child view. So in that time, a child view\nmay already be focused. So we need sync focus state with\ninput method.\n\nBUG=Virtual keyboard does not work on Login screen\nTEST=Seaboard\n\n\nCommitted: http://src.chromium.org/viewvc/chrome?view=rev&revision=90540","cc":["chromium-reviews@chromium.org","dhollowa@chromium.org","bryeung@chromium.org","anicolao@google.com"],"reviewers":["suzhe@chromium.org","fsamuel@chromium.org","sadrul@chromium.org","commit-bot@chromium.org"],"messages":[{"sender":"penghuang@chromium.org","recipients":["penghuang@chromium.org","fadysamuel@gmail.com","suzhe@chromium.org","chromium-reviews@chromium.org","dhollowa@chromium.org","bryeung@chromium.org","anicolao@google.com"],"text":"","disapproval":false,"date":"2011-06-21 19:40:38.644481","approval":false},{"sender":"suzhe@chromium.org","recipients":["penghuang@chromium.org","suzhe@chromium.org","fsamuel@chromium.org","chromium-reviews@chromium.org","dhollowa@chromium.org","bryeung@chromium.org","anicolao@google.com"],"text":"http://codereview.chromium.org/7222007/diff/4003/views/ime/input_method_base.cc\nFile views/ime/input_method_base.cc (right):\n\nhttp://codereview.chromium.org/7222007/diff/4003/views/ime/input_method_base.cc#newcode44\nviews/ime/input_method_base.cc:44: OnFocus();\nfocused != NULL doesn't necessarily mean the widget has been focused. So instead of calling OnFocus() here, it should be called in native_widget_*.cc just after creating the input method object if necessary.\n\nhttp://codereview.chromium.org/7222007/diff/4003/views/ime/input_method_base.cc#newcode45\nviews/ime/input_method_base.cc:45: FocusWillChange(NULL, focused);\nIt should only be called if widget_focused_ is true.","disapproval":false,"date":"2011-06-22 03:43:08.156068","approval":false},{"sender":"penghuang@chromium.org","recipients":["penghuang@chromium.org","suzhe@chromium.org","fsamuel@chromium.org","sadrul@chromium.org","chromium-reviews@chromium.org","dhollowa@chromium.org","bryeung@chromium.org","anicolao@google.com"],"text":"http://codereview.chromium.org/7222007/diff/4003/views/ime/input_method_base.cc\nFile views/ime/input_method_base.cc (right):\n\nhttp://codereview.chromium.org/7222007/diff/4003/views/ime/input_method_base.cc#newcode44\nviews/ime/input_method_base.cc:44: OnFocus();\nOn 2011/06/22 03:43:08, James Su wrote:\n> focused != NULL doesn't necessarily mean the widget has been focused. So instead\n> of calling OnFocus() here, it should be called in native_widget_*.cc just after\n> creating the input method object if necessary.\n\nI think it is little weird to call OnFocus() before Init(). Maybe some implement need Init() before handling focus.\n\nhttp://codereview.chromium.org/7222007/diff/4003/views/ime/input_method_base.cc#newcode45\nviews/ime/input_method_base.cc:45: FocusWillChange(NULL, focused);\nOn 2011/06/22 03:43:08, James Su wrote:\n> It should only be called if widget_focused_ is true.\n\nDone.","disapproval":false,"date":"2011-06-22 18:24:23.932877","approval":false},{"sender":"suzhe@chromium.org","recipients":["penghuang@chromium.org","suzhe@chromium.org","fsamuel@chromium.org","sadrul@chromium.org","chromium-reviews@chromium.org","dhollowa@chromium.org","bryeung@chromium.org","anicolao@google.com"],"text":"http://codereview.chromium.org/7222007/diff/6001/views/ime/input_method_base.cc\nFile views/ime/input_method_base.cc (right):\n\nhttp://codereview.chromium.org/7222007/diff/6001/views/ime/input_method_base.cc#newcode42\nviews/ime/input_method_base.cc:42: if (widget->IsActive()) {\nIn native_widget_gtk.cc IsActive() uses a different flag instead of has_focus_. So we'd better not to use it as focus state.\n\nhttp://codereview.chromium.org/7222007/diff/6001/views/ime/input_method_base.cc#newcode43\nviews/ime/input_method_base.cc:43: OnFocus();\nOnFocus() should be called by native widget implementations just after creating and initializing the input method instance.","disapproval":false,"date":"2011-06-23 01:50:05.763086","approval":false},{"sender":"penghuang@chromium.org","recipients":["penghuang@chromium.org","suzhe@chromium.org","fsamuel@chromium.org","sadrul@chromium.org","chromium-reviews@chromium.org","dhollowa@chromium.org","bryeung@chromium.org","anicolao@google.com"],"text":"http://codereview.chromium.org/7222007/diff/6001/views/ime/input_method_base.cc\nFile views/ime/input_method_base.cc (right):\n\nhttp://codereview.chromium.org/7222007/diff/6001/views/ime/input_method_base.cc#newcode42\nviews/ime/input_method_base.cc:42: if (widget->IsActive()) {\nOn 2011/06/23 01:50:05, James Su wrote:\n> In native_widget_gtk.cc IsActive() uses a different flag instead of has_focus_.\n> So we'd better not to use it as focus state.\n\nhttp://en.wikipedia.org/wiki/Active_window\n\nFrom here, the active window should be equal to focused window. And we widget does not have better function to get focus state.\n\nhttp://codereview.chromium.org/7222007/diff/6001/views/ime/input_method_base.cc#newcode43\nviews/ime/input_method_base.cc:43: OnFocus();\nOn 2011/06/23 01:50:05, James Su wrote:\n> OnFocus() should be called by native widget implementations just after creating\n> and initializing the input method instance.\n\nIf the OnFocuse() is called by native widget, where to call FocusWillChange()? I think FocusWillChange() should be called in Init(). But OnFocuse() will be called after Init(). So during Init(), the widget_focused_  can not be true.","disapproval":false,"date":"2011-06-23 03:17:40.953606","approval":false},{"sender":"suzhe@chromium.org","recipients":["penghuang@chromium.org","suzhe@chromium.org","fsamuel@chromium.org","sadrul@chromium.org","chromium-reviews@chromium.org","dhollowa@chromium.org","bryeung@chromium.org","anicolao@google.com"],"text":"http://codereview.chromium.org/7222007/diff/6001/views/ime/input_method_base.cc\nFile views/ime/input_method_base.cc (right):\n\nhttp://codereview.chromium.org/7222007/diff/6001/views/ime/input_method_base.cc#newcode42\nviews/ime/input_method_base.cc:42: if (widget->IsActive()) {\nOn 2011/06/23 03:17:41, Peng wrote:\n> On 2011/06/23 01:50:05, James Su wrote:\n> > In native_widget_gtk.cc IsActive() uses a different flag instead of\n> has_focus_.\n> > So we'd better not to use it as focus state.\n> \n> http://en.wikipedia.org/wiki/Active_window\n> \n> From here, the active window should be equal to focused window. And we widget\n> does not have better function to get focus state.\n> \n\nin native_widget_gtk.cc, this two states use different code path, so they may be set at different time. The IsActive state comes from window manager indicating if the window is activated in the WM, but the focus state comes from gdk's event layer (from Xserver).\n\nhttp://codereview.chromium.org/7222007/diff/6001/views/ime/input_method_base.cc#newcode43\nviews/ime/input_method_base.cc:43: OnFocus();\nOn 2011/06/23 03:17:41, Peng wrote:\n> On 2011/06/23 01:50:05, James Su wrote:\n> > OnFocus() should be called by native widget implementations just after\n> creating\n> > and initializing the input method instance.\n> \n> If the OnFocuse() is called by native widget, where to call FocusWillChange()? I\n> think FocusWillChange() should be called in Init(). But OnFocuse() will be\n> called after Init(). So during Init(), the widget_focused_  can not be true.\n> \nIt's ok to call FocusWillChange() with widget_focused_ == false.","disapproval":false,"date":"2011-06-23 04:02:59.036802","approval":false},{"sender":"penghuang@chromium.org","recipients":["penghuang@chromium.org","suzhe@chromium.org","fsamuel@chromium.org","sadrul@chromium.org","chromium-reviews@chromium.org","dhollowa@chromium.org","bryeung@chromium.org","anicolao@google.com"],"text":"Fixed. Please review it again.\n\nOn 2011/06/23 04:02:59, James Su wrote:\n> http://codereview.chromium.org/7222007/diff/6001/views/ime/input_method_base.cc\n> File views/ime/input_method_base.cc (right):\n> \n> http://codereview.chromium.org/7222007/diff/6001/views/ime/input_method_base.cc#newcode42\n> views/ime/input_method_base.cc:42: if (widget->IsActive()) {\n> On 2011/06/23 03:17:41, Peng wrote:\n> > On 2011/06/23 01:50:05, James Su wrote:\n> > > In native_widget_gtk.cc IsActive() uses a different flag instead of\n> > has_focus_.\n> > > So we'd better not to use it as focus state.\n> > \n> > http://en.wikipedia.org/wiki/Active_window\n> > \n> > From here, the active window should be equal to focused window. And we widget\n> > does not have better function to get focus state.\n> > \n> \n> in native_widget_gtk.cc, this two states use different code path, so they may be\n> set at different time. The IsActive state comes from window manager indicating\n> if the window is activated in the WM, but the focus state comes from gdk's event\n> layer (from Xserver).\n> \n> http://codereview.chromium.org/7222007/diff/6001/views/ime/input_method_base.cc#newcode43\n> views/ime/input_method_base.cc:43: OnFocus();\n> On 2011/06/23 03:17:41, Peng wrote:\n> > On 2011/06/23 01:50:05, James Su wrote:\n> > > OnFocus() should be called by native widget implementations just after\n> > creating\n> > > and initializing the input method instance.\n> > \n> > If the OnFocuse() is called by native widget, where to call FocusWillChange()?\n> I\n> > think FocusWillChange() should be called in Init(). But OnFocuse() will be\n> > called after Init(). So during Init(), the widget_focused_  can not be true.\n> > \n> It's ok to call FocusWillChange() with widget_focused_ == false.","disapproval":false,"date":"2011-06-23 15:04:35.810787","approval":false},{"sender":"suzhe@chromium.org","recipients":["penghuang@chromium.org","suzhe@chromium.org","fsamuel@chromium.org","sadrul@chromium.org","chromium-reviews@chromium.org","dhollowa@chromium.org","bryeung@chromium.org","anicolao@google.com"],"text":"LGTM.","disapproval":false,"date":"2011-06-24 01:48:11.641667","approval":true},{"sender":"commit-bot@chromium.org","recipients":["penghuang@chromium.org","suzhe@chromium.org","fsamuel@chromium.org","sadrul@chromium.org","commit-bot@chromium.org","chromium-reviews@chromium.org","dhollowa@chromium.org","bryeung@chromium.org","anicolao@google.com"],"text":"Change committed as 90540","disapproval":false,"date":"2011-06-27 03:40:33.131078","approval":false}],"owner_email":"penghuang@chromium.org","private":false,"base_url":"http://git.chromium.org/git/chromium.git@trunk","owner":"Peng","subject":"Fix virtual keyboard issue with login screen","created":"2011-06-21 16:29:39.638455","patchsets":[4003,6001,12001],"modified":"2011-06-27 19:47:56.745341","closed":true,"commit":false,"issue":7222007}