{"description":"Include the sync specific device guid in the DeviceInfo data structure. This will be used to identify a partnership between a client and server.\nNote: This will not be exposed as such to the extensions but will be hashed or encrypted.\nBUG=\nR=bauerb@chromium.org, pam@chromium.org, zea@chromium.org\n\nCommitted: https://src.chromium.org/viewvc/chrome?view=rev&revision=211867","cc":["chromium-reviews@chromium.org","tim+watch@chromium.org","haitaol+watch@chromium.org","rsimha+watch@chromium.org","pam+watch@chromium.org"],"reviewers":["zea@chromium.org","bauerb@chromium.org","pam@chromium.org"],"messages":[{"sender":"lipalani@chromium.org","recipients":["lipalani@chromium.org","zea@chromium.org","chromium-reviews@chromium.org","tim+watch@chromium.org","haitaol+watch@chromium.org","rsimha+watch@chromium.org","pam+watch@chromium.org"],"text":"PTAL","disapproval":false,"date":"2013-06-25 22:07:45.797060","approval":false},{"sender":"zea@chromium.org","recipients":["lipalani@chromium.org","zea@chromium.org","chromium-reviews@chromium.org","tim+watch@chromium.org","haitaol+watch@chromium.org","rsimha+watch@chromium.org","pam+watch@chromium.org"],"text":"https://codereview.chromium.org/17684003/diff/7001/chrome/browser/sync/glue/device_info.cc\nFile chrome/browser/sync/glue/device_info.cc (right):\n\nhttps://codereview.chromium.org/17684003/diff/7001/chrome/browser/sync/glue/device_info.cc#newcode177\nchrome/browser/sync/glue/device_info.cc:177: \nremove newline\n\nhttps://codereview.chromium.org/17684003/diff/7001/chrome/browser/sync/glue/device_info.h\nFile chrome/browser/sync/glue/device_info.h (right):\n\nhttps://codereview.chromium.org/17684003/diff/7001/chrome/browser/sync/glue/device_info.h#newcode30\nchrome/browser/sync/glue/device_info.h:30: const std::string& guid() const;\nI think it's worth describing what GUID in this context means (i.e. unique per profile). May as well add comments for the other fields here too.\n\nhttps://codereview.chromium.org/17684003/diff/7001/chrome/browser/sync/glue/device_info.h#newcode41\nchrome/browser/sync/glue/device_info.h:41: const std::string& guid,\nwhy isn't this part of |local_info|?\n\nhttps://codereview.chromium.org/17684003/diff/7001/chrome/browser/sync/glue/device_info.h#newcode50\nchrome/browser/sync/glue/device_info.h:50: static std::string GetClientName();\nI'm not a big fan of exposing this. These calls should be performed on the FILE thread as they can be blocking. Having this as a public method makes me think it will lead to jank.","disapproval":false,"date":"2013-06-26 22:16:32.236220","approval":false},{"sender":"lipalani@chromium.org","recipients":["lipalani@chromium.org","zea@chromium.org","chromium-reviews@chromium.org","tim+watch@chromium.org","haitaol+watch@chromium.org","rsimha+watch@chromium.org","pam+watch@chromium.org"],"text":"PTAL.\n\nI am relooking the threading issue. Please look at my comment as well.\n\nThanks!\n\nhttps://codereview.chromium.org/17684003/diff/7001/chrome/browser/sync/glue/device_info.cc\nFile chrome/browser/sync/glue/device_info.cc (right):\n\nhttps://codereview.chromium.org/17684003/diff/7001/chrome/browser/sync/glue/device_info.cc#newcode177\nchrome/browser/sync/glue/device_info.cc:177: \nOn 2013/06/26 22:16:32, Nicolas Zea wrote:\n> remove newline\n\nDone.\n\nhttps://codereview.chromium.org/17684003/diff/7001/chrome/browser/sync/glue/device_info.h\nFile chrome/browser/sync/glue/device_info.h (right):\n\nhttps://codereview.chromium.org/17684003/diff/7001/chrome/browser/sync/glue/device_info.h#newcode30\nchrome/browser/sync/glue/device_info.h:30: const std::string& guid() const;\nOn 2013/06/26 22:16:32, Nicolas Zea wrote:\n> I think it's worth describing what GUID in this context means (i.e. unique per\n> profile). May as well add comments for the other fields here too.\n\nDone.\n\nhttps://codereview.chromium.org/17684003/diff/7001/chrome/browser/sync/glue/device_info.h#newcode41\nchrome/browser/sync/glue/device_info.h:41: const std::string& guid,\nThis is a slightly weird function, so difficult to interpret at first glance. It might be worth rethinking the way we construct local info in another cl(it will touch few more files)\n\nTo your qn: localinfo in this case is not the parameter :) it is the thing that we construct and pass to the callback. To construct lcoalinfo we need the guid.\nOn 2013/06/26 22:16:32, Nicolas Zea wrote:\n> why isn't this part of |local_info|?\n\nhttps://codereview.chromium.org/17684003/diff/7001/chrome/browser/sync/glue/device_info.h#newcode50\nchrome/browser/sync/glue/device_info.h:50: static std::string GetClientName();\nI took a pretty careful look in doing this but I might have missed something. The function(GetSessionNameSynchronously) seems to call things that can be done in any thread. All it is doing is getting a hostname in various platforms. Do you know a reason it has to be in file thread? I will also check further. If that is needed we can make this post a task to file thread.\nOn 2013/06/26 22:16:32, Nicolas Zea wrote:\n> I'm not a big fan of exposing this. These calls should be performed on the FILE\n> thread as they can be blocking. Having this as a public method makes me think it\n> will lead to jank.","disapproval":false,"date":"2013-06-27 23:09:49.395840","approval":false},{"sender":"zea@chromium.org","recipients":["lipalani@chromium.org","zea@chromium.org","chromium-reviews@chromium.org","tim+watch@chromium.org","haitaol+watch@chromium.org","rsimha+watch@chromium.org","pam+watch@chromium.org"],"text":"https://codereview.chromium.org/17684003/diff/7001/chrome/browser/sync/glue/device_info.h\nFile chrome/browser/sync/glue/device_info.h (right):\n\nhttps://codereview.chromium.org/17684003/diff/7001/chrome/browser/sync/glue/device_info.h#newcode50\nchrome/browser/sync/glue/device_info.h:50: static std::string GetClientName();\nThe issue is that, although nothing will explicitly complain, those platform-specific hostname methods may perform blocking I/O, i.e. due to reading some system location for the actual name.\n\nI'll admit, I haven't actually gone through and verified whether all of them _do_, so if you're confident that all the methods are safe to perform on the UI thread because they're only in-memory operations, then perhaps this is fine.\n\nOn 2013/06/27 23:09:49, lipalani1 wrote:\n> I took a pretty careful look in doing this but I might have missed something.\n> The function(GetSessionNameSynchronously) seems to call things that can be done\n> in any thread. All it is doing is getting a hostname in various platforms. Do\n> you know a reason it has to be in file thread? I will also check further. If\n> that is needed we can make this post a task to file thread.\n> On 2013/06/26 22:16:32, Nicolas Zea wrote:\n> > I'm not a big fan of exposing this. These calls should be performed on the\n> FILE\n> > thread as they can be blocking. Having this as a public method makes me think\n> it\n> > will lead to jank.\n>\n\nhttps://codereview.chromium.org/17684003/diff/26001/chrome/browser/sync/glue/device_info.cc\nFile chrome/browser/sync/glue/device_info.cc (right):\n\nhttps://codereview.chromium.org/17684003/diff/26001/chrome/browser/sync/glue/device_info.cc#newcode158\nchrome/browser/sync/glue/device_info.cc:158: void DeviceInfo::CreateLocalDeviceInfoContinuation(const std::string& guid,\nmove onto next line and align with other params\n\nhttps://codereview.chromium.org/17684003/diff/26001/chrome/browser/sync/glue/device_info.h\nFile chrome/browser/sync/glue/device_info.h (right):\n\nhttps://codereview.chromium.org/17684003/diff/26001/chrome/browser/sync/glue/device_info.h#newcode50\nchrome/browser/sync/glue/device_info.h:50: void SetUniqueDeviceIdForApp\nLooks like this method isn't fully defined?\n\nhttps://codereview.chromium.org/17684003/diff/26001/chrome/browser/sync/glue/device_info.h#newcode63\nchrome/browser/sync/glue/device_info.h:63: static std::string GetClientName();\nAdd method comment. Also maybe move up to be next to GetLocalDeviceType(), and comment that these are static helpers for extracting local system data.\n\nhttps://codereview.chromium.org/17684003/diff/26001/chrome/browser/sync/glue/device_info.h#newcode76\nchrome/browser/sync/glue/device_info.h:76: const std::string client_name_;\nNow that we're commenting above, I think it's worth commenting the other members here.\n\nhttps://codereview.chromium.org/17684003/diff/26001/chrome/browser/sync/glue/synced_device_tracker.cc\nFile chrome/browser/sync/glue/synced_device_tracker.cc (right):\n\nhttps://codereview.chromium.org/17684003/diff/26001/chrome/browser/sync/glue/synced_device_tracker.cc#newcode7\nchrome/browser/sync/glue/synced_device_tracker.cc:7: #include \"base/logging.h\"\nwhat is this needed for?\n\nhttps://codereview.chromium.org/17684003/diff/26001/sync/util/get_session_name.h\nFile sync/util/get_session_name.h (right):\n\nhttps://codereview.chromium.org/17684003/diff/26001/sync/util/get_session_name.h#newcode22\nsync/util/get_session_name.h:22: SYNC_EXPORT void GetSessionName(\nIf the above is now being exported, we probably don't need this one anymore","disapproval":false,"date":"2013-07-01 20:45:06.074170","approval":false},{"sender":"lipalani@chromium.org","recipients":["lipalani@chromium.org","zea@chromium.org","chromium-reviews@chromium.org","tim+watch@chromium.org","haitaol+watch@chromium.org","rsimha+watch@chromium.org","pam+watch@chromium.org"],"text":"Sorry about the delay in getting to this. \n\nTo jog your memory, the major issue that we were discussing: The function to get client name(GetSessionName) was being executed in file thread which made calls from UI thread a little convoluted as they have to post closures. In my first version I moved the function to any thread because the function only seemed to read some system values. \n\nIn this version I have moved it back to the file thread as the system calls could theoretically cause jank.\n\nThanks!\n\nhttps://codereview.chromium.org/17684003/diff/26001/chrome/browser/sync/glue/device_info.cc\nFile chrome/browser/sync/glue/device_info.cc (right):\n\nhttps://codereview.chromium.org/17684003/diff/26001/chrome/browser/sync/glue/device_info.cc#newcode158\nchrome/browser/sync/glue/device_info.cc:158: void DeviceInfo::CreateLocalDeviceInfoContinuation(const std::string& guid,\nOn 2013/07/01 20:45:06, Nicolas Zea wrote:\n> move onto next line and align with other params\n\nDone.\n\nhttps://codereview.chromium.org/17684003/diff/26001/chrome/browser/sync/glue/device_info.h\nFile chrome/browser/sync/glue/device_info.h (right):\n\nhttps://codereview.chromium.org/17684003/diff/26001/chrome/browser/sync/glue/device_info.h#newcode50\nchrome/browser/sync/glue/device_info.h:50: void SetUniqueDeviceIdForApp\nOn 2013/07/01 20:45:06, Nicolas Zea wrote:\n> Looks like this method isn't fully defined?\n\nDone.\n\nhttps://codereview.chromium.org/17684003/diff/26001/chrome/browser/sync/glue/device_info.h#newcode63\nchrome/browser/sync/glue/device_info.h:63: static std::string GetClientName();\nOn 2013/07/01 20:45:06, Nicolas Zea wrote:\n> Add method comment. Also maybe move up to be next to GetLocalDeviceType(), and\n> comment that these are static helpers for extracting local system data.\n\nDone.\n\nhttps://codereview.chromium.org/17684003/diff/26001/chrome/browser/sync/glue/device_info.h#newcode76\nchrome/browser/sync/glue/device_info.h:76: const std::string client_name_;\nOn 2013/07/01 20:45:06, Nicolas Zea wrote:\n> Now that we're commenting above, I think it's worth commenting the other members\n> here.\n\nDone.\n\nhttps://codereview.chromium.org/17684003/diff/26001/chrome/browser/sync/glue/synced_device_tracker.cc\nFile chrome/browser/sync/glue/synced_device_tracker.cc (right):\n\nhttps://codereview.chromium.org/17684003/diff/26001/chrome/browser/sync/glue/synced_device_tracker.cc#newcode7\nchrome/browser/sync/glue/synced_device_tracker.cc:7: #include \"base/logging.h\"\nOn 2013/07/01 20:45:06, Nicolas Zea wrote:\n> what is this needed for?\n\nDone.\n\nhttps://codereview.chromium.org/17684003/diff/26001/sync/util/get_session_name.h\nFile sync/util/get_session_name.h (right):\n\nhttps://codereview.chromium.org/17684003/diff/26001/sync/util/get_session_name.h#newcode22\nsync/util/get_session_name.h:22: SYNC_EXPORT void GetSessionName(\nOn 2013/07/01 20:45:06, Nicolas Zea wrote:\n> If the above is now being exported, we probably don't need this one anymore\n\nDone.","disapproval":false,"date":"2013-07-11 22:09:46.672670","approval":false},{"sender":"zea@chromium.org","recipients":["lipalani@chromium.org","zea@chromium.org","chromium-reviews@chromium.org","tim+watch@chromium.org","haitaol+watch@chromium.org","rsimha+watch@chromium.org","pam+watch@chromium.org"],"text":"LGTM\n\nhttps://codereview.chromium.org/17684003/diff/40001/chrome/browser/sync/glue/device_info.h\nFile chrome/browser/sync/glue/device_info.h (right):\n\nhttps://codereview.chromium.org/17684003/diff/40001/chrome/browser/sync/glue/device_info.h#newcode29\nchrome/browser/sync/glue/device_info.h:29: // Sync specific unique identifier for the device. Note if a device\nnewline above\n\nhttps://codereview.chromium.org/17684003/diff/40001/chrome/browser/sync/glue/device_info.h#newcode62\nchrome/browser/sync/glue/device_info.h:62: \nremove extra newline\n\nhttps://codereview.chromium.org/17684003/diff/40001/chrome/browser/sync/glue/device_info.h#newcode71\nchrome/browser/sync/glue/device_info.h:71: base::Callback<void(const std::string& local_info)> callback,\nfix indent\n\nhttps://codereview.chromium.org/17684003/diff/40001/chrome/browser/sync/glue/synced_device_tracker_unittest.cc\nFile chrome/browser/sync/glue/synced_device_tracker_unittest.cc (right):\n\nhttps://codereview.chromium.org/17684003/diff/40001/chrome/browser/sync/glue/synced_device_tracker_unittest.cc#newcode25\nchrome/browser/sync/glue/synced_device_tracker_unittest.cc:25: void ConvertDeviceInfoSpecifics(const DeviceInfo& device_info,\nmove param onto next line with a 4 space indent","disapproval":false,"date":"2013-07-12 18:36:29.394120","approval":true},{"sender":"commit-bot@chromium.org","recipients":["lipalani@chromium.org","zea@chromium.org","chromium-reviews@chromium.org","tim+watch@chromium.org","haitaol+watch@chromium.org","rsimha+watch@chromium.org","pam+watch@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/lipalani@chromium.org/17684003/63001","disapproval":false,"date":"2013-07-12 21:33:50.932200","approval":false},{"sender":"commit-bot@chromium.org","recipients":["lipalani@chromium.org","zea@chromium.org","chromium-reviews@chromium.org","tim+watch@chromium.org","haitaol+watch@chromium.org","rsimha+watch@chromium.org","pam+watch@chromium.org"],"text":"Retried try job too often on chromium_presubmit for step(s) presubmit\nhttp://build.chromium.org/p/tryserver.chromium/buildstatus?builder=chromium_presubmit&number=15073","disapproval":false,"date":"2013-07-12 21:52:05.533130","approval":false},{"sender":"lipalani@chromium.org","recipients":["lipalani@chromium.org","zea@chromium.org","bauerb@chromium.org","pam@chromium.org","chromium-reviews@chromium.org","tim+watch@chromium.org","haitaol+watch@chromium.org","rsimha+watch@chromium.org","pam+watch@chromium.org"],"text":"Pam/Bauer - would you mind LGTMing the changes in managed_user_registration*.*\n\nhttps://codereview.chromium.org/17684003/diff/40001/chrome/browser/sync/glue/device_info.h\nFile chrome/browser/sync/glue/device_info.h (right):\n\nhttps://codereview.chromium.org/17684003/diff/40001/chrome/browser/sync/glue/device_info.h#newcode29\nchrome/browser/sync/glue/device_info.h:29: // Sync specific unique identifier for the device. Note if a device\nOn 2013/07/12 18:36:29, Nicolas Zea wrote:\n> newline above\n\nDone.\n\nhttps://codereview.chromium.org/17684003/diff/40001/chrome/browser/sync/glue/device_info.h#newcode62\nchrome/browser/sync/glue/device_info.h:62: \nOn 2013/07/12 18:36:29, Nicolas Zea wrote:\n> remove extra newline\n\nDone.\n\nhttps://codereview.chromium.org/17684003/diff/40001/chrome/browser/sync/glue/device_info.h#newcode71\nchrome/browser/sync/glue/device_info.h:71: base::Callback<void(const std::string& local_info)> callback,\nOn 2013/07/12 18:36:29, Nicolas Zea wrote:\n> fix indent\n\nDone.\n\nhttps://codereview.chromium.org/17684003/diff/40001/chrome/browser/sync/glue/synced_device_tracker_unittest.cc\nFile chrome/browser/sync/glue/synced_device_tracker_unittest.cc (right):\n\nhttps://codereview.chromium.org/17684003/diff/40001/chrome/browser/sync/glue/synced_device_tracker_unittest.cc#newcode25\nchrome/browser/sync/glue/synced_device_tracker_unittest.cc:25: void ConvertDeviceInfoSpecifics(const DeviceInfo& device_info,\nOn 2013/07/12 18:36:29, Nicolas Zea wrote:\n> move param onto next line with a 4 space indent\n\nDone.","disapproval":false,"date":"2013-07-15 18:01:43.018390","approval":false},{"sender":"bauerb@chromium.org","recipients":["lipalani@chromium.org","zea@chromium.org","bauerb@chromium.org","pam@chromium.org","chromium-reviews@chromium.org","tim+watch@chromium.org","haitaol+watch@chromium.org","rsimha+watch@chromium.org","pam+watch@chromium.org"],"text":"managed_mode LGTM\n\nhttps://codereview.chromium.org/17684003/diff/63001/chrome/browser/managed_mode/managed_user_registration_service.h\nFile chrome/browser/managed_mode/managed_user_registration_service.h (right):\n\nhttps://codereview.chromium.org/17684003/diff/63001/chrome/browser/managed_mode/managed_user_registration_service.h#newcode121\nchrome/browser/managed_mode/managed_user_registration_service.h:121: // Fetches the managed user token when we have the device info.\ns/info/name/","disapproval":false,"date":"2013-07-15 19:58:31.290160","approval":true},{"sender":"commit-bot@chromium.org","recipients":["lipalani@chromium.org","zea@chromium.org","bauerb@chromium.org","pam@chromium.org","chromium-reviews@chromium.org","tim+watch@chromium.org","haitaol+watch@chromium.org","rsimha+watch@chromium.org","pam+watch@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/lipalani@chromium.org/17684003/71001","disapproval":false,"date":"2013-07-15 21:05:42.494750","approval":false},{"sender":"commit-bot@chromium.org","recipients":["lipalani@chromium.org","zea@chromium.org","bauerb@chromium.org","pam@chromium.org","chromium-reviews@chromium.org","tim+watch@chromium.org","haitaol+watch@chromium.org","rsimha+watch@chromium.org","pam+watch@chromium.org"],"text":"Retried try job too often on linux_aura for step(s) unit_tests\nhttp://build.chromium.org/p/tryserver.chromium/buildstatus?builder=linux_aura&number=59536","disapproval":false,"date":"2013-07-15 23:19:48.644600","approval":false},{"sender":"commit-bot@chromium.org","recipients":["lipalani@chromium.org","zea@chromium.org","bauerb@chromium.org","pam@chromium.org","chromium-reviews@chromium.org","tim+watch@chromium.org","haitaol+watch@chromium.org","rsimha+watch@chromium.org","pam+watch@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/lipalani@chromium.org/17684003/71001","disapproval":false,"date":"2013-07-15 23:44:35.340920","approval":false},{"sender":"commit-bot@chromium.org","recipients":["lipalani@chromium.org","zea@chromium.org","bauerb@chromium.org","pam@chromium.org","chromium-reviews@chromium.org","tim+watch@chromium.org","haitaol+watch@chromium.org","rsimha+watch@chromium.org","pam+watch@chromium.org"],"text":"Retried try job too often on linux_aura for step(s) unit_tests\nhttp://build.chromium.org/p/tryserver.chromium/buildstatus?builder=linux_aura&number=59636","disapproval":false,"date":"2013-07-16 01:45:54.483270","approval":false},{"sender":"pam@chromium.org","recipients":["lipalani@chromium.org","zea@chromium.org","bauerb@chromium.org","pam@chromium.org","chromium-reviews@chromium.org","tim+watch@chromium.org","haitaol+watch@chromium.org","rsimha+watch@chromium.org","pam+watch@chromium.org"],"text":"managed_mode lgtm too fwiw\n\n- Pam","disapproval":false,"date":"2013-07-16 12:22:27.316730","approval":true},{"sender":"commit-bot@chromium.org","recipients":["lipalani@chromium.org","zea@chromium.org","bauerb@chromium.org","pam@chromium.org","chromium-reviews@chromium.org","tim+watch@chromium.org","haitaol+watch@chromium.org","rsimha+watch@chromium.org","pam+watch@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/lipalani@chromium.org/17684003/71001","disapproval":false,"date":"2013-07-16 18:35:04.925320","approval":false},{"sender":"commit-bot@chromium.org","recipients":["lipalani@chromium.org","zea@chromium.org","bauerb@chromium.org","pam@chromium.org","chromium-reviews@chromium.org","tim+watch@chromium.org","haitaol+watch@chromium.org","rsimha+watch@chromium.org","pam+watch@chromium.org"],"text":"Retried try job too often on linux_aura for step(s) unit_tests\nhttp://build.chromium.org/p/tryserver.chromium/buildstatus?builder=linux_aura&number=60489","disapproval":false,"date":"2013-07-16 20:36:44.468660","approval":false},{"sender":"lipalani@chromium.org","recipients":["lipalani@chromium.org","zea@chromium.org","bauerb@chromium.org","pam@chromium.org","chromium-reviews@chromium.org","tim+watch@chromium.org","haitaol+watch@chromium.org","rsimha+watch@chromium.org","pam+watch@chromium.org"],"text":"Committed patchset #7 manually as r211867 (presubmit successful).","disapproval":false,"date":"2013-07-16 23:04:26.089000","approval":false}],"owner_email":"lipalani@chromium.org","private":false,"base_url":"svn://svn.chromium.org/chrome/trunk/src","owner":"lipalani1","subject":"Include the device guid in the DeviceInfo data structure. This will be used to identify the device.","created":"2013-06-25 19:27:42.050380","patchsets":[7001,26001,37001,40001,56001,63001,71001],"modified":"2013-07-16 23:04:26.584860","closed":true,"commit":false,"issue":17684003}