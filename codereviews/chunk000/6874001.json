{"description":"[Sync] Simplify themes notifications and themes sync\n\nChange ThemesService to listen to EXTENSION_LOADED instead of\nTHEME_INSTALLED.  Remove THEME_INSTALLED notification and always send\nEXTENSION_INSTALLED.\n\nRemove Extension details from BROWSER_THEME_CHANGED notification.\n\nThe two changes above make it so that listeners to BROWSER_THEME_CHANGED\ncan simply query the ThemeService about the new theme; previously this\nwas not possible since the theme was only installed and not loaded.\n\nCut out the now-unneeded code in ThemeChangeProcessor (yay!).\n\nBUG=74831\nTEST=\n\nCommitted: http://src.chromium.org/viewvc/chrome?view=rev&revision=81795","cc":["chromium-reviews@chromium.org"],"reviewers":["asargent@chromium.org","zea@chromium.org"],"messages":[{"sender":"akalin@chromium.org","recipients":["akalin@chromium.org","asargent@chromium.org","zea@chromium.org","chromium-reviews@chromium.org"],"text":"+zea for sync stuff, +asargent for everything else","disapproval":false,"date":"2011-04-15 04:22:50.706678","approval":false},{"sender":"zea@chromium.org","recipients":["akalin@chromium.org","asargent@chromium.org","zea@chromium.org","chromium-reviews@chromium.org"],"text":"Sync changes LGTM\n\nhttp://codereview.chromium.org/6874001/diff/1/chrome/browser/sync/glue/theme_change_processor.cc\nFile chrome/browser/sync/glue/theme_change_processor.cc (right):\n\nhttp://codereview.chromium.org/6874001/diff/1/chrome/browser/sync/glue/theme_change_processor.cc#newcode34\nchrome/browser/sync/glue/theme_change_processor.cc:34: DCHECK(type == NotificationType::BROWSER_THEME_CHANGED);\nHurray!","disapproval":false,"date":"2011-04-15 04:47:26.300444","approval":true},{"sender":"asargent@chromium.org","recipients":["akalin@chromium.org","asargent@chromium.org","zea@chromium.org","chromium-reviews@chromium.org"],"text":"Awesomesauce, thanks for doing this. \n\nLooks good overall, I just have one question.\n\nhttp://codereview.chromium.org/6874001/diff/1/content/common/notification_type.h\nFile content/common/notification_type.h (right):\n\nhttp://codereview.chromium.org/6874001/diff/1/content/common/notification_type.h#newcode264\ncontent/common/notification_type.h:264: // The user has changed the browser theme.  There are no details.\nOut of curiousity, why'd you remove the Extension* details? Is it because you don't want the abiguity about NULL either meaning \"no theme\" or \"gtk native theme\"?\n\nIt looks like there's at least one place in this CL where the listener for this notification has to turn around and ask the theme service for the theme id, and I can see possible future scenarios where code would want to get a handle to the Extension too (I might need to do this in the management API, for instance).","disapproval":false,"date":"2011-04-15 19:03:29.271843","approval":false},{"sender":"akalin@chromium.org","recipients":["akalin@chromium.org","asargent@chromium.org","zea@chromium.org","chromium-reviews@chromium.org"],"text":"http://codereview.chromium.org/6874001/diff/1/content/common/notification_type.h\nFile content/common/notification_type.h (right):\n\nhttp://codereview.chromium.org/6874001/diff/1/content/common/notification_type.h#newcode264\ncontent/common/notification_type.h:264: // The user has changed the browser theme.  There are no details.\nOn 2011/04/15 19:03:29, Antony Sargent wrote:\n> Out of curiousity, why'd you remove the Extension* details? Is it because you\n> don't want the abiguity about NULL either meaning \"no theme\" or \"gtk native\n> theme\"?\n>\n> It looks like there's at least one place in this CL where the listener for this\n> notification has to turn around and ask the theme service for the theme id, and\n> I can see possible future scenarios where code would want to get a handle to the\n> Extension too (I might need to do this in the management API, for instance). \n\nWell, that's part of it.  I was the one that originally added the Extension* details to the notification, and that was to work around the problem this CL solves w.r.t. listeners to BROWSER_THEME_CHANGED not being able to query the extension service for the theme (since it's installed but not loaded yet).  Thinking about it, that wasn't a very good solution.  Ideally, stuff that deals with themes notifications shouldn't have to know that themes are implemented as extensions, just that they're identified by IDs.  Even more ideally, the ID would be different for default vs. native.  If that were the case, and if transporting the ID via notification weren't a pain, I would have added the ID as the notification details.\n\nI think I removed the one place where themes were treated differently by the extension service (THEME_INSTALLED vs. EXTENSION_INSTALLED).  So shouldn't stuff that listens to extension notifications (like the management API) automatically handle themes, and thus have no need to listen to BROWSER_THEME_CHANGED?","disapproval":false,"date":"2011-04-15 19:31:50.858546","approval":false},{"sender":"asargent@chromium.org","recipients":["akalin@chromium.org","asargent@chromium.org","zea@chromium.org","chromium-reviews@chromium.org"],"text":"Ok, that seems reasonable. We can always change this later if we need to.\n\nlgtm","disapproval":false,"date":"2011-04-15 19:46:15.307875","approval":true}],"owner_email":"akalin@chromium.org","private":false,"base_url":"svn://svn.chromium.org/chrome/trunk/src","owner":"akalin","subject":"[Sync] Simplify themes notifications and themes sync","created":"2011-04-15 04:20:05.746078","patchsets":[1],"modified":"2011-05-20 02:38:52.643056","closed":true,"commit":false,"issue":6874001}