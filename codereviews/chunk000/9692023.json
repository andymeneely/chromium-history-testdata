{"description":"Add alwaysOnTop property to extension Window object\n\nSince we now support detaching panels, we allow extensions to determine if their panel windows are probably visible.\n\nBUG=116484\nTEST=browser_tests\n\nCommitted: http://src.chromium.org/viewvc/chrome?view=rev&revision=127044","cc":["chromium-reviews@chromium.org","dslomov@chromium.org","jennb@chromium.org","mihaip+watch@chromium.org","dimich@chromium.org","jianli@chromium.org","aburago@chromium.org"],"reviewers":["jennb@chromium.org","jianli@chromium.org","ben@chromium.org","mihaip@chromium.org","aa@chromium.org","thakis@chromium.org","erg@chromium.org"],"messages":[{"sender":"dcheng@chromium.org","recipients":["dcheng@chromium.org","jennb@chromium.org","jianli@chromium.org","chromium-reviews@chromium.org","dslomov@chromium.org","jennb@chromium.org","mihaip+watch@chromium.org","dcheng@chromium.org","dimich@chromium.org","aa@chromium.org","jianli@chromium.org","aburago@chromium.org"],"text":"I suspect people will have thoughts on where the logic in PanelIsTopmost() should really belong. It's actually being done three different ways right now:\n\n- On Windows (though not Aura), we just check the Win32 extended window styles.\n\n- On GTK, we keep track of the state ourselves in a bool since there's no easy way to extract the state from the GtkWindow...\n\n- On Mac, we currently see if the window level is greater than NSNormalWindowLevel. Mac has the pattern of hiding some logic in the window controller though, so it's not clear to me what the best way to split this code is: maybe we should just expose the new member that Jian added to the window controller and return its value. This would make the implementation similar to GTK.\n\nIt'd be good to settle on something semi-consistent.\n\n(On an unrelated note, I think it's silly that every time we add a function implemented by BrowserWindow and Panel we end up adding two vtable entries into NativePanel...)","disapproval":false,"date":"2012-03-13 23:26:52.195869","approval":false},{"sender":"jennb@chromium.org","recipients":["dcheng@chromium.org","jennb@chromium.org","jianli@chromium.org","chromium-reviews@chromium.org","dslomov@chromium.org","jennb@chromium.org","mihaip+watch@chromium.org","dcheng@chromium.org","dimich@chromium.org","aa@chromium.org","jianli@chromium.org","aburago@chromium.org"],"text":"http://codereview.chromium.org/9692023/diff/8001/chrome/browser/extensions/window_open_apitest.cc\nFile chrome/browser/extensions/window_open_apitest.cc (right):\n\nhttp://codereview.chromium.org/9692023/diff/8001/chrome/browser/extensions/window_open_apitest.cc#newcode201\nchrome/browser/extensions/window_open_apitest.cc:201: #define MAYBE_WindowOpenPanel FAILS_WindowOpenPanel\nShould say why we expect the test to fail under Aura.\n\nhttp://codereview.chromium.org/9692023/diff/8001/chrome/browser/ui/base_window.h\nFile chrome/browser/ui/base_window.h (right):\n\nhttp://codereview.chromium.org/9692023/diff/8001/chrome/browser/ui/base_window.h#newcode69\nchrome/browser/ui/base_window.h:69: // Returns the true if a window is \"always on top\".\nthe true\n\nhttp://codereview.chromium.org/9692023/diff/8001/chrome/browser/ui/panels/panel.cc\nFile chrome/browser/ui/panels/panel.cc (right):\n\nhttp://codereview.chromium.org/9692023/diff/8001/chrome/browser/ui/panels/panel.cc#newcode263\nchrome/browser/ui/panels/panel.cc:263: bool Panel::IsTopmost() const {\nCould just return always_on_top_. Trust that we saved the correct setting rather than query the OS. That will eliminate the native panel changes.","disapproval":false,"date":"2012-03-14 01:02:18.152816","approval":false},{"sender":"dcheng@chromium.org","recipients":["dcheng@chromium.org","jennb@chromium.org","jianli@chromium.org","chromium-reviews@chromium.org","dslomov@chromium.org","jennb@chromium.org","mihaip+watch@chromium.org","dcheng@chromium.org","dimich@chromium.org","aa@chromium.org","jianli@chromium.org","aburago@chromium.org"],"text":"http://codereview.chromium.org/9692023/diff/8001/chrome/browser/extensions/window_open_apitest.cc\nFile chrome/browser/extensions/window_open_apitest.cc (right):\n\nhttp://codereview.chromium.org/9692023/diff/8001/chrome/browser/extensions/window_open_apitest.cc#newcode201\nchrome/browser/extensions/window_open_apitest.cc:201: #define MAYBE_WindowOpenPanel FAILS_WindowOpenPanel\nOn 2012/03/14 01:02:18, jennb wrote:\n> Should say why we expect the test to fail under Aura.\n\nDone.\n\nhttp://codereview.chromium.org/9692023/diff/8001/chrome/browser/ui/base_window.h\nFile chrome/browser/ui/base_window.h (right):\n\nhttp://codereview.chromium.org/9692023/diff/8001/chrome/browser/ui/base_window.h#newcode69\nchrome/browser/ui/base_window.h:69: // Returns the true if a window is \"always on top\".\nOn 2012/03/14 01:02:18, jennb wrote:\n> the true\n\nDone.\n\nhttp://codereview.chromium.org/9692023/diff/8001/chrome/browser/ui/panels/panel.cc\nFile chrome/browser/ui/panels/panel.cc (right):\n\nhttp://codereview.chromium.org/9692023/diff/8001/chrome/browser/ui/panels/panel.cc#newcode263\nchrome/browser/ui/panels/panel.cc:263: bool Panel::IsTopmost() const {\nOn 2012/03/14 01:02:18, jennb wrote:\n> Could just return always_on_top_. Trust that we saved the correct setting rather\n> than query the OS. That will eliminate the native panel changes.\n\nDone. Thanks for pointing this out--I didn't notice it in the patch that added detach support. It seems like we should be able to eliminate the duplicate always_on_top_ member variable in PanelBrowserWindowController then. I'll fix that in a separate patch.","disapproval":false,"date":"2012-03-14 17:50:42.549586","approval":false},{"sender":"jianli@chromium.org","recipients":["dcheng@chromium.org","jennb@chromium.org","jianli@chromium.org","chromium-reviews@chromium.org","dslomov@chromium.org","jennb@chromium.org","mihaip+watch@chromium.org","dcheng@chromium.org","dimich@chromium.org","aa@chromium.org","jianli@chromium.org","aburago@chromium.org"],"text":"Please also ask Ben to take a look since this patch involves changes to basic UI.\n\nhttp://codereview.chromium.org/9692023/diff/8032/chrome/browser/ui/base_window.h\nFile chrome/browser/ui/base_window.h (right):\n\nhttp://codereview.chromium.org/9692023/diff/8032/chrome/browser/ui/base_window.h#newcode70\nchrome/browser/ui/base_window.h:70: virtual bool IsTopmost() const = 0;\nProbably we should name it as IsAlwaysOnTop for consistency.","disapproval":false,"date":"2012-03-14 20:25:52.243200","approval":false},{"sender":"dcheng@chromium.org","recipients":["dcheng@chromium.org","jennb@chromium.org","jianli@chromium.org","chromium-reviews@chromium.org","dslomov@chromium.org","jennb@chromium.org","mihaip+watch@chromium.org","dcheng@chromium.org","dimich@chromium.org","aa@chromium.org","jianli@chromium.org","aburago@chromium.org"],"text":"I've also updated the extension docs.\n\nhttp://codereview.chromium.org/9692023/diff/8032/chrome/browser/ui/base_window.h\nFile chrome/browser/ui/base_window.h (right):\n\nhttp://codereview.chromium.org/9692023/diff/8032/chrome/browser/ui/base_window.h#newcode70\nchrome/browser/ui/base_window.h:70: virtual bool IsTopmost() const = 0;\nOn 2012/03/14 20:25:52, jianli wrote:\n> Probably we should name it as IsAlwaysOnTop for consistency.\n\nThe JS property is named topmost though. It's a little inconsistent, but this way, the inconsistency is limited to the panels code.","disapproval":false,"date":"2012-03-14 20:42:19.445423","approval":false},{"sender":"jennb@chromium.org","recipients":["dcheng@chromium.org","jennb@chromium.org","jianli@chromium.org","chromium-reviews@chromium.org","dslomov@chromium.org","jennb@chromium.org","mihaip+watch@chromium.org","dcheng@chromium.org","dimich@chromium.org","aa@chromium.org","jianli@chromium.org","aburago@chromium.org"],"text":"LGTM\n\nhttp://codereview.chromium.org/9692023/diff/12019/chrome/browser/extensions/extension_window_controller.cc\nFile chrome/browser/extensions/extension_window_controller.cc (right):\n\nhttp://codereview.chromium.org/9692023/diff/12019/chrome/browser/extensions/extension_window_controller.cc#newcode52\nchrome/browser/extensions/extension_window_controller.cc:52: result->SetBoolean(keys::kTopmostKey, window()->IsTopmost());\nDon't put this in the middle of the bounds logic. Move under incognito setting.","disapproval":false,"date":"2012-03-14 22:19:38.006423","approval":true},{"sender":"dcheng@chromium.org","recipients":["dcheng@chromium.org","jennb@chromium.org","jianli@chromium.org","ben@chromium.org","chromium-reviews@chromium.org","dslomov@chromium.org","jennb@chromium.org","mihaip+watch@chromium.org","dcheng@chromium.org","dimich@chromium.org","aa@chromium.org","jianli@chromium.org","aburago@chromium.org"],"text":"+ben for chrome/browser/ui and chrome/browser/ui/views/ash\n+thakis for chrome/browser/ui/cocoa\n+erg for chrome/browser/ui/gtk\n+aa for chrome/browser/extensions","disapproval":false,"date":"2012-03-14 22:25:02.082326","approval":false},{"sender":"mihaip@chromium.org","recipients":["dcheng@chromium.org","jennb@chromium.org","jianli@chromium.org","ben@chromium.org","mihaip@chromium.org","chromium-reviews@chromium.org","dslomov@chromium.org","jennb@chromium.org","mihaip+watch@chromium.org","dcheng@chromium.org","dimich@chromium.org","aa@chromium.org","jianli@chromium.org","aburago@chromium.org"],"text":"http://codereview.chromium.org/9692023/diff/8032/chrome/browser/ui/base_window.h\nFile chrome/browser/ui/base_window.h (right):\n\nhttp://codereview.chromium.org/9692023/diff/8032/chrome/browser/ui/base_window.h#newcode70\nchrome/browser/ui/base_window.h:70: virtual bool IsTopmost() const = 0;\nOn 2012/03/14 20:42:19, dcheng wrote:\n> On 2012/03/14 20:25:52, jianli wrote:\n> > Probably we should name it as IsAlwaysOnTop for consistency.\n> \n> The JS property is named topmost though. It's a little inconsistent, but this\n> way, the inconsistency is limited to the panels code.\n\nBut you're also adding the JS property in this CL, so it can be changed. I think calling this \"IsAlwaysOnTop\" makes more sense. \"Topmost\" risks being confused with IsActive (as far being the foreground window).","disapproval":false,"date":"2012-03-14 22:34:06.096359","approval":false},{"sender":"ben@chromium.org","recipients":["reply@chromiumcodereview.appspotmail.com"],"text":"I agree. AlwaysOnTop is clearer, and consistent with the terminology we use\nin the views frontend, at least.\n\n-Ben\n\nOn Wed, Mar 14, 2012 at 3:34 PM, <mihaip@chromium.org> wrote:\n\n>\n> http://codereview.chromium.**org/9692023/diff/8032/chrome/**\n> browser/ui/base_window.h<http://codereview.chromium.org/9692023/diff/8032/chrome/browser/ui/base_window.h>\n> File chrome/browser/ui/base_window.**h (right):\n>\n> http://codereview.chromium.**org/9692023/diff/8032/chrome/**\n> browser/ui/base_window.h#**newcode70<http://codereview.chromium.org/9692023/diff/8032/chrome/browser/ui/base_window.h#newcode70>\n> chrome/browser/ui/base_window.**h:70: virtual bool IsTopmost() const = 0;\n> On 2012/03/14 20:42:19, dcheng wrote:\n>\n>> On 2012/03/14 20:25:52, jianli wrote:\n>> > Probably we should name it as IsAlwaysOnTop for consistency.\n>>\n>\n>  The JS property is named topmost though. It's a little inconsistent,\n>>\n> but this\n>\n>> way, the inconsistency is limited to the panels code.\n>>\n>\n> But you're also adding the JS property in this CL, so it can be changed.\n> I think calling this \"IsAlwaysOnTop\" makes more sense. \"Topmost\" risks\n> being confused with IsActive (as far being the foreground window).\n>\n> http://codereview.chromium.**org/9692023/<http://codereview.chromium.org/9692023/>\n>\n","disapproval":false,"date":"2012-03-15 14:55:48.934520","approval":false},{"sender":"dcheng@chromium.org","recipients":["dcheng@chromium.org","jennb@chromium.org","jianli@chromium.org","ben@chromium.org","mihaip@chromium.org","aa@chromium.org","thakis@chromium.org","erg@chromium.org","chromium-reviews@chromium.org","dslomov@chromium.org","jennb@chromium.org","mihaip+watch@chromium.org","dcheng@chromium.org","dimich@chromium.org","aa@chromium.org","jianli@chromium.org","aburago@chromium.org"],"text":"PTAL. Per Ben and Mihai's suggestion, changed topmost to always on top.\n\nAlso re-added OWNERS for approval (not sure why they disappeared).","disapproval":false,"date":"2012-03-15 16:34:18.681953","approval":false},{"sender":"erg@chromium.org","recipients":["dcheng@chromium.org","jennb@chromium.org","jianli@chromium.org","ben@chromium.org","mihaip@chromium.org","aa@chromium.org","thakis@chromium.org","erg@chromium.org","chromium-reviews@chromium.org","dslomov@chromium.org","jennb@chromium.org","mihaip+watch@chromium.org","dcheng@chromium.org","dimich@chromium.org","aa@chromium.org","jianli@chromium.org","aburago@chromium.org"],"text":"gtk lgtm","disapproval":false,"date":"2012-03-15 16:49:01.886067","approval":true},{"sender":"thakis@chromium.org","recipients":["dcheng@chromium.org","jennb@chromium.org","jianli@chromium.org","ben@chromium.org","mihaip@chromium.org","aa@chromium.org","thakis@chromium.org","erg@chromium.org","chromium-reviews@chromium.org","dslomov@chromium.org","jennb@chromium.org","mihaip+watch@chromium.org","dcheng@chromium.org","dimich@chromium.org","aa@chromium.org","jianli@chromium.org","aburago@chromium.org"],"text":"cocoa/ lgtm stamp\n\n\"always on top\" doesn't have clear semantics on mac though: Is it on top of all other windows, but below the dock? Above the doc? Above the menu?\n\nYou'll might run into various issues with spaces, expose, missing control. Be sure to test these work correctly","disapproval":false,"date":"2012-03-15 18:28:42.821086","approval":true},{"sender":"dcheng@chromium.org","recipients":["dcheng@chromium.org","jennb@chromium.org","jianli@chromium.org","ben@chromium.org","mihaip@chromium.org","aa@chromium.org","thakis@chromium.org","erg@chromium.org","chromium-reviews@chromium.org","dslomov@chromium.org","jennb@chromium.org","mihaip+watch@chromium.org","dimich@chromium.org","aa@chromium.org","jianli@chromium.org","aburago@chromium.org"],"text":"On 2012/03/15 18:28:42, Nico wrote:\n> cocoa/ lgtm stamp\n> \n> \"always on top\" doesn't have clear semantics on mac though: Is it on top of all\n> other windows, but below the dock? Above the doc? Above the menu?\n\nalwaysOnTop is a readonly property to help address some panel use cases. This is a whole can of worms (that's being resolved separately... I hope). It's currently above the dock... and the IME window.\n\n> \n> You'll might run into various issues with spaces, expose, missing control. Be\n> sure to test these work correctly\n\nYep =(","disapproval":false,"date":"2012-03-15 18:35:30.759413","approval":false},{"sender":"aa@chromium.org","recipients":["dcheng@chromium.org","jennb@chromium.org","jianli@chromium.org","ben@chromium.org","mihaip@chromium.org","aa@chromium.org","thakis@chromium.org","erg@chromium.org","chromium-reviews@chromium.org","dslomov@chromium.org","jennb@chromium.org","mihaip+watch@chromium.org","dimich@chromium.org","jianli@chromium.org","aburago@chromium.org"],"text":"LGTM","disapproval":false,"date":"2012-03-15 18:37:28.424783","approval":true},{"sender":"jianli@chromium.org","recipients":["dcheng@chromium.org","jennb@chromium.org","jianli@chromium.org","ben@chromium.org","mihaip@chromium.org","aa@chromium.org","thakis@chromium.org","erg@chromium.org","chromium-reviews@chromium.org","dslomov@chromium.org","jennb@chromium.org","mihaip+watch@chromium.org","dimich@chromium.org","jianli@chromium.org","aburago@chromium.org"],"text":"lgtm","disapproval":false,"date":"2012-03-15 18:38:26.253598","approval":true},{"sender":"ben@chromium.org","recipients":["dcheng@chromium.org","jennb@chromium.org","jianli@chromium.org","ben@chromium.org","mihaip@chromium.org","aa@chromium.org","thakis@chromium.org","erg@chromium.org","chromium-reviews@chromium.org","dslomov@chromium.org","jennb@chromium.org","mihaip+watch@chromium.org","dimich@chromium.org","jianli@chromium.org","aburago@chromium.org"],"text":"lgtm","disapproval":false,"date":"2012-03-15 19:07:04.985158","approval":true},{"sender":"commit-bot@chromium.org","recipients":["dcheng@chromium.org","jennb@chromium.org","jianli@chromium.org","ben@chromium.org","mihaip@chromium.org","aa@chromium.org","thakis@chromium.org","erg@chromium.org","chromium-reviews@chromium.org","dslomov@chromium.org","jennb@chromium.org","mihaip+watch@chromium.org","dimich@chromium.org","jianli@chromium.org","aburago@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/dcheng@chromium.org/9692023/11045","disapproval":false,"date":"2012-03-15 19:25:36.238211","approval":false},{"sender":"commit-bot@chromium.org","recipients":["dcheng@chromium.org","jennb@chromium.org","jianli@chromium.org","ben@chromium.org","mihaip@chromium.org","aa@chromium.org","thakis@chromium.org","erg@chromium.org","chromium-reviews@chromium.org","dslomov@chromium.org","jennb@chromium.org","mihaip+watch@chromium.org","dimich@chromium.org","jianli@chromium.org","aburago@chromium.org"],"text":"Change committed as 127044","disapproval":false,"date":"2012-03-16 00:31:01.139792","approval":false}],"owner_email":"dcheng@chromium.org","private":false,"base_url":"svn://svn.chromium.org/chrome/trunk/src","owner":"dcheng","subject":"Add alwaysOnTop property to extension Window object","created":"2012-03-12 23:20:37.807154","patchsets":[1,1016,3002,8001,13002,8030,8032,12019,9030,11045],"modified":"2012-03-16 00:31:01.305377","closed":true,"commit":false,"issue":9692023}