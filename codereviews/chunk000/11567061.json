{"description":"Throw exception when initialization failed.\n\nPreviously the initialization return code was ignored, it will lead us\ncrash later. We need a way to exit and maybe show error message if something\nwrong during initialization.\n\nUsing exception might better than returning the result code since the\ninitialization code could be called from constructor and initialization\nerror is an exception at most of time.\n\nIn activity, the exception is caught, then call finish() to exit.\n\nIn tests, the exception is wrapped with Error and threw out.\n\nBUG=b/7705055\n\n\nCommitted: https://src.chromium.org/viewvc/chrome?view=rev&revision=176975","cc":["chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"reviewers":["klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","cpu@chromium.org"],"messages":[{"sender":"michaelbai@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"Hi all,\n\nThis CL is not complete, there are somewhere need to catch the exception. Can we agree to use exception then I finish this CL? It seemed that we haven't used exception in our code.","disapproval":false,"date":"2012-12-21 20:02:27.501650","approval":false},{"sender":"joth@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"I think an unchecked exception would be a better fit here, and more consistent with how we deal with the library load failure. (Added Ted as he wrote that)\n\nhttps://codereview.chromium.org/11567061/diff/1/android_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java\nFile android_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/1/android_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java#newcode54\nandroid_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java:54: // TODO: How do we handle the exception here?\nthrow new Error(\"Cannot initialize WebView\", e);\n\nhttps://codereview.chromium.org/11567061/diff/1/content/public/android/java/src/org/chromium/content/browser/AndroidBrowserProcessInitException.java\nFile content/public/android/java/src/org/chromium/content/browser/AndroidBrowserProcessInitException.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/1/content/public/android/java/src/org/chromium/content/browser/AndroidBrowserProcessInitException.java#newcode7\ncontent/public/android/java/src/org/chromium/content/browser/AndroidBrowserProcessInitException.java:7: public class AndroidBrowserProcessInitException extends Exception {\nconsider having this extend Error, like UnsatisfiedLinkError does.\n\nThat way you don't have to add throws clauses all over the place, and we can instead have a top-level catch for both these errors in the init path, and gives the same \"Either app not installed properly, or your phone is not supported\" bail out.","disapproval":false,"date":"2012-12-21 21:53:12.926670","approval":false},{"sender":"michaelbai@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"Talked to Ted, we agreed to use Exception because Error is not required to be caught and easy to miss, so,\n\n- UnsatisfiedLinkErrors were replaced with exception\n- Renamed AndroidBrowserProcessInitException to ProcessInitException, so it could be used in all types of process.\n\n\nPTAL","disapproval":false,"date":"2013-01-04 23:38:31.021440","approval":false},{"sender":"michaelbai@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"joi@ please help to review \t content/public/common/result_codes.h","disapproval":false,"date":"2013-01-04 23:40:53.278740","approval":false},{"sender":"joi@chromium.org","recipients":["reply@chromiumcodereview-hr.appspotmail.com"],"text":"LGTM for content/public/common.\r\n\r\nOn Fri, Jan 4, 2013 at 11:40 PM,  <michaelbai@chromium.org> wrote:\r\n> joi@ please help to review       content/public/common/result_codes.h\r\n>\r\n> https://codereview.chromium.org/11567061/\r\n","disapproval":false,"date":"2013-01-07 12:37:16.595090","approval":true},{"sender":"tedchoc@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"https://codereview.chromium.org/11567061/diff/5001/android_webview/java/src/org/chromium/android_webview/AwContents.java\nFile android_webview/java/src/org/chromium/android_webview/AwContents.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/5001/android_webview/java/src/org/chromium/android_webview/AwContents.java#newcode279\nandroid_webview/java/src/org/chromium/android_webview/AwContents.java:279: \nI think this needs to be indented 8 more because of the long parameters lines above.\n\nhttps://codereview.chromium.org/11567061/diff/5001/android_webview/javatests/src/org/chromium/android_webview/test/AndroidWebViewTestBase.java\nFile android_webview/javatests/src/org/chromium/android_webview/test/AndroidWebViewTestBase.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/5001/android_webview/javatests/src/org/chromium/android_webview/test/AndroidWebViewTestBase.java#newcode219\nandroid_webview/javatests/src/org/chromium/android_webview/test/AndroidWebViewTestBase.java:219: \nit doesn't actually look like it throws Exception anymore, are these needed?  Also it would be better to scope this to be more fine grained than general exception.\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/app/LibraryLoader.java\nFile content/public/android/java/src/org/chromium/content/app/LibraryLoader.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/app/LibraryLoader.java#newcode163\ncontent/public/android/java/src/org/chromium/content/app/LibraryLoader.java:163: \nis that supposed to be common instead of comment?\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/browser/AndroidBrowserProcess.java\nFile content/public/android/java/src/org/chromium/content/browser/AndroidBrowserProcess.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/browser/AndroidBrowserProcess.java#newcode163\ncontent/public/android/java/src/org/chromium/content/browser/AndroidBrowserProcess.java:163: \nshould this just != 0?\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/browser/AndroidBrowserProcess.java#newcode164\ncontent/public/android/java/src/org/chromium/content/browser/AndroidBrowserProcess.java:164: \nin java, braces are always required unless the conditional and statement can all fit on one line (looks like this can, so you should be able to just move this up with the result check):\n\nhttp://source.android.com/source/code-style.html#use-standard-brace-style\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/browser/ContentView.java\nFile content/public/android/java/src/org/chromium/content/browser/ContentView.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/browser/ContentView.java#newcode119\ncontent/public/android/java/src/org/chromium/content/browser/ContentView.java:119: \n+8\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/browser/ContentView.java#newcode138\ncontent/public/android/java/src/org/chromium/content/browser/ContentView.java:138: \n+8 and the two below\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/browser/JellyBeanContentView.java\nFile content/public/android/java/src/org/chromium/content/browser/JellyBeanContentView.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/browser/JellyBeanContentView.java#newcode22\ncontent/public/android/java/src/org/chromium/content/browser/JellyBeanContentView.java:22: \n+8\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/common/ProcessInitException.java\nFile content/public/android/java/src/org/chromium/content/common/ProcessInitException.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/common/ProcessInitException.java#newcode7\ncontent/public/android/java/src/org/chromium/content/common/ProcessInitException.java:7: public class ProcessInitException extends Exception {\nclass level javadoc\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/common/ProcessInitException.java#newcode8\ncontent/public/android/java/src/org/chromium/content/common/ProcessInitException.java:8: private int mErrorCode = 0;\nthis file is indented c style, but needs to be indented 4 spaces each instead of 2\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/common/ProcessInitException.java#newcode10\ncontent/public/android/java/src/org/chromium/content/common/ProcessInitException.java:10: public ProcessInitException(int errorCode) {\nwhat does this javadoc represent?  all public methods should have javadocs as well, so I guess explain it there.","disapproval":false,"date":"2013-01-07 18:38:45.886020","approval":false},{"sender":"michaelbai@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"Hi Ted, PTAL\n\nhttps://codereview.chromium.org/11567061/diff/5001/android_webview/java/src/org/chromium/android_webview/AwContents.java\nFile android_webview/java/src/org/chromium/android_webview/AwContents.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/5001/android_webview/java/src/org/chromium/android_webview/AwContents.java#newcode279\nandroid_webview/java/src/org/chromium/android_webview/AwContents.java:279: \nOn 2013/01/07 18:38:46, Ted C wrote:\n> I think this needs to be indented 8 more because of the long parameters lines\n> above.\n\nDone.\n\nhttps://codereview.chromium.org/11567061/diff/5001/android_webview/javatests/src/org/chromium/android_webview/test/AndroidWebViewTestBase.java\nFile android_webview/javatests/src/org/chromium/android_webview/test/AndroidWebViewTestBase.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/5001/android_webview/javatests/src/org/chromium/android_webview/test/AndroidWebViewTestBase.java#newcode219\nandroid_webview/javatests/src/org/chromium/android_webview/test/AndroidWebViewTestBase.java:219: \nIt throws ProcessInitException because of AwContents constructor.\n\nChanged Exception to ProcessInitException.\n\nOn 2013/01/07 18:38:46, Ted C wrote:\n> it doesn't actually look like it throws Exception anymore, are these needed? \n> Also it would be better to scope this to be more fine grained than general\n> exception.\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/app/LibraryLoader.java\nFile content/public/android/java/src/org/chromium/content/app/LibraryLoader.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/app/LibraryLoader.java#newcode163\ncontent/public/android/java/src/org/chromium/content/app/LibraryLoader.java:163: \nOn 2013/01/07 18:38:46, Ted C wrote:\n> is that supposed to be common instead of comment?\n\nDone.\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/browser/AndroidBrowserProcess.java\nFile content/public/android/java/src/org/chromium/content/browser/AndroidBrowserProcess.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/browser/AndroidBrowserProcess.java#newcode163\ncontent/public/android/java/src/org/chromium/content/browser/AndroidBrowserProcess.java:163: \nActually the negative value means success here, see my change in chrome_main_delegate_android.cc and content_main_runner.cc RunNamedProcessTypeMain(...)\n\nOn 2013/01/07 18:38:46, Ted C wrote:\n> should this just != 0?\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/browser/AndroidBrowserProcess.java#newcode164\ncontent/public/android/java/src/org/chromium/content/browser/AndroidBrowserProcess.java:164: \nOn 2013/01/07 18:38:46, Ted C wrote:\n> in java, braces are always required unless the conditional and statement can all\n> fit on one line (looks like this can, so you should be able to just move this up\n> with the result check):\n> \n> http://source.android.com/source/code-style.html#use-standard-brace-style\n\nDone.\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/browser/ContentView.java\nFile content/public/android/java/src/org/chromium/content/browser/ContentView.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/browser/ContentView.java#newcode119\ncontent/public/android/java/src/org/chromium/content/browser/ContentView.java:119: \nOn 2013/01/07 18:38:46, Ted C wrote:\n> +8\n\nDone.\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/browser/ContentView.java#newcode138\ncontent/public/android/java/src/org/chromium/content/browser/ContentView.java:138: \nOn 2013/01/07 18:38:46, Ted C wrote:\n> +8 and the two below\n\nDone.\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/browser/JellyBeanContentView.java\nFile content/public/android/java/src/org/chromium/content/browser/JellyBeanContentView.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/browser/JellyBeanContentView.java#newcode22\ncontent/public/android/java/src/org/chromium/content/browser/JellyBeanContentView.java:22: \nOn 2013/01/07 18:38:46, Ted C wrote:\n> +8\n\nDone.\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/common/ProcessInitException.java\nFile content/public/android/java/src/org/chromium/content/common/ProcessInitException.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/common/ProcessInitException.java#newcode7\ncontent/public/android/java/src/org/chromium/content/common/ProcessInitException.java:7: public class ProcessInitException extends Exception {\nOn 2013/01/07 18:38:46, Ted C wrote:\n> class level javadoc\n\nDone.\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/common/ProcessInitException.java#newcode8\ncontent/public/android/java/src/org/chromium/content/common/ProcessInitException.java:8: private int mErrorCode = 0;\nOn 2013/01/07 18:38:46, Ted C wrote:\n> this file is indented c style, but needs to be indented 4 spaces each instead of\n> 2\n\nDone.\n\nhttps://codereview.chromium.org/11567061/diff/5001/content/public/android/java/src/org/chromium/content/common/ProcessInitException.java#newcode10\ncontent/public/android/java/src/org/chromium/content/common/ProcessInitException.java:10: public ProcessInitException(int errorCode) {\nOn 2013/01/07 18:38:46, Ted C wrote:\n> what does this javadoc represent?  all public methods should have javadocs as\n> well, so I guess explain it there.\n\nDone.","disapproval":false,"date":"2013-01-07 23:22:07.458310","approval":false},{"sender":"yfriedman@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"I'm with joth on this one. This seems like it should be an Error or at least RuntimeException and not a checked exception. There's too much code that's just passing the buck and it's a catastrophic failure that most callers can't recover from and yet are forced to be exposed to (e.g. creating an AwContents or ContentView{,Core}). If most consumers don't care, that should favour unchecked. Finally, this is comparable to UnsatisfiedLinkError which is an error, not checked exception.\n\nhttps://codereview.chromium.org/11567061/diff/21001/content/app/android/library_loader_hooks.cc\nFile content/app/android/library_loader_hooks.cc (right):\n\nhttps://codereview.chromium.org/11567061/diff/21001/content/app/android/library_loader_hooks.cc#newcode89\ncontent/app/android/library_loader_hooks.cc:89: return 0;\nThis should probably be RESULT_CODE_NORMAL_EXIT to indicate difference from above.\n\nhttps://codereview.chromium.org/11567061/diff/21001/content/public/android/java/src/org/chromium/content/common/ProcessInitException.java\nFile content/public/android/java/src/org/chromium/content/common/ProcessInitException.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/21001/content/public/android/java/src/org/chromium/content/common/ProcessInitException.java#newcode18\ncontent/public/android/java/src/org/chromium/content/common/ProcessInitException.java:18: super();\nWhy is this necessary? Please remove.\n\nhttps://codereview.chromium.org/11567061/diff/21001/content/public/common/result_codes.h\nFile content/public/common/result_codes.h (right):\n\nhttps://codereview.chromium.org/11567061/diff/21001/content/public/common/result_codes.h#newcode35\ncontent/public/common/result_codes.h:35: RESULT_CODE_FAILED_TO_REG_JNI = 4,\n*_REGISTER_*","disapproval":false,"date":"2013-01-08 00:54:21.985680","approval":false},{"sender":"michaelbai@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"This Exception is what we want to catch, to make it a checked Exception will prevent people from missing to catch it.\n\nI wrapped in a Error in AndroidWebview related code because Android API can be changed.\n\nYou could also see we missed to check UnsatisfiedLinkError (replace with ProcessInitException) in many places. https://gerrit-int.chromium.org/#/c/30443\n\nhttps://codereview.chromium.org/11567061/diff/21001/content/app/android/library_loader_hooks.cc\nFile content/app/android/library_loader_hooks.cc (right):\n\nhttps://codereview.chromium.org/11567061/diff/21001/content/app/android/library_loader_hooks.cc#newcode89\ncontent/app/android/library_loader_hooks.cc:89: return 0;\nRESULT_CODE_NORMAL_EXIT means the process exit normally, it might not suitable to be used here.\n\nOn 2013/01/08 00:54:22, Yaron wrote:\n> This should probably be RESULT_CODE_NORMAL_EXIT to indicate difference from\n> above.\n\nhttps://codereview.chromium.org/11567061/diff/21001/content/public/android/java/src/org/chromium/content/common/ProcessInitException.java\nFile content/public/android/java/src/org/chromium/content/common/ProcessInitException.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/21001/content/public/android/java/src/org/chromium/content/common/ProcessInitException.java#newcode18\ncontent/public/android/java/src/org/chromium/content/common/ProcessInitException.java:18: super();\nOn 2013/01/08 00:54:22, Yaron wrote:\n> Why is this necessary? Please remove.\n\nDone.\n\nhttps://codereview.chromium.org/11567061/diff/21001/content/public/common/result_codes.h\nFile content/public/common/result_codes.h (right):\n\nhttps://codereview.chromium.org/11567061/diff/21001/content/public/common/result_codes.h#newcode35\ncontent/public/common/result_codes.h:35: RESULT_CODE_FAILED_TO_REG_JNI = 4,\nOn 2013/01/08 00:54:22, Yaron wrote:\n> *_REGISTER_*\n\nDone.","disapproval":false,"date":"2013-01-08 18:06:48.671230","approval":false},{"sender":"michaelbai@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"Talked to Yaron,\n\nremoved unnecessary process initialization in ContentViewCore's constructor as process should be initialized before creating instance of ContentViewCore.\n\nPTAL","disapproval":false,"date":"2013-01-08 20:19:03.243240","approval":false},{"sender":"joth@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"https://codereview.chromium.org/11567061/diff/28001/android_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java\nFile android_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/28001/android_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java#newcode55\nandroid_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java:55: throw new Error(\"Cannot initialize WebView\", e);\nUnfortunately ThreadUtils.runOnUiThreadBlocking does not propogate Errors back to the caller, only exceptions.\nCoud you update ThreadUtils.runOnUiThreadBlocking to catch Throwable instead of Exception? (and pass it back through) or just create a RuntimeException here (maybe more reasonable).\n\nhttps://codereview.chromium.org/11567061/diff/28001/content/app/android/library_loader_hooks.cc\nFile content/app/android/library_loader_hooks.cc (right):\n\nhttps://codereview.chromium.org/11567061/diff/28001/content/app/android/library_loader_hooks.cc#newcode39\ncontent/app/android/library_loader_hooks.cc:39: jobjectArray init_command_line) {\nindent wrong.\n\nhttps://codereview.chromium.org/11567061/diff/28001/content/app/android/library_loader_hooks.cc#newcode87\ncontent/app/android/library_loader_hooks.cc:87: return RESULT_CODE_FAILED_TO_REGISTER_JNI;\nI don't think it's adding much to reuse result_codes.h for these. It seems the other result codes would be impossible to return here, and conversely the FAILED_TO_REGSITER_JNI is android only cannot happen subsequent to this point.\n\njust returning a boolean and then on the java side include a message in the exception (need a new c'tor overload) \"JNI registration error\" seems as good. we can define exception.getErrorCode() == -1 to mean other or some such thing\n\nhttps://codereview.chromium.org/11567061/diff/28001/content/public/android/java/src/org/chromium/content/app/LibraryLoader.java\nFile content/public/android/java/src/org/chromium/content/app/LibraryLoader.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/28001/content/public/android/java/src/org/chromium/content/app/LibraryLoader.java#newcode61\ncontent/public/android/java/src/org/chromium/content/app/LibraryLoader.java:61: public static void loadAndInitSync() throws ProcessInitException {\ncould you  just delete this method? it's finally not called anywhere any more\n\nhttps://codereview.chromium.org/11567061/diff/28001/content/public/android/java/src/org/chromium/content/app/LibraryLoader.java#newcode118\ncontent/public/android/java/src/org/chromium/content/app/LibraryLoader.java:118: Log.e(TAG, \"error calling nativeLibraryLoadedOnMainThread\");\nmay as well log the code here.\n\nhttps://codereview.chromium.org/11567061/diff/28001/content/public/common/result_codes.h\nFile content/public/common/result_codes.h (right):\n\nhttps://codereview.chromium.org/11567061/diff/28001/content/public/common/result_codes.h#newcode12\ncontent/public/common/result_codes.h:12: // c) the exception value that causes a process to terminate.\nthis comment will need updating if we do add this error in here (but see other comments)","disapproval":false,"date":"2013-01-08 21:20:45.376030","approval":false},{"sender":"michaelbai@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"Hi Joth,\n\nPlease see my comment for alternative way to handle this.\n\nhttps://codereview.chromium.org/11567061/diff/28001/android_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java\nFile android_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/28001/android_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java#newcode55\nandroid_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java:55: throw new Error(\"Cannot initialize WebView\", e);\nUsed RuntimeException.\n\n\nOn 2013/01/08 21:20:45, joth wrote:\n> Unfortunately ThreadUtils.runOnUiThreadBlocking does not propogate Errors back\n> to the caller, only exceptions.\n> Coud you update ThreadUtils.runOnUiThreadBlocking to catch Throwable instead of\n> Exception? (and pass it back through) or just create a RuntimeException here\n> (maybe more reasonable).\n> \n>\n\nhttps://codereview.chromium.org/11567061/diff/28001/content/app/android/library_loader_hooks.cc\nFile content/app/android/library_loader_hooks.cc (right):\n\nhttps://codereview.chromium.org/11567061/diff/28001/content/app/android/library_loader_hooks.cc#newcode87\ncontent/app/android/library_loader_hooks.cc:87: return RESULT_CODE_FAILED_TO_REGISTER_JNI;\nI think it is better for user to find the error in one place. If we are concerned about the change here, I can revert this file and add a native method like\n int nativeGetFailedToRegisterJNIResultCode(). \nand add it in Java side. Sounds better?\n\n\nOn 2013/01/08 21:20:45, joth wrote:\n> I don't think it's adding much to reuse result_codes.h for these. It seems the\n> other result codes would be impossible to return here, and conversely the\n> FAILED_TO_REGSITER_JNI is android only cannot happen subsequent to this point.\n> \n> just returning a boolean and then on the java side include a message in the\n> exception (need a new c'tor overload) \"JNI registration error\" seems as good. we\n> can define exception.getErrorCode() == -1 to mean other or some such thing\n\nhttps://codereview.chromium.org/11567061/diff/28001/content/public/android/java/src/org/chromium/content/app/LibraryLoader.java\nFile content/public/android/java/src/org/chromium/content/app/LibraryLoader.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/28001/content/public/android/java/src/org/chromium/content/app/LibraryLoader.java#newcode61\ncontent/public/android/java/src/org/chromium/content/app/LibraryLoader.java:61: public static void loadAndInitSync() throws ProcessInitException {\nOn 2013/01/08 21:20:45, joth wrote:\n> could you  just delete this method? it's finally not called anywhere any more\n\nDone.\n\nhttps://codereview.chromium.org/11567061/diff/28001/content/public/common/result_codes.h\nFile content/public/common/result_codes.h (right):\n\nhttps://codereview.chromium.org/11567061/diff/28001/content/public/common/result_codes.h#newcode12\ncontent/public/common/result_codes.h:12: // c) the exception value that causes a process to terminate.\nOur case belongs to 'c', isn't it?\n\nOn 2013/01/08 21:20:45, joth wrote:\n> this comment will need updating if we do add this error in here (but see other\n> comments)","disapproval":false,"date":"2013-01-09 00:14:00.074330","approval":false},{"sender":"michaelbai@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"I meant the alternative way to handle the error code in LibraryLoadedOnMainThread.","disapproval":false,"date":"2013-01-09 00:15:05.742820","approval":false},{"sender":"joth@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"lgtm\n\nhttps://codereview.chromium.org/11567061/diff/28001/android_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java\nFile android_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/28001/android_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java#newcode55\nandroid_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java:55: throw new Error(\"Cannot initialize WebView\", e);\nOn 2013/01/09 00:14:00, michaelbai wrote:\n> Used RuntimeException.\n> \nOK. Was removing  the message intentional? That should work ok with RuntimeException too. (and seems sufficiently useful to include)\n\n\n\n> \n> On 2013/01/08 21:20:45, joth wrote:\n> > Unfortunately ThreadUtils.runOnUiThreadBlocking does not propogate Errors back\n> > to the caller, only exceptions.\n> > Coud you update ThreadUtils.runOnUiThreadBlocking to catch Throwable instead\n> of\n> > Exception? (and pass it back through) or just create a RuntimeException here\n> > (maybe more reasonable).\n> > \n> > \n>\n\nhttps://codereview.chromium.org/11567061/diff/28001/content/public/common/result_codes.h\nFile content/public/common/result_codes.h (right):\n\nhttps://codereview.chromium.org/11567061/diff/28001/content/public/common/result_codes.h#newcode12\ncontent/public/common/result_codes.h:12: // c) the exception value that causes a process to terminate.\nOn 2013/01/09 00:14:00, michaelbai wrote:\n> Our case belongs to 'c', isn't it?\n> \n\nfair enough. (c) was sufficiently general it didn't mean much to me so my eyes skimmed past it.\n\nAlso, conceivably, the webview user can catch and ignore this error, so in that respect it's an init failure not a process \"termination\" but yes this is locally consistent with the terminology we use in chromium content AndroidProcess  etc so lets go with it like this.","disapproval":false,"date":"2013-01-09 02:51:24.426890","approval":true},{"sender":"michaelbai@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"https://codereview.chromium.org/11567061/diff/28001/android_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java\nFile android_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/28001/android_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java#newcode55\nandroid_webview/java/src/org/chromium/android_webview/AwBrowserProcess.java:55: throw new Error(\"Cannot initialize WebView\", e);\nI were thinking it might be a redundant message, I added it back since you like it.\n\n\nOn 2013/01/09 02:51:24, joth wrote:\n> On 2013/01/09 00:14:00, michaelbai wrote:\n> > Used RuntimeException.\n> > \n> OK. Was removing  the message intentional? That should work ok with\n> RuntimeException too. (and seems sufficiently useful to include)\n> \n> \n> \n> > \n> > On 2013/01/08 21:20:45, joth wrote:\n> > > Unfortunately ThreadUtils.runOnUiThreadBlocking does not propogate Errors\n> back\n> > > to the caller, only exceptions.\n> > > Coud you update ThreadUtils.runOnUiThreadBlocking to catch Throwable instead\n> > of\n> > > Exception? (and pass it back through) or just create a RuntimeException here\n> > > (maybe more reasonable).\n> > > \n> > > \n> > \n>","disapproval":false,"date":"2013-01-09 21:04:42.494980","approval":false},{"sender":"tedchoc@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"lgtm","disapproval":false,"date":"2013-01-09 23:26:27.484040","approval":true},{"sender":"yfriedman@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"lgtm\n\nhttps://codereview.chromium.org/11567061/diff/29016/content/public/android/java/src/org/chromium/content/browser/ContentView.java\nFile content/public/android/java/src/org/chromium/content/browser/ContentView.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/29016/content/public/android/java/src/org/chromium/content/browser/ContentView.java#newcode75\ncontent/public/android/java/src/org/chromium/content/browser/ContentView.java:75: public static boolean enableMultiProcess(Context context, int maxRendererProcesses)\nThis can be a separate change but I think we should remove these functsion from ContentView/ContentViewCore. Given design changes, I don't think it makes sense to have them here and they're just ultimately forwarding to AndroidBrowserProcess","disapproval":false,"date":"2013-01-10 01:43:20.677940","approval":true},{"sender":"joth@chromium.org","recipients":["reply@chromiumcodereview-hr.appspotmail.com"],"text":"On 9 January 2013 17:43, <yfriedman@chromium.org> wrote:\r\n\r\n> lgtm\r\n>\r\n>\r\n>\r\n>\r\n> https://codereview.chromium.**org/11567061/diff/29016/**\r\n> content/public/android/java/**src/org/chromium/content/**\r\n> browser/ContentView.java<https://codereview.chromium.org/11567061/diff/29016/content/public/android/java/src/org/chromium/content/browser/ContentView.java>\r\n> File\r\n> content/public/android/java/**src/org/chromium/content/**\r\n> browser/ContentView.java\r\n> (right):\r\n>\r\n> https://codereview.chromium.**org/11567061/diff/29016/**\r\n> content/public/android/java/**src/org/chromium/content/**\r\n> browser/ContentView.java#**newcode75<https://codereview.chromium.org/11567061/diff/29016/content/public/android/java/src/org/chromium/content/browser/ContentView.java#newcode75>\r\n> content/public/android/java/**src/org/chromium/content/**\r\n> browser/ContentView.java:75:\r\n> public static boolean enableMultiProcess(Context context, int\r\n> maxRendererProcesses)\r\n> This can be a separate change but I think we should remove these\r\n> functsion from ContentView/ContentViewCore. Given design changes, I\r\n> don't think it makes sense to have them here and they're just ultimately\r\n> forwarding to AndroidBrowserProcess\r\n>\r\n> +1\r\n\r\n\r\n> https://codereview.chromium.**org/11567061/<https://codereview.chromium.org/11567061/>\r\n>\r\n","disapproval":false,"date":"2013-01-10 03:12:45.555090","approval":false},{"sender":"michaelbai@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"https://codereview.chromium.org/11567061/diff/29016/content/public/android/java/src/org/chromium/content/browser/ContentView.java\nFile content/public/android/java/src/org/chromium/content/browser/ContentView.java (right):\n\nhttps://codereview.chromium.org/11567061/diff/29016/content/public/android/java/src/org/chromium/content/browser/ContentView.java#newcode75\ncontent/public/android/java/src/org/chromium/content/browser/ContentView.java:75: public static boolean enableMultiProcess(Context context, int maxRendererProcesses)\nI will make another CL to remove it.\n\n\nOn 2013/01/10 01:43:20, Yaron wrote:\n> This can be a separate change but I think we should remove these functsion from\n> ContentView/ContentViewCore. Given design changes, I don't think it makes sense\n> to have them here and they're just ultimately forwarding to\n> AndroidBrowserProcess","disapproval":false,"date":"2013-01-10 17:46:04.644420","approval":false},{"sender":"commit-bot@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/michaelbai@chromium.org/11567061/29016","disapproval":false,"date":"2013-01-10 17:46:32.800030","approval":false},{"sender":"commit-bot@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"Presubmit check for 11567061-29016 failed and returned exit status 1.\n\n\nRunning presubmit commit checks ...\n\n** Presubmit ERRORS **\nMissing LGTM from an OWNER for files in these directories:\n    chrome/app\n\nPresubmit checks took 1.8s to calculate.","disapproval":false,"date":"2013-01-10 17:46:48.174500","approval":false},{"sender":"michaelbai@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","cpu@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"Hi cpu, please help to review the change of chrome/app/android/chrome_main_delegate_android.cc, the removed comments and code were not true any more, the default behavior will not be triggered not matter what the return value is, we handle the return value in Java side.","disapproval":false,"date":"2013-01-10 17:55:07.554180","approval":false},{"sender":"cpu@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","cpu@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"lgtm","disapproval":false,"date":"2013-01-11 19:15:32.142570","approval":true},{"sender":"commit-bot@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","cpu@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/michaelbai@chromium.org/11567061/29016","disapproval":false,"date":"2013-01-11 19:27:03.247210","approval":false},{"sender":"commit-bot@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","cpu@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"Retried try job too often on win7_aura for step(s) browser_tests","disapproval":false,"date":"2013-01-12 13:26:48.390700","approval":false},{"sender":"commit-bot@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","cpu@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/michaelbai@chromium.org/11567061/55001","disapproval":false,"date":"2013-01-14 19:40:55.061340","approval":false},{"sender":"commit-bot@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","cpu@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/michaelbai@chromium.org/11567061/55001","disapproval":false,"date":"2013-01-15 21:35:26.221330","approval":false},{"sender":"commit-bot@chromium.org","recipients":["michaelbai@chromium.org","klobag@chromium.org","joth@chromium.org","yfriedman@chromium.org","tedchoc@chromium.org","joi@chromium.org","cpu@chromium.org","chromium-reviews@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","jam@chromium.org","android-webview-reviews@chromium.org","jochen+watch@chromium.org"],"text":"Change committed as 176975","disapproval":false,"date":"2013-01-15 21:43:21.157130","approval":false}],"owner_email":"michaelbai@chromium.org","private":false,"base_url":"svn://svn.chromium.org/chrome/trunk/src","owner":"michaelbai","subject":"Throw exception when initialization failed.","created":"2012-12-21 19:53:36.012600","patchsets":[1,5001,21001,25001,28001,34001,29016,55001],"modified":"2013-01-15 21:43:21.299410","closed":true,"commit":false,"issue":11567061}