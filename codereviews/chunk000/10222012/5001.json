{"files":{"webkit/media/webmediaplayer_impl.cc":{"status":"M","num_chunks":7,"no_base_file":false,"property_changes":"","num_added":24,"num_removed":18,"messages":[{"author":"scherkus","author_email":"scherkus@chromium.org","text":"what is this DCHECK protecting us against?  that we haven't called StartPipeline()?\n\nI don't think it's adding much value so I'd remove it","draft":false,"lineno":255,"date":"2012-04-27 01:31:00.932007","left":false},{"author":"scherkus","author_email":"scherkus@chromium.org","text":"remove these DCHECKs -- they're useless as Chromium prefers null pointer crashes over superfluous DCHECKs\n\nin fact, you could just rewrite this as proxy_->video_decoder()->decryptor()->AddKey(...);","draft":false,"lineno":775,"date":"2012-04-27 01:31:00.932156","left":false},{"author":"ddorwin","author_email":"ddorwin@chromium.org","text":"On 2012/04/27 01:31:00, scherkus wrote:\n> what is this DCHECK protecting us against?  that we haven't called\n> StartPipeline()?\nYes. When we discussed this change, you said the only issue with moving the code was if the DataSourceInitialized() callback was called synchronously and thus before the demuxers and decoders were created.\n\n> \n> I don't think it's adding much value so I'd remove it\n\nOkay.","draft":false,"lineno":255,"date":"2012-04-27 02:34:50.544103","left":false},{"author":"ddorwin","author_email":"ddorwin@chromium.org","text":"On 2012/04/27 01:31:00, scherkus wrote:\n> remove these DCHECKs -- they're useless as Chromium prefers null pointer crashes\n> over superfluous DCHECKs\n> \n> in fact, you could just rewrite this as\n> proxy_->video_decoder()->decryptor()->AddKey(...);\n\nIf a null decoder is the cause of the flaky crashes, the null pointer crashes are not very helpful. For some reason, we don't actually crash when dereferencing the null pointer to make the call. Instead, we crash later in the lock code because the lock member doesn't exist. See the stacks in https://bugs.webkit.org/show_bug.cgi?id=84596.\n\n773 would cause an easy to see assert if such a race was introduced.\n\nI agree that the simpler code is preferred, but the crashes do not pinpoint the real cause. Is there something we can do to address the latter?","draft":false,"lineno":775,"date":"2012-04-27 02:34:50.544355","left":false},{"author":"ddorwin","author_email":"ddorwin@chromium.org","text":"On 2012/04/27 02:34:50, ddorwin wrote:\n> On 2012/04/27 01:31:00, scherkus wrote:\n> > what is this DCHECK protecting us against?  that we haven't called\n> > StartPipeline()?\n> Yes. When we discussed this change, you said the only issue with moving the code\n> was if the DataSourceInitialized() callback was called synchronously and thus\n> before the demuxers and decoders were created.\n> \n> > \n> > I don't think it's adding much value so I'd remove it\n> \n> Okay.\n\nDone.","draft":false,"lineno":255,"date":"2012-04-27 17:12:11.765371","left":false},{"author":"ddorwin","author_email":"ddorwin@chromium.org","text":"On 2012/04/27 02:34:50, ddorwin wrote:\n> On 2012/04/27 01:31:00, scherkus wrote:\n> > remove these DCHECKs -- they're useless as Chromium prefers null pointer\n> crashes\n> > over superfluous DCHECKs\n> > \n> > in fact, you could just rewrite this as\n> > proxy_->video_decoder()->decryptor()->AddKey(...);\n> \n> If a null decoder is the cause of the flaky crashes, the null pointer crashes\n> are not very helpful. For some reason, we don't actually crash when\n> dereferencing the null pointer to make the call. Instead, we crash later in the\n> lock code because the lock member doesn't exist. See the stacks in\n> https://bugs.webkit.org/show_bug.cgi?id=84596.\n> \n> 773 would cause an easy to see assert if such a race was introduced.\n> \n> I agree that the simpler code is preferred, but the crashes do not pinpoint the\n> real cause. Is there something we can do to address the latter?\n\nDone.","draft":false,"lineno":775,"date":"2012-04-27 17:12:11.765609","left":false},{"author":"scherkus","author_email":"scherkus@chromium.org","text":"On 2012/04/27 02:34:50, ddorwin wrote:\n> On 2012/04/27 01:31:00, scherkus wrote:\n> > remove these DCHECKs -- they're useless as Chromium prefers null pointer\n> crashes\n> > over superfluous DCHECKs\n> > \n> > in fact, you could just rewrite this as\n> > proxy_->video_decoder()->decryptor()->AddKey(...);\n> \n> If a null decoder is the cause of the flaky crashes, the null pointer crashes\n> are not very helpful. For some reason, we don't actually crash when\n> dereferencing the null pointer to make the call. Instead, we crash later in the\n> lock code because the lock member doesn't exist. See the stacks in\n> https://bugs.webkit.org/show_bug.cgi?id=84596.\n> \n> 773 would cause an easy to see assert if such a race was introduced.\n> \n> I agree that the simpler code is preferred, but the crashes do not pinpoint the\n> real cause. Is there something we can do to address the latter?\n\nAFAIK this is simply how C++ works.\n\nThe function call is always dispatched with the NULL |this| pointer pushed onto the stack/passed via register, hence the crash on invalid memory access when accessing |lock_| instead of before the function is executed.\n\nAt this point in time I'm simply used to looking up the call stack a bit in crash dumps to spot the real offender. For example, webkit_media::WebMediaPlayerImpl::addKey() would have the line number where the crash originated.","draft":false,"lineno":775,"date":"2012-04-27 17:39:22.120976","left":false}],"id":6001,"is_binary":false}},"owner_email":"ddorwin@chromium.org","owner":"ddorwin","message":"Changed decrypter => decryptor in existing comments.","try_job_results":[],"created":"2012-04-25 22:21:49.085725","url":null,"num_comments":7,"modified":"2012-04-27 17:39:22.186067","patchset":5001,"issue":10222012}