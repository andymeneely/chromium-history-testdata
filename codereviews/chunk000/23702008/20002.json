{"files":{"media/base/user_input_monitor_mac.cc":{"status":"M","num_chunks":2,"no_base_file":false,"property_changes":"","num_added":6,"num_removed":6,"messages":[],"id":6,"is_binary":false},"media/base/user_input_monitor_linux.cc":{"status":"M","num_chunks":11,"no_base_file":false,"property_changes":"","num_added":120,"num_removed":94,"messages":[{"author":"Wez","author_email":"wez@chromium.org","text":"You have to be careful using SupportsWeakPtr - WeakPtrs it dispenses are only invalidated when the base-class dtor runs, which only happens after the derived class and its members have been destroyed.\n\nI think it's cleaner here to have UserInputMonitorLinux create a WeakPtrFactory wrapping the Core, and to explicitly Invalidate() that before posting the deletion task for the Core.","draft":false,"lineno":41,"date":"2013-09-13 10:01:27.568430","left":false},{"author":"jiayl","author_email":"jiayl@chromium.org","text":"On 2013/09/13 10:01:27, Wez wrote:\n> You have to be careful using SupportsWeakPtr - WeakPtrs it dispenses are only\n> invalidated when the base-class dtor runs, which only happens after the derived\n> class and its members have been destroyed.\n> \n> I think it's cleaner here to have UserInputMonitorLinux create a WeakPtrFactory\n> wrapping the Core, and to explicitly Invalidate() that before posting the\n> deletion task for the Core.\n\nI don't think WeakPtrFactory in UserInputMonitorLinux will work, because we need to invalidate it on the monitoring thread, thus PostTask from the dtor of UserInputMonitorLinux. But the reference to WeakPtrFactory will be immediately invalid because UserInputMonitorLinux is destroyed.\n\nSupportsWeakPtr should not a problem in this use case. The WeakPtr's are only used on the monitoring thread. It's dereferenced either before or after the Core is fully destructed on the monitoring thread, not in the middle. If DeleteSoon fails and the Core is deleted on the browser main thread, that means the monitoring thread does not exist anymore so it doesn't matter.\n\n","draft":false,"lineno":41,"date":"2013-09-13 16:23:33.589280","left":false}],"id":5,"is_binary":false},"media/base/user_input_monitor.h":{"status":"M","num_chunks":4,"no_base_file":false,"property_changes":"","num_added":13,"num_removed":13,"messages":[{"author":"Wez","author_email":"wez@chromium.org","text":"nit: Name these two counters consistently, e.g. mouse_monitor_count_, keyboard_monitor_count_","draft":false,"lineno":81,"date":"2013-09-13 10:01:27.568120","left":false}],"id":4,"is_binary":false},"media/base/user_input_monitor_unittest.cc":{"status":"A","num_chunks":1,"no_base_file":false,"property_changes":"","num_added":72,"num_removed":0,"messages":[],"id":7,"is_binary":false},"media/media.gyp":{"status":"M","num_chunks":3,"no_base_file":false,"property_changes":"","num_added":7,"num_removed":2,"messages":[],"id":9,"is_binary":false},"media/base/user_input_monitor.cc":{"status":"M","num_chunks":3,"no_base_file":false,"property_changes":"","num_added":23,"num_removed":23,"messages":[],"id":3,"is_binary":false},"media/base/user_input_monitor_win.cc":{"status":"M","num_chunks":1,"no_base_file":false,"property_changes":"","num_added":285,"num_removed":3,"messages":[{"author":"Wez","author_email":"wez@chromium.org","text":"See comment on Linux impl re SupportsWeakPtr","draft":false,"lineno":30,"date":"2013-09-13 10:01:27.568720","left":false}],"id":8,"is_binary":false},"media/base/keyboard_event_counter.h":{"status":"M","num_chunks":2,"no_base_file":false,"property_changes":"","num_added":2,"num_removed":1,"messages":[],"id":2,"is_binary":false}},"owner_email":"jiayl@chromium.org","owner":"jiayl","message":" ","try_job_results":[{"parent_name":null,"tests":["base_unittests","browser_tests","cacheinvalidation_unittests","cc_unittests","check_deps","chrome_frame_net_tests","chrome_frame_tests","chrome_frame_unittests","chromedriver2_unittests","components_unittests","content_browsertests","content_unittests","crypto_unittests","gpu_unittests","installer_util_unittests","interactive_ui_tests","ipc_tests","jingle_unittests","media_unittests","mini_installer_test","nacl_integration","net_unittests","ppapi_unittests","printing_unittests","remoting_unittests","sql_unittests","sync_integration_tests","sync_unit_tests","telemetry_unittests","unit_tests"],"slave":"vm373-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/win_rel/builds/197180","timestamp":"2013-09-13 20:05:00.462199","builder":"win_rel","clobber":false,"project":"Chromium Try Server","reason":"CQ","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgIDAjJoKDA","requester":"commit-bot@chromium.org","buildnumber":"197180","revision":"HEAD"},{"parent_name":null,"tests":["ash_unittests","aura_unittests","browser_tests","compositor_unittests","content_browsertests","content_unittests","interactive_ui_tests","unit_tests","views_unittests"],"slave":"vm204-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/win7_aura/builds/78696","timestamp":"2013-09-13 17:54:59.300398","builder":"win7_aura","clobber":false,"project":"Chromium Try Server","reason":"CQ","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgIDAtKYKDA","requester":"commit-bot@chromium.org","buildnumber":"78696","revision":"HEAD"},{"parent_name":null,"tests":["aura_unittests","browser_tests","compositor_unittests","content_browsertests","content_unittests","interactive_ui_tests","unit_tests"],"slave":"vm497-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/linux_aura/builds/76990","timestamp":"2013-09-13 17:36:15.344535","builder":"linux_aura","clobber":false,"project":"Chromium Try Server","reason":"CQ","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgIDAhJEKDA","requester":"commit-bot@chromium.org","buildnumber":"76990","revision":"HEAD"},{"parent_name":null,"tests":["compile"],"slave":"vm525-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/win/builds/108456","timestamp":"2013-09-13 17:14:52.498674","builder":"win","clobber":false,"project":"Chromium Try Server","reason":"CQ","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgICAsYoJDA","requester":"commit-bot@chromium.org","buildnumber":"108456","revision":"HEAD"},{"parent_name":null,"tests":["compile"],"slave":"vm767-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/win_x64_rel/builds/37667","timestamp":"2013-09-13 17:12:37.789355","builder":"win_x64_rel","clobber":false,"project":"Chromium Try Server","reason":"CQ","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgIDArLIKDA","requester":"commit-bot@chromium.org","buildnumber":"37667","revision":"HEAD"},{"parent_name":null,"tests":["compile"],"slave":"vm733-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/mac/builds/85441","timestamp":"2013-09-13 17:11:15.098918","builder":"mac","clobber":true,"project":"Chromium Try Server","reason":"CQ","result":"2","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgIDAkogKDA","requester":"commit-bot@chromium.org","buildnumber":"85441","revision":"HEAD"},{"parent_name":"linux_rel","tests":["base_unittests_swarm","browser_tests_swarm","cacheinvalidation_unittests","cc_unittests","check_deps","chromedriver2_unittests","components_unittests","content_browsertests","content_unittests","crypto_unittests","gpu_unittests","interactive_ui_tests_swarm","ipc_tests","jingle_unittests","media_unittests","nacl_integration","net_unittests_swarm","ppapi_unittests","printing_unittests","remoting_unittests","sandbox_linux_unittests","sql_unittests","sync_integration_tests","sync_unit_tests","unit_tests_swarm"],"slave":"vm14-m4#12","url":"http://build.chromium.org/p/tryserver.chromium/builders/swarm_triggered/builds/42575","timestamp":"2013-09-13 17:08:55.239803","builder":"swarm_triggered","clobber":false,"project":"Chromium Try Server","reason":"Triggerable(swarm_triggered)","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgIDAgpQKDA","requester":null,"buildnumber":"42575","revision":"HEAD"},{"parent_name":null,"tests":["compile"],"slave":"slave529-c4","url":"http://build.chromium.org/p/tryserver.chromium/builders/android_aosp/builds/13179","timestamp":"2013-09-13 17:07:19.498145","builder":"android_aosp","clobber":false,"project":"Chromium Try Server","reason":"CQ","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgIDAqLUKDA","requester":"commit-bot@chromium.org","buildnumber":"13179","revision":"HEAD"},{"parent_name":null,"tests":["base_unittests","browser_tests","cacheinvalidation_unittests","cc_unittests","check_deps","chromedriver2_unittests","components_unittests","content_browsertests","content_unittests","crypto_unittests","gpu_unittests","interactive_ui_tests","ipc_tests","jingle_unittests","media_unittests","nacl_integration","net_unittests","ppapi_unittests","printing_unittests","remoting_unittests","sql_unittests","sync_integration_tests","sync_unit_tests","telemetry_unittests","unit_tests"],"slave":"vm707-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/mac_rel/builds/168721","timestamp":"2013-09-13 17:06:31.856670","builder":"mac_rel","clobber":true,"project":"Chromium Try Server","reason":"CQ","result":"2","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgIDAorgKDA","requester":"commit-bot@chromium.org","buildnumber":"168721","revision":"HEAD"},{"parent_name":null,"tests":["app_list_unittests","ash_unittests","aura_unittests","base_unittests","browser_tests","cacheinvalidation_unittests","check_deps","chromeos_unittests","components_unittests","content_browsertests","content_unittests","crypto_unittests","dbus_unittests","device_unittests","gpu_unittests","interactive_ui_tests","ipc_tests","jingle_unittests","media_unittests","net_unittests","ppapi_unittests","printing_unittests","sandbox_linux_unittests","sql_unittests","sync_unit_tests","unit_tests"],"slave":"slave358-c4","url":"http://build.chromium.org/p/tryserver.chromium/builders/linux_chromeos/builds/154210","timestamp":"2013-09-13 17:05:10.053709","builder":"linux_chromeos","clobber":false,"project":"Chromium Try Server","reason":"CQ","result":"2","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgICA9I4LDA","requester":"commit-bot@chromium.org","buildnumber":"154210","revision":"HEAD"},{"parent_name":null,"tests":["base_unittests_swarm","browser_tests_swarm","cacheinvalidation_unittests","cc_unittests","check_deps","chromedriver2_unittests","components_unittests","content_browsertests","content_unittests","crypto_unittests","gpu_unittests","interactive_ui_tests_swarm","ipc_tests","jingle_unittests","media_unittests","nacl_integration","net_unittests_swarm","ppapi_unittests","printing_unittests","remoting_unittests","sandbox_linux_unittests","sql_unittests","sync_integration_tests","sync_unit_tests","unit_tests_swarm"],"slave":"slave325-c4","url":"http://build.chromium.org/p/tryserver.chromium/builders/linux_rel/builds/167964","timestamp":"2013-09-13 16:56:21.083868","builder":"linux_rel","clobber":false,"project":"Chromium Try Server","reason":"CQ","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgICA7bMLDA","requester":"commit-bot@chromium.org","buildnumber":"167964","revision":"HEAD"},{"parent_name":null,"tests":["slave_steps"],"slave":"vm402-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/android_dbg/builds/102760","timestamp":"2013-09-13 16:56:14.684540","builder":"android_dbg","clobber":true,"project":"Chromium Try Server","reason":"CQ","result":"2","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgIDAvKwKDA","requester":"commit-bot@chromium.org","buildnumber":"102760","revision":"HEAD"},{"parent_name":null,"tests":["slave_steps"],"slave":"vm386-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/android_clang_dbg/builds/76422","timestamp":"2013-09-13 16:53:46.364987","builder":"android_clang_dbg","clobber":true,"project":"Chromium Try Server","reason":"CQ","result":"2","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgIDAnIIKDA","requester":"commit-bot@chromium.org","buildnumber":"76422","revision":"HEAD"},{"parent_name":null,"tests":["compile"],"slave":"slave379-c4","url":"http://build.chromium.org/p/tryserver.chromium/builders/linux_clang/builds/139584","timestamp":"2013-09-13 16:49:05.742540","builder":"linux_clang","clobber":false,"project":"Chromium Try Server","reason":"CQ","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgIDApL4KDA","requester":"commit-bot@chromium.org","buildnumber":"139584","revision":"HEAD"},{"parent_name":null,"tests":["base_unittests","compile","content_unittests","crypto_unittests","net_unittests","sql_unittests","ui_unittests","url_unittests"],"slave":"mini20-l1","url":"http://build.chromium.org/p/tryserver.chromium/builders/ios_dbg_simulator/builds/85389","timestamp":"2013-09-13 16:48:52.947928","builder":"ios_dbg_simulator","clobber":false,"project":"Chromium Try Server","reason":"CQ","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgIDAuKkKDA","requester":"commit-bot@chromium.org","buildnumber":"85389","revision":"HEAD"},{"parent_name":null,"tests":["compile"],"slave":"vm734-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/mac/builds/85436","timestamp":"2013-09-13 16:46:21.663442","builder":"mac","clobber":false,"project":"Chromium Try Server","reason":"CQ","result":"2","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgICA9M4IDA","requester":"commit-bot@chromium.org","buildnumber":"85436","revision":"HEAD"},{"parent_name":null,"tests":["compile"],"slave":"slave313-c4","url":"http://build.chromium.org/p/tryserver.chromium/builders/linux_chromeos_clang/builds/47214","timestamp":"2013-09-13 16:46:20.108725","builder":"linux_chromeos_clang","clobber":false,"project":"Chromium Try Server","reason":"CQ","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgIDAiJ0JDA","requester":"commit-bot@chromium.org","buildnumber":"47214","revision":"HEAD"},{"parent_name":null,"tests":["base_unittests","browser_tests","cacheinvalidation_unittests","cc_unittests","check_deps","chromedriver2_unittests","components_unittests","content_browsertests","content_unittests","crypto_unittests","gpu_unittests","interactive_ui_tests","ipc_tests","jingle_unittests","media_unittests","nacl_integration","net_unittests","ppapi_unittests","printing_unittests","remoting_unittests","sql_unittests","sync_integration_tests","sync_unit_tests","telemetry_unittests","unit_tests"],"slave":"vm705-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/mac_rel/builds/168716","timestamp":"2013-09-13 16:46:11.777054","builder":"mac_rel","clobber":false,"project":"Chromium Try Server","reason":"CQ","result":"2","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgIDAlI4KDA","requester":"commit-bot@chromium.org","buildnumber":"168716","revision":"HEAD"},{"parent_name":null,"tests":["slave_steps"],"slave":"vm385-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/android_dbg/builds/102757","timestamp":"2013-09-13 16:42:15.264941","builder":"android_dbg","clobber":false,"project":"Chromium Try Server","reason":"CQ","result":"2","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgIDAmIUKDA","requester":"commit-bot@chromium.org","buildnumber":"102757","revision":"HEAD"},{"parent_name":null,"tests":["compile"],"slave":"mini28-l1","url":"http://build.chromium.org/p/tryserver.chromium/builders/ios_rel_device/builds/80321","timestamp":"2013-09-13 16:40:52.971465","builder":"ios_rel_device","clobber":false,"project":"Chromium Try Server","reason":"CQ","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgIDAoLsJDA","requester":"commit-bot@chromium.org","buildnumber":"80321","revision":"HEAD"},{"parent_name":null,"tests":["slave_steps"],"slave":"vm393-m4","url":"http://build.chromium.org/p/tryserver.chromium/builders/android_clang_dbg/builds/76420","timestamp":"2013-09-13 16:40:44.071569","builder":"android_clang_dbg","clobber":false,"project":"Chromium Try Server","reason":"CQ","result":"2","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgICAga4LDA","requester":"commit-bot@chromium.org","buildnumber":"76420","revision":"HEAD"},{"parent_name":null,"tests":["presubmit"],"slave":"slave303-c4","url":"http://build.chromium.org/p/tryserver.chromium/builders/chromium_presubmit/builds/25360","timestamp":"2013-09-13 16:34:16.219704","builder":"chromium_presubmit","clobber":false,"project":"Chromium Try Server","reason":"CQ","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnI3CxIFSXNzdWUY-NOmCwwLEghQYXRjaFNldBiinAEMCxIMVHJ5Sm9iUmVzdWx0GICAgIDAiJ0KDA","requester":"commit-bot@chromium.org","buildnumber":"25360","revision":"HEAD"}],"created":"2013-09-12 19:16:45.496530","url":null,"num_comments":4,"modified":"2013-09-13 16:23:33.628820","patchset":20002,"issue":23702008}