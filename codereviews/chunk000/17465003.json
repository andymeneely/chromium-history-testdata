{"description":"Fix most tests in //components/autofill/content to not depend on //chrome.\n\nBUG=140037\n\nCommitted: https://src.chromium.org/viewvc/chrome?view=rev&revision=207859","cc":["chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","jam@chromium.org","ahutter@chromium.org","browser-components-watch@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","abodenha@chromium.org","estade+watch@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"reviewers":["blundell@chromium.org","isherman@chromium.org","phajdan.jr@chromium.org"],"messages":[{"sender":"joi@chromium.org","recipients":["joi@chromium.org","blundell@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","jam@chromium.org","ahutter@chromium.org","browser-components-watch@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","abodenha@chromium.org","estade+watch@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"","disapproval":false,"date":"2013-06-19 14:04:06.679330","approval":false},{"sender":"blundell@chromium.org","recipients":["joi@chromium.org","blundell@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","jam@chromium.org","ahutter@chromium.org","browser-components-watch@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","abodenha@chromium.org","estade+watch@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"https://codereview.chromium.org/17465003/diff/5001/components/autofill/content/browser/autocheckout/whitelist_manager_unittest.cc\nFile components/autofill/content/browser/autocheckout/whitelist_manager_unittest.cc (left):\n\nhttps://codereview.chromium.org/17465003/diff/5001/components/autofill/content/browser/autocheckout/whitelist_manager_unittest.cc#oldcode97\ncomponents/autofill/content/browser/autocheckout/whitelist_manager_unittest.cc:97: profile_.CreateRequestContext();\nWhy is it OK to remove these calls (here and in the other tests)?\n\nhttps://codereview.chromium.org/17465003/diff/5001/components/autofill/content/browser/wallet/encryption_escrow_client_unittest.cc\nFile components/autofill/content/browser/wallet/encryption_escrow_client_unittest.cc (right):\n\nhttps://codereview.chromium.org/17465003/diff/5001/components/autofill/content/browser/wallet/encryption_escrow_client_unittest.cc#newcode112\ncomponents/autofill/content/browser/wallet/encryption_escrow_client_unittest.cc:112: content::TestBrowserThread io_thread_;\nIs this still needed?","disapproval":false,"date":"2013-06-19 15:34:52.222080","approval":false},{"sender":"joi@chromium.org","recipients":["joi@chromium.org","blundell@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","jam@chromium.org","ahutter@chromium.org","browser-components-watch@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","abodenha@chromium.org","estade+watch@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"https://codereview.chromium.org/17465003/diff/5001/components/autofill/content/browser/autocheckout/whitelist_manager_unittest.cc\nFile components/autofill/content/browser/autocheckout/whitelist_manager_unittest.cc (left):\n\nhttps://codereview.chromium.org/17465003/diff/5001/components/autofill/content/browser/autocheckout/whitelist_manager_unittest.cc#oldcode97\ncomponents/autofill/content/browser/autocheckout/whitelist_manager_unittest.cc:97: profile_.CreateRequestContext();\nOn 2013/06/19 15:34:52, blundell wrote:\n> Why is it OK to remove these calls (here and in the other tests)?\n\nIn this test, because the URLRequestContextGetter that this creates is not actually being used.\n\nIn the other tests, because content::TestBrowserContext which replaces TestingProfile, creates the URLRequestContextGetter implicitly, not on a specific method call.\n\nTests pass fine after the change, at least locally and I am hopeful on trybots too.\n\nhttps://codereview.chromium.org/17465003/diff/5001/components/autofill/content/browser/wallet/encryption_escrow_client_unittest.cc\nFile components/autofill/content/browser/wallet/encryption_escrow_client_unittest.cc (right):\n\nhttps://codereview.chromium.org/17465003/diff/5001/components/autofill/content/browser/wallet/encryption_escrow_client_unittest.cc#newcode112\ncomponents/autofill/content/browser/wallet/encryption_escrow_client_unittest.cc:112: content::TestBrowserThread io_thread_;\nOn 2013/06/19 15:34:52, blundell wrote:\n> Is this still needed?\n\nI'm not sure; let me test.","disapproval":false,"date":"2013-06-19 15:38:04.011300","approval":false},{"sender":"joi@chromium.org","recipients":["joi@chromium.org","blundell@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","jam@chromium.org","ahutter@chromium.org","browser-components-watch@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","abodenha@chromium.org","estade+watch@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"Looks like the io_thread_ thing was no longer needed in a couple of tests; uploaded a new patchset that removes it.\n\nCheers,\nJói","disapproval":false,"date":"2013-06-19 17:37:19.464800","approval":false},{"sender":"blundell@chromium.org","recipients":["joi@chromium.org","blundell@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","jam@chromium.org","ahutter@chromium.org","browser-components-watch@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","abodenha@chromium.org","estade+watch@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"lgtm\n\nThanks for the explanations!","disapproval":false,"date":"2013-06-19 17:53:21.933710","approval":true},{"sender":"joi@chromium.org","recipients":["joi@chromium.org","blundell@chromium.org","isherman@chromium.org","phajdan.jr@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","jam@chromium.org","ahutter@chromium.org","browser-components-watch@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","abodenha@chromium.org","estade+watch@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"+isherman@ to sanity check removal of TestBrowserThread IO thread thingies from tests (blundell@ already reviewed the change).\n\n+phajdan.jr@ for \"new\" DEPS for //chrome/browser/test (actually just moving an existing one I think).","disapproval":false,"date":"2013-06-19 18:06:18.774630","approval":false},{"sender":"phajdan.jr@chromium.org","recipients":["joi@chromium.org","blundell@chromium.org","isherman@chromium.org","phajdan.jr@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","jam@chromium.org","ahutter@chromium.org","browser-components-watch@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","abodenha@chromium.org","estade+watch@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"LGTM with a comment.\n\nhttps://codereview.chromium.org/17465003/diff/12001/components/autofill/content/browser/DEPS\nFile components/autofill/content/browser/DEPS (right):\n\nhttps://codereview.chromium.org/17465003/diff/12001/components/autofill/content/browser/DEPS#newcode33\ncomponents/autofill/content/browser/DEPS:33: \"+chrome/test/base/chrome_render_view_host_test_harness.h\",\nWhy not \"!\" ?","disapproval":false,"date":"2013-06-19 23:00:03.730980","approval":true},{"sender":"isherman@chromium.org","recipients":["joi@chromium.org","blundell@chromium.org","isherman@chromium.org","phajdan.jr@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","jam@chromium.org","ahutter@chromium.org","browser-components-watch@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","abodenha@chromium.org","estade+watch@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"Drive-by LGTM with a nit:\n\nhttps://codereview.chromium.org/17465003/diff/12001/components/autofill/browser/autofill_common_test.h\nFile components/autofill/browser/autofill_common_test.h (right):\n\nhttps://codereview.chromium.org/17465003/diff/12001/components/autofill/browser/autofill_common_test.h#newcode73\ncomponents/autofill/browser/autofill_common_test.h:73: void DisableSystemServices(content::BrowserContext* profile);\nnit: Please update the variable name here.","disapproval":false,"date":"2013-06-19 23:06:14.651430","approval":true},{"sender":"joi@chromium.org","recipients":["joi@chromium.org","blundell@chromium.org","isherman@chromium.org","phajdan.jr@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","jam@chromium.org","ahutter@chromium.org","browser-components-watch@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","abodenha@chromium.org","estade+watch@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"https://codereview.chromium.org/17465003/diff/12001/components/autofill/browser/autofill_common_test.h\nFile components/autofill/browser/autofill_common_test.h (right):\n\nhttps://codereview.chromium.org/17465003/diff/12001/components/autofill/browser/autofill_common_test.h#newcode73\ncomponents/autofill/browser/autofill_common_test.h:73: void DisableSystemServices(content::BrowserContext* profile);\nOn 2013/06/19 23:06:14, Ilya Sherman wrote:\n> nit: Please update the variable name here.\n\nDone.\n\nhttps://codereview.chromium.org/17465003/diff/12001/components/autofill/content/browser/DEPS\nFile components/autofill/content/browser/DEPS (right):\n\nhttps://codereview.chromium.org/17465003/diff/12001/components/autofill/content/browser/DEPS#newcode33\ncomponents/autofill/content/browser/DEPS:33: \"+chrome/test/base/chrome_render_view_host_test_harness.h\",\nOn 2013/06/19 23:00:04, Paweł Hajdan Jr. wrote:\n> Why not \"!\" ?\n\nFixed to use ! here and line below.","disapproval":false,"date":"2013-06-21 13:13:23.616670","approval":false},{"sender":"commit-bot@chromium.org","recipients":["joi@chromium.org","blundell@chromium.org","isherman@chromium.org","phajdan.jr@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","jam@chromium.org","ahutter@chromium.org","browser-components-watch@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","abodenha@chromium.org","estade+watch@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/joi@chromium.org/17465003/21002","disapproval":false,"date":"2013-06-21 13:13:54.906720","approval":false},{"sender":"commit-bot@chromium.org","recipients":["joi@chromium.org","blundell@chromium.org","isherman@chromium.org","phajdan.jr@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","jam@chromium.org","ahutter@chromium.org","browser-components-watch@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","abodenha@chromium.org","estade+watch@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"Failed to apply patch for components/autofill/browser/autofill_common_test.cc:\nWhile running patch -p1 --forward --force --no-backup-if-mismatch;\n  can't find file to patch at input line 6\n  Perhaps you used the wrong -p or --strip option?\n  The text leading up to this was:\n  --------------------------\n  |Index: components/autofill/browser/autofill_common_test.cc\n  |diff --git a/components/autofill/browser/autofill_common_test.cc b/components/autofill/browser/autofill_common_test.cc\n  |index cd33530a34bb4c02aa81a135411ebb296170aac6..03e1bfabe60d584b9960ffdca46ea1a5c60f3273 100644\n  |--- a/components/autofill/browser/autofill_common_test.cc\n  |+++ b/components/autofill/browser/autofill_common_test.cc\n  --------------------------\n  No file to patch.  Skipping patch.\n  3 out of 3 hunks ignored\n\nPatch:       components/autofill/browser/autofill_common_test.cc\nIndex: components/autofill/browser/autofill_common_test.cc\ndiff --git a/components/autofill/browser/autofill_common_test.cc b/components/autofill/browser/autofill_common_test.cc\nindex cd33530a34bb4c02aa81a135411ebb296170aac6..03e1bfabe60d584b9960ffdca46ea1a5c60f3273 100644\n--- a/components/autofill/browser/autofill_common_test.cc\n+++ b/components/autofill/browser/autofill_common_test.cc\n@@ -7,13 +7,13 @@\n #include \"base/guid.h\"\n #include \"base/prefs/pref_service.h\"\n #include \"base/strings/utf_string_conversions.h\"\n-#include \"chrome/browser/profiles/profile.h\"\n #include \"components/autofill/browser/autofill_profile.h\"\n #include \"components/autofill/browser/credit_card.h\"\n #include \"components/autofill/core/common/autofill_pref_names.h\"\n #include \"components/autofill/core/common/form_field_data.h\"\n #include \"components/user_prefs/user_prefs.h\"\n #include \"components/webdata/encryptor/encryptor.h\"\n+#include \"content/public/browser/browser_context.h\"\n \n namespace autofill {\n namespace test {\n@@ -142,7 +142,7 @@ void SetCreditCardInfo(CreditCard* credit_card,\n   check_and_set(credit_card, CREDIT_CARD_EXP_4_DIGIT_YEAR, expiration_year);\n }\n \n-void DisableSystemServices(Profile* profile) {\n+void DisableSystemServices(content::BrowserContext* browser_context) {\n   // Use a mock Keychain rather than the OS one to store credit card data.\n #if defined(OS_MACOSX)\n   Encryptor::UseMockKeychain(true);\n@@ -150,8 +150,8 @@ void DisableSystemServices(Profile* profile) {\n \n   // Disable auxiliary profiles for unit testing.  These reach out to system\n   // services on the Mac.\n-  if (profile) {\n-    user_prefs::UserPrefs::Get(profile)->SetBoolean(\n+  if (browser_context) {\n+    user_prefs::UserPrefs::Get(browser_context)->SetBoolean(\n         prefs::kAutofillAuxiliaryProfilesEnabled, false);\n   }\n }","disapproval":false,"date":"2013-06-21 13:13:58.800550","approval":false},{"sender":"commit-bot@chromium.org","recipients":["joi@chromium.org","blundell@chromium.org","isherman@chromium.org","phajdan.jr@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","jam@chromium.org","ahutter@chromium.org","browser-components-watch@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","abodenha@chromium.org","estade+watch@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/joi@chromium.org/17465003/22009","disapproval":false,"date":"2013-06-21 13:40:32.216530","approval":false},{"sender":"commit-bot@chromium.org","recipients":["joi@chromium.org","blundell@chromium.org","isherman@chromium.org","phajdan.jr@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","jam@chromium.org","ahutter@chromium.org","browser-components-watch@chromium.org","joi+watch-content@chromium.org","darin-cc@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","abodenha@chromium.org","estade+watch@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"Change committed as 207859","disapproval":false,"date":"2013-06-21 16:41:19.143280","approval":false}],"owner_email":"joi@chromium.org","private":false,"base_url":"svn://svn.chromium.org/chrome/trunk/src","owner":"Jói","subject":"Fix most tests in //components/autofill/content to not depend on //chrome.","created":"2013-06-19 14:03:22.464460","patchsets":[1,5001,12001,21002,22009],"modified":"2013-06-21 16:41:19.471360","closed":true,"commit":false,"issue":17465003}