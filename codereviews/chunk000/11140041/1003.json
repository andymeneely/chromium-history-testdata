{"files":{"ash/desktop_background/desktop_background_view.cc":{"status":"M","num_chunks":2,"no_base_file":false,"property_changes":"","num_added":5,"num_removed":0,"messages":[{"author":"hshi1","author_email":"hshi@chromium.org","text":"Why does deleting \"this\" prevent it from being called? \n\nAt line 70 we're already removing this from observers list, shouldn't it prevent future calls to OnImplicitAnimationsCompleted() from ui::LayerAnimationSequence::NotifyEnded()?","draft":false,"lineno":75,"date":"2012-10-16 00:21:26.366270","left":false},{"author":"bshe","author_email":"bshe@chromium.org","text":"I am guessing OnImplicitAnimationsCompleted() is called by ui::ImplicitAnimationObserver? So removing it from widget observer may not prevent it get called. After deleting \"this\", the ui::ImplicitAnimationObserver became invalid somehow?\n\nOn 2012/10/16 00:21:26, hshi1 wrote:\n> Why does deleting \"this\" prevent it from being called? \n> \n> At line 70 we're already removing this from observers list, shouldn't it prevent\n> future calls to OnImplicitAnimationsCompleted() from\n> ui::LayerAnimationSequence::NotifyEnded()?\n\n","draft":false,"lineno":75,"date":"2012-10-16 00:45:59.444440","left":false},{"author":"Ian Vollick","author_email":"vollick@chromium.org","text":"On 2012/10/16 00:45:59, bshe wrote:\n> I am guessing OnImplicitAnimationsCompleted() is called by\n> ui::ImplicitAnimationObserver? So removing it from widget observer may not\n> prevent it get called. After deleting \"this\", the ui::ImplicitAnimationObserver\n> became invalid somehow?\n> \n> On 2012/10/16 00:21:26, hshi1 wrote:\n> > Why does deleting \"this\" prevent it from being called? \n> > \n> > At line 70 we're already removing this from observers list, shouldn't it\n> prevent\n> > future calls to OnImplicitAnimationsCompleted() from\n> > ui::LayerAnimationSequence::NotifyEnded()?\n> \nThe ShowWallpaperAnimationObserver is both an animation and a widget observer. The call on line 70 stops this instance from observing the widget, but it is still registered with the animation controller. If we 'delete this' code in ~LayerAnimationObserver will ensure that we stop listening to any *running* animations, but this is not a silver bullet! The observer's destructor does not detach it from any layer animators, so it's quite possible that we could be attached to another animation after we've called 'delete this' leading to crashes, etc. I actually think this is buggy behavior (I've logged http://code.google.com/p/chromium/issues/detail?id=156071 to track this), but in the meantime, I would suggest preceding the 'delete this' line with desktop_widget_->...->layer()->GetAnimator()->RemoveObserver(this)","draft":false,"lineno":75,"date":"2012-10-16 13:29:32.288850","left":false}],"id":2001,"is_binary":false},"ash/wm/window_animations.cc":{"status":"M","num_chunks":2,"no_base_file":false,"property_changes":"","num_added":1,"num_removed":1,"messages":[],"id":2002,"is_binary":false}},"owner_email":"bshe@chromium.org","owner":"bshe","message":"Please review this patch","try_job_results":[],"created":"2012-10-15 23:54:56.670610","url":null,"num_comments":3,"modified":"2012-10-16 13:29:32.324680","patchset":1003,"issue":11140041}