{"files":{"ash/desktop_background/desktop_background_view.cc":{"status":"M","num_chunks":2,"no_base_file":false,"property_changes":"","num_added":9,"num_removed":0,"messages":[{"author":"sky","author_email":"sky@chromium.org","text":"Comments should describe why code is the way it is. You shouldn't have to go to a bug to figure out it. Document the issue here.","draft":false,"lineno":71,"date":"2012-10-16 17:38:36.098520","left":false},{"author":"sky","author_email":"sky@chromium.org","text":"Can you remove 75 and 70 now so that the destructor does the cleanup?","draft":false,"lineno":75,"date":"2012-10-16 17:38:36.098710","left":false},{"author":"sky","author_email":"sky@chromium.org","text":"How does the code in OnImplicitAnimationsCompleted() get run if you delete this here?","draft":false,"lineno":76,"date":"2012-10-16 17:38:36.098880","left":false},{"author":"oshima","author_email":"oshima@chromium.org","text":"Looks like animator doesn't seem to have *this* observer (see my comment below) and it's failing to remove it, yet the observer gets called at the end, which leads to the crash.","draft":false,"lineno":74,"date":"2012-10-16 22:32:51.011600","left":false},{"author":"oshima","author_email":"oshima@chromium.org","text":"Doing this while there is animation may be causing the issue? Won't this override and delete current animation, and/or causes inconsistency?\n","draft":false,"lineno":196,"date":"2012-10-16 22:32:51.011810","left":false},{"author":"bshe","author_email":"bshe@chromium.org","text":"After discussed with vollick, it seems using StopObservingImplicitAnimations is a better alternative. And moved it in destructor.\n\nOn 2012/10/16 17:38:36, sky wrote:\n> Comments should describe why code is the way it is. You shouldn't have to go to\n> a bug to figure out it. Document the issue here.\n\n","draft":false,"lineno":71,"date":"2012-10-17 17:40:41.851870","left":false},{"author":"bshe","author_email":"bshe@chromium.org","text":"It looks like the animator have *this* observer. It is just when we remove *this* observer, we call OnImplicitAnimationsCompleted. It then execute 'delete this'. And after removed the observer, we then execute 'delete this' again in line 79. The second call to 'delete this' caused the crash.\n\nOn 2012/10/16 22:32:51, oshima wrote:\n> Looks like animator doesn't seem to have *this* observer (see my comment below)\n> and it's failing to remove it, yet the observer gets called at the end, which\n> leads to the crash.\n\n","draft":false,"lineno":74,"date":"2012-10-17 17:40:41.852140","left":false},{"author":"bshe","author_email":"bshe@chromium.org","text":"Keep it since I dont use 'delete this' here anymore.\n\nOn 2012/10/16 17:38:36, sky wrote:\n> Can you remove 75 and 70 now so that the destructor does the cleanup?\n\n","draft":false,"lineno":75,"date":"2012-10-17 17:40:41.852390","left":false},{"author":"bshe","author_email":"bshe@chromium.org","text":"I originally want to prevent OnImplicitAnimationsCompleted from being run when widget closed. So I use 'delete this' here.\nIt can fix the black screen problem. But after discussion with vollick, it seems make sure it got run all the time is a better option. Please see my latest patch.\nPreviously, OnImplicitAnimationsCompleted may or maynot run when user switches wallpaper really fast.\n\nOn 2012/10/16 17:38:36, sky wrote:\n> How does the code in OnImplicitAnimationsCompleted() get run if you delete this\n> here?\n\n","draft":false,"lineno":76,"date":"2012-10-17 17:40:41.852620","left":false},{"author":"bshe","author_email":"bshe@chromium.org","text":"I am not sure if it override and delete current animation. vollick@ may have better answer?\n\nIf you are referring the crash issue here. It should not because of this since the latest patch do not crash ash_shell.\n\nOn 2012/10/16 22:32:51, oshima wrote:\n> Doing this while there is animation may be causing the issue? Won't this\n> override and delete current animation, and/or causes inconsistency?\n\n","draft":false,"lineno":196,"date":"2012-10-17 17:40:41.852890","left":false}],"id":18001,"is_binary":false},"ash/wm/window_animations.cc":{"status":"M","num_chunks":2,"no_base_file":false,"property_changes":"","num_added":1,"num_removed":1,"messages":[{"author":"sky","author_email":"sky@chromium.org","text":"How was this code ever working? Wouldn't this mean all windows didn't show anything until the animation was done?","draft":false,"lineno":252,"date":"2012-10-16 17:38:36.099060","left":true},{"author":"bshe","author_email":"bshe@chromium.org","text":"This is suggested by vollick@. It seems it is doing the opposite as you describe. If we keep it in this scope, the window didn't show anything until animation was done.\n\nOn 2012/10/16 17:38:36, sky wrote:\n> How was this code ever working? Wouldn't this mean all windows didn't show\n> anything until the animation was done?\n\n","draft":false,"lineno":252,"date":"2012-10-17 17:40:41.853160","left":true},{"author":"sky","author_email":"sky@chromium.org","text":"On 2012/10/17 17:40:41, bshe wrote:\n> This is suggested by vollick@. It seems it is doing the opposite as you\n> describe. If we keep it in this scope, the window didn't show anything until\n> animation was done.\n> \n> On 2012/10/16 17:38:36, sky wrote:\n> > How was this code ever working? Wouldn't this mean all windows didn't show\n> > anything until the animation was done?\n> \n\nI think the new code makes sense. What I was confused by was how it ever worked.","draft":false,"lineno":252,"date":"2012-10-22 16:51:03.566500","left":true}],"id":18002,"is_binary":false}},"owner_email":"bshe@chromium.org","owner":"bshe","message":"Add comment and rebase to master","try_job_results":[{"parent_name":null,"tests":[],"slave":"vm318-m4","url":"http://build.chromium.org/p/tryserver.chromium/buildstatus?builder=win&number=32576","timestamp":"2012-10-16 20:53:07.377576","builder":"win","clobber":false,"project":"Chromium Try Server","reason":"","result":"2","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIxCxIFSXNzdWUYyfenBQwLEghQYXRjaFNldBjKZQwLEgxUcnlKb2JSZXN1bHQYw5QBDA","requester":"bshe@chromium.org","buildnumber":"32576","revision":"162133"},{"parent_name":null,"tests":[],"slave":"vm362-m4","url":"http://build.chromium.org/p/tryserver.chromium/buildstatus?builder=win_rel&number=70958","timestamp":"2012-10-16 19:35:31.588681","builder":"win_rel","clobber":false,"project":"Chromium Try Server","reason":"","result":"2","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIxCxIFSXNzdWUYyfenBQwLEghQYXRjaFNldBjKZQwLEgxUcnlKb2JSZXN1bHQYxJQBDA","requester":"bshe@chromium.org","buildnumber":"70958","revision":"162133"},{"parent_name":null,"tests":[],"slave":"vm411-m4","url":"http://build.chromium.org/p/tryserver.chromium/buildstatus?builder=linux_chromeos_asan&number=1425","timestamp":"2012-10-16 18:14:36.982352","builder":"linux_chromeos_asan","clobber":false,"project":"Chromium Try Server","reason":"","result":"2","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIxCxIFSXNzdWUYyfenBQwLEghQYXRjaFNldBjKZQwLEgxUcnlKb2JSZXN1bHQYvpQBDA","requester":"bshe@chromium.org","buildnumber":"1425","revision":"162133"},{"parent_name":null,"tests":[],"slave":"slave17-b1","url":"http://build.chromium.org/p/tryserver.chromium/buildstatus?builder=linux&number=3549","timestamp":"2012-10-16 18:05:39.353763","builder":"linux","clobber":false,"project":"Chromium Try Server","reason":"","result":"2","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIxCxIFSXNzdWUYyfenBQwLEghQYXRjaFNldBjKZQwLEgxUcnlKb2JSZXN1bHQYu5QBDA","requester":"bshe@chromium.org","buildnumber":"3549","revision":"162133"},{"parent_name":null,"tests":[],"slave":"vm621-m4","url":"http://build.chromium.org/p/tryserver.chromium/buildstatus?builder=mac&number=12310","timestamp":"2012-10-16 17:59:38.433791","builder":"mac","clobber":false,"project":"Chromium Try Server","reason":"","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIxCxIFSXNzdWUYyfenBQwLEghQYXRjaFNldBjKZQwLEgxUcnlKb2JSZXN1bHQYwZQBDA","requester":"bshe@chromium.org","buildnumber":"12310","revision":"162133"},{"parent_name":null,"tests":[],"slave":"slave28-b1","url":"http://build.chromium.org/p/tryserver.chromium/buildstatus?builder=linux_rel&number=65992","timestamp":"2012-10-16 17:41:59.063330","builder":"linux_rel","clobber":false,"project":"Chromium Try Server","reason":"","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIxCxIFSXNzdWUYyfenBQwLEghQYXRjaFNldBjKZQwLEgxUcnlKb2JSZXN1bHQYwJQBDA","requester":"bshe@chromium.org","buildnumber":"65992","revision":"162133"},{"parent_name":null,"tests":[],"slave":"build5-m4","url":"http://build.chromium.org/p/tryserver.chromium/buildstatus?builder=cros_x86&number=913","timestamp":"2012-10-16 17:29:02.079185","builder":"cros_x86","clobber":false,"project":"Chromium Try Server","reason":"","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIxCxIFSXNzdWUYyfenBQwLEghQYXRjaFNldBjKZQwLEgxUcnlKb2JSZXN1bHQYupQBDA","requester":"bshe@chromium.org","buildnumber":"913","revision":"162133"},{"parent_name":null,"tests":[],"slave":"vm632-m4","url":"http://build.chromium.org/p/tryserver.chromium/buildstatus?builder=mac_rel&number=64165","timestamp":"2012-10-16 17:12:40.144294","builder":"mac_rel","clobber":false,"project":"Chromium Try Server","reason":"","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIxCxIFSXNzdWUYyfenBQwLEghQYXRjaFNldBjKZQwLEgxUcnlKb2JSZXN1bHQYwpQBDA","requester":"bshe@chromium.org","buildnumber":"64165","revision":"162133"},{"parent_name":null,"tests":[],"slave":"slave37-b1","url":"http://build.chromium.org/p/tryserver.chromium/buildstatus?builder=linux_chromeos&number=49524","timestamp":"2012-10-16 16:50:13.625780","builder":"linux_chromeos","clobber":false,"project":"Chromium Try Server","reason":"","result":"2","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIxCxIFSXNzdWUYyfenBQwLEghQYXRjaFNldBjKZQwLEgxUcnlKb2JSZXN1bHQYvZQBDA","requester":"bshe@chromium.org","buildnumber":"49524","revision":"162133"},{"parent_name":null,"tests":[],"slave":"vm421-m4","url":"http://build.chromium.org/p/tryserver.chromium/buildstatus?builder=linux_aura&number=1135","timestamp":"2012-10-16 16:38:40.445263","builder":"linux_aura","clobber":false,"project":"Chromium Try Server","reason":"","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIxCxIFSXNzdWUYyfenBQwLEghQYXRjaFNldBjKZQwLEgxUcnlKb2JSZXN1bHQYvJQBDA","requester":"bshe@chromium.org","buildnumber":"1135","revision":"162133"},{"parent_name":null,"tests":[],"slave":"vm449-m4","url":"http://build.chromium.org/p/tryserver.chromium/buildstatus?builder=android_clang_dbg&number=29","timestamp":"2012-10-16 16:30:24.525799","builder":"android_clang_dbg","clobber":false,"project":"Chromium Try Server","reason":"","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIxCxIFSXNzdWUYyfenBQwLEghQYXRjaFNldBjKZQwLEgxUcnlKb2JSZXN1bHQYuZQBDA","requester":"bshe@chromium.org","buildnumber":"29","revision":"162133"},{"parent_name":null,"tests":[],"slave":"vm396-m4","url":"http://build.chromium.org/p/tryserver.chromium/buildstatus?builder=linux_chromeos_clang&number=6929","timestamp":"2012-10-16 16:29:30.582137","builder":"linux_chromeos_clang","clobber":false,"project":"Chromium Try Server","reason":"","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIxCxIFSXNzdWUYyfenBQwLEghQYXRjaFNldBjKZQwLEgxUcnlKb2JSZXN1bHQYv5QBDA","requester":"bshe@chromium.org","buildnumber":"6929","revision":"162133"}],"created":"2012-10-16 16:16:55.678780","url":null,"num_comments":13,"modified":"2012-10-22 16:51:03.605100","patchset":13002,"issue":11140041}