{"description":"Refactor the state-machine & threading out of the windows wifi provider into a cross platform base class\r\nThis will make the linux & mac impementations much simpler\r\n\r\nBUG=11246\r\nTEST=Aded wifi_data_provider_common_unittest.cc. Run: unit_tests.exe --gtest_filer=Geoloc*\r\n\r\n\n\nCommitted: http://src.chromium.org/viewvc/chrome?view=rev&revision=38890","cc":["chromium-reviews@chromium.org","ben+cc@chromium.org","phajdan.jr@chromium.org","steveblock@google.com"],"reviewers":["bulach@chromium.org","jorlow@chromium.org"],"messages":[{"sender":"joth@chromium.org","recipients":["joth@chromium.org","bulach@chromium.org","jorlow@chromium.org","chromium-reviews@chromium.org","ben+cc@chromium.org","phajdan.jr@chromium.org","steveblock@google.com"],"text":"","disapproval":false,"date":"2010-02-11 16:01:22.484654","approval":false},{"sender":"bulach@chromium.org","recipients":["joth@chromium.org","bulach@chromium.org","jorlow@chromium.org","chromium-reviews@chromium.org","ben+cc@chromium.org","phajdan.jr@chromium.org","steveblock@google.com"],"text":"nice refactoring! this will surely make things easier for other platforms. some nits and suggestions below:\n\nhttp://codereview.chromium.org/604019/diff/5001/4003\nFile chrome/browser/geolocation/wifi_data_provider_common.cc (right):\n\nhttp://codereview.chromium.org/604019/diff/5001/4003#newcode79\nchrome/browser/geolocation/wifi_data_provider_common.cc:79: update_available = wifi_data_.DiffersSignificantly(new_data);\nsince it's not a block, perhaps declare the bool here and remove 77?\n\nhttp://codereview.chromium.org/604019/diff/5001/4004\nFile chrome/browser/geolocation/wifi_data_provider_common.h (right):\n\nhttp://codereview.chromium.org/604019/diff/5001/4004#newcode72\nchrome/browser/geolocation/wifi_data_provider_common.h:72: virtual bool GetAccessPointData(WifiData::AccessPointDataSet *data) = 0;\nfoo* bar\n\nhttp://codereview.chromium.org/604019/diff/5001/4002\nFile chrome/browser/geolocation/wifi_data_provider_common_unittest.cc (right):\n\nhttp://codereview.chromium.org/604019/diff/5001/4002#newcode47\nchrome/browser/geolocation/wifi_data_provider_common_unittest.cc:47: class WifiDataProviderToTest : public WifiDataProviderCommon {\nperhaps: \ns/WifiDataProviderToTest/WifiDataProviderCommonWithMock?\nreason: ..ToTest seems this is a generic thing that could test different \"WifiDataProvider\", but in fact it's the other way around as it injects a mock in WifiDataProviderCommon..\n\nhttp://codereview.chromium.org/604019/diff/5001/4002#newcode67\nchrome/browser/geolocation/wifi_data_provider_common_unittest.cc:67: WifiDataProviderImplBase* CreateWifiDataProviderToTest() {\nyeah, this would be clearer as well..\n\nhttp://codereview.chromium.org/604019/diff/5001/4005\nFile chrome/browser/geolocation/wifi_data_provider_unittest_win.cc (right):\n\nhttp://codereview.chromium.org/604019/diff/5001/4005#newcode19\nchrome/browser/geolocation/wifi_data_provider_unittest_win.cc:19: // it accessing hardware and making the unittest unpredictable / brittle.\ns/\"unpredictable / brittle\"/flaky/","disapproval":false,"date":"2010-02-12 10:42:25.565607","approval":false},{"sender":"joth@chromium.org","recipients":["joth@chromium.org","bulach@chromium.org","jorlow@chromium.org","chromium-reviews@chromium.org","ben+cc@chromium.org","phajdan.jr@chromium.org","steveblock@google.com"],"text":"Thanks! Will submit once it's all green...\n\nhttp://codereview.chromium.org/604019/diff/5001/4003\nFile chrome/browser/geolocation/wifi_data_provider_common.cc (right):\n\nhttp://codereview.chromium.org/604019/diff/5001/4003#newcode79\nchrome/browser/geolocation/wifi_data_provider_common.cc:79: update_available = wifi_data_.DiffersSignificantly(new_data);\nOn 2010/02/12 10:42:26, bulach wrote:\n> since it's not a block, perhaps declare the bool here and remove 77?\n\nDone.\n\nhttp://codereview.chromium.org/604019/diff/5001/4004\nFile chrome/browser/geolocation/wifi_data_provider_common.h (right):\n\nhttp://codereview.chromium.org/604019/diff/5001/4004#newcode72\nchrome/browser/geolocation/wifi_data_provider_common.h:72: virtual bool GetAccessPointData(WifiData::AccessPointDataSet *data) = 0;\nOn 2010/02/12 10:42:26, bulach wrote:\n> foo* bar\n\nDone.\n\nhttp://codereview.chromium.org/604019/diff/5001/4002\nFile chrome/browser/geolocation/wifi_data_provider_common_unittest.cc (right):\n\nhttp://codereview.chromium.org/604019/diff/5001/4002#newcode47\nchrome/browser/geolocation/wifi_data_provider_common_unittest.cc:47: class WifiDataProviderToTest : public WifiDataProviderCommon {\nOn 2010/02/12 10:42:26, bulach wrote:\n> perhaps: \n> s/WifiDataProviderToTest/WifiDataProviderCommonWithMock?\n> reason: ..ToTest seems this is a generic thing that could test different\n> \"WifiDataProvider\", but in fact it's the other way around as it injects a mock\n> in WifiDataProviderCommon..\nYeah I originally though of WifiDataProviderUnderTest\nWifiDataProviderCommonWithMock is better.\n\nhttp://codereview.chromium.org/604019/diff/5001/4002#newcode67\nchrome/browser/geolocation/wifi_data_provider_common_unittest.cc:67: WifiDataProviderImplBase* CreateWifiDataProviderToTest() {\nOn 2010/02/12 10:42:26, bulach wrote:\n> yeah, this would be clearer as well..\n\nDone.\n\nhttp://codereview.chromium.org/604019/diff/5001/4005\nFile chrome/browser/geolocation/wifi_data_provider_unittest_win.cc (right):\n\nhttp://codereview.chromium.org/604019/diff/5001/4005#newcode19\nchrome/browser/geolocation/wifi_data_provider_unittest_win.cc:19: // it accessing hardware and making the unittest unpredictable / brittle.\nOn 2010/02/12 10:42:26, bulach wrote:\n> s/\"unpredictable / brittle\"/flaky/\n\nDone.","disapproval":false,"date":"2010-02-12 11:28:29.313820","approval":false},{"sender":"jorlow@chromium.org","recipients":["joth@chromium.org","bulach@chromium.org","jorlow@chromium.org","chromium-reviews@chromium.org","ben+cc@chromium.org","phajdan.jr@chromium.org","steveblock@google.com"],"text":"A couple comments to roll into your next patch.\n\nhttp://codereview.chromium.org/604019/diff/3005/2010\nFile chrome/browser/geolocation/wifi_data_provider_common.cc (right):\n\nhttp://codereview.chromium.org/604019/diff/3005/2010#newcode20\nchrome/browser/geolocation/wifi_data_provider_common.cc:20: : Thread(__FILE__),\nHm...this seems kind of non-standard.\n\nhttp://codereview.chromium.org/604019/diff/3005/2010#newcode22\nchrome/browser/geolocation/wifi_data_provider_common.cc:22: ALLOW_THIS_IN_INITIALIZER_LIST(task_factory_(this)) {\nI think usually this goes inside the task_factor_()\n\nhttp://codereview.chromium.org/604019/diff/3005/2011\nFile chrome/browser/geolocation/wifi_data_provider_common.h (right):\n\nhttp://codereview.chromium.org/604019/diff/3005/2011#newcode120\nchrome/browser/geolocation/wifi_data_provider_common.h:120: \n2 newlines","disapproval":false,"date":"2010-02-14 22:09:27.051985","approval":false},{"sender":"jorlow@chromium.org","recipients":["joth@chromium.org","bulach@chromium.org","jorlow@chromium.org","chromium-reviews@chromium.org","ben+cc@chromium.org","phajdan.jr@chromium.org","steveblock@google.com"],"text":"http://codereview.chromium.org/604019/diff/3005/2010\nFile chrome/browser/geolocation/wifi_data_provider_common.cc (right):\n\nhttp://codereview.chromium.org/604019/diff/3005/2010#newcode22\nchrome/browser/geolocation/wifi_data_provider_common.cc:22: ALLOW_THIS_IN_INITIALIZER_LIST(task_factory_(this)) {\nOn 2010/02/14 22:09:27, Jeremy Orlow wrote:\n> I think usually this goes inside the task_factor_()\n\nnever mind","disapproval":false,"date":"2010-02-14 22:48:22.505744","approval":false},{"sender":"joth@chromium.org","recipients":["joth@chromium.org","bulach@chromium.org","jorlow@chromium.org","chromium-reviews@chromium.org","ben+cc@chromium.org","phajdan.jr@chromium.org","steveblock@google.com"],"text":"Thanks, will roll into my next patch.\n\nhttp://codereview.chromium.org/604019/diff/3005/2010\nFile chrome/browser/geolocation/wifi_data_provider_common.cc (right):\n\nhttp://codereview.chromium.org/604019/diff/3005/2010#newcode20\nchrome/browser/geolocation/wifi_data_provider_common.cc:20: : Thread(__FILE__),\nOn 2010/02/14 22:09:27, Jeremy Orlow wrote:\n> Hm...this seems kind of non-standard.\n\nGood point, I did this as a placeholder and never looked back at it.\n\"Geolocation_wifi_provider\" it is.\n\nhttp://codereview.chromium.org/604019/diff/3005/2010#newcode22\nchrome/browser/geolocation/wifi_data_provider_common.cc:22: ALLOW_THIS_IN_INITIALIZER_LIST(task_factory_(this)) {\nOn 2010/02/14 22:48:22, Jeremy Orlow wrote:\n> On 2010/02/14 22:09:27, Jeremy Orlow wrote:\n> > I think usually this goes inside the task_factor_()\n> \n> never mind\n\nNow you point it out I do prefer the foo_(ALLOW_THIS_IN_INITIALIZER_LIST(this)) form, but it does seem it's much more common to do it the way I already have it.\n\nhttp://codereview.chromium.org/604019/diff/3005/2011\nFile chrome/browser/geolocation/wifi_data_provider_common.h (right):\n\nhttp://codereview.chromium.org/604019/diff/3005/2011#newcode120\nchrome/browser/geolocation/wifi_data_provider_common.h:120: \nOn 2010/02/14 22:09:27, Jeremy Orlow wrote:\n> 2 newlines\n\nDone.","disapproval":false,"date":"2010-02-15 11:28:53.605637","approval":false}],"owner_email":"joth@chromium.org","private":false,"base_url":"svn://chrome-svn/chrome/trunk/src/","owner":"joth","subject":"Refactor the state-machine & threading out of the windows wifi provider into ...","created":"2010-02-11 15:53:21.507461","patchsets":[1,5001,3005],"modified":"2011-05-09 13:34:41.805907","closed":true,"commit":false,"issue":604019}