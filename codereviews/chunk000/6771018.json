{"description":"Use the \"DNS prefetch\" button to control whether prerender is enabled/disabled.\r\n\r\nThis also removes prerender from about:flags.\r\n\r\nBUG=77783\r\nTEST=Force prerender on [via --prerender=enabled] and toggle the checkbox on/off to dynamically adjust prerender.\n\nCommitted: http://src.chromium.org/viewvc/chrome?view=rev&revision=79986","cc":["chromium-reviews@chromium.org","tburkard+watch@chromium.org","cbentzel+watch@chromium.org","darin-cc@chromium.org"],"reviewers":["gavinp@chromium.org","jar@chromium.org","phajdan.jr@chromium.org","mirandac@chromium.org"],"messages":[{"sender":"cbentzel@chromium.org","recipients":["cbentzel@chromium.org","gavinp@chromium.org","jar@chromium.org","chromium-reviews@chromium.org","tburkard+watch@chromium.org","cbentzel+watch@chromium.org","darin-cc@chromium.org"],"text":"I will do the GRD changes for the text of the DNS prefetch button in a separate CL.","disapproval":false,"date":"2011-03-29 21:08:50.359576","approval":false},{"sender":"jar@chromium.org","recipients":["cbentzel@chromium.org","gavinp@chromium.org","jar@chromium.org","chromium-reviews@chromium.org","tburkard+watch@chromium.org","cbentzel+watch@chromium.org","darin-cc@chromium.org"],"text":"I'm not familiar with much of this code, and haven't read the surrounding code thoroughly.  Comments below are just about the delta.\n\nhttp://codereview.chromium.org/6771018/diff/5002/chrome/app/generated_resources.grd\nFile chrome/app/generated_resources.grd (left):\n\nhttp://codereview.chromium.org/6771018/diff/5002/chrome/app/generated_resources.grd#oldcode4129\nchrome/app/generated_resources.grd:4129: Speculatively prerenders complete webpages in the background for a faster browsing experience.  The default setting of automatic can cause this feature to enable/disable randomly for testing purposes.\\n\nWe don't generally comment on testing stuff.  I'd suggest removing it.\n\nhttp://codereview.chromium.org/6771018/diff/5002/chrome/browser/net/net_pref_observer.cc\nFile chrome/browser/net/net_pref_observer.cc (right):\n\nhttp://codereview.chromium.org/6771018/diff/5002/chrome/browser/net/net_pref_observer.cc#newcode63\nchrome/browser/net/net_pref_observer.cc:63: prerender_manager->set_enabled(*dns_prefetching_enabled_);\nI think the pattern here is to call a single static method, and let the underlying function with things like getting the prerender_manager (presumably a global), check for validity, and move forward with the setting.\nNote this pattern appears to be in use on lines 59 and 64.\n\nIf this is the only reason why you passed in profile (rather than prefs), then you might not need that either.\n\nhttp://codereview.chromium.org/6771018/diff/5002/chrome/browser/net/net_pref_observer.h\nFile chrome/browser/net/net_pref_observer.h (right):\n\nhttp://codereview.chromium.org/6771018/diff/5002/chrome/browser/net/net_pref_observer.h#newcode40\nchrome/browser/net/net_pref_observer.h:40: Profile* profile_;\nnit: Profile* const profile;","disapproval":false,"date":"2011-03-29 22:02:00.452040","approval":false},{"sender":"cbentzel@chromium.org","recipients":["cbentzel@chromium.org","gavinp@chromium.org","jar@chromium.org","chromium-reviews@chromium.org","tburkard+watch@chromium.org","cbentzel+watch@chromium.org","darin-cc@chromium.org"],"text":"Thanks for taking a look Jim. I'll run a blame and see if I can suss out who else to have review this.\n\nhttp://codereview.chromium.org/6771018/diff/5002/chrome/app/generated_resources.grd\nFile chrome/app/generated_resources.grd (left):\n\nhttp://codereview.chromium.org/6771018/diff/5002/chrome/app/generated_resources.grd#oldcode4129\nchrome/app/generated_resources.grd:4129: Speculatively prerenders complete webpages in the background for a faster browsing experience.  The default setting of automatic can cause this feature to enable/disable randomly for testing purposes.\\n\nOn 2011/03/29 22:02:00, jar wrote:\n> We don't generally comment on testing stuff.  I'd suggest removing it.\n\nThese are being removed - you must have looked at the diff in a mirror :)\n\nThe strings were here for about:flags\n\nhttp://codereview.chromium.org/6771018/diff/5002/chrome/browser/net/net_pref_observer.cc\nFile chrome/browser/net/net_pref_observer.cc (right):\n\nhttp://codereview.chromium.org/6771018/diff/5002/chrome/browser/net/net_pref_observer.cc#newcode63\nchrome/browser/net/net_pref_observer.cc:63: prerender_manager->set_enabled(*dns_prefetching_enabled_);\nOn 2011/03/29 22:02:00, jar wrote:\n> I think the pattern here is to call a single static method, and let the\n> underlying function with things like getting the prerender_manager (presumably a\n> global), check for validity, and move forward with the setting.\n> Note this pattern appears to be in use on lines 59 and 64.\n> \n> If this is the only reason why you passed in profile (rather than prefs), then\n> you might not need that either.\n\nThe prefs are per-profile, as is the PrerenderManager. With the move to multi-profile I'd like to keep that approach rather than use a static. Arguably the other parameters should be treated similarly.","disapproval":false,"date":"2011-03-30 01:00:28.045111","approval":false},{"sender":"gavinp@chromium.org","recipients":["cbentzel@chromium.org","gavinp@chromium.org","jar@chromium.org","chromium-reviews@chromium.org","tburkard+watch@chromium.org","cbentzel+watch@chromium.org","darin-cc@chromium.org"],"text":"LGTM.\n\nHowever with the demise of about:flags for prerendering, we might want to rethink the multi-select logic I added.  Apparently it's proven slightly contentious, and so some amount of backing it off and making it modal like it was before for multi-select options might make sense?","disapproval":false,"date":"2011-03-30 17:27:34.569651","approval":true},{"sender":"cbentzel@chromium.org","recipients":["reply@chromiumcodereview.appspotmail.com"],"text":"On Wed, Mar 30, 2011 at 1:27 PM, <gavinp@chromium.org> wrote:\n\n> LGTM.\n>\n> However with the demise of about:flags for prerendering, we might want to\n> rethink the multi-select logic I added.  Apparently it's proven slightly\n> contentious, and so some amount of backing it off and making it modal like\n> it\n> was before for multi-select options might make sense?\n\n\nPerhaps. I'd definitely prefer that in a separate CL.\n","disapproval":false,"date":"2011-03-30 17:34:32.675831","approval":false},{"sender":"cbentzel@chromium.org","recipients":["cbentzel@chromium.org","gavinp@chromium.org","jar@chromium.org","phajdan.jr@chromium.org","mirandac@chromium.org","chromium-reviews@chromium.org","tburkard+watch@chromium.org","cbentzel+watch@chromium.org","darin-cc@chromium.org"],"text":"I changed this CL to pass in the PrefService and PrerenderManager into the NetPrefObserver, rather than the entire Profile.\n\nThe rationale for changing a setting on a specific PrerenderManager rather than setting a static value is that multi-profile Chrome should be able to accomodate one profile that has prerendering enabled, and one that does not. DNS may need to do something similar.\n\n+phajdan.jr for NetPrefObserver\n+mirandac for the trivial Profile changes, if interested","disapproval":false,"date":"2011-03-30 18:17:16.450727","approval":false},{"sender":"phajdan.jr@chromium.org","recipients":["cbentzel@chromium.org","gavinp@chromium.org","jar@chromium.org","phajdan.jr@chromium.org","mirandac@chromium.org","chromium-reviews@chromium.org","tburkard+watch@chromium.org","cbentzel+watch@chromium.org","darin-cc@chromium.org"],"text":"NetPrefObserver changes LGTM.","disapproval":false,"date":"2011-03-31 11:17:30.310139","approval":true},{"sender":"mirandac@chromium.org","recipients":["cbentzel@chromium.org","gavinp@chromium.org","jar@chromium.org","phajdan.jr@chromium.org","mirandac@chromium.org","chromium-reviews@chromium.org","tburkard+watch@chromium.org","cbentzel+watch@chromium.org","darin-cc@chromium.org"],"text":"On 2011/03/31 11:17:30, PaweÅ‚ Hajdan Jr. wrote:\n> NetPrefObserver changes LGTM.\n\nProfile changes also LGTM, thanks for the FYI.","disapproval":false,"date":"2011-03-31 13:45:15.355568","approval":true},{"sender":"jar@chromium.org","recipients":["cbentzel@chromium.org","gavinp@chromium.org","jar@chromium.org","phajdan.jr@chromium.org","mirandac@chromium.org","chromium-reviews@chromium.org","tburkard+watch@chromium.org","cbentzel+watch@chromium.org","darin-cc@chromium.org"],"text":"http://codereview.chromium.org/6771018/diff/10001/chrome/browser/net/net_pref_observer.cc\nFile chrome/browser/net/net_pref_observer.cc (right):\n\nhttp://codereview.chromium.org/6771018/diff/10001/chrome/browser/net/net_pref_observer.cc#newcode60\nchrome/browser/net/net_pref_observer.cc:60: prerender_manager_->set_enabled(*dns_prefetching_enabled_);\nThis approach still seems confusing.  Although the pref is based on the profile, I would have expected that there would be only one profile active in a browser at one time.  \n\nI'm surprised to see the seemingly global prerender_manager stored in this instance, as its existence or non-existence seems an internal issue for the class, just as it is with the dns prefetching, and other services.\n\nMy expectation continues to be that a global function can be called here.  What is the (new?) use case for the browser that necessitates this?","disapproval":false,"date":"2011-03-31 16:04:24.547573","approval":false},{"sender":"cbentzel@chromium.org","recipients":["cbentzel@chromium.org","gavinp@chromium.org","jar@chromium.org","phajdan.jr@chromium.org","mirandac@chromium.org","chromium-reviews@chromium.org","tburkard+watch@chromium.org","cbentzel+watch@chromium.org","darin-cc@chromium.org"],"text":"http://codereview.chromium.org/6771018/diff/10001/chrome/browser/net/net_pref_observer.cc\nFile chrome/browser/net/net_pref_observer.cc (right):\n\nhttp://codereview.chromium.org/6771018/diff/10001/chrome/browser/net/net_pref_observer.cc#newcode60\nchrome/browser/net/net_pref_observer.cc:60: prerender_manager_->set_enabled(*dns_prefetching_enabled_);\nOn 2011/03/31 16:04:24, jar wrote:\n> This approach still seems confusing.  Although the pref is based on the profile,\n> I would have expected that there would be only one profile active in a browser\n> at one time.  \n\nThis is changing with multi-profile - Miranda [who's on this bug] knows much more about it than I do. The thing I don't know is whether there are going to be multiple profiles per browser instance. If each profile gets it's own browser process, a global is OK.\n\nhttp://dev.chromium.org/user-experience/multi-profiles\n\nThe rationale for different prerender manager's per-profile is that we don't want to swap in a prerendered version of \"www.cnn.com\" generated under profile A if profile B navigates to \"www.cnn.com\".","disapproval":false,"date":"2011-03-31 17:03:43.176241","approval":false},{"sender":"cbentzel@chromium.org","recipients":["cbentzel@chromium.org","gavinp@chromium.org","jar@chromium.org","phajdan.jr@chromium.org","mirandac@chromium.org","chromium-reviews@chromium.org","tburkard+watch@chromium.org","cbentzel+watch@chromium.org","darin-cc@chromium.org"],"text":"http://codereview.chromium.org/6771018/diff/10001/chrome/browser/net/net_pref_observer.cc\nFile chrome/browser/net/net_pref_observer.cc (right):\n\nhttp://codereview.chromium.org/6771018/diff/10001/chrome/browser/net/net_pref_observer.cc#newcode60\nchrome/browser/net/net_pref_observer.cc:60: prerender_manager_->set_enabled(*dns_prefetching_enabled_);\nI just chatted with Miranda and multi-profile will be doing multiple profiles per browser process, so the global approach is not a good idea.","disapproval":false,"date":"2011-03-31 17:05:58.203357","approval":false}],"owner_email":"cbentzel@chromium.org","private":false,"base_url":"svn://svn.chromium.org/chrome/trunk/src","owner":"cbentzel","subject":"Use the \"DNS prefetch\" button to control whether prerender is enabled/disabled.","created":"2011-03-29 18:05:09.645851","patchsets":[1,3002,5001,5002,10001],"modified":"2011-05-26 14:45:03.178859","closed":true,"commit":false,"issue":6771018}