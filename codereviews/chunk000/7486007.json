{"description":"Fix NamedProxyLauncher on windows. Wait for the named pipe to be connectable.\nEnable NamedInterfaceTest on windows.\nBUG=chromium-os:8515\nTEST=none\n\n\nCommitted: http://src.chromium.org/viewvc/chrome?view=rev&revision=95957","cc":["chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","phajdan.jr@chromium.org"],"reviewers":["dtu@chromium.org","dmaclach@chromium.org","commit-bot@chromium.org"],"messages":[{"sender":"kkania@chromium.org","recipients":["kkania@chromium.org","dtu@chromium.org","jam@chromium.org","chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","kkania@chromium.org","phajdan.jr@chromium.org"],"text":"jam: ipc/*\ndtu: all else","disapproval":false,"date":"2011-07-21 22:10:41.782203","approval":false},{"sender":"kkania@chromium.org","recipients":["kkania@chromium.org","dtu@chromium.org","tsepez@chromium.org","chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","kkania@chromium.org","phajdan.jr@chromium.org"],"text":"tsepez: ipc/* (jam's out)","disapproval":false,"date":"2011-07-21 22:12:56.126958","approval":false},{"sender":"dtu@chromium.org","recipients":["kkania@chromium.org","dtu@chromium.org","tsepez@chromium.org","chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","kkania@chromium.org","phajdan.jr@chromium.org"],"text":"Thanks for doing this Ken!\n\nLGTM","disapproval":false,"date":"2011-07-21 22:33:38.444827","approval":true},{"sender":"tsepez@chromium.org","recipients":["kkania@chromium.org","dtu@chromium.org","tsepez@chromium.org","chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","kkania@chromium.org","phajdan.jr@chromium.org"],"text":"The proxy launcher has too much knowledge of the platform specific implementation details of the channel.  What's required is a way for it to ask IPC whether a given channel_id is ready, rather than poking around itself. \n\nI'd like to get John's take on what such an interface would look like.  Is there a lot of time pressure on this?","disapproval":false,"date":"2011-07-21 23:43:20.539871","approval":false},{"sender":"kkania@chromium.org","recipients":["kkania@chromium.org","dtu@chromium.org","tsepez@chromium.org","chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","phajdan.jr@chromium.org"],"text":"This can wait till John gets back if you would like.\n\nWhat do you think of adding a static method Channel::IsChannelAvailableForConnection which does this check?","disapproval":false,"date":"2011-07-21 23:48:49.055338","approval":false},{"sender":"tsepez@chromium.org","recipients":["kkania@chromium.org","dtu@chromium.org","tsepez@chromium.org","chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","phajdan.jr@chromium.org"],"text":"On 2011/07/21 23:48:49, kkania wrote:\n> This can wait till John gets back if you would like.\n> \n> What do you think of adding a static method\n> Channel::IsChannelAvailableForConnection which does this check?\n\nThat would be my suggestion, but I'd call it Channel::IsAvailableForConnection (without repeating \"Channel\").   But check with John before you spend any more time on it.","disapproval":false,"date":"2011-07-21 23:55:38.852652","approval":false},{"sender":"kkania@chromium.org","recipients":["kkania@chromium.org","dtu@chromium.org","tsepez@chromium.org","jam@chromium.org","chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","phajdan.jr@chromium.org"],"text":"","disapproval":false,"date":"2011-07-25 22:09:13.104333","approval":false},{"sender":"kkania@chromium.org","recipients":["kkania@chromium.org","dtu@chromium.org","tsepez@chromium.org","jam@chromium.org","chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","phajdan.jr@chromium.org"],"text":"Adding John as reviewer, as requested by Tom.","disapproval":false,"date":"2011-07-25 22:09:57.043349","approval":false},{"sender":"kkania@chromium.org","recipients":["kkania@chromium.org","dtu@chromium.org","tsepez@chromium.org","jam@chromium.org","chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","phajdan.jr@chromium.org"],"text":"reminder to jam this is awaiting his input","disapproval":false,"date":"2011-07-26 22:48:07.391241","approval":false},{"sender":"jam@chromium.org","recipients":["kkania@chromium.org","dtu@chromium.org","tsepez@chromium.org","jam@chromium.org","chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","phajdan.jr@chromium.org"],"text":"I'm not the best reviewer for this, since that code was written before I started and I haven't touched it much. I think Darin might have written it.\n\nIf he's fine with this, the one nit I'll make is that PipeName should still be in the class, just be a static method instead.","disapproval":false,"date":"2011-07-27 16:59:43.164892","approval":false},{"sender":"kkania@chromium.org","recipients":["kkania@chromium.org","dtu@chromium.org","tsepez@chromium.org","darin@chromium.org","chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","phajdan.jr@chromium.org"],"text":"-jam, +darin\n\nDarin,\nThe current plan for this CL is to add:\nstatic bool Channel::IsAvailableForConnection(channel_id),\nwhich returns whether a server channel is listening on that channel ID.\n\nOne other piece I would like to add to this CL is fixing the race where the ProxyLauncher sees the domain socket file exists and attempts to connect before the server calls listen.\nOne hacky way to fix this would be to create the domain socket with a temp file and only after calling listen, rename it to the actual pipe name.\n\nWhat do you think?","disapproval":false,"date":"2011-07-28 23:11:48.530322","approval":false},{"sender":"kkania@chromium.org","recipients":["kkania@chromium.org","dtu@chromium.org","tsepez@chromium.org","darin@chromium.org","dmaclach@chromium.org","chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","phajdan.jr@chromium.org"],"text":"+dmaclach\n\nSeems Darin is busy. Do you think you can comment/review here instead?\n\nOn 2011/07/28 23:11:48, kkania wrote:\n> -jam, +darin\n> \n> Darin,\n> The current plan for this CL is to add:\n> static bool Channel::IsAvailableForConnection(channel_id),\n> which returns whether a server channel is listening on that channel ID.\n> \n> One other piece I would like to add to this CL is fixing the race where the\n> ProxyLauncher sees the domain socket file exists and attempts to connect before\n> the server calls listen.\n> One hacky way to fix this would be to create the domain socket with a temp file\n> and only after calling listen, rename it to the actual pipe name.\n> \n> What do you think?","disapproval":false,"date":"2011-08-01 23:09:40.806435","approval":false},{"sender":"dmaclach@chromium.org","recipients":["kkania@chromium.org","dtu@chromium.org","tsepez@chromium.org","darin@chromium.org","dmaclach@chromium.org","chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","phajdan.jr@chromium.org"],"text":"On 2011/08/01 23:09:40, kkania wrote:\n> +dmaclach\n> \n> Seems Darin is busy. Do you think you can comment/review here instead?\n> \n> On 2011/07/28 23:11:48, kkania wrote:\n> > -jam, +darin\n> > \n> > Darin,\n> > The current plan for this CL is to add:\n> > static bool Channel::IsAvailableForConnection(channel_id),\n> > which returns whether a server channel is listening on that channel ID.\n> > \n> > One other piece I would like to add to this CL is fixing the race where the\n> > ProxyLauncher sees the domain socket file exists and attempts to connect\n> before\n> > the server calls listen.\n> > One hacky way to fix this would be to create the domain socket with a temp\n> file\n> > and only after calling listen, rename it to the actual pipe name.\n> > \n> > What do you think?\n\nI somewhat agree with Tom's initial assessment, that we should be asking the channel if it is ready instead of poking around in it. This would also have the advantage of getting rid of the #ifdef block in proxy_launcher and moving it into the already split up platform implementations of IPC::Channel.","disapproval":false,"date":"2011-08-02 00:32:04.920062","approval":false},{"sender":"dmaclach@chromium.org","recipients":["kkania@chromium.org","dtu@chromium.org","tsepez@chromium.org","darin@chromium.org","dmaclach@chromium.org","chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","phajdan.jr@chromium.org"],"text":"http://codereview.chromium.org/7486007/diff/2001/chrome/test/automation/proxy_launcher.cc\nFile chrome/test/automation/proxy_launcher.cc (right):\n\nhttp://codereview.chromium.org/7486007/diff/2001/chrome/test/automation/proxy_launcher.cc#newcode544\nchrome/test/automation/proxy_launcher.cc:544: 1);\non Windows does it not make more sense just to call WaitNamedPipe(name, TestTimeouts::action_max_timout_ms())?","disapproval":false,"date":"2011-08-02 00:32:13.888530","approval":false},{"sender":"kkania@chromium.org","recipients":["kkania@chromium.org","dtu@chromium.org","tsepez@chromium.org","darin@chromium.org","dmaclach@chromium.org","chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","phajdan.jr@chromium.org"],"text":"dmac,\n\nThanks for the comment. I'll put up a change and let you review in place of Darin, if that's ok.\n\nhttp://codereview.chromium.org/7486007/diff/2001/chrome/test/automation/proxy_launcher.cc\nFile chrome/test/automation/proxy_launcher.cc (right):\n\nhttp://codereview.chromium.org/7486007/diff/2001/chrome/test/automation/proxy_launcher.cc#newcode544\nchrome/test/automation/proxy_launcher.cc:544: 1);\nWaitNamedPipe on windows returns immediately if the pipe doesn't exist yet. The wait param supposedly only comes into play when waiting for an existing pipe to be available for connection","disapproval":false,"date":"2011-08-02 15:00:58.820658","approval":false},{"sender":"dmaclach@google.com","recipients":["reply@chromiumcodereview.appspotmail.com"],"text":"On Tue, Aug 2, 2011 at 08:00,  <kkania@chromium.org> wrote:\n> dmac,\n>\n> Thanks for the comment. I'll put up a change and let you review in place of\n> Darin, if that's ok.\n>\n>\n> http://codereview.chromium.org/7486007/diff/2001/chrome/test/automation/proxy_launcher.cc\n> File chrome/test/automation/proxy_launcher.cc (right):\n>\n> http://codereview.chromium.org/7486007/diff/2001/chrome/test/automation/proxy_launcher.cc#newcode544\n> chrome/test/automation/proxy_launcher.cc:544: 1);\n> WaitNamedPipe on windows returns immediately if the pipe doesn't exist\n> yet. The wait param supposedly only comes into play when waiting for an\n> existing pipe to be available for connection\n\nand does 0 signify wait forever then? Just wondering why 1 instead of 0.\n","disapproval":false,"date":"2011-08-02 15:17:06.787829","approval":false},{"sender":"kkania@chromium.org","recipients":["kkania@chromium.org","dtu@chromium.org","tsepez@chromium.org","darin@chromium.org","dmaclach@chromium.org","dmaclach@google.com","chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","phajdan.jr@chromium.org"],"text":"added IsNamedServerInitialized static method to Channel. I named it this instead of IsAvailableForConnection because on POSIX we do not know if it is actually available, just if it is initialized\n\ndmac: passing 0 to WaitNamedPipe uses the default timeout, which was set at 5s in CreateNamedPipe.","disapproval":false,"date":"2011-08-02 18:26:35.020158","approval":false},{"sender":"kkania@chromium.org","recipients":["kkania@chromium.org","dtu@chromium.org","tsepez@chromium.org","darin@chromium.org","dmaclach@chromium.org","dmaclach@google.com","chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","phajdan.jr@chromium.org"],"text":"ping. Waiting for dmac","disapproval":false,"date":"2011-08-05 23:07:31.533795","approval":false},{"sender":"dmaclach@chromium.org","recipients":["kkania@chromium.org","dtu@chromium.org","tsepez@chromium.org","darin@chromium.org","dmaclach@chromium.org","dmaclach@google.com","chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","phajdan.jr@chromium.org"],"text":"On 2011/08/05 23:07:31, kkania wrote:\n> ping. Waiting for dmac\n\nLGTM","disapproval":false,"date":"2011-08-05 23:10:23.660030","approval":true},{"sender":"commit-bot@chromium.org","recipients":["kkania@chromium.org","dtu@chromium.org","dmaclach@chromium.org","commit-bot@chromium.org","chromium-reviews@chromium.org","jam@chromium.org","darin-cc@chromium.org","phajdan.jr@chromium.org"],"text":"Change committed as 95957","disapproval":false,"date":"2011-08-09 06:46:07.715130","approval":false}],"owner_email":"kkania@chromium.org","private":false,"base_url":"svn://svn.chromium.org/chrome/trunk/src","owner":"kkania","subject":"Fix NamedProxyLauncher on Windows.","created":"2011-07-21 21:50:47.323263","patchsets":[2001,19001,25001],"modified":"2011-08-09 06:46:14.746704","closed":true,"commit":false,"issue":7486007}