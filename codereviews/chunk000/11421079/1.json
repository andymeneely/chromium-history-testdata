{"files":{"chrome/browser/instant/instant_client.cc":{"status":"A","num_chunks":1,"no_base_file":false,"property_changes":"","num_added":88,"num_removed":0,"messages":[{"author":"sky","author_email":"sky@chromium.org","text":"I would name this SetInstantSupportDetermined.","draft":false,"lineno":56,"date":"2012-11-27 01:07:51.777860","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 01:07:51, sky wrote:\n> I would name this SetInstantSupportDetermined.\n\nDone. Now it's just \"InstantSupportDetermined\".","draft":false,"lineno":56,"date":"2012-11-29 07:33:19.638210","left":false}],"id":3,"is_binary":false},"chrome/browser/instant/instant_client.h":{"status":"A","num_chunks":1,"no_base_file":false,"property_changes":"","num_added":89,"num_removed":0,"messages":[{"author":"sky","author_email":"sky@chromium.org","text":"Seem weird that this is public.","draft":false,"lineno":49,"date":"2012-11-27 01:07:51.778130","left":false},{"author":"sky","author_email":"sky@chromium.org","text":"nit: one of:\n\nconst content::WebContents* contents() const\ncontent::WebContents* contents()","draft":false,"lineno":57,"date":"2012-11-27 01:07:51.778410","left":false},{"author":"sky","author_email":"sky@chromium.org","text":"You should also add a comment that once invoked with true subsequent calls are ignored, and why that's ok.","draft":false,"lineno":64,"date":"2012-11-27 01:07:51.778670","left":false},{"author":"sky","author_email":"sky@chromium.org","text":"style guide says no protected members.","draft":false,"lineno":67,"date":"2012-11-27 01:07:51.778920","left":false},{"author":"samarth","author_email":"samarth@chromium.org","text":"Comment either here for below (where the member is) that this doesn't take ownership of controller.","draft":false,"lineno":27,"date":"2012-11-27 18:09:43.882390","left":false},{"author":"Jered","author_email":"jered@chromium.org","text":"determining -> indicating","draft":false,"lineno":81,"date":"2012-11-27 18:19:53.582210","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 18:09:43, samarth wrote:\n> Comment either here for below (where the member is) that this doesn't take\n> ownership of controller.\n\nDone.","draft":false,"lineno":27,"date":"2012-11-29 07:33:19.638450","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 01:07:51, sky wrote:\n> Seem weird that this is public.\n\nDone.","draft":false,"lineno":49,"date":"2012-11-29 07:33:19.638720","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 01:07:51, sky wrote:\n> nit: one of:\n> \n> const content::WebContents* contents() const\n> content::WebContents* contents()\n\nI don't understand this rule. Are you saying that we can't legitimately return any non-const pointer from a const method (even if the pointer is NOT to a data member)? That seems draconian to me. For example, would you similarly restrict InstantController::GetPreviewContents() from returning a non-const object?","draft":false,"lineno":57,"date":"2012-11-29 07:33:19.639000","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 01:07:51, sky wrote:\n> You should also add a comment that once invoked with true subsequent calls are\n> ignored, and why that's ok.\n\nI've moved this stuff into private sections now, and so the comments are in the .cc files.","draft":false,"lineno":64,"date":"2012-11-29 07:33:19.639280","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 01:07:51, sky wrote:\n> style guide says no protected members.\n\nDone.","draft":false,"lineno":67,"date":"2012-11-29 07:33:19.639550","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 18:19:53, Jered wrote:\n> determining -> indicating\n\nRemoved. No longer applicable.","draft":false,"lineno":81,"date":"2012-11-29 07:33:19.639810","left":false}],"id":4,"is_binary":false},"chrome/browser/instant/instant_loader.cc":{"status":"M","num_chunks":13,"no_base_file":false,"property_changes":"","num_added":62,"num_removed":183,"messages":[{"author":"sky","author_email":"sky@chromium.org","text":"I get why you subclassed here, but it feels a bit iffy. It seems like InstantLoader and what is InstantClient want to have an InstantClient rather than be InstantClient.","draft":false,"lineno":186,"date":"2012-11-27 01:07:51.780010","left":false},{"author":"samarth","author_email":"samarth@chromium.org","text":"On 2012/11/27 01:07:51, sky wrote:\n> I get why you subclassed here, but it feels a bit iffy. It seems like\n> InstantLoader and what is InstantClient want to have an InstantClient rather\n> than be InstantClient.\n\nThis might be what sky is already saying, but what about having InstantClient (or some other name) be in charge of multiplexing between the active tab and the preview contents? That has two benefits:\n1) You don't need to split up the loader functionality into two places (which will make things harder to find and understand later)\n2) We can reduce the burden on InstantController which is already handling tons of state and tricky logic.","draft":false,"lineno":186,"date":"2012-11-27 18:09:43.884360","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"I understand the style guide's preference for composition over inheritance. If we do that here, I think we'll have something like this (say the new stuff is called InstantTab; and the object that both InstantTab and InstantLoader hold is called InstantClient):\n\nvoid InstantController::SetSuggestions(InstantClient* client, ...) {\n  if (CurrentClient()->client() != client || ...)\n    return;\n\nI.e., when calling back from the loader to InstantController, we'll have to pass in something that's common to both InstantTab and InstantLoader, and then do this roundabout check to see which one actually called the InstantController. (\"roundabout\" because there's really no reason for InstantTab/InstantLoader to expose their client() to InstantController otherwise.)\n\nThe above is a somewhat small point, but overall I think inheritance makes the code leaner in this case. I think composition will just give us a whole bunch of shim methods for no good reason.\n\nTo samarth's point: I don't think we can do the multiplexing outside the InstantController easily. The logic is quite complex, and depends on InstantController state (such as search_mode_ and is_focused_ and such), so we'd have to expose all of that as well.","draft":false,"lineno":186,"date":"2012-11-27 18:41:33.291840","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"Done. Composition wins.","draft":false,"lineno":186,"date":"2012-11-29 07:33:19.642860","left":false}],"id":7,"is_binary":false},"chrome/renderer/searchbox/searchbox_extension.cc":{"status":"M","num_chunks":15,"no_base_file":false,"property_changes":"","num_added":15,"num_removed":25,"messages":[],"id":12,"is_binary":false},"chrome/chrome_browser.gypi":{"status":"M","num_chunks":1,"no_base_file":false,"property_changes":"","num_added":2,"num_removed":0,"messages":[],"id":10,"is_binary":false},"chrome/browser/instant/instant_controller.cc":{"status":"M","num_chunks":20,"no_base_file":false,"property_changes":"","num_added":127,"num_removed":49,"messages":[{"author":"sky","author_email":"sky@chromium.org","text":"Shouldn't we early out if no client?","draft":false,"lineno":366,"date":"2012-11-27 01:07:51.779170","left":false},{"author":"samarth","author_email":"samarth@chromium.org","text":"Mostly for my understanding: Hide() will be a no-op here if client_ is set, right? If so, it might be clearer to make that explicit by checking if (!client_) before calling it.","draft":false,"lineno":251,"date":"2012-11-27 18:09:43.882780","left":false},{"author":"samarth","author_email":"samarth@chromium.org","text":"nit: does the Chrome style guide allow this? I haven't seen assignment in conditionals elsewhere.","draft":false,"lineno":386,"date":"2012-11-27 18:09:43.883070","left":false},{"author":"samarth","author_email":"samarth@chromium.org","text":"What should IsCurrent return if client_ is set? For instance, part of the check you have below for client_ in CommitIfCurrent could be moved here.\n\nThe only other place where IsCurrent is used is in OmniboxLostFocus. Is there any reason that isn't just a no-op (beyond updating if_focused) when client_ is set?","draft":false,"lineno":406,"date":"2012-11-27 18:09:43.883370","left":false},{"author":"samarth","author_email":"samarth@chromium.org","text":"Is this code path relevant when client_ is set? In general, I think we should be more explicit here about only doing things that are necessary when using client_ or using loader_. Even if it's functionally equivalent, it makes it harder to read the code because you can't tell what matters and what doesn't.","draft":false,"lineno":564,"date":"2012-11-27 18:09:43.883660","left":false},{"author":"Jered","author_email":"jered@chromium.org","text":"Why reset the loader here if client_ is set?","draft":false,"lineno":216,"date":"2012-11-27 19:21:57.578470","left":false},{"author":"Jered","author_email":"jered@chromium.org","text":"Please extract a method like IsCommitted() for loader_ == CurrentClient() and client_ == CurrentClient().","draft":false,"lineno":314,"date":"2012-11-27 19:21:57.578780","left":false},{"author":"Jered","author_email":"jered@chromium.org","text":"I am very confused. Why doesn't this cancel sometimes? What is the business about loader_ below?","draft":false,"lineno":414,"date":"2012-11-27 19:21:57.579080","left":false},{"author":"samarth","author_email":"samarth@chromium.org","text":"This no longer works correctly.  Well, we don't care about these bounds for extended mode, but in general, we can no longer keep a copy of state here to compare against since we now care about what was the last value sent to CurrentClient().\n\nOne option is to stashed the cached values either in InstantLoader or in per-tab profile data.  For committed tabs, you can check for changes and dispatch the appropriate events when ResetClient is called. ","draft":false,"lineno":348,"date":"2012-11-28 06:31:15.705240","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 19:21:57, Jered wrote:\n> Why reset the loader here if client_ is set?\n\nDone.","draft":false,"lineno":216,"date":"2012-11-29 07:33:19.639980","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 18:09:43, samarth wrote:\n> Mostly for my understanding: Hide() will be a no-op here if client_ is set,\n> right? If so, it might be clearer to make that explicit by checking if\n> (!client_) before calling it.\n\nNo, Hide() won't be a no-op. For one, it will actually hide the preview (i.e., owned by |loader_|). It will also reset last_full_text_, which also isn't a no-op.","draft":false,"lineno":251,"date":"2012-11-29 07:33:19.640140","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 19:21:57, Jered wrote:\n> Please extract a method like IsCommitted() for loader_ == CurrentClient() and\n> client_ == CurrentClient().\n\nI've gone with the simpler \"if (instant_tab_)\" idiom everywhere. I think this reads reasonably well (\"if [there's] an instant tab, ...\").","draft":false,"lineno":314,"date":"2012-11-29 07:33:19.640320","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/28 06:31:15, samarth wrote:\n> This no longer works correctly.  Well, we don't care about these bounds for\n> extended mode, but in general, we can no longer keep a copy of state here to\n> compare against since we now care about what was the last value sent to\n> CurrentClient().\n> \n> One option is to stashed the cached values either in InstantLoader or in per-tab\n> profile data.  For committed tabs, you can check for changes and dispatch the\n> appropriate events when ResetClient is called. \n\nAs discussed offline, this does work correctly (because the bounds are always sent to |loader_|). Further CLs, such as @melevin's, that need to send to either |instant_tab_| or |loader_| should just send to both, and make sure that the state is sent again when they are recreated.","draft":false,"lineno":348,"date":"2012-11-29 07:33:19.640480","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 01:07:51, sky wrote:\n> Shouldn't we early out if no client?\n\nDone.","draft":false,"lineno":366,"date":"2012-11-29 07:33:19.640640","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 18:09:43, samarth wrote:\n> nit: does the Chrome style guide allow this? I haven't seen assignment in\n> conditionals elsewhere.\n\nThe style guide doesn't mention it. @sky hates it. I like this style, but am cognizant that I might be overdoing it. I think it helps in some cases; for example, see InstantLoader::SetupPreviewContents().","draft":false,"lineno":386,"date":"2012-11-29 07:33:19.640810","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 18:09:43, samarth wrote:\n> What should IsCurrent return if client_ is set? For instance, part of the check\n> you have below for client_ in CommitIfCurrent could be moved here.\n\nIf |instant_tab_| is non-NULL, IsCurrent() should be false, since the preview should have been hidden by then. I don't see a need to check instant_tab_ here explicitly.\n\n> The only other place where IsCurrent is used is in OmniboxLostFocus. Is there\n> any reason that isn't just a no-op (beyond updating if_focused) when client_ is\n> set?\n\nNot sure what you mean, but OmniboxLostFocus() could lead to the |loader_| getting refreshed if IsCurrent() is false (among other things).","draft":false,"lineno":406,"date":"2012-11-29 07:33:19.641010","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 19:21:57, Jered wrote:\n> I am very confused. Why doesn't this cancel sometimes? What is the business\n> about loader_ below?\n\nCancel() isn't applicable in the case of a committed tab. I've added a short comment about why this block exists here; let me know if it is still unclear.","draft":false,"lineno":414,"date":"2012-11-29 07:33:19.641200","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 18:09:43, samarth wrote:\n> Is this code path relevant when client_ is set? In general, I think we should be\n> more explicit here about only doing things that are necessary when using client_\n> or using loader_. Even if it's functionally equivalent, it makes it harder to\n> read the code because you can't tell what matters and what doesn't.\n\nI think there's a balance to be struck here. I don't want to see \"if (instant_tab_) return;\" all over the place. I think you feel this way because instant_tab_ is a new piece being introduced. Once it has been around a while, I think we'll get used to the idea.\n\nFor example, why do we not have \"if (!loader_) return;\" or \"if (model_.mode().is_default()) return;\" all over the place too? In many places, we go ahead with the logic, end up calling Hide(), knowing that it might be redundant - the preview may already be hidden, or worse still, we may not even have a loader.","draft":false,"lineno":564,"date":"2012-11-29 07:33:19.641360","left":false}],"id":5,"is_binary":false},"chrome/browser/ui/omnibox/omnibox_edit_model.cc":{"status":"M","num_chunks":1,"no_base_file":false,"property_changes":"","num_added":3,"num_removed":11,"messages":[{"author":"Jered","author_email":"jered@chromium.org","text":"I am mildly terrified by GetText(). It's platform dependent and has a vague comment. Is it what we want here? (Do we not need DisplayTextFromUserText()?)","draft":false,"lineno":1194,"date":"2012-11-27 18:19:53.582510","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 18:19:53, Jered wrote:\n> I am mildly terrified by GetText(). It's platform dependent and has a vague\n> comment. Is it what we want here? (Do we not need DisplayTextFromUserText()?)\n\nYeah. user_text_ (and things derived from it, such as DisplayTextFromUserText()) will return a blank string if the user is not typing. As you can see from the table in InstantController::Update(), there are situations where user_input_in_progress is false, yet we need to know what the omnibox is showing.","draft":false,"lineno":1194,"date":"2012-11-29 07:33:19.643100","left":false}],"id":9,"is_binary":false},"chrome/browser/instant/instant_loader.h":{"status":"M","num_chunks":7,"no_base_file":false,"property_changes":"","num_added":28,"num_removed":44,"messages":[],"id":8,"is_binary":false},"chrome/browser/instant/instant_browsertest.cc":{"status":"M","num_chunks":2,"no_base_file":false,"property_changes":"","num_added":2,"num_removed":2,"messages":[{"author":"Jered","author_email":"jered@chromium.org","text":"Update comment.","draft":false,"lineno":403,"date":"2012-11-27 18:19:53.581900","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 18:19:53, Jered wrote:\n> Update comment.\n\nDone.","draft":false,"lineno":403,"date":"2012-11-29 07:33:19.637920","left":false}],"id":2,"is_binary":false},"chrome/renderer/searchbox/searchbox.cc":{"status":"M","num_chunks":6,"no_base_file":false,"property_changes":"","num_added":6,"num_removed":0,"messages":[{"author":"Jered","author_email":"jered@chromium.org","text":"Why not DVLOG here? Too spammy?","draft":false,"lineno":183,"date":"2012-11-27 18:19:53.582810","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 18:19:53, Jered wrote:\n> Why not DVLOG here? Too spammy?\n\nDone. I had simply not cared enough about this particular event to add a DVLOG for it.","draft":false,"lineno":183,"date":"2012-11-29 07:33:19.643270","left":false}],"id":11,"is_binary":false},"chrome/browser/instant/instant_controller.h":{"status":"M","num_chunks":6,"no_base_file":false,"property_changes":"","num_added":8,"num_removed":2,"messages":[{"author":"sky","author_email":"sky@chromium.org","text":"Update comment.","draft":false,"lineno":97,"date":"2012-11-27 01:07:51.779450","left":false},{"author":"sky","author_email":"sky@chromium.org","text":"Since InstantLoader is also an InstantClient using the name client_ here is mildly confusing.","draft":false,"lineno":203,"date":"2012-11-27 01:07:51.779700","left":false},{"author":"samarth","author_email":"samarth@chromium.org","text":"Worth clarifying somewhere that model_ only reflects the model for loader_.","draft":false,"lineno":201,"date":"2012-11-27 18:09:43.884030","left":false},{"author":"Jered","author_email":"jered@chromium.org","text":"InstantLoader -> client","draft":false,"lineno":118,"date":"2012-11-27 19:21:57.579350","left":false},{"author":"Jered","author_email":"jered@chromium.org","text":"InstantLoader -> client","draft":false,"lineno":131,"date":"2012-11-27 19:21:57.579640","left":false},{"author":"Jered","author_email":"jered@chromium.org","text":"It feels funny to me that InstantController owns client_. Instead, is there somehow it could be tethered to the active tab? Then if the active tab has a client, use it, otherwise use the loader. (The client flakes off from the loader on commit.)","draft":false,"lineno":204,"date":"2012-11-27 19:21:57.579850","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 01:07:51, sky wrote:\n> Update comment.\n\nDone.","draft":false,"lineno":97,"date":"2012-11-29 07:33:19.641520","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 19:21:57, Jered wrote:\n> InstantLoader -> client\n\nDone.","draft":false,"lineno":118,"date":"2012-11-29 07:33:19.641720","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 19:21:57, Jered wrote:\n> InstantLoader -> client\n\nDone.","draft":false,"lineno":131,"date":"2012-11-29 07:33:19.641940","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 18:09:43, samarth wrote:\n> Worth clarifying somewhere that model_ only reflects the model for loader_.\n\nDone.","draft":false,"lineno":201,"date":"2012-11-29 07:33:19.642130","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 01:07:51, sky wrote:\n> Since InstantLoader is also an InstantClient using the name client_ here is\n> mildly confusing.\n\nDone.","draft":false,"lineno":203,"date":"2012-11-29 07:33:19.642360","left":false},{"author":"sreeram","author_email":"sreeram@chromium.org","text":"On 2012/11/27 19:21:57, Jered wrote:\n> It feels funny to me that InstantController owns client_. Instead, is there\n> somehow it could be tethered to the active tab? Then if the active tab has a\n> client, use it, otherwise use the loader. (The client flakes off from the loader\n> on commit.)\n\nAck. As per previous comments, I've kept the ownership the same.","draft":false,"lineno":204,"date":"2012-11-29 07:33:19.642600","left":false}],"id":6,"is_binary":false}},"owner_email":"sreeram@chromium.org","owner":"sreeram","message":null,"try_job_results":[],"created":"2012-11-26 22:00:38.301810","url":null,"num_comments":54,"modified":"2012-11-29 07:33:19.721940","patchset":1,"issue":11421079}