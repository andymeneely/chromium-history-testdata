{"description":"[Chrome OS] Prevent HOSTED accounts from logging in, but still handle CAPTCHA correctly\r\n\r\nBUG=chromium-os:7867\r\nTEST=unit tests, install on device and verify that you can clear the CAPTCHAd state for a HOSTED account, and still see the appropriate log message.\n\nCommitted: http://src.chromium.org/viewvc/chrome?view=rev&revision=64247","cc":["chromium-reviews@chromium.org","phajdan.jr@chromium.org","nkostylev+cc@chromium.org","davemoore+watch@chromium.org","ben+cc@chromium.org"],"reviewers":["nkostylev@chromium.org"],"messages":[{"sender":"cmasone@chromium.org","recipients":["cmasone@chromium.org","nkostylev@chromium.org","chromium-reviews@chromium.org","phajdan.jr@chromium.org","nkostylev+cc@chromium.org","davemoore+watch@chromium.org","ben+cc@chromium.org"],"text":"","disapproval":false,"date":"2010-10-28 03:08:17.699087","approval":false},{"sender":"nkostylev@chromium.org","recipients":["cmasone@chromium.org","nkostylev@chromium.org","chromium-reviews@chromium.org","phajdan.jr@chromium.org","nkostylev+cc@chromium.org","davemoore+watch@chromium.org","ben+cc@chromium.org"],"text":"http://codereview.chromium.org/4109004/diff/1/2\nFile chrome/browser/chromeos/login/google_authenticator.cc (right):\n\nhttp://codereview.chromium.org/4109004/diff/1/2#newcode191\nchrome/browser/chromeos/login/google_authenticator.cc:191: if (hosted_policy_ == GaiaAuthenticator2::HostedAccountsAllowed &&\nI thought about a different solution:\n\ninitial: HostedAccountsNotAllowed\n\nIf it's CAPTCHA'd - ClientLogin will return CAPTCHA_REQUIRED.\nSomewhere in GoogleAuthenticator instance we mark that (this instance will be reused for the same user login).\n\nWhen HOSTED account enters CAPTCHA, GA::Authenticate() with captcha is called, it will succeed, but return INVALID_CREDENTIALS, we try with HostedAllowed then.\n\nIn this case we won't make 2 ClientLogin attempts for each new user in case of LoginSuccess.","disapproval":false,"date":"2010-10-28 08:32:02.774620","approval":false},{"sender":"nkostylev@chromium.org","recipients":["cmasone@chromium.org","nkostylev@chromium.org","chromium-reviews@chromium.org","phajdan.jr@chromium.org","nkostylev+cc@chromium.org","davemoore+watch@chromium.org","ben+cc@chromium.org"],"text":"There's even no need to save state in GA instance.\n\nFailures\n- If CAPTCHA_REQUIRED - return to LoginStatusConsumer\n- If INVALID_GAIA_CREDENTIALS - try HostedAllowed and then return to LSC.","disapproval":false,"date":"2010-10-28 08:33:53.338459","approval":false},{"sender":"cmasone@chromium.org","recipients":["reply@chromiumcodereview.appspotmail.com"],"text":"On Thu, Oct 28, 2010 at 1:32 AM,  <nkostylev@chromium.org> wrote:\n>\n> http://codereview.chromium.org/4109004/diff/1/2\n> File chrome/browser/chromeos/login/google_authenticator.cc (right):\n>\n> http://codereview.chromium.org/4109004/diff/1/2#newcode191\n> chrome/browser/chromeos/login/google_authenticator.cc:191: if\n> (hosted_policy_ == GaiaAuthenticator2::HostedAccountsAllowed &&\n> I thought about a different solution:\n>\n> initial: HostedAccountsNotAllowed\n>\n> If it's CAPTCHA'd - ClientLogin will return CAPTCHA_REQUIRED.\n> Somewhere in GoogleAuthenticator instance we mark that (this instance\n> will be reused for the same user login).\n>\n> When HOSTED account enters CAPTCHA, GA::Authenticate() with captcha is\n> called, it will succeed, but return INVALID_CREDENTIALS, we try with\n> HostedAllowed then.\n\nThat doesn't work, though; I tried that first :-/  If you pass HOSTED\ncredentials with a correct CAPTCHA solution but are only allowing\nGOOGLE logins, it just returns CAPTCHA again, and the CAPTCHA the user\nsolved is no longer acceptable.  So we're back in the infinite loop of\nCAPTCHA_REQUIRED\n\n>\n> In this case we won't make 2 ClientLogin attempts for each new user in\n> case of LoginSuccess.\n>\n> http://codereview.chromium.org/4109004/show\n>\n","disapproval":false,"date":"2010-10-28 14:44:10.374984","approval":false},{"sender":"nkostylev@chromium.org","recipients":["cmasone@chromium.org","nkostylev@chromium.org","chromium-reviews@chromium.org","phajdan.jr@chromium.org","nkostylev+cc@chromium.org","davemoore+watch@chromium.org","ben+cc@chromium.org"],"text":"LGTM","disapproval":false,"date":"2010-10-28 14:47:16.696560","approval":true},{"sender":"cmasone@chromium.org","recipients":["reply@chromiumcodereview.appspotmail.com"],"text":"Thanks.\n\nI'm not entirely happy with this solution either.  I'm generally\nunhappy with it, in fact, but it's the least objectionable solution I\ncould find to this corner case that, I hope, goes away, in the\nnot-terribly-distant future :-/\n\nOn Thu, Oct 28, 2010 at 7:47 AM,  <nkostylev@chromium.org> wrote:\n> LGTM\n>\n>\n> http://codereview.chromium.org/4109004/show\n>\n","disapproval":false,"date":"2010-10-28 14:49:45.185953","approval":false}],"owner_email":"cmasone@chromium.org","private":false,"base_url":"svn://svn.chromium.org/chrome/trunk/src","owner":"Chris Masone","subject":"[Chrome OS] Prevent HOSTED accounts from logging in, but still handle CAPTCHA correctly","created":"2010-10-28 03:02:39.201424","patchsets":[1],"modified":"2011-05-09 13:36:23.182983","closed":true,"commit":false,"issue":4109004}