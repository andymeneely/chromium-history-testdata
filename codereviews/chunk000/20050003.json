{"description":"Fix overlay border painting issue on Windows.\n\nMakes AutofillDialogViews::OverlayView::OnPaint()'s accounting for border radius and thickness more robust.\n\nBUG=263066\nR=estade@chromium.org, msw@chromium.org\nTEST=overlays look better\nNOTRY=True\n\nCommitted: https://src.chromium.org/viewvc/chrome?view=rev&revision=213725","cc":["chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org","sky@chromium.org"],"reviewers":["estade@chromium.org","msw@chromium.org"],"messages":[{"sender":"dbeam@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"","disapproval":false,"date":"2013-07-23 21:26:54.920500","approval":false},{"sender":"estade@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"https://chromiumcodereview.appspot.com/20050003/diff/4002/chrome/browser/ui/views/autofill/autofill_dialog_views.cc\nFile chrome/browser/ui/views/autofill/autofill_dialog_views.cc (right):\n\nhttps://chromiumcodereview.appspot.com/20050003/diff/4002/chrome/browser/ui/views/autofill/autofill_dialog_views.cc#newcode639\nchrome/browser/ui/views/autofill/autofill_dialog_views.cc:639: return gfx::Insets(12, 12, 12, 12);\nwhat uses this?\n\nhttps://chromiumcodereview.appspot.com/20050003/diff/4002/chrome/browser/ui/views/autofill/autofill_dialog_views.cc#newcode676\nchrome/browser/ui/views/autofill/autofill_dialog_views.cc:676: GetWidget()->non_client_view()->frame_view())->bubble_border();\nI get why you're doing this, but imo this is worse than just copying the constant you need to copy.","disapproval":false,"date":"2013-07-23 21:47:43.451270","approval":false},{"sender":"dbeam@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"the spacing on both platforms has been playing tag, I think I finally got them to agree\n\nhttps://chromiumcodereview.appspot.com/20050003/diff/4002/chrome/browser/ui/views/autofill/autofill_dialog_views.cc\nFile chrome/browser/ui/views/autofill/autofill_dialog_views.cc (right):\n\nhttps://chromiumcodereview.appspot.com/20050003/diff/4002/chrome/browser/ui/views/autofill/autofill_dialog_views.cc#newcode639\nchrome/browser/ui/views/autofill/autofill_dialog_views.cc:639: return gfx::Insets(12, 12, 12, 12);\nOn 2013/07/23 21:47:44, Evan Stade wrote:\n> what uses this?\n\nsorry, had a newer patch locally, didn't upload","disapproval":false,"date":"2013-07-23 22:42:17.931690","approval":false},{"sender":"estade@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"https://codereview.chromium.org/20050003/diff/12001/chrome/browser/ui/views/autofill/autofill_dialog_views.h\nFile chrome/browser/ui/views/autofill/autofill_dialog_views.h (right):\n\nhttps://codereview.chromium.org/20050003/diff/12001/chrome/browser/ui/views/autofill/autofill_dialog_views.h#newcode295\nchrome/browser/ui/views/autofill/autofill_dialog_views.h:295: virtual gfx::Rect GetContentsBounds() const OVERRIDE;\nare you not compiling with clang? This is not an override (GetContentsBounds is not virtual).","disapproval":false,"date":"2013-07-23 23:43:47.002230","approval":false},{"sender":"dbeam@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"more physical\n\nhttps://chromiumcodereview.appspot.com/20050003/diff/12001/chrome/browser/ui/views/autofill/autofill_dialog_views.h\nFile chrome/browser/ui/views/autofill/autofill_dialog_views.h (right):\n\nhttps://chromiumcodereview.appspot.com/20050003/diff/12001/chrome/browser/ui/views/autofill/autofill_dialog_views.h#newcode295\nchrome/browser/ui/views/autofill/autofill_dialog_views.h:295: virtual gfx::Rect GetContentsBounds() const OVERRIDE;\nOn 2013/07/23 23:43:47, Evan Stade wrote:\n> are you not compiling with clang? This is not an override (GetContentsBounds is\n> not virtual).\n\nI made it virtual...","disapproval":false,"date":"2013-07-24 03:12:49.204270","approval":false},{"sender":"estade@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"+msw\n\nhttps://codereview.chromium.org/20050003/diff/20001/chrome/browser/ui/views/autofill/autofill_dialog_views.cc\nFile chrome/browser/ui/views/autofill/autofill_dialog_views.cc (right):\n\nhttps://codereview.chromium.org/20050003/diff/20001/chrome/browser/ui/views/autofill/autofill_dialog_views.cc#newcode730\nchrome/browser/ui/views/autofill/autofill_dialog_views.cc:730: return static_cast<views::BubbleFrameView*>(\nI don't think this is safe.\n\nhttps://codereview.chromium.org/20050003/diff/20001/chrome/browser/ui/views/autofill/autofill_dialog_views.h\nFile chrome/browser/ui/views/autofill/autofill_dialog_views.h (right):\n\nhttps://codereview.chromium.org/20050003/diff/20001/chrome/browser/ui/views/autofill/autofill_dialog_views.h#newcode295\nchrome/browser/ui/views/autofill/autofill_dialog_views.h:295: virtual gfx::Insets GetInsets() const OVERRIDE;\nstill virtual","disapproval":false,"date":"2013-07-24 20:43:05.728510","approval":false},{"sender":"dbeam@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"https://codereview.chromium.org/20050003/diff/20001/chrome/browser/ui/views/autofill/autofill_dialog_views.cc\nFile chrome/browser/ui/views/autofill/autofill_dialog_views.cc (right):\n\nhttps://codereview.chromium.org/20050003/diff/20001/chrome/browser/ui/views/autofill/autofill_dialog_views.cc#newcode730\nchrome/browser/ui/views/autofill/autofill_dialog_views.cc:730: return static_cast<views::BubbleFrameView*>(\nOn 2013/07/24 20:43:06, Evan Stade wrote:\n> I don't think this is safe.\n\nwill use GetAncestorWithClassName(\"BubbleFrameView\") like we talked about","disapproval":false,"date":"2013-07-24 21:23:46.800610","approval":false},{"sender":"msw@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"I'm confused by what's going on here. Is there some functionality that dialogs are missing that causes this dialog to need so many hacks and overridden/atypical behavior?","disapproval":false,"date":"2013-07-24 21:48:07.695770","approval":false},{"sender":"dbeam@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"On 2013/07/24 21:48:07, msw wrote:\n> I'm confused by what's going on here. Is there some functionality that dialogs\n> are missing that causes this dialog to need so many hacks and\n> overridden/atypical behavior?\n\nmsw@: see bug","disapproval":false,"date":"2013-07-24 22:38:41.625560","approval":false},{"sender":"msw@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"On 2013/07/24 22:38:41, Dan Beam wrote:\n> On 2013/07/24 21:48:07, msw wrote:\n> > I'm confused by what's going on here. Is there some functionality that dialogs\n> > are missing that causes this dialog to need so many hacks and\n> > overridden/atypical behavior?\n> \n> msw@: see bug\n\nCan't you just schedule a paint or invalidate layout on the border or something?","disapproval":false,"date":"2013-07-24 22:41:31.707030","approval":false},{"sender":"dbeam@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org"],"text":"On 2013/07/24 22:41:31, msw wrote:\n> On 2013/07/24 22:38:41, Dan Beam wrote:\n> > On 2013/07/24 21:48:07, msw wrote:\n> > > I'm confused by what's going on here. Is there some functionality that\n> dialogs\n> > > are missing that causes this dialog to need so many hacks and\n> > > overridden/atypical behavior?\n> > \n> > msw@: see bug\n> \n> Can't you just schedule a paint or invalidate layout on the border or something?\n\nto expound, this is an issue in our code trying to match the behavior of the BubbleFrameView's border, not an issue with DialogDelegateView/BubbleFrameView itself (AFAIK).  it would, however, be useful if the frame view masked the overlay view instead of having to copy the style ourselves.","disapproval":false,"date":"2013-07-24 22:51:52.158580","approval":false},{"sender":"msw@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org","sky@chromium.org"],"text":"On 2013/07/24 22:51:52, Dan Beam wrote:\n> On 2013/07/24 22:41:31, msw wrote:\n> > On 2013/07/24 22:38:41, Dan Beam wrote:\n> > > On 2013/07/24 21:48:07, msw wrote:\n> > > > I'm confused by what's going on here. Is there some functionality that\n> > dialogs\n> > > > are missing that causes this dialog to need so many hacks and\n> > > > overridden/atypical behavior?\n> > > \n> > > msw@: see bug\n> > \n> > Can't you just schedule a paint or invalidate layout on the border or\n> something?\n> \n> to expound, this is an issue in our code trying to match the behavior of the\n> BubbleFrameView's border, not an issue with DialogDelegateView/BubbleFrameView\n> itself (AFAIK).  it would, however, be useful if the frame view masked the\n> overlay view instead of having to copy the style ourselves.\n\nSorry, I'd never heard of OverlayView; it seems REALLY odd to me :-/\nWhy aren't View contents simply updated or swapped as needed instead?\nMatching frame view border behavior sounds like sketchy code duplication.\nSorry for derailing with potentially unrelated questions and comments, but I'm definitely not up to speed on the complexities of this dialog nor the overlay view approach/necessity; I'm a little dubious of the implementation decisions leading up to that, but I guess Scott approved the original CL(s). Feel free to catch me up on that (perhaps chat/hangout would be easier), ask me about more specific dialog/bubble/border behavior, or ignore me altogether :p","disapproval":false,"date":"2013-07-24 23:17:20.139600","approval":false},{"sender":"dbeam@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org","sky@chromium.org"],"text":"msw@, while you're here ;), can you review ui/views/bubble?","disapproval":false,"date":"2013-07-24 23:38:57.564500","approval":false},{"sender":"msw@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org","sky@chromium.org"],"text":"The ui/views/bubble change alone LGTM.","disapproval":false,"date":"2013-07-24 23:44:28.932620","approval":true},{"sender":"estade@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org","sky@chromium.org"],"text":"On 2013/07/24 23:17:20, msw wrote:\n> On 2013/07/24 22:51:52, Dan Beam wrote:\n> > On 2013/07/24 22:41:31, msw wrote:\n> > > On 2013/07/24 22:38:41, Dan Beam wrote:\n> > > > On 2013/07/24 21:48:07, msw wrote:\n> > > > > I'm confused by what's going on here. Is there some functionality that\n> > > dialogs\n> > > > > are missing that causes this dialog to need so many hacks and\n> > > > > overridden/atypical behavior?\n> > > > \n> > > > msw@: see bug\n> > > \n> > > Can't you just schedule a paint or invalidate layout on the border or\n> > something?\n> > \n> > to expound, this is an issue in our code trying to match the behavior of the\n> > BubbleFrameView's border, not an issue with DialogDelegateView/BubbleFrameView\n> > itself (AFAIK).  it would, however, be useful if the frame view masked the\n> > overlay view instead of having to copy the style ourselves.\n> \n> Sorry, I'd never heard of OverlayView; it seems REALLY odd to me :-/\n> Why aren't View contents simply updated or swapped as needed instead?\n> Matching frame view border behavior sounds like sketchy code duplication.\n> Sorry for derailing with potentially unrelated questions and comments, but I'm\n> definitely not up to speed on the complexities of this dialog nor the overlay\n> view approach/necessity; I'm a little dubious of the implementation decisions\n> leading up to that, but I guess Scott approved the original CL(s). Feel free to\n> catch me up on that (perhaps chat/hangout would be easier), ask me about more\n> specific dialog/bubble/border behavior, or ignore me altogether :p\n\nthe overlay extends over the title bar and close button.","disapproval":false,"date":"2013-07-25 01:09:19.506570","approval":false},{"sender":"estade@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org","sky@chromium.org"],"text":"lgtm aside from strcmp","disapproval":false,"date":"2013-07-25 01:11:35.282770","approval":true},{"sender":"msw@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org","sky@chromium.org"],"text":"On 2013/07/25 01:09:19, Evan Stade wrote:\n> On 2013/07/24 23:17:20, msw wrote:\n> > On 2013/07/24 22:51:52, Dan Beam wrote:\n> > > On 2013/07/24 22:41:31, msw wrote:\n> > > > On 2013/07/24 22:38:41, Dan Beam wrote:\n> > > > > On 2013/07/24 21:48:07, msw wrote:\n> > > > > > I'm confused by what's going on here. Is there some functionality that\n> > > > dialogs\n> > > > > > are missing that causes this dialog to need so many hacks and\n> > > > > > overridden/atypical behavior?\n> > > > > \n> > > > > msw@: see bug\n> > > > \n> > > > Can't you just schedule a paint or invalidate layout on the border or\n> > > something?\n> > > \n> > > to expound, this is an issue in our code trying to match the behavior of the\n> > > BubbleFrameView's border, not an issue with\n> DialogDelegateView/BubbleFrameView\n> > > itself (AFAIK).  it would, however, be useful if the frame view masked the\n> > > overlay view instead of having to copy the style ourselves.\n> > \n> > Sorry, I'd never heard of OverlayView; it seems REALLY odd to me :-/\n> > Why aren't View contents simply updated or swapped as needed instead?\n> > Matching frame view border behavior sounds like sketchy code duplication.\n> > Sorry for derailing with potentially unrelated questions and comments, but I'm\n> > definitely not up to speed on the complexities of this dialog nor the overlay\n> > view approach/necessity; I'm a little dubious of the implementation decisions\n> > leading up to that, but I guess Scott approved the original CL(s). Feel free\n> to\n> > catch me up on that (perhaps chat/hangout would be easier), ask me about more\n> > specific dialog/bubble/border behavior, or ignore me altogether :p\n> \n> the overlay extends over the title bar and close button.\n\nThat doesn't seem like a big deal, but I could suggest a number of alternate (hopefully simpler) ways to ignore/solve/workaround that problem without adding the complexity of an overlay view.\n1) Show the title and close button, they're informative and helpful, who cares?\n2) Use an empty title but leave the close button (as a recourse for the user).\n3) Use an empty title and add dialog api to control the close button presence.\n4) Show a completely separate interstitial window before showing the dialog.\nI won't bother coming up with more, you get the idea.","disapproval":false,"date":"2013-07-25 01:20:18.256490","approval":false},{"sender":"estade@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org","sky@chromium.org"],"text":"On 2013/07/25 01:20:18, msw wrote:\n> On 2013/07/25 01:09:19, Evan Stade wrote:\n> > On 2013/07/24 23:17:20, msw wrote:\n> > > On 2013/07/24 22:51:52, Dan Beam wrote:\n> > > > On 2013/07/24 22:41:31, msw wrote:\n> > > > > On 2013/07/24 22:38:41, Dan Beam wrote:\n> > > > > > On 2013/07/24 21:48:07, msw wrote:\n> > > > > > > I'm confused by what's going on here. Is there some functionality\n> that\n> > > > > dialogs\n> > > > > > > are missing that causes this dialog to need so many hacks and\n> > > > > > > overridden/atypical behavior?\n> > > > > > \n> > > > > > msw@: see bug\n> > > > > \n> > > > > Can't you just schedule a paint or invalidate layout on the border or\n> > > > something?\n> > > > \n> > > > to expound, this is an issue in our code trying to match the behavior of\n> the\n> > > > BubbleFrameView's border, not an issue with\n> > DialogDelegateView/BubbleFrameView\n> > > > itself (AFAIK).  it would, however, be useful if the frame view masked the\n> > > > overlay view instead of having to copy the style ourselves.\n> > > \n> > > Sorry, I'd never heard of OverlayView; it seems REALLY odd to me :-/\n> > > Why aren't View contents simply updated or swapped as needed instead?\n> > > Matching frame view border behavior sounds like sketchy code duplication.\n> > > Sorry for derailing with potentially unrelated questions and comments, but\n> I'm\n> > > definitely not up to speed on the complexities of this dialog nor the\n> overlay\n> > > view approach/necessity; I'm a little dubious of the implementation\n> decisions\n> > > leading up to that, but I guess Scott approved the original CL(s). Feel free\n> > to\n> > > catch me up on that (perhaps chat/hangout would be easier), ask me about\n> more\n> > > specific dialog/bubble/border behavior, or ignore me altogether :p\n> > \n> > the overlay extends over the title bar and close button.\n> \n> That doesn't seem like a big deal, but I could suggest a number of alternate\n> (hopefully simpler) ways to ignore/solve/workaround that problem without adding\n> the complexity of an overlay view.\n> 1) Show the title and close button, they're informative and helpful, who cares?\n\nUX\n\n> 2) Use an empty title but leave the close button (as a recourse for the user).\n\ndoesn't match mocks; we're intentionally trying to make it impossible to close the dialog\n\n> 3) Use an empty title and add dialog api to control the close button presence.\n\nit also needs to hide the dialog buttons and extra view, and not only hide them but use that space.\n\n> 4) Show a completely separate interstitial window before showing the dialog.\n\nin many cases we'll have to go back to showing the dialog --- alternating between dialogs sounds like a world of pain\n\n> I won't bother coming up with more, you get the idea.","disapproval":false,"date":"2013-07-25 01:22:49.901050","approval":false},{"sender":"dbeam@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org","sky@chromium.org"],"text":"On 2013/07/24 23:17:20, msw wrote:\n> On 2013/07/24 22:51:52, Dan Beam wrote:\n> > On 2013/07/24 22:41:31, msw wrote:\n> > > On 2013/07/24 22:38:41, Dan Beam wrote:\n> > > > On 2013/07/24 21:48:07, msw wrote:\n> > > > > I'm confused by what's going on here. Is there some functionality that\n> > > dialogs\n> > > > > are missing that causes this dialog to need so many hacks and\n> > > > > overridden/atypical behavior?\n> > > > \n> > > > msw@: see bug\n> > > \n> > > Can't you just schedule a paint or invalidate layout on the border or\n> > something?\n> > \n> > to expound, this is an issue in our code trying to match the behavior of the\n> > BubbleFrameView's border, not an issue with DialogDelegateView/BubbleFrameView\n> > itself (AFAIK).  it would, however, be useful if the frame view masked the\n> > overlay view instead of having to copy the style ourselves.\n> \n> Sorry, I'd never heard of OverlayView; it seems REALLY odd to me :-/\n> Why aren't View contents simply updated or swapped as needed instead?\n> Matching frame view border behavior sounds like sketchy code duplication.\n\nI think this is only a problem if we see this pattern occurring over and over again.  If we do, we'll revisit.\n\n> Sorry for derailing with potentially unrelated questions and comments, but I'm\n> definitely not up to speed on the complexities of this dialog nor the overlay\n> view approach/necessity; I'm a little dubious of the implementation decisions\n> leading up to that, but I guess Scott approved the original CL(s). Feel free to\n> catch me up on that (perhaps chat/hangout would be easier), ask me about more\n> specific dialog/bubble/border behavior, or ignore me altogether :p","disapproval":false,"date":"2013-07-25 01:27:31.834780","approval":false},{"sender":"commit-bot@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org","sky@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/dbeam@chromium.org/20050003/50001","disapproval":false,"date":"2013-07-25 01:29:37.459720","approval":false},{"sender":"msw@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org","sky@chromium.org"],"text":"On 2013/07/25 01:22:49, Evan Stade wrote:\n> On 2013/07/25 01:20:18, msw wrote:\n> > On 2013/07/25 01:09:19, Evan Stade wrote:\n> > > On 2013/07/24 23:17:20, msw wrote:\n> > > > On 2013/07/24 22:51:52, Dan Beam wrote:\n> > > > > On 2013/07/24 22:41:31, msw wrote:\n> > > > > > On 2013/07/24 22:38:41, Dan Beam wrote:\n> > > > > > > On 2013/07/24 21:48:07, msw wrote:\n> > > > > > > > I'm confused by what's going on here. Is there some functionality\n> > that\n> > > > > > dialogs\n> > > > > > > > are missing that causes this dialog to need so many hacks and\n> > > > > > > > overridden/atypical behavior?\n> > > > > > > \n> > > > > > > msw@: see bug\n> > > > > > \n> > > > > > Can't you just schedule a paint or invalidate layout on the border or\n> > > > > something?\n> > > > > \n> > > > > to expound, this is an issue in our code trying to match the behavior of\n> > the\n> > > > > BubbleFrameView's border, not an issue with\n> > > DialogDelegateView/BubbleFrameView\n> > > > > itself (AFAIK).  it would, however, be useful if the frame view masked\n> the\n> > > > > overlay view instead of having to copy the style ourselves.\n> > > > \n> > > > Sorry, I'd never heard of OverlayView; it seems REALLY odd to me :-/\n> > > > Why aren't View contents simply updated or swapped as needed instead?\n> > > > Matching frame view border behavior sounds like sketchy code duplication.\n> > > > Sorry for derailing with potentially unrelated questions and comments, but\n> > I'm\n> > > > definitely not up to speed on the complexities of this dialog nor the\n> > overlay\n> > > > view approach/necessity; I'm a little dubious of the implementation\n> > decisions\n> > > > leading up to that, but I guess Scott approved the original CL(s). Feel\n> free\n> > > to\n> > > > catch me up on that (perhaps chat/hangout would be easier), ask me about\n> > more\n> > > > specific dialog/bubble/border behavior, or ignore me altogether :p\n> > > \n> > > the overlay extends over the title bar and close button.\n> > \n> > That doesn't seem like a big deal, but I could suggest a number of alternate\n> > (hopefully simpler) ways to ignore/solve/workaround that problem without\n> adding\n> > the complexity of an overlay view.\n> > 1) Show the title and close button, they're informative and helpful, who\n> cares?\n> \n> UX\n> \n> > 2) Use an empty title but leave the close button (as a recourse for the user).\n> \n> doesn't match mocks; we're intentionally trying to make it impossible to close\n> the dialog\n> \n> > 3) Use an empty title and add dialog api to control the close button presence.\n> \n> it also needs to hide the dialog buttons and extra view, and not only hide them\n> but use that space.\n> \n> > 4) Show a completely separate interstitial window before showing the dialog.\n> \n> in many cases we'll have to go back to showing the dialog --- alternating\n> between dialogs sounds like a world of pain\n> \n> > I won't bother coming up with more, you get the idea.\n\nI guess baffling designs yield baffling code. Did you consider shortcutting/overriding the dialog/frame OnPaint instead of managing a view on top? (since the red stripe paints to the edges but is clipped by the frame's border, i'm guessing something similar could be done on top of or instead of all the other dialog content and frame painting). If there's really no better solution than placing some view over all the dialog contents and frame view contents... does it (A) extend into the border and thus need to mimic some border logic? Or does it (B) simply cover a minimal solid rect over the dialog contents and frame elements? If (B), is that why some red bits of the underlying stripe show through on the sides? Could you simply remove the red stripe when the overlay is showing? Does it matter that the http://crbug.com/263066 pic shows the overlay colors not extending to the edges of the dialog elsewhere?\n\nAgain, if you've thought this all out and my questions and snarky comments are useless, just tell me so and I'll leave you to it. But really, I feel bad that you're implementing something so complex for so seemingly arbitrary/bad design choices.","disapproval":false,"date":"2013-07-25 01:43:13.344460","approval":false},{"sender":"commit-bot@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org","sky@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/dbeam@chromium.org/20050003/50001","disapproval":false,"date":"2013-07-25 14:10:13.325280","approval":false},{"sender":"estade@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org","sky@chromium.org"],"text":"On 2013/07/25 01:43:13, msw wrote:\n> On 2013/07/25 01:22:49, Evan Stade wrote:\n> > On 2013/07/25 01:20:18, msw wrote:\n> > > On 2013/07/25 01:09:19, Evan Stade wrote:\n> > > > On 2013/07/24 23:17:20, msw wrote:\n> > > > > On 2013/07/24 22:51:52, Dan Beam wrote:\n> > > > > > On 2013/07/24 22:41:31, msw wrote:\n> > > > > > > On 2013/07/24 22:38:41, Dan Beam wrote:\n> > > > > > > > On 2013/07/24 21:48:07, msw wrote:\n> > > > > > > > > I'm confused by what's going on here. Is there some\n> functionality\n> > > that\n> > > > > > > dialogs\n> > > > > > > > > are missing that causes this dialog to need so many hacks and\n> > > > > > > > > overridden/atypical behavior?\n> > > > > > > > \n> > > > > > > > msw@: see bug\n> > > > > > > \n> > > > > > > Can't you just schedule a paint or invalidate layout on the border\n> or\n> > > > > > something?\n> > > > > > \n> > > > > > to expound, this is an issue in our code trying to match the behavior\n> of\n> > > the\n> > > > > > BubbleFrameView's border, not an issue with\n> > > > DialogDelegateView/BubbleFrameView\n> > > > > > itself (AFAIK).  it would, however, be useful if the frame view masked\n> > the\n> > > > > > overlay view instead of having to copy the style ourselves.\n> > > > > \n> > > > > Sorry, I'd never heard of OverlayView; it seems REALLY odd to me :-/\n> > > > > Why aren't View contents simply updated or swapped as needed instead?\n> > > > > Matching frame view border behavior sounds like sketchy code\n> duplication.\n> > > > > Sorry for derailing with potentially unrelated questions and comments,\n> but\n> > > I'm\n> > > > > definitely not up to speed on the complexities of this dialog nor the\n> > > overlay\n> > > > > view approach/necessity; I'm a little dubious of the implementation\n> > > decisions\n> > > > > leading up to that, but I guess Scott approved the original CL(s). Feel\n> > free\n> > > > to\n> > > > > catch me up on that (perhaps chat/hangout would be easier), ask me about\n> > > more\n> > > > > specific dialog/bubble/border behavior, or ignore me altogether :p\n> > > > \n> > > > the overlay extends over the title bar and close button.\n> > > \n> > > That doesn't seem like a big deal, but I could suggest a number of alternate\n> > > (hopefully simpler) ways to ignore/solve/workaround that problem without\n> > adding\n> > > the complexity of an overlay view.\n> > > 1) Show the title and close button, they're informative and helpful, who\n> > cares?\n> > \n> > UX\n> > \n> > > 2) Use an empty title but leave the close button (as a recourse for the\n> user).\n> > \n> > doesn't match mocks; we're intentionally trying to make it impossible to close\n> > the dialog\n> > \n> > > 3) Use an empty title and add dialog api to control the close button\n> presence.\n> > \n> > it also needs to hide the dialog buttons and extra view, and not only hide\n> them\n> > but use that space.\n> > \n> > > 4) Show a completely separate interstitial window before showing the dialog.\n> > \n> > in many cases we'll have to go back to showing the dialog --- alternating\n> > between dialogs sounds like a world of pain\n> > \n> > > I won't bother coming up with more, you get the idea.\n> \n> I guess baffling designs yield baffling code. Did you consider\n> shortcutting/overriding the dialog/frame OnPaint instead of managing a view on\n> top? (since the red stripe paints to the edges but is clipped by the frame's\n> border, i'm guessing something similar could be done on top of or instead of all\n> the other dialog content and frame painting). If there's really no better\n> solution than placing some view over all the dialog contents and frame view\n> contents... does it (A) extend into the border and thus need to mimic some\n> border logic? Or does it (B) simply cover a minimal solid rect over the dialog\n> contents and frame elements? If (B), is that why some red bits of the underlying\n> stripe show through on the sides? Could you simply remove the red stripe when\n> the overlay is showing? Does it matter that the http://crbug.com/263066 pic\n> shows the overlay colors not extending to the edges of the dialog elsewhere?\n\n(A) (The screenshot you're looking at describes a bug. The colors should go all the way to the border.)\n\n> \n> Again, if you've thought this all out and my questions and snarky comments are\n> useless, just tell me so and I'll leave you to it. But really, I feel bad that\n> you're implementing something so complex for so seemingly arbitrary/bad design\n> choices.","disapproval":false,"date":"2013-07-25 17:54:18.221230","approval":false},{"sender":"msw@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org","sky@chromium.org"],"text":"On 2013/07/25 17:54:18, Evan Stade wrote:\n> On 2013/07/25 01:43:13, msw wrote:\n> > ... If there's really no better\n> > solution than placing some view over all the dialog contents and frame view\n> > contents... does it (A) extend into the border and thus need to mimic some\n> > border logic? Or does it (B) ...\n> (A) (The screenshot you're looking at describes a bug. The colors should go all\n> the way to the border.)\n\nWould it make more sense to set the dialog color and clear the red strip to match the overlay, instead of trying to shape the overlay to match the shape of the dialog's border?","disapproval":false,"date":"2013-07-25 18:08:50.499680","approval":false},{"sender":"estade@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org","sky@chromium.org"],"text":"On 2013/07/25 18:08:50, msw wrote:\n> On 2013/07/25 17:54:18, Evan Stade wrote:\n> > On 2013/07/25 01:43:13, msw wrote:\n> > > ... If there's really no better\n> > > solution than placing some view over all the dialog contents and frame view\n> > > contents... does it (A) extend into the border and thus need to mimic some\n> > > border logic? Or does it (B) ...\n> > (A) (The screenshot you're looking at describes a bug. The colors should go\n> all\n> > the way to the border.)\n> \n> Would it make more sense to set the dialog color and clear the red strip to\n> match the overlay, instead of trying to shape the overlay to match the shape of\n> the dialog's border?\n\nThe color of the bottom area (and the border above it) is supposed to extend all the way to the edge of the dialog.","disapproval":false,"date":"2013-07-25 18:12:53.936210","approval":false},{"sender":"msw@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org","sky@chromium.org"],"text":"On 2013/07/25 18:12:53, Evan Stade wrote:\n> On 2013/07/25 18:08:50, msw wrote:\n> > On 2013/07/25 17:54:18, Evan Stade wrote:\n> > > On 2013/07/25 01:43:13, msw wrote:\n> > > > ... If there's really no better\n> > > > solution than placing some view over all the dialog contents and frame\n> view\n> > > > contents... does it (A) extend into the border and thus need to mimic some\n> > > > border logic? Or does it (B) ...\n> > > (A) (The screenshot you're looking at describes a bug. The colors should go\n> > all\n> > > the way to the border.)\n> > \n> > Would it make more sense to set the dialog color and clear the red strip to\n> > match the overlay, instead of trying to shape the overlay to match the shape\n> of\n> > the dialog's border?\n> \n> The color of the bottom area (and the border above it) is supposed to extend all\n> the way to the edge of the dialog.\n\nComplex dialog is complex... I guess I'm out of ideas.\nFeel free to send me reviews adding any needed support to the common dialog infrastructure, but thank you for keeping the majority of this complexity limited to this one unusual use case, and thanks for entertaining my questions and comments. I hope that maybe this sort of design complexity will be simpler to implement with Aura window decorations once we don't need to support non-Aura Views windows (see ui/views/corewm/shadow.cc or ask derat@ and other authors there if that's really possible, if you're interested).","disapproval":false,"date":"2013-07-25 18:24:01.940990","approval":false},{"sender":"dbeam@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org","sky@chromium.org"],"text":"Committed patchset #14 manually as r213725 (presubmit successful).","disapproval":false,"date":"2013-07-26 00:21:53.386480","approval":false},{"sender":"commit-bot@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org","sky@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/dbeam@chromium.org/20050003/50001","disapproval":false,"date":"2013-07-26 01:53:41.664010","approval":false},{"sender":"commit-bot@chromium.org","recipients":["dbeam@chromium.org","estade@chromium.org","msw@chromium.org","chromium-reviews@chromium.org","ramankk@chromium.org","benquan@chromium.org","tfarina@chromium.org","ahutter@chromium.org","dgwallinga@chromium.org","dyu@chromium.org","estade+watch@chromium.org","abodenha@chromium.org","isherman@chromium.org","rouslan+autofillwatch@chromium.org","sky@chromium.org"],"text":"Failed to apply patch for chrome/browser/ui/views/autofill/autofill_dialog_views.cc:\nWhile running patch -p1 --forward --force --no-backup-if-mismatch;\n  patching file chrome/browser/ui/views/autofill/autofill_dialog_views.cc\n  Hunk #1 FAILED at 33.\n  Hunk #2 FAILED at 548.\n  Hunk #3 FAILED at 633.\n  Hunk #4 FAILED at 666.\n  Hunk #5 succeeded at 730 with fuzz 1 (offset 11 lines).\n  4 out of 5 hunks FAILED -- saving rejects to file chrome/browser/ui/views/autofill/autofill_dialog_views.cc.rej\n\nPatch:       chrome/browser/ui/views/autofill/autofill_dialog_views.cc\nIndex: chrome/browser/ui/views/autofill/autofill_dialog_views.cc\ndiff --git a/chrome/browser/ui/views/autofill/autofill_dialog_views.cc b/chrome/browser/ui/views/autofill/autofill_dialog_views.cc\nindex 29dda7caf497a6e2be2fcb321de22662e6c83b48..7865ec546e4b59ea69e68a415212dc6f5be9c2d7 100644\n--- a/chrome/browser/ui/views/autofill/autofill_dialog_views.cc\n+++ b/chrome/browser/ui/views/autofill/autofill_dialog_views.cc\n@@ -33,6 +33,8 @@\n #include \"ui/gfx/skia_util.h\"\n #include \"ui/views/background.h\"\n #include \"ui/views/border.h\"\n+#include \"ui/views/bubble/bubble_border.h\"\n+#include \"ui/views/bubble/bubble_frame_view.h\"\n #include \"ui/views/controls/button/blue_button.h\"\n #include \"ui/views/controls/button/checkbox.h\"\n #include \"ui/views/controls/button/image_button.h\"\n@@ -548,7 +550,6 @@ AutofillDialogViews::OverlayView::OverlayView(views::ButtonListener* listener)\n     : image_view_(new views::ImageView()),\n       message_stack_(new views::View()),\n       button_(new views::BlueButton(listener, string16())) {\n-  set_border(views::Border::CreateEmptyBorder(12, 12, 12, 12));\n   set_background(views::Background::CreateSolidBackground(GetNativeTheme()->\n       GetSystemColor(ui::NativeTheme::kColorId_DialogBackground)));\n \n@@ -633,8 +634,12 @@ void AutofillDialogViews::OverlayView::AnimationEnded(\n   fade_out_.reset();\n }\n \n+gfx::Insets AutofillDialogViews::OverlayView::GetInsets() const {\n+  return gfx::Insets(12, 12, 12, 12);\n+}\n+\n void AutofillDialogViews::OverlayView::Layout() {\n-  gfx::Rect bounds = GetContentsBounds();\n+  gfx::Rect bounds = ContentBoundsSansBubbleBorder();\n   if (!message_stack_->visible()) {\n     image_view_->SetBoundsRect(bounds);\n     return;\n@@ -666,8 +671,9 @@ const char* AutofillDialogViews::OverlayView::GetClassName() const {\n void AutofillDialogViews::OverlayView::OnPaint(gfx::Canvas* canvas) {\n   // BubbleFrameView doesn't mask the window, it just draws the border via\n   // image assets. Match that rounding here.\n-  static const SkScalar kCornerRadius = SkIntToScalar(2);\n-  gfx::Rect rect = GetContentsBounds();\n+  gfx::Rect rect = ContentBoundsSansBubbleBorder();\n+  const SkScalar kCornerRadius = SkIntToScalar(\n+      GetBubbleBorder() ? GetBubbleBorder()->GetBorderCornerRadius() : 2);\n   gfx::Path window_mask;\n   window_mask.addRoundRect(gfx::RectToSkRect(rect),\n                            kCornerRadius, kCornerRadius);\n@@ -719,6 +725,24 @@ void AutofillDialogViews::OverlayView::PaintChildren(gfx::Canvas* canvas) {\n   views::View::PaintChildren(canvas);\n }\n \n+views::BubbleBorder* AutofillDialogViews::OverlayView::GetBubbleBorder() {\n+  views::View* frame = GetWidget()->non_client_view()->frame_view();\n+  std::string bubble_frame_view_name(views::BubbleFrameView::kViewClassName);\n+  if (frame->GetClassName() == bubble_frame_view_name)\n+    return static_cast<views::BubbleFrameView*>(frame)->bubble_border();\n+  NOTREACHED();\n+  return NULL;\n+}\n+\n+gfx::Rect AutofillDialogViews::OverlayView::ContentBoundsSansBubbleBorder() {\n+  gfx::Rect bounds = GetContentsBounds();\n+  int bubble_width = 5;\n+  if (GetBubbleBorder())\n+    bubble_width = GetBubbleBorder()->GetBorderThickness();\n+  bounds.Inset(bubble_width, bubble_width, bubble_width, bubble_width);\n+  return bounds;\n+}\n+\n // AutofillDialogViews::NotificationArea ---------------------------------------\n \n AutofillDialogViews::NotificationArea::NotificationArea(","disapproval":false,"date":"2013-07-26 01:53:43.692180","approval":false}],"owner_email":"dbeam@chromium.org","private":false,"base_url":"https://chromium.googlesource.com/chromium/src.git@master","owner":"Dan Beam","subject":"Fix overlay border painting issue on Windows.","created":"2013-07-23 19:14:50.232120","patchsets":[1,2001,4002,8001,9001,12001,18001,20001,28001,31001,35001,43001,50001,66001],"modified":"2013-07-26 01:53:44.541780","closed":true,"commit":false,"issue":20050003}