{"description":"Make views web intents picker able to initialize directly to inline disposition.\n\n\nBUG=\n\n\nCommitted: http://src.chromium.org/viewvc/chrome?view=rev&revision=161997","cc":["chromium-reviews@chromium.org","gbillock+watch@chromium.org","smckay+watch@chromium.org","groby+watch@chromium.org","rouslan+watch@chromium.org","tfarina@chromium.org"],"reviewers":["rouslan@chromium.org","groby@chromium.org","sail@chromium.org","pkasting@google.com","pkasting@chromium.org"],"messages":[{"sender":"gbillock@chromium.org","recipients":["gbillock@chromium.org","rouslan@chromium.org","groby@chromium.org","sail@chromium.org","chromium-reviews@chromium.org","gbillock+watch@chromium.org","smckay+watch@chromium.org","groby+watch@chromium.org","rouslan+watch@chromium.org","tfarina@chromium.org"],"text":"Follow-up to http://codereview.chromium.org/11126002/","disapproval":false,"date":"2012-10-13 09:16:52.101080","approval":false},{"sender":"rouslan@chromium.org","recipients":["gbillock@chromium.org","rouslan@chromium.org","groby@chromium.org","sail@chromium.org","chromium-reviews@chromium.org","gbillock+watch@chromium.org","smckay+watch@chromium.org","groby+watch@chromium.org","rouslan+watch@chromium.org","tfarina@chromium.org"],"text":"On 2012/10/13 09:16:52, Greg Billock wrote:\n> Follow-up to http://codereview.chromium.org/11126002/\n\nlooks it will get the job done :-)","disapproval":false,"date":"2012-10-13 20:09:53.268380","approval":false},{"sender":"gbillock@chromium.org","recipients":["gbillock@chromium.org","rouslan@chromium.org","groby@chromium.org","sail@chromium.org","pkasting@google.com","chromium-reviews@chromium.org","gbillock+watch@chromium.org","smckay+watch@chromium.org","groby+watch@chromium.org","rouslan+watch@chromium.org","tfarina@chromium.org"],"text":"On 2012/10/13 20:09:53, Rouslan Solomakhin wrote:\n> On 2012/10/13 09:16:52, Greg Billock wrote:\n> > Follow-up to http://codereview.chromium.org/11126002/\n> \n> looks it will get the job done :-)\n\n+pkasting for views owners","disapproval":false,"date":"2012-10-15 15:39:08.259020","approval":false},{"sender":"groby@chromium.org","recipients":["gbillock@chromium.org","rouslan@chromium.org","groby@chromium.org","sail@chromium.org","pkasting@google.com","chromium-reviews@chromium.org","gbillock+watch@chromium.org","smckay+watch@chromium.org","groby+watch@chromium.org","rouslan+watch@chromium.org","tfarina@chromium.org"],"text":"http://codereview.chromium.org/11146006/diff/1/chrome/browser/ui/intents/web_intent_picker_controller.cc\nFile chrome/browser/ui/intents/web_intent_picker_controller.cc (right):\n\nhttp://codereview.chromium.org/11146006/diff/1/chrome/browser/ui/intents/web_intent_picker_controller.cc#newcode1034\nchrome/browser/ui/intents/web_intent_picker_controller.cc:1034: CreatePicker();\nWait, we've abandoned that part of the state machine?\n\nDoes that work, or are we now causing other issues? (I.e. \"use another\" from inline disposition, CWS results coming in _really_ late, etc.)\n\nhttp://codereview.chromium.org/11146006/diff/1/chrome/browser/ui/views/web_intent_picker_views.cc\nFile chrome/browser/ui/views/web_intent_picker_views.cc (right):\n\nhttp://codereview.chromium.org/11146006/diff/1/chrome/browser/ui/views/web_intent_picker_views.cc#newcode951\nchrome/browser/ui/views/web_intent_picker_views.cc:951: // If created in inline disposition mode, lay it out immediately.\nDoes Cocoa/Gtk do the right thing?\n\nhttp://codereview.chromium.org/11146006/diff/1/chrome/browser/ui/views/web_intent_picker_views.cc#newcode1128\nchrome/browser/ui/views/web_intent_picker_views.cc:1128: if (model_->show_use_another_service() &&\nShould the whole clause be part of show_use_another_service()?\n\n(Also, the use of underscore for what looks like a logic instead of a getter function is a bit jarring)","disapproval":false,"date":"2012-10-15 17:24:12.556950","approval":false},{"sender":"gbillock@chromium.org","recipients":["gbillock@chromium.org","rouslan@chromium.org","groby@chromium.org","sail@chromium.org","pkasting@google.com","chromium-reviews@chromium.org","gbillock+watch@chromium.org","smckay+watch@chromium.org","groby+watch@chromium.org","rouslan+watch@chromium.org","tfarina@chromium.org"],"text":"http://codereview.chromium.org/11146006/diff/1/chrome/browser/ui/intents/web_intent_picker_controller.cc\nFile chrome/browser/ui/intents/web_intent_picker_controller.cc (right):\n\nhttp://codereview.chromium.org/11146006/diff/1/chrome/browser/ui/intents/web_intent_picker_controller.cc#newcode1034\nchrome/browser/ui/intents/web_intent_picker_controller.cc:1034: CreatePicker();\nOn 2012/10/15 17:24:12, groby wrote:\n> Wait, we've abandoned that part of the state machine?\n> \n> Does that work, or are we now causing other issues? (I.e. \"use another\" from\n> inline disposition, CWS results coming in _really_ late, etc.)\n\nNo, that state is still there for the picker->inline case. Should I manually set the state to inline here?\n\nBasically I want to not provoke the SetWaitingForSuggestions call.\n\nhttp://codereview.chromium.org/11146006/diff/1/chrome/browser/ui/views/web_intent_picker_views.cc\nFile chrome/browser/ui/views/web_intent_picker_views.cc (right):\n\nhttp://codereview.chromium.org/11146006/diff/1/chrome/browser/ui/views/web_intent_picker_views.cc#newcode951\nchrome/browser/ui/views/web_intent_picker_views.cc:951: // If created in inline disposition mode, lay it out immediately.\nOn 2012/10/15 17:24:12, groby wrote:\n> Does Cocoa/Gtk do the right thing?\n\nSailesh tested this on cocoa. GTK does not look at this flag at present. I need to look at that later.\n\nhttp://codereview.chromium.org/11146006/diff/1/chrome/browser/ui/views/web_intent_picker_views.cc#newcode1128\nchrome/browser/ui/views/web_intent_picker_views.cc:1128: if (model_->show_use_another_service() &&\nOn 2012/10/15 17:24:12, groby wrote:\n> Should the whole clause be part of show_use_another_service()?\n\nArguably, but let's refactor that separately -- there's more cross-toolkit implication that way.\n\n> \n> (Also, the use of underscore for what looks like a logic instead of a getter\n> function is a bit jarring)","disapproval":false,"date":"2012-10-15 18:10:57.533390","approval":false},{"sender":"pkasting@chromium.org","recipients":["gbillock@chromium.org","rouslan@chromium.org","groby@chromium.org","sail@chromium.org","pkasting@google.com","pkasting@chromium.org","chromium-reviews@chromium.org","gbillock+watch@chromium.org","smckay+watch@chromium.org","groby+watch@chromium.org","rouslan+watch@chromium.org","tfarina@chromium.org"],"text":"views LGTM\n\nhttp://codereview.chromium.org/11146006/diff/7005/chrome/browser/ui/views/web_intent_picker_views.cc\nFile chrome/browser/ui/views/web_intent_picker_views.cc (right):\n\nhttp://codereview.chromium.org/11146006/diff/7005/chrome/browser/ui/views/web_intent_picker_views.cc#newcode949\nchrome/browser/ui/views/web_intent_picker_views.cc:949: // If created in inline disposition mode, lay it out immediately.\nNit: Does this comment add very much value?\n\nhttp://codereview.chromium.org/11146006/diff/7005/chrome/browser/ui/views/web_intent_picker_views.cc#newcode1238\nchrome/browser/ui/views/web_intent_picker_views.cc:1238: } else if (model_ && model_->IsWaitingForSuggestions()) {\nNit No else after return\n\nhttp://codereview.chromium.org/11146006/diff/7005/chrome/browser/ui/views/web_intent_picker_views.cc#newcode1247\nchrome/browser/ui/views/web_intent_picker_views.cc:1247: model_->GetSuggestedExtensionCount()) {\nNit: Old indenting was correct","disapproval":false,"date":"2012-10-15 19:00:19.504780","approval":true},{"sender":"gbillock@chromium.org","recipients":["gbillock@chromium.org","rouslan@chromium.org","groby@chromium.org","sail@chromium.org","pkasting@google.com","pkasting@chromium.org","chromium-reviews@chromium.org","gbillock+watch@chromium.org","smckay+watch@chromium.org","groby+watch@chromium.org","rouslan+watch@chromium.org","tfarina@chromium.org"],"text":"http://codereview.chromium.org/11146006/diff/7005/chrome/browser/ui/views/web_intent_picker_views.cc\nFile chrome/browser/ui/views/web_intent_picker_views.cc (right):\n\nhttp://codereview.chromium.org/11146006/diff/7005/chrome/browser/ui/views/web_intent_picker_views.cc#newcode949\nchrome/browser/ui/views/web_intent_picker_views.cc:949: // If created in inline disposition mode, lay it out immediately.\nOn 2012/10/15 19:00:19, Peter Kasting wrote:\n> Nit: Does this comment add very much value?\n\nDone.\n\nhttp://codereview.chromium.org/11146006/diff/7005/chrome/browser/ui/views/web_intent_picker_views.cc#newcode1238\nchrome/browser/ui/views/web_intent_picker_views.cc:1238: } else if (model_ && model_->IsWaitingForSuggestions()) {\nOn 2012/10/15 19:00:19, Peter Kasting wrote:\n> Nit No else after return\n\nDone.\n\nhttp://codereview.chromium.org/11146006/diff/7005/chrome/browser/ui/views/web_intent_picker_views.cc#newcode1247\nchrome/browser/ui/views/web_intent_picker_views.cc:1247: model_->GetSuggestedExtensionCount()) {\nOn 2012/10/15 19:00:19, Peter Kasting wrote:\n> Nit: Old indenting was correct\n\nDone.","disapproval":false,"date":"2012-10-15 19:14:50.784930","approval":false},{"sender":"sail@chromium.org","recipients":["gbillock@chromium.org","rouslan@chromium.org","groby@chromium.org","sail@chromium.org","pkasting@google.com","pkasting@chromium.org","chromium-reviews@chromium.org","gbillock+watch@chromium.org","smckay+watch@chromium.org","groby+watch@chromium.org","rouslan+watch@chromium.org","tfarina@chromium.org"],"text":"cocoa/* LGTM","disapproval":false,"date":"2012-10-15 19:17:01.814080","approval":true},{"sender":"pkasting@chromium.org","recipients":["gbillock@chromium.org","rouslan@chromium.org","groby@chromium.org","sail@chromium.org","pkasting@google.com","pkasting@chromium.org","chromium-reviews@chromium.org","gbillock+watch@chromium.org","smckay+watch@chromium.org","groby+watch@chromium.org","rouslan+watch@chromium.org","tfarina@chromium.org"],"text":"http://codereview.chromium.org/11146006/diff/12001/chrome/browser/ui/views/web_intent_picker_views.cc\nFile chrome/browser/ui/views/web_intent_picker_views.cc (right):\n\nhttp://codereview.chromium.org/11146006/diff/12001/chrome/browser/ui/views/web_intent_picker_views.cc#newcode948\nchrome/browser/ui/views/web_intent_picker_views.cc:948: if (model_->IsInlineDisposition()) {\nNit: {} now unnecessary\n\nhttp://codereview.chromium.org/11146006/diff/12001/chrome/browser/ui/views/web_intent_picker_views.cc#newcode1235\nchrome/browser/ui/views/web_intent_picker_views.cc:1235: if (model_ && model_->IsInlineDisposition())\nSomething is screwy here.  The first two conditionals check whether |model_| is non-null but the third conditional blindly assumes that it is.  This can't be right.","disapproval":false,"date":"2012-10-15 19:17:06.811880","approval":false},{"sender":"gbillock@chromium.org","recipients":["gbillock@chromium.org","rouslan@chromium.org","groby@chromium.org","sail@chromium.org","pkasting@google.com","pkasting@chromium.org","chromium-reviews@chromium.org","gbillock+watch@chromium.org","smckay+watch@chromium.org","groby+watch@chromium.org","rouslan+watch@chromium.org","tfarina@chromium.org"],"text":"http://codereview.chromium.org/11146006/diff/12001/chrome/browser/ui/views/web_intent_picker_views.cc\nFile chrome/browser/ui/views/web_intent_picker_views.cc (right):\n\nhttp://codereview.chromium.org/11146006/diff/12001/chrome/browser/ui/views/web_intent_picker_views.cc#newcode948\nchrome/browser/ui/views/web_intent_picker_views.cc:948: if (model_->IsInlineDisposition()) {\nOn 2012/10/15 19:17:07, Peter Kasting wrote:\n> Nit: {} now unnecessary\n\nDone.\n\nhttp://codereview.chromium.org/11146006/diff/12001/chrome/browser/ui/views/web_intent_picker_views.cc#newcode1235\nchrome/browser/ui/views/web_intent_picker_views.cc:1235: if (model_ && model_->IsInlineDisposition())\nOn 2012/10/15 19:17:07, Peter Kasting wrote:\n> Something is screwy here.  The first two conditionals check whether |model_| is\n> non-null but the third conditional blindly assumes that it is.  This can't be\n> right.\n\nDefinitely true. (I think it turns out that external factors make that path impossible, but that's too brittle.) Fixed.","disapproval":false,"date":"2012-10-15 19:28:32.692010","approval":false},{"sender":"pkasting@chromium.org","recipients":["gbillock@chromium.org","rouslan@chromium.org","groby@chromium.org","sail@chromium.org","pkasting@google.com","pkasting@chromium.org","chromium-reviews@chromium.org","gbillock+watch@chromium.org","smckay+watch@chromium.org","groby+watch@chromium.org","rouslan+watch@chromium.org","tfarina@chromium.org"],"text":"http://codereview.chromium.org/11146006/diff/12001/chrome/browser/ui/views/web_intent_picker_views.cc\nFile chrome/browser/ui/views/web_intent_picker_views.cc (right):\n\nhttp://codereview.chromium.org/11146006/diff/12001/chrome/browser/ui/views/web_intent_picker_views.cc#newcode1235\nchrome/browser/ui/views/web_intent_picker_views.cc:1235: if (model_ && model_->IsInlineDisposition())\nOn 2012/10/15 19:28:32, Greg Billock wrote:\n> Definitely true. (I think it turns out that external factors make that path\n> impossible, but that's too brittle.) Fixed.\n\nIf it's actually not possible for |model_| to be NULL here, it would be great to DCHECK that to make that clear.  NULL-checking is safe but implies that it's both possible and correct for that to actually happen, and we wouldn't want to imply that unless it's actually the case.","disapproval":false,"date":"2012-10-15 19:35:53.404070","approval":false},{"sender":"gbillock@chromium.org","recipients":["gbillock@chromium.org","rouslan@chromium.org","groby@chromium.org","sail@chromium.org","pkasting@google.com","pkasting@chromium.org","chromium-reviews@chromium.org","gbillock+watch@chromium.org","smckay+watch@chromium.org","groby+watch@chromium.org","rouslan+watch@chromium.org","tfarina@chromium.org"],"text":"http://codereview.chromium.org/11146006/diff/12001/chrome/browser/ui/views/web_intent_picker_views.cc\nFile chrome/browser/ui/views/web_intent_picker_views.cc (right):\n\nhttp://codereview.chromium.org/11146006/diff/12001/chrome/browser/ui/views/web_intent_picker_views.cc#newcode1235\nchrome/browser/ui/views/web_intent_picker_views.cc:1235: if (model_ && model_->IsInlineDisposition())\nOn 2012/10/15 19:35:53, Peter Kasting wrote:\n> On 2012/10/15 19:28:32, Greg Billock wrote:\n> > Definitely true. (I think it turns out that external factors make that path\n> > impossible, but that's too brittle.) Fixed.\n> \n> If it's actually not possible for |model_| to be NULL here, it would be great to\n> DCHECK that to make that clear.  NULL-checking is safe but implies that it's\n> both possible and correct for that to actually happen, and we wouldn't want to\n> imply that unless it's actually the case.\n\nIt's OK for it to be null, so I added the check. I think this didn't crash because it turns out to not actually happen in practice.","disapproval":false,"date":"2012-10-15 20:07:22.798180","approval":false},{"sender":"commit-bot@chromium.org","recipients":["gbillock@chromium.org","rouslan@chromium.org","groby@chromium.org","sail@chromium.org","pkasting@google.com","pkasting@chromium.org","chromium-reviews@chromium.org","gbillock+watch@chromium.org","smckay+watch@chromium.org","groby+watch@chromium.org","rouslan+watch@chromium.org","tfarina@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/gbillock@chromium.org/11146006/2002","disapproval":false,"date":"2012-10-15 20:07:44.530370","approval":false},{"sender":"commit-bot@chromium.org","recipients":["gbillock@chromium.org","rouslan@chromium.org","groby@chromium.org","sail@chromium.org","pkasting@google.com","pkasting@chromium.org","chromium-reviews@chromium.org","gbillock+watch@chromium.org","smckay+watch@chromium.org","groby+watch@chromium.org","rouslan+watch@chromium.org","tfarina@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/gbillock@chromium.org/11146006/2002","disapproval":false,"date":"2012-10-15 20:53:45.458840","approval":false},{"sender":"commit-bot@chromium.org","recipients":["gbillock@chromium.org","rouslan@chromium.org","groby@chromium.org","sail@chromium.org","pkasting@google.com","pkasting@chromium.org","chromium-reviews@chromium.org","gbillock+watch@chromium.org","smckay+watch@chromium.org","groby+watch@chromium.org","rouslan+watch@chromium.org","tfarina@chromium.org"],"text":"Change committed as 161997","disapproval":false,"date":"2012-10-15 23:28:20.551370","approval":false}],"owner_email":"gbillock@chromium.org","private":false,"base_url":"svn://svn.chromium.org/chrome/trunk/src","owner":"Greg Billock","subject":"Make views web intents picker able to initialize directly to inline disposition.","created":"2012-10-13 09:15:15.155110","patchsets":[1,5002,7005,12001,2002],"modified":"2012-10-15 23:28:20.946790","closed":true,"commit":false,"issue":11146006}