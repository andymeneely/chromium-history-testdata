{"files":{"ui/base/clipboard/clipboard_win.cc":{"status":"M","num_chunks":3,"no_base_file":false,"property_changes":"","num_added":65,"num_removed":0,"messages":[{"author":"tony","author_email":"tony@chromium.org","text":"Nit: sorting","draft":false,"lineno":24,"date":"2011-04-12 17:30:54.242967","left":false},{"author":"tony","author_email":"tony@chromium.org","text":"What thread does this happen on?  Seems like this could be slow.  Can we do this work on another thread?\n\nAlternately, we could use shared memory to pass the raw bitmap to the renderer (thus saving a copy) and have the renderer do the encoding.\n\nWe also have third_party/snappy, which might be a useful fast compression/decompression algorithm.","draft":false,"lineno":489,"date":"2011-04-12 17:30:54.243130","left":false},{"author":"dcheng","author_email":"dcheng@chromium.org","text":"On 2011/04/12 17:30:54, tony wrote:\n> Nit: sorting\n\nDone.","draft":false,"lineno":24,"date":"2011-04-12 21:04:55.071293","left":false},{"author":"dcheng","author_email":"dcheng@chromium.org","text":"On 2011/04/12 17:30:54, tony wrote:\n> What thread does this happen on?  Seems like this could be slow.  Can we do this\n> work on another thread?\n> \n\nThis occurs on the IO thread.\n\n> Alternately, we could use shared memory to pass the raw bitmap to the renderer\n> (thus saving a copy) and have the renderer do the encoding.\n> \n\nI am already working on a follow-up patch to reduce the number of copies this will require. It will go through the BlobRegistry and make use of the Blob code that's already been built.\n\n> We also have third_party/snappy, which might be a useful fast\n> compression/decompression algorithm.\n\nIs snappy compatible with deflate?","draft":false,"lineno":489,"date":"2011-04-12 21:04:55.071438","left":false},{"author":"tony","author_email":"tony@chromium.org","text":"How long does it take to PNG compress, say, an 8 megapixel image?  If it's more than a few seconds, then I think we need to move this off of the IO thread.\n\nI think it's fine optimizing the memory use in a follow up patch.\n\nA unittest would be nice so someone could run this through purify or wine+valgrind.","draft":false,"lineno":489,"date":"2011-04-12 21:14:17.610994","left":false},{"author":"dcheng","author_email":"dcheng@chromium.org","text":"On 2011/04/12 21:14:17, tony wrote:\n> How long does it take to PNG compress, say, an 8 megapixel image?  If it's more\n> than a few seconds, then I think we need to move this off of the IO thread.\n> \n\nWith Z_DEFAULT_COMPRESSION, a 2560x1600 screenshot takes ~840-850ms on my machine. Z_NO_COMPRESSION takes ~650ms and Z_BEST_SPEED takes ~470-480ms. I suspect this may be due to the amount of data being copied around, and I think that reducing the number of copies of data will significantly improve this.\n\nI am planning on refactoring this function, since Clipboard::ReadImage must execute on the UI thread on Linux. I haven't figured out an appropriate strategy though (one route I am considering is using a sync IPC on Linux to grab the raw bitmap data on the UI thread from the IO thread, though I am not sure if this will cause deadlock issues).\n\n> I think it's fine optimizing the memory use in a follow up patch.\n> \n> A unittest would be nice so someone could run this through purify or\n> wine+valgrind.\n\nHow would you structure such a unit test? I agree it'd be nice, but I'm not entirely sure it belongs within the scope of this change (there are a few other things here that could use a test of that sort as well then; for example,Clipboard::WriteBitmapFromHandle).","draft":false,"lineno":489,"date":"2011-04-12 23:30:54.406305","left":false}],"id":2003,"is_binary":false}},"owner_email":"dcheng@chromium.org","owner":"dcheng","message":"Minor comment improvement.","try_job_results":[],"created":"2011-04-12 02:08:29.065018","url":null,"num_comments":6,"modified":"2011-04-12 23:30:54.423778","patchset":6001,"issue":6824063}