{"description":"Port AudioConverter benchmarks to media_perftests.\n\nBUG=310837\n\nCommitted: https://src.chromium.org/viewvc/chrome?view=rev&revision=231115","cc":["chromium-reviews@chromium.org","feature-media-reviews@chromium.org"],"reviewers":["scherkus@chromium.org","dalecurtis@chromium.org"],"messages":[{"sender":"rileya@chromium.org","recipients":["rileya@chromium.org","scherkus@chromium.org","dalecurtis@chromium.org","chromium-reviews@chromium.org","feature-media-reviews@chromium.org"],"text":"","disapproval":false,"date":"2013-10-24 19:39:01.081370","approval":false},{"sender":"dalecurtis@chromium.org","recipients":["rileya@chromium.org","scherkus@chromium.org","dalecurtis@chromium.org","chromium-reviews@chromium.org","feature-media-reviews@chromium.org"],"text":"https://codereview.chromium.org/39263008/diff/30001/media/base/audio_converter_perftest.cc\nFile media/base/audio_converter_perftest.cc (right):\n\nhttps://codereview.chromium.org/39263008/diff/30001/media/base/audio_converter_perftest.cc#newcode1\nmedia/base/audio_converter_perftest.cc:1: // Copyright (c) 2013 The Chromium Authors. All rights reserved.\nNo (c) in 2013 license.\n\nhttps://codereview.chromium.org/39263008/diff/30001/media/base/audio_converter_perftest.cc#newcode28\nmedia/base/audio_converter_perftest.cc:28: void RunConvertBenchmark(AudioParameters in_params,\nconst &\n\nhttps://codereview.chromium.org/39263008/diff/30001/media/base/audio_converter_perftest.cc#newcode29\nmedia/base/audio_converter_perftest.cc:29: AudioParameters out_params,\nconst&\n\nhttps://codereview.chromium.org/39263008/diff/30001/media/base/audio_converter_perftest.cc#newcode37\nmedia/base/audio_converter_perftest.cc:37: scoped_ptr<AudioConverter> converter(\nThis can actually just be stack allocated.\n\nhttps://codereview.chromium.org/39263008/diff/30001/media/base/audio_converter_perftest.cc#newcode47\nmedia/base/audio_converter_perftest.cc:47: double runs_per_s = kBenchmarkIterations /\nruns_per_sec.  Is 50000 enough to test this?  I originally used 50000, but later realized it was artificially slow due to the InputCallback used at the time (hence the NullInputProvider).\n\nIs runs/sec the standard for perf tests?\n\nhttps://codereview.chromium.org/39263008/diff/30001/media/base/audio_converter_perftest.cc#newcode61\nmedia/base/audio_converter_perftest.cc:61: RunConvertBenchmark(input_params, output_params, false, \"resample_common\");\nTechnically more than resampling.  \"convert\" should be fine.\n\nhttps://codereview.chromium.org/39263008/diff/30001/media/base/audio_converter_perftest.cc#newcode72\nmedia/base/audio_converter_perftest.cc:72: RunConvertBenchmark(input_params, output_params, true, \"no_resample_fifo\");\nconvert_fifo_only\n\nhttps://codereview.chromium.org/39263008/diff/30001/media/base/audio_converter_perftest.cc#newcode74\nmedia/base/audio_converter_perftest.cc:74: \"no_resample_no_fifo\");\nconvert_pass_through?\n\nhttps://codereview.chromium.org/39263008/diff/30001/media/media.gyp\nFile media/media.gyp (right):\n\nhttps://codereview.chromium.org/39263008/diff/30001/media/media.gyp#newcode1077\nmedia/media.gyp:1077: '../testing/perf/perf_test.gyp:*',\n:* Is this standard syntax?","disapproval":false,"date":"2013-10-24 19:55:06.772660","approval":false},{"sender":"rileya@chromium.org","recipients":["rileya@chromium.org","scherkus@chromium.org","dalecurtis@chromium.org","chromium-reviews@chromium.org","feature-media-reviews@chromium.org"],"text":"I think I addressed just about everything, see my comment on iteration count and runs/s.\n\nhttps://codereview.chromium.org/39263008/diff/30001/media/base/audio_converter_perftest.cc\nFile media/base/audio_converter_perftest.cc (right):\n\nhttps://codereview.chromium.org/39263008/diff/30001/media/base/audio_converter_perftest.cc#newcode47\nmedia/base/audio_converter_perftest.cc:47: double runs_per_s = kBenchmarkIterations /\nOn 2013/10/24 19:55:07, DaleCurtis (OOO Oct 24-29) wrote:\n> runs_per_sec.  Is 50000 enough to test this?  I originally used 50000, but later\n> realized it was artificially slow due to the InputCallback used at the time\n> (hence the NullInputProvider).\n> \n> Is runs/sec the standard for perf tests?\n\nI'll experiment a bit and see what is a more reasonable number (on my machine all 3 benchmarks take ~2s to run on a debug build, so it could probably be increased a fair bit).\n\nruns/sec is what all of the cc_perftest tests use, so I followed along with that (and they use \"runs/s\" for the unit string).\n\nhttps://codereview.chromium.org/39263008/diff/30001/media/base/audio_converter_perftest.cc#newcode61\nmedia/base/audio_converter_perftest.cc:61: RunConvertBenchmark(input_params, output_params, false, \"resample_common\");\nOn 2013/10/24 19:55:07, DaleCurtis (OOO Oct 24-29) wrote:\n> Technically more than resampling.  \"convert\" should be fine.\nSounds good, I applied your other naming suggestions as well.\n\nhttps://codereview.chromium.org/39263008/diff/30001/media/media.gyp\nFile media/media.gyp (right):\n\nhttps://codereview.chromium.org/39263008/diff/30001/media/media.gyp#newcode1077\nmedia/media.gyp:1077: '../testing/perf/perf_test.gyp:*',\nOn 2013/10/24 19:55:07, DaleCurtis (OOO Oct 24-29) wrote:\n> :* Is this standard syntax?\n\nIt's what cc_perftests' gyp file did, but perf_test.gyp only actually has one target, \"perf_test\", so I switched to that instead of the wildcard.","disapproval":false,"date":"2013-10-24 20:21:29.021780","approval":false},{"sender":"dalecurtis@chromium.org","recipients":["rileya@chromium.org","scherkus@chromium.org","dalecurtis@chromium.org","chromium-reviews@chromium.org","feature-media-reviews@chromium.org"],"text":"Looks like the upload didn't finish correctly, please reupload.\n\nhttps://codereview.chromium.org/39263008/diff/80001/media/base/audio_converter_perftest.cc\nFile media/base/audio_converter_perftest.cc (right):\n\nhttps://codereview.chromium.org/39263008/diff/80001/media/base/audio_converter_perftest.cc#newcode46\nmedia/base/audio_converter_perftest.cc:46: double runs_per_s = kBenchmarkIterations /\nrun_per_second","disapproval":false,"date":"2013-10-24 21:08:13.303540","approval":false},{"sender":"rileya@chromium.org","recipients":["rileya@chromium.org","scherkus@chromium.org","dalecurtis@chromium.org","chromium-reviews@chromium.org","feature-media-reviews@chromium.org"],"text":"Okay, I think it uploaded properly this time.\n\nhttps://codereview.chromium.org/39263008/diff/80001/media/base/audio_converter_perftest.cc\nFile media/base/audio_converter_perftest.cc (right):\n\nhttps://codereview.chromium.org/39263008/diff/80001/media/base/audio_converter_perftest.cc#newcode46\nmedia/base/audio_converter_perftest.cc:46: double runs_per_s = kBenchmarkIterations /\nOn 2013/10/24 21:08:13, DaleCurtis (OOO Oct 24-29) wrote:\n> run_per_second\n\nOh, whoops, when you said that last patchset I thought you meant replace \"runs/s\" with that. Fixed now.","disapproval":false,"date":"2013-10-24 21:14:54.858550","approval":false},{"sender":"dalecurtis@chromium.org","recipients":["rileya@chromium.org","scherkus@chromium.org","dalecurtis@chromium.org","chromium-reviews@chromium.org","feature-media-reviews@chromium.org"],"text":"lgtm","disapproval":false,"date":"2013-10-24 21:44:20.193060","approval":true},{"sender":"commit-bot@chromium.org","recipients":["rileya@chromium.org","scherkus@chromium.org","dalecurtis@chromium.org","chromium-reviews@chromium.org","feature-media-reviews@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/rileya@chromium.org/39263008/140002","disapproval":false,"date":"2013-10-24 22:17:59.672860","approval":false},{"sender":"commit-bot@chromium.org","recipients":["rileya@chromium.org","scherkus@chromium.org","dalecurtis@chromium.org","chromium-reviews@chromium.org","feature-media-reviews@chromium.org"],"text":"Step \"update\" is always a major failure.\nLook at the try server FAQ for more details.\nhttp://build.chromium.org/p/tryserver.chromium/buildstatus?builder=win&number=119549","disapproval":false,"date":"2013-10-24 22:42:15.196490","approval":false},{"sender":"commit-bot@chromium.org","recipients":["rileya@chromium.org","scherkus@chromium.org","dalecurtis@chromium.org","chromium-reviews@chromium.org","feature-media-reviews@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/rileya@chromium.org/39263008/470001","disapproval":false,"date":"2013-10-25 17:06:41.848170","approval":false},{"sender":"commit-bot@chromium.org","recipients":["rileya@chromium.org","scherkus@chromium.org","dalecurtis@chromium.org","chromium-reviews@chromium.org","feature-media-reviews@chromium.org"],"text":"Change committed as 231115","disapproval":false,"date":"2013-10-25 21:05:05.398250","approval":false},{"sender":"scherkus@chromium.org","recipients":["rileya@chromium.org","scherkus@chromium.org","dalecurtis@chromium.org","chromium-reviews@chromium.org","feature-media-reviews@chromium.org"],"text":"few post-commit nits\n\ncan you send out a separate CL addressing these?\n\nhttps://codereview.chromium.org/39263008/diff/470001/media/base/audio_converter_perftest.cc\nFile media/base/audio_converter_perftest.cc (right):\n\nhttps://codereview.chromium.org/39263008/diff/470001/media/base/audio_converter_perftest.cc#newcode47\nmedia/base/audio_converter_perftest.cc:47: (base::TimeTicks::HighResNow() - start).InSecondsF();\nthis line should be 4-space indent\n\nhttps://codereview.chromium.org/39263008/diff/470001/media/base/audio_converter_perftest.cc#newcode67\nmedia/base/audio_converter_perftest.cc:67: AudioParameters::AUDIO_PCM_LINEAR, CHANNEL_LAYOUT_STEREO, 44100, 16, 2048);\nthis should be indented two more spaces (you may have to wrap params to next line)\n\nhttps://codereview.chromium.org/39263008/diff/470001/media/base/audio_converter_perftest.cc#newcode69\nmedia/base/audio_converter_perftest.cc:69: AudioParameters::AUDIO_PCM_LINEAR, CHANNEL_LAYOUT_STEREO, 44100, 16, 440);\nditto\n\nhttps://codereview.chromium.org/39263008/diff/470001/media/media.gyp\nFile media/media.gyp (right):\n\nhttps://codereview.chromium.org/39263008/diff/470001/media/media.gyp#newcode1082\nmedia/media.gyp:1082: 'base/audio_converter_perftest.cc',\nsources should be organized alphabetically a->z","disapproval":false,"date":"2013-10-28 19:24:47.625790","approval":false},{"sender":"rileya@chromium.org","recipients":["rileya@chromium.org","scherkus@chromium.org","dalecurtis@chromium.org","chromium-reviews@chromium.org","feature-media-reviews@chromium.org"],"text":"On 2013/10/28 19:24:47, scherkus wrote:\n> few post-commit nits\n> \n> can you send out a separate CL addressing these?\n> \n> https://codereview.chromium.org/39263008/diff/470001/media/base/audio_converter_perftest.cc\n> File media/base/audio_converter_perftest.cc (right):\n> \n> https://codereview.chromium.org/39263008/diff/470001/media/base/audio_converter_perftest.cc#newcode47\n> media/base/audio_converter_perftest.cc:47: (base::TimeTicks::HighResNow() -\n> start).InSecondsF();\n> this line should be 4-space indent\n> \n> https://codereview.chromium.org/39263008/diff/470001/media/base/audio_converter_perftest.cc#newcode67\n> media/base/audio_converter_perftest.cc:67: AudioParameters::AUDIO_PCM_LINEAR,\n> CHANNEL_LAYOUT_STEREO, 44100, 16, 2048);\n> this should be indented two more spaces (you may have to wrap params to next\n> line)\n> \n> https://codereview.chromium.org/39263008/diff/470001/media/base/audio_converter_perftest.cc#newcode69\n> media/base/audio_converter_perftest.cc:69: AudioParameters::AUDIO_PCM_LINEAR,\n> CHANNEL_LAYOUT_STEREO, 44100, 16, 440);\n> ditto\n> \n> https://codereview.chromium.org/39263008/diff/470001/media/media.gyp\n> File media/media.gyp (right):\n> \n> https://codereview.chromium.org/39263008/diff/470001/media/media.gyp#newcode1082\n> media/media.gyp:1082: 'base/audio_converter_perftest.cc',\n> sources should be organized alphabetically a->z\n\nAlright, see: https://codereview.chromium.org/49633002","disapproval":false,"date":"2013-10-28 19:35:57.792450","approval":false}],"owner_email":"rileya@chromium.org","private":false,"base_url":"https://chromium.googlesource.com/chromium/src.git@master","owner":"rileya","subject":"Port AudioConverter benchmarks to media_perftests.","created":"2013-10-24 19:25:04.623200","patchsets":[1,30001,80001,140002,470001],"modified":"2013-10-28 19:35:58.295740","closed":true,"commit":false,"issue":39263008}