{"description":"Remove the close button for Windows native windows with the standard frame removed.\n\n\nBUG=none\nTEST=none\n\n\nCommitted: http://src.chromium.org/viewvc/chrome?view=rev&revision=130323","cc":["chromium-reviews@chromium.org","tfarina@chromium.org","ben+watch@chromium.org"],"reviewers":["ben@chromium.org"],"messages":[{"sender":"jeremya@chromium.org","recipients":["jeremya@chromium.org","beng@google.com","chromium-reviews@chromium.org","tfarina@chromium.org","ben+watch@chromium.org"],"text":"I found a way to do this without removing the system menu :)\n\nhttps://chromiumcodereview.appspot.com/9372053/diff/1/ui/views/widget/native_widget_win.cc\nFile ui/views/widget/native_widget_win.cc (right):\n\nhttps://chromiumcodereview.appspot.com/9372053/diff/1/ui/views/widget/native_widget_win.cc#newcode1296\nui/views/widget/native_widget_win.cc:1296: SetWindowLong(GWL_STYLE, GetWindowLong(GWL_STYLE) & ~WS_CAPTION);\nFor some reason, the WS_CAPTION style gets added to the window even when I tried not specifying it in CreateWindowEx.","disapproval":false,"date":"2012-02-10 04:30:04.958129","approval":false},{"sender":"tfarina@chromium.org","recipients":["jeremya@chromium.org","beng@google.com","chromium-reviews@chromium.org","tfarina@chromium.org","ben+watch@chromium.org"],"text":"What is the motivation for this patch? Is there a BUG filed that you can assign to it?","disapproval":false,"date":"2012-02-10 08:42:15.558804","approval":false},{"sender":"jeremya@chromium.org","recipients":["jeremya@chromium.org","beng@google.com","chromium-reviews@chromium.org","tfarina@chromium.org","ben+watch@chromium.org"],"text":"On 2012/02/10 08:42:15, tfarina wrote:\n> What is the motivation for this patch? Is there a BUG filed that you can assign\n> to it?\n\nIt removes the unsightly close button visible in the frame during startup and resizing: see http://www/~jeremya/close1.png and http://www/~jeremya/close2.jpg","disapproval":false,"date":"2012-02-13 23:27:53.502991","approval":false},{"sender":"ben@chromium.org","recipients":["jeremya@chromium.org","beng@google.com","ben@chromium.org","chromium-reviews@chromium.org","tfarina@chromium.org","ben+watch@chromium.org"],"text":"What windows shell behavior does removing WS_CAPTION cause to no longer work? In general we have tried very hard to make sure our custom frames have the standard frame styles so that various things like window sizing, moving, system menus all work.","disapproval":false,"date":"2012-02-14 17:58:27.812240","approval":false},{"sender":"jeremya@chromium.org","recipients":["jeremya@chromium.org","beng@google.com","ben@chromium.org","chromium-reviews@chromium.org","tfarina@chromium.org","ben+watch@chromium.org"],"text":"On 2012/02/14 17:58:27, Ben Goodger (Google) wrote:\n> What windows shell behavior does removing WS_CAPTION cause to no longer work? In\n> general we have tried very hard to make sure our custom frames have the standard\n> frame styles so that various things like window sizing, moving, system menus all\n> work.\n\nAs far as I can tell, nothing: it just stops Windows from adding a caption.","disapproval":false,"date":"2012-02-15 06:52:48.192464","approval":false},{"sender":"beng@google.com","recipients":["reply@chromiumcodereview.appspotmail.com"],"text":"Have you tried dragging your WS_CAPTION-less window to the screen edges on\nWin7 and seeing if it'll do the WM snap-docking?\n\nDoes your window show up in the Alt+Tab list?\n\nDoes your window participate in the tile windows/cascade windows\nfunctionality?\n\nDoes it show up in the task bar?\n\n-Ben\n\nOn Tue, Feb 14, 2012 at 10:52 PM, <jeremya@chromium.org> wrote:\n\n> On 2012/02/14 17:58:27, Ben Goodger (Google) wrote:\n>\n>> What windows shell behavior does removing WS_CAPTION cause to no longer\n>> work?\n>>\n> In\n>\n>> general we have tried very hard to make sure our custom frames have the\n>>\n> standard\n>\n>> frame styles so that various things like window sizing, moving, system\n>> menus\n>>\n> all\n>\n>> work.\n>>\n>\n> As far as I can tell, nothing: it just stops Windows from adding a caption.\n>\n> https://chromiumcodereview.**appspot.com/9372053/<https://chromiumcodereview.appspot.com/9372053/>\n>\n","disapproval":false,"date":"2012-02-15 22:17:02.964802","approval":false},{"sender":"jeremya@chromium.org","recipients":["reply@chromiumcodereview.appspotmail.com"],"text":"On Thu, Feb 16, 2012 at 9:16 AM, Ben Goodger <beng@google.com> wrote:\n\n> Have you tried dragging your WS_CAPTION-less window to the screen edges on\n> Win7 and seeing if it'll do the WM snap-docking?\n\n\nWorks fine.\n\n\n> Does your window show up in the Alt+Tab list?\n>\n\nYes.\n\nDoes your window participate in the tile windows/cascade windows\n> functionality?\n>\n\nNo, but Chrome proper doesn't either, so I don't think it's related to\nWS_CAPTION.\n\nDoes it show up in the task bar?\n>\n\nYes.\n","disapproval":false,"date":"2012-02-16 02:49:15.661811","approval":false},{"sender":"ben@chromium.org","recipients":["jeremya@chromium.org","beng@google.com","ben@chromium.org","chromium-reviews@chromium.org","tfarina@chromium.org","ben+watch@chromium.org"],"text":"https://chromiumcodereview.appspot.com/9372053/diff/1/ui/views/widget/native_widget_win.cc\nFile ui/views/widget/native_widget_win.cc (right):\n\nhttps://chromiumcodereview.appspot.com/9372053/diff/1/ui/views/widget/native_widget_win.cc#newcode1205\nui/views/widget/native_widget_win.cc:1205: if (!remove_standard_frame_ && GetWidget()->ShouldUseNativeFrame())\nFinally... why do you need to do this?\n\nhttps://chromiumcodereview.appspot.com/9372053/diff/1/ui/views/widget/native_widget_win.cc#newcode1649\nui/views/widget/native_widget_win.cc:1649: SetWindowLong(GWL_STYLE, GetWindowLong(GWL_STYLE) & ~WS_VISIBLE);\nLook at ScopedRedrawLock in this file. It does the visibility munging for you.","disapproval":false,"date":"2012-02-16 02:53:49.782604","approval":false},{"sender":"jeremya@chromium.org","recipients":["jeremya@chromium.org","beng@google.com","ben@chromium.org","chromium-reviews@chromium.org","tfarina@chromium.org","ben+watch@chromium.org"],"text":"https://chromiumcodereview.appspot.com/9372053/diff/1/ui/views/widget/native_widget_win.cc\nFile ui/views/widget/native_widget_win.cc (right):\n\nhttps://chromiumcodereview.appspot.com/9372053/diff/1/ui/views/widget/native_widget_win.cc#newcode1205\nui/views/widget/native_widget_win.cc:1205: if (!remove_standard_frame_ && GetWidget()->ShouldUseNativeFrame())\nOn 2012/02/16 02:53:49, Ben Goodger (Google) wrote:\n> Finally... why do you need to do this?\n\nWithout this, when the window loses focus, Windows paints a bunch of white over its border.\n\nhttps://chromiumcodereview.appspot.com/9372053/diff/1/ui/views/widget/native_widget_win.cc#newcode1649\nui/views/widget/native_widget_win.cc:1649: SetWindowLong(GWL_STYLE, GetWindowLong(GWL_STYLE) & ~WS_VISIBLE);\nOn 2012/02/16 02:53:49, Ben Goodger (Google) wrote:\n> Look at ScopedRedrawLock in this file. It does the visibility munging for you.\n\nScopedRedrawLock doesn't do anything when Aero is enabled. (see NativeWidgetWin::LockUpdates())","disapproval":false,"date":"2012-02-16 03:18:13.419061","approval":false},{"sender":"ben@chromium.org","recipients":["jeremya@chromium.org","beng@google.com","ben@chromium.org","chromium-reviews@chromium.org","tfarina@chromium.org","ben+watch@chromium.org"],"text":"https://chromiumcodereview.appspot.com/9372053/diff/1/ui/views/widget/native_widget_win.cc\nFile ui/views/widget/native_widget_win.cc (right):\n\nhttps://chromiumcodereview.appspot.com/9372053/diff/1/ui/views/widget/native_widget_win.cc#newcode1649\nui/views/widget/native_widget_win.cc:1649: SetWindowLong(GWL_STYLE, GetWindowLong(GWL_STYLE) & ~WS_VISIBLE);\nCan you add an alternate ctor or flag to SRL then that allows it to work in this case? I'd rather limit the hackery to one place.","disapproval":false,"date":"2012-02-16 03:53:01.514251","approval":false},{"sender":"jeremya@chromium.org","recipients":["jeremya@chromium.org","beng@google.com","ben@chromium.org","chromium-reviews@chromium.org","tfarina@chromium.org","ben+watch@chromium.org"],"text":"https://chromiumcodereview.appspot.com/9372053/diff/1/ui/views/widget/native_widget_win.cc\nFile ui/views/widget/native_widget_win.cc (right):\n\nhttps://chromiumcodereview.appspot.com/9372053/diff/1/ui/views/widget/native_widget_win.cc#newcode1649\nui/views/widget/native_widget_win.cc:1649: SetWindowLong(GWL_STYLE, GetWindowLong(GWL_STYLE) & ~WS_VISIBLE);\nOn 2012/02/16 03:53:01, Ben Goodger (Google) wrote:\n> Can you add an alternate ctor or flag to SRL then that allows it to work in this\n> case? I'd rather limit the hackery to one place.\n\nDone.","disapproval":false,"date":"2012-02-16 04:36:56.984933","approval":false},{"sender":"ben@chromium.org","recipients":["jeremya@chromium.org","beng@google.com","ben@chromium.org","chromium-reviews@chromium.org","tfarina@chromium.org","ben+watch@chromium.org"],"text":"https://chromiumcodereview.appspot.com/9372053/diff/8001/ui/views/widget/native_widget_win.cc\nFile ui/views/widget/native_widget_win.cc (right):\n\nhttps://chromiumcodereview.appspot.com/9372053/diff/8001/ui/views/widget/native_widget_win.cc#newcode358\nui/views/widget/native_widget_win.cc:358: explicit ScopedRedrawLock(NativeWidgetWin* widget, bool force = false)\nno default values.\n\nRename your variable to lock_in_aero_glass_, default to false, and provide a set_lock_in_aero_glass() setter that yo call from your function.\n\nhttps://chromiumcodereview.appspot.com/9372053/diff/8001/ui/views/widget/native_widget_win.h\nFile ui/views/widget/native_widget_win.h (right):\n\nhttps://chromiumcodereview.appspot.com/9372053/diff/8001/ui/views/widget/native_widget_win.h#newcode511\nui/views/widget/native_widget_win.h:511: bool force = false);\nYou're not allowed to use default values for parameters per Google style.","disapproval":false,"date":"2012-02-16 04:44:12.456289","approval":false},{"sender":"jeremya@chromium.org","recipients":["jeremya@chromium.org","beng@google.com","ben@chromium.org","chromium-reviews@chromium.org","tfarina@chromium.org","ben+watch@chromium.org"],"text":"Oops, forgot about default values :)\n\nhttps://chromiumcodereview.appspot.com/9372053/diff/8001/ui/views/widget/native_widget_win.cc\nFile ui/views/widget/native_widget_win.cc (right):\n\nhttps://chromiumcodereview.appspot.com/9372053/diff/8001/ui/views/widget/native_widget_win.cc#newcode358\nui/views/widget/native_widget_win.cc:358: explicit ScopedRedrawLock(NativeWidgetWin* widget, bool force = false)\nOn 2012/02/16 04:44:12, Ben Goodger (Google) wrote:\n> no default values.\n> \n> Rename your variable to lock_in_aero_glass_, default to false, and provide a\n> set_lock_in_aero_glass() setter that yo call from your function.\n\nDid this a slightly different way, since ScopedRedrawLock does its work in its constructor.\n\nhttps://chromiumcodereview.appspot.com/9372053/diff/8001/ui/views/widget/native_widget_win.h\nFile ui/views/widget/native_widget_win.h (right):\n\nhttps://chromiumcodereview.appspot.com/9372053/diff/8001/ui/views/widget/native_widget_win.h#newcode511\nui/views/widget/native_widget_win.h:511: bool force = false);\nOn 2012/02/16 04:44:12, Ben Goodger (Google) wrote:\n> You're not allowed to use default values for parameters per Google style.\n\nDone.","disapproval":false,"date":"2012-02-16 05:06:39.346619","approval":false},{"sender":"jeremya@chromium.org","recipients":["jeremya@chromium.org","ben@chromium.org","chromium-reviews@chromium.org","tfarina@chromium.org","ben+watch@chromium.org"],"text":"Ping- this patch fixes graphical artifacts that appear when the window is resized to be small (e.g. http://www/~jeremya/close-buttons.png), and I'd like to land it :)","disapproval":false,"date":"2012-03-29 00:56:07.693925","approval":false},{"sender":"ben@chromium.org","recipients":["jeremya@chromium.org","ben@chromium.org","chromium-reviews@chromium.org","tfarina@chromium.org","ben+watch@chromium.org"],"text":"lgtm","disapproval":false,"date":"2012-04-02 15:45:12.739883","approval":true},{"sender":"commit-bot@chromium.org","recipients":["jeremya@chromium.org","ben@chromium.org","chromium-reviews@chromium.org","tfarina@chromium.org","ben+watch@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/jeremya@chromium.org/9372053/5","disapproval":false,"date":"2012-04-03 01:38:25.326206","approval":false},{"sender":"commit-bot@chromium.org","recipients":["jeremya@chromium.org","ben@chromium.org","chromium-reviews@chromium.org","tfarina@chromium.org","ben+watch@chromium.org"],"text":"Change committed as 130323","disapproval":false,"date":"2012-04-03 06:30:01.157877","approval":false}],"owner_email":"jeremya@chromium.org","private":false,"base_url":"http://git.chromium.org/chromium/src.git@master","owner":"jeremya","subject":"Remove the close button for Windows native windows with the standard frame removed.","created":"2012-02-10 04:24:39.333586","patchsets":[1,8001,9004,5],"modified":"2012-04-03 06:30:01.244723","closed":true,"commit":false,"issue":9372053}