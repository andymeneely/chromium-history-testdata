{"files":{"net/third_party/nss/ssl/sslproto.h":{"status":"M    ","num_chunks":1,"no_base_file":false,"property_changes":"","num_added":7,"num_removed":0,"messages":[],"id":33007,"is_binary":false},"net/third_party/nss/ssl/ssl.h":{"status":"M    ","num_chunks":1,"no_base_file":false,"property_changes":"","num_added":18,"num_removed":0,"messages":[{"author":"Ryan Sleevi (OoO until 11-18)","author_email":"rsleevi@chromium.org","text":"If you have to document that it has a side-effect, would it make more sense to have a UseSRTP function (which sets some default cipher list) and then a SetSRTPCiphers?\n\nThis would parallel the DTLS/TLS cipher preference setting.\n\nAlso, the interaction with SSL model sockets is not clear here. Does this have a model socket / global preference parallel?","draft":false,"lineno":842,"date":"2012-05-10 19:43:11.314792","left":false},{"author":"wtc","author_email":"wtc@chromium.org","text":"\nOn 2012/05/10 19:43:11, Ryan Sleevi wrote:\n> If you have to document that it has a side-effect, would it make more sense to\n> have a UseSRTP function (which sets some default cipher list) and then a\n> SetSRTPCiphers?\n> \n> This would parallel the DTLS/TLS cipher preference setting.\n\nI will talk to Ekr about this.  Thanks for the suggestion.\n\n> Also, the interaction with SSL model sockets is not clear here. Does this have a\n> model socket / global preference parallel?\n\nI updated ssl_DupSocket and SSL_ReconfigFD to copy from\nthe model socket.\n\nI will talk to Ekr about a global preference for\nSRTP ciphers.","draft":false,"lineno":842,"date":"2012-05-12 01:00:59.512782","left":false}],"id":33004,"is_binary":false},"net/third_party/nss/ssl/ssl3ext.c":{"status":"M    ","num_chunks":5,"no_base_file":false,"property_changes":"","num_added":206,"num_removed":1,"messages":[{"author":"Ryan Sleevi (OoO until 11-18)","author_email":"rsleevi@chromium.org","text":"Seems IS_DTLS should be checked before the server side is checked, otherwise SRTP can be negotiated on a TLS socket?","draft":false,"lineno":1892,"date":"2012-05-10 19:43:11.315058","left":false},{"author":"Ryan Sleevi (OoO until 11-18)","author_email":"rsleevi@chromium.org","text":"IS_DTLS check","draft":false,"lineno":1956,"date":"2012-05-10 19:43:11.315250","left":false},{"author":"Ryan Sleevi (OoO until 11-18)","author_email":"rsleevi@chromium.org","text":"This function seems to have inconsistent bracing throughout.\n\n1972-1973, 1976/1977, 1990/1991, 1996-1998, 2011/2012, 2035-2037, 2039/2040, 2056-2058, 2060/2061","draft":false,"lineno":1972,"date":"2012-05-10 19:43:11.315442","left":false},{"author":"Ryan Sleevi (OoO until 11-18)","author_email":"rsleevi@chromium.org","text":"nit: newline following }","draft":false,"lineno":1999,"date":"2012-05-10 19:43:11.315663","left":false},{"author":"Ryan Sleevi (OoO until 11-18)","author_email":"rsleevi@chromium.org","text":"Perhaps move this up to 1964, since it applies to the SECFailure returned in (1961/1966), and at least there it provides context about the MKI.","draft":false,"lineno":2010,"date":"2012-05-10 19:43:11.315866","left":false},{"author":"Ryan Sleevi (OoO until 11-18)","author_email":"rsleevi@chromium.org","text":"!found && j + 1 ...","draft":false,"lineno":2045,"date":"2012-05-10 19:43:11.316094","left":false},{"author":"Ryan Sleevi (OoO until 11-18)","author_email":"rsleevi@chromium.org","text":"I assume this is where you were talking about gotos?\n\nI note the equivalent NSS function does use goto, but that's because it's got an error handler - http://code.google.com/searchframe#OAMlx_jo-ck/src/net/third_party/nss/ssl/ssl3con.c&exact_package=chromium&q=hs.cipher_suite&type=cs&l=6844","draft":false,"lineno":2049,"date":"2012-05-10 19:43:11.316284","left":false},{"author":"wtc","author_email":"wtc@chromium.org","text":"\nOn 2012/05/10 19:43:11, Ryan Sleevi wrote:\n> Seems IS_DTLS should be checked before the server side is checked, otherwise\n> SRTP can be negotiated on a TLS socket?\n\nThis is a good question.\n\nThe server side checks IS_DTLS in ssl3_HandleUseSRTPXtn on\nline 2021.  The reason client and server check IS_DTLS in\ndifferent places is that the client always calls\nssl3_SendUseSRTPXtn, but the server calls \nssl3_SendUseSRTPXtn\nonly if ssl3_HandleUseSRTPXtn has validated the extension\nand marked that ssl3_SendUseSRTPXtn should be called.\n\nSimilarly, the client side does not need to check IS_DTLS\nin ssl3_HandleUseSRTPXtn because the client won't call\nssl3_HandleUseSRTPXtn (even if the server sends the\nextension) unless the client has sent the extension.","draft":false,"lineno":1892,"date":"2012-05-12 01:00:59.513017","left":false},{"author":"wtc","author_email":"wtc@chromium.org","text":"\nOn 2012/05/10 19:43:11, Ryan Sleevi wrote:\n> Perhaps move this up to 1964, since it applies to the SECFailure returned in\n> (1961/1966), and at least there it provides context about the MKI.\n\nAfter studying this code, I decided to move the\nextension data length check (data->len != 5) on line 1964 after the MKI length check here.  This way we only need to\ntalk about MKI here.","draft":false,"lineno":2010,"date":"2012-05-12 01:00:59.513233","left":false},{"author":"wtc","author_email":"wtc@chromium.org","text":"\nOn 2012/05/10 19:43:11, Ryan Sleevi wrote:\n> !found && j + 1 ...\n\nIt is not necessary to test !found here because !found is\nguaranteed to be true by the !found test on line 2044 and\nthe break statement on line 2049.","draft":false,"lineno":2045,"date":"2012-05-12 01:00:59.513426","left":false},{"author":"wtc","author_email":"wtc@chromium.org","text":"\nOn 2012/05/10 19:43:11, Ryan Sleevi wrote:\n> I assume this is where you were talking about gotos?\n\nYes, it is.  Do you still prefer that we avoid goto here?","draft":false,"lineno":2049,"date":"2012-05-12 01:00:59.513621","left":false},{"author":"Ryan Sleevi (OoO until 11-18)","author_email":"rsleevi@chromium.org","text":"On 2012/05/12 01:00:59, wtc wrote:\n> \n> On 2012/05/10 19:43:11, Ryan Sleevi wrote:\n> > Seems IS_DTLS should be checked before the server side is checked, otherwise\n> > SRTP can be negotiated on a TLS socket?\n> \n> This is a good question.\n> \n> The server side checks IS_DTLS in ssl3_HandleUseSRTPXtn on\n> line 2021.  The reason client and server check IS_DTLS in\n> different places is that the client always calls\n> ssl3_SendUseSRTPXtn, but the server calls \n> ssl3_SendUseSRTPXtn\n> only if ssl3_HandleUseSRTPXtn has validated the extension\n> and marked that ssl3_SendUseSRTPXtn should be called.\n> \n> Similarly, the client side does not need to check IS_DTLS\n> in ssl3_HandleUseSRTPXtn because the client won't call\n> ssl3_HandleUseSRTPXtn (even if the server sends the\n> extension) unless the client has sent the extension.\n\nFair enough, if that's the contract. I wanted to make sure it wasn't possible for a misbehaving program to end up with this called on a server socket or a malicious server to be able to send an invalid extension. Seems like this is already covered.","draft":false,"lineno":1892,"date":"2012-05-12 01:13:06.042519","left":false},{"author":"Ryan Sleevi (OoO until 11-18)","author_email":"rsleevi@chromium.org","text":"On 2012/05/12 01:00:59, wtc wrote:\n> \n> On 2012/05/10 19:43:11, Ryan Sleevi wrote:\n> > Perhaps move this up to 1964, since it applies to the SECFailure returned in\n> > (1961/1966), and at least there it provides context about the MKI.\n> \n> After studying this code, I decided to move the\n> extension data length check (data->len != 5) on line 1964 after the MKI length\n> check here.  This way we only need to\n> talk about MKI here.\n\nThis means you're now relying on ssl3_ConsumeHandshakeVariable to do the length check.\n\nThis is probably fine, but note that if the lengths don't match, this will force SSL3_SendAlert() to be called. Is this what you want to happen?\n","draft":false,"lineno":2010,"date":"2012-05-12 01:13:06.042751","left":false},{"author":"Ryan Sleevi (OoO until 11-18)","author_email":"rsleevi@chromium.org","text":"On 2012/05/12 01:00:59, wtc wrote:\n> \n> On 2012/05/10 19:43:11, Ryan Sleevi wrote:\n> > !found && j + 1 ...\n> \n> It is not necessary to test !found here because !found is\n> guaranteed to be true by the !found test on line 2044 and\n> the break statement on line 2049.\n\nAh, right.","draft":false,"lineno":2045,"date":"2012-05-12 01:13:06.042956","left":false},{"author":"Ryan Sleevi (OoO until 11-18)","author_email":"rsleevi@chromium.org","text":"On 2012/05/12 01:00:59, wtc wrote:\n> \n> On 2012/05/10 19:43:11, Ryan Sleevi wrote:\n> > I assume this is where you were talking about gotos?\n> \n> Yes, it is.  Do you still prefer that we avoid goto here?\n\nDepends.\n\nCurrently, the code always consumes the srtp_mki value (line 2055), even when !found (line 2064). If that's the expected behaviour, then yeah, I think goto is considered harmful.","draft":false,"lineno":2049,"date":"2012-05-12 01:13:06.043157","left":false},{"author":"ekr","author_email":"ekr@rtfm.com","text":"On 2012/05/12 01:13:06, Ryan Sleevi wrote:\n> On 2012/05/12 01:00:59, wtc wrote:\n> > \n> > On 2012/05/10 19:43:11, Ryan Sleevi wrote:\n> > > I assume this is where you were talking about gotos?\n> > \n> > Yes, it is.  Do you still prefer that we avoid goto here?\n> \n> Depends.\n> \n> Currently, the code always consumes the srtp_mki value (line 2055), even when\n> !found (line 2064). If that's the expected behaviour, then yeah, I think goto is\n> considered harmful.\n\nI don't think it matters either way, since we're going to generate an error.\n\nIMO the goto is clearer but I'm not going to go to the mat over it.\n","draft":false,"lineno":2049,"date":"2012-05-14 22:50:49.862692","left":false},{"author":"wtc","author_email":"wtc@chromium.org","text":"\nOn 2012/05/12 01:13:06, Ryan Sleevi wrote:\n>\n> This means you're now relying on ssl3_ConsumeHandshakeVariable to do the length\n> check.\n> \n> This is probably fine, but note that if the lengths don't match, this will force\n> SSL3_SendAlert() to be called. Is this what you want to happen?\n\nI didn't intend to force SSL3_SendAlert(), but I think it\nis fine to send a decode_error alert when an extension\ncannot be decoded because the length of the extension is\nincorrect.","draft":false,"lineno":2010,"date":"2012-05-15 00:56:41.942015","left":false}],"id":33005,"is_binary":false},"net/third_party/nss/ssl/sslt.h":{"status":"M    ","num_chunks":2,"no_base_file":false,"property_changes":"","num_added":2,"num_removed":1,"messages":[],"id":33009,"is_binary":false},"net/third_party/nss/ssl/sslsock.c":{"status":"M    ","num_chunks":2,"no_base_file":false,"property_changes":"","num_added":71,"num_removed":0,"messages":[{"author":"Ryan Sleevi (OoO until 11-18)","author_email":"rsleevi@chromium.org","text":"The NSS SSL/DTLS code accepts non-existant cipher suites without issue, simply ignoring them. I think this works to our advantage. Does it make sense to do the same here?","draft":false,"lineno":1633,"date":"2012-05-10 19:43:11.316492","left":false},{"author":"Ryan Sleevi (OoO until 11-18)","author_email":"rsleevi@chromium.org","text":"Does it make sense to update this function, even though it's not implemented?\n\nSeems a subtle edge if it gets enabled but breaks.","draft":false,"lineno":1677,"date":"2012-05-10 19:43:11.316682","left":false},{"author":"wtc","author_email":"wtc@chromium.org","text":"\nOn 2012/05/10 19:43:11, Ryan Sleevi wrote:\n> The NSS SSL/DTLS code accepts non-existant cipher suites without issue, simply\n> ignoring them.\n\nSSL_CipherPrefSet returns SECFailure with\nSSL_ERROR_UNKNOWN_CIPHER_SUITE if the cipher suite is\nnonexistent.  Perhaps I misunderstood your comment here?","draft":false,"lineno":1633,"date":"2012-05-12 01:00:59.513815","left":false},{"author":"wtc","author_email":"wtc@chromium.org","text":"\nOn 2012/05/10 19:43:11, Ryan Sleevi wrote:\n> Does it make sense to update this function, even though it's not implemented?\n\nI updated both this function and ssl_DupSocket (both of them\ntake a model socket as input).","draft":false,"lineno":1677,"date":"2012-05-12 01:00:59.514003","left":false},{"author":"Ryan Sleevi (OoO until 11-18)","author_email":"rsleevi@chromium.org","text":"On 2012/05/12 01:00:59, wtc wrote:\n> \n> On 2012/05/10 19:43:11, Ryan Sleevi wrote:\n> > The NSS SSL/DTLS code accepts non-existant cipher suites without issue, simply\n> > ignoring them.\n> \n> SSL_CipherPrefSet returns SECFailure with\n> SSL_ERROR_UNKNOWN_CIPHER_SUITE if the cipher suite is\n> nonexistent.  Perhaps I misunderstood your comment here?\n\nAh, you're right, sorry for not double-checking memory.\n\nIn the SSL/TLS case, we can enable/disable individual cipher suites via SSL_CipherPrefSet, so we can safely ignore any errors with unrecognized suites ( see http://code.google.com/searchframe#OAMlx_jo-ck/src/net/socket/ssl_server_socket_nss.cc&exact_package=chromium&q=SSL_CipherPrefSet&type=cs&l=299 )\n\nWith this code, because setting enabled suites is all-or-nothing, and because even enabling SRTP is dependent on all-or-nothing suites, we couldn't do such an approach if we wanted to.\n\nThis would be an issue if a cipher suite ever needed to be removed, as it would break clients still supplying the old cipher suite. I think that would argue in favour of separating the API?","draft":false,"lineno":1633,"date":"2012-05-12 01:13:06.043384","left":false},{"author":"wtc","author_email":"wtc@chromium.org","text":"\nOn 2012/05/12 01:13:06, Ryan Sleevi wrote:\n> \n> This would be an issue if a cipher suite ever needed to be removed, as it would\n> break clients still supplying the old cipher suite. I think that would argue in\n> favour of separating the API?\n\nI also came to the same conclusion that we probably should\nenable SRTP cipher suites individually, in the same way we\nenable TLS cipher suites.\n\nEkr: do you have time to implement an SSL_USE_SRTP socket\noption and the SSL_SRTPCipherPrefSet and SSL_SRTPCipherPrefGet\nfunctions, or do you want me to do that?\n\nI think we can omit the global preferences and just support\na model socket.","draft":false,"lineno":1633,"date":"2012-05-15 00:56:41.942292","left":false}],"id":33008,"is_binary":false},"net/third_party/nss/ssl/sslimpl.h":{"status":"M    ","num_chunks":2,"no_base_file":false,"property_changes":"","num_added":7,"num_removed":0,"messages":[],"id":33006,"is_binary":false}},"owner_email":"wtc@chromium.org","owner":"wtc","message":"Add NSS bug number","try_job_results":[{"parent_name":null,"tests":[],"slave":"vm84-m4","url":"http://build.chromium.org/p/tryserver.chromium/buildstatus?builder=win_rel&number=27324","timestamp":"2012-05-09 03:05:33.874500","builder":"win_rel","clobber":null,"project":"Chromium Try Server","reason":"","result":"2","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYw6DhBAwLEghQYXRjaFNldBiKoQIMCxIMVHJ5Sm9iUmVzdWx0GMvfAgw","requester":null,"buildnumber":"27324","revision":"135899"},{"parent_name":null,"tests":[],"slave":"vm638-m4","url":"http://build.chromium.org/p/tryserver.chromium/buildstatus?builder=mac_rel&number=23670","timestamp":"2012-05-08 23:11:04.446234","builder":"mac_rel","clobber":null,"project":"Chromium Try Server","reason":"","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYw6DhBAwLEghQYXRjaFNldBiKoQIMCxIMVHJ5Sm9iUmVzdWx0GKOZAgw","requester":null,"buildnumber":"23670","revision":"135899"},{"parent_name":null,"tests":[],"slave":"vm390-m4","url":"http://build.chromium.org/p/tryserver.chromium/buildstatus?builder=linux_rel&number=23117","timestamp":"2012-05-08 23:07:16.702236","builder":"linux_rel","clobber":null,"project":"Chromium Try Server","reason":"","result":"2","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYw6DhBAwLEghQYXRjaFNldBiKoQIMCxIMVHJ5Sm9iUmVzdWx0GJrvAgw","requester":null,"buildnumber":"23117","revision":"135899"},{"parent_name":null,"tests":[],"slave":"vm418-m4","url":"http://build.chromium.org/p/tryserver.chromium/buildstatus?builder=linux_clang&number=19978","timestamp":"2012-05-08 22:41:54.244161","builder":"linux_clang","clobber":null,"project":"Chromium Try Server","reason":"","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYw6DhBAwLEghQYXRjaFNldBiKoQIMCxIMVHJ5Sm9iUmVzdWx0GMrfAgw","requester":null,"buildnumber":"19978","revision":"135899"},{"parent_name":null,"tests":[],"slave":"vm65-m4","url":"http://build.chromium.org/p/tryserver.chromium/buildstatus?builder=linux_redux&number=202","timestamp":"2012-05-08 22:39:36.893425","builder":"linux_redux","clobber":null,"project":"Chromium Try Server","reason":"","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYw6DhBAwLEghQYXRjaFNldBiKoQIMCxIMVHJ5Sm9iUmVzdWx0GIuhAgw","requester":null,"buildnumber":"202","revision":"135899"},{"parent_name":null,"tests":[],"slave":"vm442-m4","url":"http://build.chromium.org/p/tryserver.chromium/buildstatus?builder=android&number=11679","timestamp":"2012-05-08 22:26:18.325983","builder":"android","clobber":null,"project":"Chromium Try Server","reason":"","result":"0","key":"ahdzfmNocm9taXVtY29kZXJldmlldy1ocnIyCxIFSXNzdWUYw6DhBAwLEghQYXRjaFNldBiKoQIMCxIMVHJ5Sm9iUmVzdWx0GLLnAgw","requester":null,"buildnumber":"11679","revision":"135899"}],"created":"2012-05-08 22:12:00.284280","url":null,"num_comments":25,"modified":"2012-05-15 00:56:41.998424","patchset":37002,"issue":9982019}