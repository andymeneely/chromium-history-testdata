{"description":"Extend simple_file_system to use SandboxedFileSystemOperation\r\nso that most of the code paths that run in chromium can be tested\r\nin test_shell.\r\n\r\nAlso removed SandboxedFileSystemContext::CheckIfFilePathIsSafe that is not used at all.\r\n\r\nBUG=60243\r\nTEST=fast/filesystem\n\nCommitted: http://src.chromium.org/viewvc/chrome?view=rev&revision=67158","cc":["chromium-reviews@chromium.org","pam+watch@chromium.org","darin-cc@chromium.org"],"reviewers":["michaeln@chromium.org","ericu@chromium.org"],"messages":[{"sender":"michaeln@chromium.org","recipients":["kinuko@chromium.org","michaeln@chromium.org","ericu@chromium.org","chromium-reviews@chromium.org","pam+watch@chromium.org","darin-cc@chromium.org"],"text":"I like the encapsulation.\n\nhttp://codereview.chromium.org/4879001/diff/4001/webkit/tools/test_shell/simple_file_system.cc\nFile webkit/tools/test_shell/simple_file_system.cc (right):\n\nhttp://codereview.chromium.org/4879001/diff/4001/webkit/tools/test_shell/simple_file_system.cc#newcode114\nwebkit/tools/test_shell/simple_file_system.cc:114: // (which in turn deletes this dispatcher instance).\n~SimpleFileSystemCallbackDispatcher() invokes RemoveOperation(), in that code path is operation_ ever holding a non-NULL ptr? Could that call in the dtor be changed to a DCHECK(!operation_.get())?","disapproval":false,"date":"2010-11-13 00:16:42.440130","approval":false},{"sender":"kinuko@chromium.org","recipients":["kinuko@chromium.org","michaeln@chromium.org","ericu@chromium.org","chromium-reviews@chromium.org","pam+watch@chromium.org","darin-cc@chromium.org"],"text":"http://codereview.chromium.org/4879001/diff/4001/webkit/tools/test_shell/simple_file_system.cc\nFile webkit/tools/test_shell/simple_file_system.cc (right):\n\nhttp://codereview.chromium.org/4879001/diff/4001/webkit/tools/test_shell/simple_file_system.cc#newcode114\nwebkit/tools/test_shell/simple_file_system.cc:114: // (which in turn deletes this dispatcher instance).\nOn 2010/11/13 00:16:42, michaeln wrote:\n> ~SimpleFileSystemCallbackDispatcher() invokes RemoveOperation(), in that code\n> path is operation_ ever holding a non-NULL ptr? Could that call in the dtor be\n> changed to a DCHECK(!operation_.get())?\n\nSounds right.  It can be changed.  Btw I have another patch trying to cleanup Operation lifetime issues -- the patch tries to make Operation self-destructed.  If you have time can you also take a look at this one?  (It's not in a hurry)\nhttp://codereview.chromium.org/4821005/","disapproval":false,"date":"2010-11-13 00:38:14.528036","approval":false},{"sender":"ericu@chromium.org","recipients":["kinuko@chromium.org","michaeln@chromium.org","ericu@chromium.org","chromium-reviews@chromium.org","pam+watch@chromium.org","darin-cc@chromium.org"],"text":"Other than Michael's DCHECK, this looks good to me.","disapproval":false,"date":"2010-11-17 02:02:20.667456","approval":false},{"sender":"kinuko@chromium.org","recipients":["kinuko@chromium.org","michaeln@chromium.org","ericu@chromium.org","chromium-reviews@chromium.org","pam+watch@chromium.org","darin-cc@chromium.org"],"text":"Added the DCHECK.\n\nAlso made the callback dispatcher hold WeakPtr of SimpleFileSystem, as this patch may also cause the (potential) problem pointed out by michael on another patch.\n\nhttp://codereview.chromium.org/4879001/diff/4001/webkit/tools/test_shell/simple_file_system.cc\nFile webkit/tools/test_shell/simple_file_system.cc (right):\n\nhttp://codereview.chromium.org/4879001/diff/4001/webkit/tools/test_shell/simple_file_system.cc#newcode114\nwebkit/tools/test_shell/simple_file_system.cc:114: // (which in turn deletes this dispatcher instance).\nOn 2010/11/13 00:16:42, michaeln wrote:\n> ~SimpleFileSystemCallbackDispatcher() invokes RemoveOperation(), in that code\n> path is operation_ ever holding a non-NULL ptr? Could that call in the dtor be\n> changed to a DCHECK(!operation_.get())?\n\nDone.","disapproval":false,"date":"2010-11-19 20:44:38.806068","approval":false},{"sender":"ericu@chromium.org","recipients":["kinuko@chromium.org","michaeln@chromium.org","ericu@chromium.org","chromium-reviews@chromium.org","pam+watch@chromium.org","darin-cc@chromium.org"],"text":"http://codereview.chromium.org/4879001/diff/15001/webkit/tools/test_shell/simple_file_system.cc\nFile webkit/tools/test_shell/simple_file_system.cc (right):\n\nhttp://codereview.chromium.org/4879001/diff/15001/webkit/tools/test_shell/simple_file_system.cc#newcode71\nwebkit/tools/test_shell/simple_file_system.cc:71: if (file_system_) {\nAs discussed, change these ifs to DCHECKs, and you're good to go.","disapproval":false,"date":"2010-11-23 02:09:51.890862","approval":false}],"owner_email":"kinuko@chromium.org","private":false,"base_url":"svn://svn.chromium.org/chrome/trunk/src","owner":"kinuko","subject":"Extend simple_file_system to use SandboxedFileSystemOperation","created":"2010-11-12 07:29:13.784763","patchsets":[4001,9001,15001,44001],"modified":"2011-05-20 02:33:01.922425","closed":true,"commit":false,"issue":4879001}