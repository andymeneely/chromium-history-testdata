{"description":"Make the pnacl translator files in chrome depend on the pnacl_translator stamp.\r\n\r\nOtherwise, the pnacl files won't get re-layed out when only\r\nthe pnacl translator files have changed.\r\n\r\nBUG=none\r\nTEST=\r\n(1) ninja -C out/Release pnacl_support_extension\r\n(2) touch the SOURCE_SHA1 file (or change TOOLS_REVISION + hashes, and run gclient runhooks)\r\n(3) ninja again (gets re-layed out)\r\n(4) ninja again (nothing happens)\n\nCommitted: https://src.chromium.org/viewvc/chrome?view=rev&revision=189988","cc":["chromium-reviews@chromium.org","aa@chromium.org","chromium-apps-reviews@chromium.org"],"reviewers":["dschuff@chromium.org","mseaborn@chromium.org","jvoung@google.com"],"messages":[{"sender":"jvoung@chromium.org","recipients":["jvoung@chromium.org","dschuff@chromium.org","mseaborn@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","chromium-apps-reviews@chromium.org"],"text":"","disapproval":false,"date":"2013-03-22 16:04:55.691370","approval":false},{"sender":"mseaborn@chromium.org","recipients":["jvoung@chromium.org","dschuff@chromium.org","mseaborn@chromium.org","chromium-reviews@chromium.org","aa@chromium.org","chromium-apps-reviews@chromium.org"],"text":"https://codereview.chromium.org/12578018/diff/1/ppapi/native_client/src/untrusted/pnacl_support_extension/pnacl_support_extension.gyp\nFile ppapi/native_client/src/untrusted/pnacl_support_extension/pnacl_support_extension.gyp (right):\n\nhttps://codereview.chromium.org/12578018/diff/1/ppapi/native_client/src/untrusted/pnacl_support_extension/pnacl_support_extension.gyp#newcode31\nppapi/native_client/src/untrusted/pnacl_support_extension/pnacl_support_extension.gyp:31: '<(DEPTH)/native_client/toolchain/.tars/naclsdk_pnacl_translator.tgz',\nI don't think pnacl_component_crx_gen.py reads this .tgz file, does it?  If it doesn't, then this doesn't seem like the right dependency to declare.","disapproval":false,"date":"2013-03-22 16:25:50.475810","approval":false},{"sender":"jvoung@google.com","recipients":["jvoung@chromium.org","dschuff@chromium.org","mseaborn@chromium.org","jvoung@google.com","chromium-reviews@chromium.org","aa@chromium.org","chromium-apps-reviews@chromium.org"],"text":"https://codereview.chromium.org/12578018/diff/1/ppapi/native_client/src/untrusted/pnacl_support_extension/pnacl_support_extension.gyp\nFile ppapi/native_client/src/untrusted/pnacl_support_extension/pnacl_support_extension.gyp (right):\n\nhttps://codereview.chromium.org/12578018/diff/1/ppapi/native_client/src/untrusted/pnacl_support_extension/pnacl_support_extension.gyp#newcode31\nppapi/native_client/src/untrusted/pnacl_support_extension/pnacl_support_extension.gyp:31: '<(DEPTH)/native_client/toolchain/.tars/naclsdk_pnacl_translator.tgz',\nOn 2013/03/22 16:25:50, Mark Seaborn wrote:\n> I don't think pnacl_component_crx_gen.py reads this .tgz file, does it?  If it\n> doesn't, then this doesn't seem like the right dependency to declare.\n\nIt doesn't read the .tgz file itself, but it reads the files from various subdirs in the native_client/toolchain/pnacl_translator directory. The content of native_client/toolchain/pnacl_translator comes from that tarball though.\n\nIs there a way to make a recursive wildcard dependency on the contents of native_client/toolchain/pnacl_translator?","disapproval":false,"date":"2013-03-22 16:28:49.809990","approval":false},{"sender":"mseaborn@chromium.org","recipients":["reply@chromiumcodereview-hr.appspotmail.com"],"text":"On 22 March 2013 09:28, <jvoung@google.com> wrote:\r\n\r\n>\r\n> https://codereview.chromium.**org/12578018/diff/1/ppapi/**\r\n> native_client/src/untrusted/**pnacl_support_extension/pnacl_**\r\n> support_extension.gyp<https://codereview.chromium.org/12578018/diff/1/ppapi/native_client/src/untrusted/pnacl_support_extension/pnacl_support_extension.gyp>\r\n> File\r\n> ppapi/native_client/src/**untrusted/pnacl_support_**\r\n> extension/pnacl_support_**extension.gyp\r\n> (right):\r\n>\r\n> https://codereview.chromium.**org/12578018/diff/1/ppapi/**\r\n> native_client/src/untrusted/**pnacl_support_extension/pnacl_**\r\n> support_extension.gyp#**newcode31<https://codereview.chromium.org/12578018/diff/1/ppapi/native_client/src/untrusted/pnacl_support_extension/pnacl_support_extension.gyp#newcode31>\r\n> ppapi/native_client/src/**untrusted/pnacl_support_**\r\n> extension/pnacl_support_**extension.gyp:31:\r\n> '<(DEPTH)/native_client/**toolchain/.tars/naclsdk_pnacl_**translator.tgz',\r\n> On 2013/03/22 16:25:50, Mark Seaborn wrote:\r\n>\r\n>> I don't think pnacl_component_crx_gen.py reads this .tgz file, does it?\r\n>>  If it\r\n>>\r\n> doesn't, then this doesn't seem like the right dependency to declare.\r\n>>\r\n>\r\n> It doesn't read the .tgz file itself, but it reads the files from\r\n> various subdirs in the native_client/toolchain/pnacl_**translator\r\n> directory. The content of native_client/toolchain/pnacl_**translator comes\r\n> from that tarball though.\r\n>\r\n\r\nWhat unpacks native_client/toolchain/pnacl_translator these days?\r\n\r\nIf it's the gclient hooks, pnacl_support_extension should declare a direct\r\ndependency on a stamp file in native_client/toolchain/pnacl_translator.\r\n\r\nIf it's a Gyp step, pnacl_support_extension should declare a dependency on\r\nthe Gyp step.  But I don't think it is, because Gyp steps shouldn't be\r\nwriting to native_client/toolchain/pnacl_translator (since that's in the\r\nsource tree).\r\n\r\n\r\n> Is there a way to make a recursive wildcard dependency on the contents\r\n> of native_client/toolchain/pnacl_translator?\r\n>\r\n\r\nI'm pretty sure there isn't a way to do that in Gyp:  make, ninja, MSVS,\r\nxcodebuild, etc. won't support that.  You have to use stamp files instead.\r\n\r\nMark\r\n","disapproval":false,"date":"2013-03-22 16:37:47.300600","approval":false},{"sender":"jvoung@google.com","recipients":["jvoung@chromium.org","dschuff@chromium.org","mseaborn@chromium.org","jvoung@google.com","chromium-reviews@chromium.org","aa@chromium.org","chromium-apps-reviews@chromium.org"],"text":"On 2013/03/22 16:37:47, Mark Seaborn wrote:\n> On 22 March 2013 09:28, <mailto:jvoung@google.com> wrote:\n> \n> >\n> > https://codereview.chromium.**org/12578018/diff/1/ppapi/**\n> > native_client/src/untrusted/**pnacl_support_extension/pnacl_**\n> >\n> support_extension.gyp<https://codereview.chromium.org/12578018/diff/1/ppapi/native_client/src/untrusted/pnacl_support_extension/pnacl_support_extension.gyp>\n> > File\n> > ppapi/native_client/src/**untrusted/pnacl_support_**\n> > extension/pnacl_support_**extension.gyp\n> > (right):\n> >\n> > https://codereview.chromium.**org/12578018/diff/1/ppapi/**\n> > native_client/src/untrusted/**pnacl_support_extension/pnacl_**\n> >\n> support_extension.gyp#**newcode31<https://codereview.chromium.org/12578018/diff/1/ppapi/native_client/src/untrusted/pnacl_support_extension/pnacl_support_extension.gyp#newcode31>\n> > ppapi/native_client/src/**untrusted/pnacl_support_**\n> > extension/pnacl_support_**extension.gyp:31:\n> > '<(DEPTH)/native_client/**toolchain/.tars/naclsdk_pnacl_**translator.tgz',\n> > On 2013/03/22 16:25:50, Mark Seaborn wrote:\n> >\n> >> I don't think pnacl_component_crx_gen.py reads this .tgz file, does it?\n> >>  If it\n> >>\n> > doesn't, then this doesn't seem like the right dependency to declare.\n> >>\n> >\n> > It doesn't read the .tgz file itself, but it reads the files from\n> > various subdirs in the native_client/toolchain/pnacl_**translator\n> > directory. The content of native_client/toolchain/pnacl_**translator comes\n> > from that tarball though.\n> >\n> \n> What unpacks native_client/toolchain/pnacl_translator these days?\n> \n> If it's the gclient hooks, pnacl_support_extension should declare a direct\n> dependency on a stamp file in native_client/toolchain/pnacl_translator.\n\nIt's runhooks. I changed it to depend on the SOURCE_SHA1 stamp file that native_client/build/download_utils.py writes into the directory.\n\n\n\n> \n> If it's a Gyp step, pnacl_support_extension should declare a dependency on\n> the Gyp step.  But I don't think it is, because Gyp steps shouldn't be\n> writing to native_client/toolchain/pnacl_translator (since that's in the\n> source tree).\n> \n> \n> > Is there a way to make a recursive wildcard dependency on the contents\n> > of native_client/toolchain/pnacl_translator?\n> >\n> \n> I'm pretty sure there isn't a way to do that in Gyp:  make, ninja, MSVS,\n> xcodebuild, etc. won't support that.  You have to use stamp files instead.\n> \n> Mark","disapproval":false,"date":"2013-03-22 16:44:41.206890","approval":false},{"sender":"mseaborn@chromium.org","recipients":["jvoung@chromium.org","dschuff@chromium.org","mseaborn@chromium.org","jvoung@google.com","chromium-reviews@chromium.org","aa@chromium.org","chromium-apps-reviews@chromium.org"],"text":"LGTM","disapproval":false,"date":"2013-03-22 16:49:47.534080","approval":true},{"sender":"commit-bot@chromium.org","recipients":["jvoung@chromium.org","dschuff@chromium.org","mseaborn@chromium.org","jvoung@google.com","chromium-reviews@chromium.org","aa@chromium.org","chromium-apps-reviews@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/jvoung@chromium.org/12578018/10001","disapproval":false,"date":"2013-03-22 18:23:10.681620","approval":false},{"sender":"jvoung@chromium.org","recipients":["jvoung@chromium.org","dschuff@chromium.org","mseaborn@chromium.org","jvoung@google.com","chromium-reviews@chromium.org","aa@chromium.org","chromium-apps-reviews@chromium.org"],"text":"Committed patchset #2 manually as r189988 (presubmit successful).","disapproval":false,"date":"2013-03-23 04:48:50.139580","approval":false}],"owner_email":"jvoung@chromium.org","private":false,"base_url":"svn://svn.chromium.org/chrome/trunk/src","owner":"jvoung (cr)","subject":"Make the pnacl translator files in chrome depend on the pnacl_translator stamp.","created":"2013-03-22 15:57:30.606980","patchsets":[1,10001],"modified":"2013-03-23 04:48:50.232570","closed":true,"commit":false,"issue":12578018}