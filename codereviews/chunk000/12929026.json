{"description":"Load sync token upon login for locally managed user\n\n\nBUG=176277\nTBR=brettw@chromium.org\n\nCommitted: https://src.chromium.org/viewvc/chrome?view=rev&revision=190464","cc":["chromium-reviews@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","nkostylev+watch@chromium.org","davemoore+watch@chromium.org"],"reviewers":["nkostylev@chromium.org","brettw@chromium.org"],"messages":[{"sender":"antrim@chromium.org","recipients":["antrim@chromium.org","nkostylev@chromium.org","chromium-reviews@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","nkostylev+watch@chromium.org","davemoore+watch@chromium.org"],"text":"","disapproval":false,"date":"2013-03-22 16:29:48.427990","approval":false},{"sender":"nkostylev@chromium.org","recipients":["antrim@chromium.org","nkostylev@chromium.org","chromium-reviews@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","nkostylev+watch@chromium.org","davemoore+watch@chromium.org"],"text":"lgtm with nits\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/login_utils.cc\nFile chrome/browser/chromeos/login/login_utils.cc (right):\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/login_utils.cc#newcode273\nchrome/browser/chromeos/login/login_utils.cc:273: login_host);\nnit: Please align params\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_creation_flow.h\nFile chrome/browser/chromeos/login/managed/locally_managed_user_creation_flow.h (right):\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_creation_flow.h#newcode28\nchrome/browser/chromeos/login/managed/locally_managed_user_creation_flow.h:28: LoginDisplayHost* host) OVERRIDE;\nnit: Alignment\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc\nFile chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc (right):\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc#newcode33\nchrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc:33: void LocallyManagedUserLoginFlow::RegisterPrefs(PrefRegistrySimple* registry) {\nAs discussed makes sense to comment code that stores token in Prefs for now.\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc#newcode52\nchrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc:52: return true;\nAs far as I could see this will lead to skipping user image selection screen which now still is part of LMU sign in flow.\nMakes sense to return false here till this step is moved to user creation part?\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc#newcode68\nchrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc:68: \nnit: Remove empty line.\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc#newcode70\nchrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc:70: \nnit: Remove empty line.\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc#newcode85\nchrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc:85: PrefService* prefs = profile_->GetPrefs();\nnit: Lines 85-87 should be commented.\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc#newcode93\nchrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc:93: // ToDo(antrim): Propagate token when we know API.\nnit: TODO format is as follows\n\n// TODO(ldap): Capitalized sentence comment here.\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc#newcode104\nchrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc:104: \nnit: drop empty line\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc#newcode119\nchrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc:119: \nnit: drop empty line\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.h\nFile chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.h (right):\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.h#newcode15\nchrome/browser/chromeos/login/managed/locally_managed_user_login_flow.h:15: // UserFlow implementation for loggin in locally managed user.\nnit: signing in\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/user_flow.cc\nFile chrome/browser/chromeos/login/user_flow.cc (right):\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/user_flow.cc#newcode18\nchrome/browser/chromeos/login/user_flow.cc:18: }\nnit: // namespace\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/user_flow.cc#newcode42\nchrome/browser/chromeos/login/user_flow.cc:42: LoginDisplayHost* host) {\nnit: align\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/user_flow.h\nFile chrome/browser/chromeos/login/user_flow.h (right):\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/user_flow.h#newcode49\nchrome/browser/chromeos/login/user_flow.h:49: virtual void DeleteSoon();\nnit: Rename to smth like UnregisterFlow()\n\nhttps://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/user_flow.h#newcode50\nchrome/browser/chromeos/login/user_flow.h:50: virtual std::string UserId();\nuser_id() {\n  return user_ud_;\n}","disapproval":false,"date":"2013-03-25 12:16:23.148650","approval":true},{"sender":"antrim@chromium.org","recipients":["antrim@chromium.org","nkostylev@chromium.org","chromium-reviews@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","nkostylev+watch@chromium.org","davemoore+watch@chromium.org"],"text":"On 2013/03/25 12:16:23, Nikita Kostylev wrote:\n> lgtm with nits\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/login_utils.cc\n> File chrome/browser/chromeos/login/login_utils.cc (right):\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/login_utils.cc#newcode273\n> chrome/browser/chromeos/login/login_utils.cc:273: login_host);\n> nit: Please align params\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_creation_flow.h\n> File chrome/browser/chromeos/login/managed/locally_managed_user_creation_flow.h\n> (right):\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_creation_flow.h#newcode28\n> chrome/browser/chromeos/login/managed/locally_managed_user_creation_flow.h:28:\n> LoginDisplayHost* host) OVERRIDE;\n> nit: Alignment\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc\n> File chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc\n> (right):\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc#newcode33\n> chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc:33:\n> void LocallyManagedUserLoginFlow::RegisterPrefs(PrefRegistrySimple* registry) {\n> As discussed makes sense to comment code that stores token in Prefs for now.\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc#newcode52\n> chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc:52:\n> return true;\n> As far as I could see this will lead to skipping user image selection screen\n> which now still is part of LMU sign in flow.\n> Makes sense to return false here till this step is moved to user creation part?\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc#newcode68\n> chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc:68: \n> nit: Remove empty line.\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc#newcode70\n> chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc:70: \n> nit: Remove empty line.\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc#newcode85\n> chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc:85:\n> PrefService* prefs = profile_->GetPrefs();\n> nit: Lines 85-87 should be commented.\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc#newcode93\n> chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc:93: //\n> ToDo(antrim): Propagate token when we know API.\n> nit: TODO format is as follows\n> \n> // TODO(ldap): Capitalized sentence comment here.\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc#newcode104\n> chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc:104: \n> nit: drop empty line\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc#newcode119\n> chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.cc:119: \n> nit: drop empty line\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.h\n> File chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.h\n> (right):\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.h#newcode15\n> chrome/browser/chromeos/login/managed/locally_managed_user_login_flow.h:15: //\n> UserFlow implementation for loggin in locally managed user.\n> nit: signing in\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/user_flow.cc\n> File chrome/browser/chromeos/login/user_flow.cc (right):\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/user_flow.cc#newcode18\n> chrome/browser/chromeos/login/user_flow.cc:18: }\n> nit: // namespace\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/user_flow.cc#newcode42\n> chrome/browser/chromeos/login/user_flow.cc:42: LoginDisplayHost* host) {\n> nit: align\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/user_flow.h\n> File chrome/browser/chromeos/login/user_flow.h (right):\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/user_flow.h#newcode49\n> chrome/browser/chromeos/login/user_flow.h:49: virtual void DeleteSoon();\n> nit: Rename to smth like UnregisterFlow()\n> \n> https://codereview.chromium.org/12929026/diff/1/chrome/browser/chromeos/login/user_flow.h#newcode50\n> chrome/browser/chromeos/login/user_flow.h:50: virtual std::string UserId();\n> user_id() {\n>   return user_ud_;\n> }\n\nFixed all nits.","disapproval":false,"date":"2013-03-25 13:33:42.308580","approval":false},{"sender":"commit-bot@chromium.org","recipients":["antrim@chromium.org","nkostylev@chromium.org","chromium-reviews@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","nkostylev+watch@chromium.org","davemoore+watch@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/antrim@chromium.org/12929026/5002","disapproval":false,"date":"2013-03-25 13:37:22.916010","approval":false},{"sender":"commit-bot@chromium.org","recipients":["antrim@chromium.org","nkostylev@chromium.org","chromium-reviews@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","nkostylev+watch@chromium.org","davemoore+watch@chromium.org"],"text":"Presubmit check for 12929026-5002 failed and returned exit status 1.\n\nINFO:root:Found 9 file(s).\n\nRunning presubmit commit checks ...\nRunning /b/commit-queue/workdir/chromium/PRESUBMIT.py\nRunning /b/commit-queue/workdir/chromium/chrome/PRESUBMIT.py\n\n** Presubmit ERRORS **\nMissing LGTM from an OWNER for these files:\n    chrome/chrome_browser_chromeos.gypi\n\nPresubmit checks took 1.8s to calculate.","disapproval":false,"date":"2013-03-25 13:37:27.926330","approval":false},{"sender":"antrim@chromium.org","recipients":["antrim@chromium.org","nkostylev@chromium.org","brettw@chromium.org","chromium-reviews@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","nkostylev+watch@chromium.org","davemoore+watch@chromium.org"],"text":"+brettw for rubber-stamping chrome/chrome_browser_chromeos.gypi.","disapproval":false,"date":"2013-03-25 13:43:23.550920","approval":false},{"sender":"commit-bot@chromium.org","recipients":["antrim@chromium.org","nkostylev@chromium.org","brettw@chromium.org","chromium-reviews@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","nkostylev+watch@chromium.org","davemoore+watch@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/antrim@chromium.org/12929026/5002","disapproval":false,"date":"2013-03-25 13:43:34.182640","approval":false},{"sender":"commit-bot@chromium.org","recipients":["antrim@chromium.org","nkostylev@chromium.org","brettw@chromium.org","chromium-reviews@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","nkostylev+watch@chromium.org","davemoore+watch@chromium.org"],"text":"Sorry for I got bad news for ya.\nCompile failed with a clobber build on linux_chromeos_clang.\nhttp://build.chromium.org/p/tryserver.chromium/buildstatus?builder=linux_chromeos_clang&number=17392\nYour code is likely broken or HEAD is junk. Please ensure your\ncode is not broken then alert the build sheriffs.\nLook at the try server FAQ for more details.","disapproval":false,"date":"2013-03-25 14:13:52.564300","approval":false},{"sender":"commit-bot@chromium.org","recipients":["antrim@chromium.org","nkostylev@chromium.org","brettw@chromium.org","chromium-reviews@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","nkostylev+watch@chromium.org","davemoore+watch@chromium.org"],"text":"CQ is trying da patch. Follow status at\nhttps://chromium-status.appspot.com/cq/antrim@chromium.org/12929026/7012","disapproval":false,"date":"2013-03-25 16:27:11.299630","approval":false},{"sender":"brettw@chromium.org","recipients":["antrim@chromium.org","nkostylev@chromium.org","brettw@chromium.org","chromium-reviews@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","nkostylev+watch@chromium.org","davemoore+watch@chromium.org"],"text":".gypi lgtm stubber-ramp","disapproval":false,"date":"2013-03-25 17:21:10.627820","approval":true},{"sender":"commit-bot@chromium.org","recipients":["antrim@chromium.org","nkostylev@chromium.org","brettw@chromium.org","chromium-reviews@chromium.org","oshima+watch@chromium.org","stevenjb+watch@chromium.org","nkostylev+watch@chromium.org","davemoore+watch@chromium.org"],"text":"Change committed as 190464","disapproval":false,"date":"2013-03-25 20:07:02.746710","approval":false}],"owner_email":"antrim@chromium.org","private":false,"base_url":"svn://svn.chromium.org/chrome/trunk/src","owner":"Denis Kuznetsov","subject":"Load sync token upon login","created":"2013-03-22 16:26:23.472880","patchsets":[1,5002,7012],"modified":"2013-03-25 20:07:02.832540","closed":true,"commit":false,"issue":12929026}